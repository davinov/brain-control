{"version":3,"sources":["webpack:///./src/lib/field-play/bus.js","webpack:///./src/components/Session.vue?6811","webpack:///./src/components/Session.vue?8861","webpack:///./src/components/Session.vue","webpack:///./src/components/Visualization.vue?f9ff","webpack:///./src/components/Visualization.vue?2bc3","webpack:///./src/components/Visualization.vue","webpack:///./src/components/ParticlesVisualization.vue?61c6","webpack:///./src/components/ParticlesVisualization.vue","webpack:///./src/lib/field-play/gl-utils.js","webpack:///./src/lib/field-play/programs/colorModes.js","webpack:///./src/lib/field-play/wrapVectorField.js","webpack:///./src/lib/field-play/isSmallScreen.js","webpack:///./src/lib/field-play/appState.js","webpack:///./src/lib/field-play/programs/screenProgram.js","webpack:///./src/lib/field-play/shaderGraph/parts/decodeFloatRGBA.js","webpack:///./src/lib/field-play/shaderGraph/BaseShaderNode.js","webpack:///./src/lib/field-play/shaderGraph/parts/simplex-noise.js","webpack:///./src/lib/field-play/shaderGraph/customInput.js","webpack:///./src/lib/field-play/shaderGraph/UserDefinedVelocityFunction.js","webpack:///./src/lib/field-play/shaderGraph/RungeKuttaIntegrator.js","webpack:///./src/lib/field-play/shaderGraph/shaderBasedColor.js","webpack:///./src/lib/field-play/shaderGraph/DrawParticleGraph.js","webpack:///./src/lib/field-play/shaderGraph/parts/encodeFloatRGBA.js","webpack:///./src/lib/field-play/shaderGraph/TexturePositionNode.js","webpack:///./src/lib/field-play/shaderGraph/renderNodes.js","webpack:///./src/lib/field-play/shaderGraph/PanzoomTransform.js","webpack:///./src/lib/field-play/shaderGraph/updatePositionGraph.js","webpack:///./src/lib/field-play/utils/floatPacking.js","webpack:///./src/lib/field-play/utils/makeStatCounter.js","webpack:///./src/lib/field-play/programs/colorProgram.js","webpack:///./src/lib/field-play/utils/textureCollection.js","webpack:///./src/lib/field-play/programs/updatePositionProgram.js","webpack:///./src/lib/field-play/config.js","webpack:///./src/lib/field-play/programs/audioProgram.js","webpack:///./src/lib/field-play/programs/drawParticlesProgram.js","webpack:///./src/lib/field-play/utils/request.js","webpack:///./src/lib/field-play/editor/fetchGLSL.js","webpack:///./src/lib/field-play/editor/pragmaParser.js","webpack:///./src/lib/field-play/editor/getParsedVectorFieldFunction.js","webpack:///./src/lib/field-play/editor/vectorFieldState.js","webpack:///./src/lib/field-play/programs/inputs/inputCollection.js","webpack:///./src/lib/field-play/programs/inputs/loadTexture.js","webpack:///./src/lib/field-play/programs/inputs/imageInput.js","webpack:///./src/lib/field-play/createInputsModel.js","webpack:///./src/lib/field-play/scene.js","webpack:///./src/components/FieldVisualization.vue?bca2","webpack:///./src/components/FieldVisualization.vue","webpack:///./src/components/MuseRecorder.vue?0ffa","webpack:///./src/components/MuseRecorder.vue?ee2a","webpack:///./src/components/MuseRecorder.vue","webpack:///./src/App.vue?eb80","webpack:///./src/App.vue?4f8e","webpack:///./src/App.vue","webpack:///./src/store.ts","webpack:///./src/registerServiceWorker.ts","webpack:///./src/main.ts"],"names":["eventify","__webpack_require__","module","exports","Session_Session","serie","Object","d3_shape","this","sessionData","map","v","i","_this","xScale","yScale","blob","Blob","JSON","stringify","type","exportDate","Date","filename","concat","toISOString","FileSaver","keys","d3_scale","domain","length","range","width","height","vue_property_decorator_umd","__decorate","default","__metadata","Array","prototype","Number","Session_render","_vm","_h","$createElement","_c","_self","staticClass","attrs","_l","key","class","toLowerCase","d","lineForSerie","_v","_s","staticStyle","flex","on","click","$event","saveAsJSON","staticRenderFns","injectStyle","context","__vue_template_functional__","__vue_styles__","__vue_scopeId__","__vue_module_identifier__","Component","component_normalizer","components_Session","src_components_Session","Visualization_Vizualisation","Vizualisation","tk1","k1","tk2","k2","colors","targetVal","duration","start","now","interpolator","d3_interpolate","animate","t","_this2","requestAnimationFrame","_this3","y","_this4","brainWire","curve","tension","wirePoints","k","d3_ease","masterPoints","leftPoint","leftMiddlePoint","middlePoint","rightMiddlePoint","rightPoint","wireWidth","points","p","reverse","push","verticalTranslation","Math","max","radius","circleOrSquareRatio","SQRT2","verticalSymetry","point","dy","sqrt","pow","Visualization___decorate","Visualization___metadata","Function","Visualization_render","id","in","stdDeviation","result","mode","values","in2","operator","brainWires","wire","filter","transform","originTranslation","fill","Visualization_staticRenderFns","Visualization_injectStyle","Visualization___vue_template_functional__","Visualization___vue_styles__","Visualization___vue_scopeId__","Visualization___vue_module_identifier__","Visualization_Component","Visualization","components_Visualization","CAMERA_DISTANCE","BOUNDS","X","Y","CIRCLE_RADIUS","POINTS_COUNT","POINTS_RENEWAL_CHANCE","ParticlesVisualization_ParticlesVizualisation","scene","three_module","renderer","preserveDrawingBuffer","autoClearColor","camera","window","innerWidth","innerHeight","fadeMaterial","color","transparent","opacity","depthWrite","fadePlane","fadeMesh","cameraGroup","add","translateZ","position","z","renderOrder","material","size","vertexColors","createCanvasMaterial","geometry","lodash_default","a","times","addRandomPoint","random","vertices","randomPositionOnPlane","setSize","$el","appendChild","domElement","vertice","set","x","verticesNeedUpdate","isNaN","particle","h","horizontalMovement","c","circularMovement","s","squareMovement","weightedMovementAlongAxis","circleWeigth","squareWeigth","horizontalWeigth","movement","moveParticle","particleColor","dX","dY","dZ","colorsNeedUpdate","render","continue","matCanvas","document","createElement","matContext","getContext","texture","center","beginPath","arc","PI","closePath","fillStyle","needsUpdate","sin","r","θ","atan2","dr","dθ","cos","dx","paused","lastAnimationId","cancelAnimationFrame","undefined","pause","dispose","ParticlesVisualization___decorate","required","ParticlesVisualization___metadata","Boolean","__vue_render__","__vue_static_render_fns__","ParticlesVisualization_injectStyle","ParticlesVisualization___vue_template_functional__","ParticlesVisualization___vue_styles__","ParticlesVisualization___vue_scopeId__","ParticlesVisualization___vue_module_identifier__","ParticlesVisualization_Component","ParticlesVisualization","components_ParticlesVisualization","gl_utils","createTexture","gl_utils_createTexture","bindFramebuffer","createProgram","createBuffer","bindAttribute","bindTexture","gl","unit","activeTexture","TEXTURE0","TEXTURE_2D","data","buffer","bindBuffer","ARRAY_BUFFER","bufferData","STATIC_DRAW","texParameteri","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","TEXTURE_MIN_FILTER","TEXTURE_MAG_FILTER","Uint8Array","texImage2D","RGBA","UNSIGNED_BYTE","framebuffer","FRAMEBUFFER","framebufferTexture2D","COLOR_ATTACHMENT0","attribute","numComponents","enableVertexAttribArray","vertexAttribPointer","FLOAT","vertexSource","fragmentSource","program","vertexShader","createShader","VERTEX_SHADER","fragmentShader","FRAGMENT_SHADER","attachShader","linkProgram","getProgramParameter","LINK_STATUS","Error","getProgramInfoLog","wrapper","unload","numAttributes","ACTIVE_ATTRIBUTES","getActiveAttrib","name","getAttribLocation","numUniforms","ACTIVE_UNIFORMS","uniform","getActiveUniform","getUniformLocation","deleteProgram","source","shader","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","colorModes","UNIFORM","VELOCITY","ANGLE","CUSTOM","wrapVectorField","field","isSmallScreen","pendingSave","qs","query_state_default","useSearch","rewriteHashToSearch","currentState","defaultVectorField","defaults","timeStep","dropProbability","particleCount","fadeout","colorMode","settingsPanel","collapsed","appState","saveBBox","getBBox","makeBBox","getQS","saveCode","getCode","appState_getCode","getDefaultCode","getDropProbability","appState_getDropProbability","setDropProbability","appState_setDropProbability","getIntegrationTimeStep","setIntegrationTimeStep","getParticleCount","setParticleCount","getFadeout","setFadeout","getColorMode","appState_getColorMode","setColorMode","appState_setColorMode","getColorFunction","appState_getColorFunction","setColorFunction","appState_setColorFunction","get","defined","cm","colorFunction","cf","fo","pc","dt","clamp","cx","cy","w","bboxDefined","w2","h2","minX","round","maxX","minY","maxY","bbox","arguments","clearTimeout","setTimeout","vfCode","oldCode","code","number","isFinite","min","onChange","bus_default","fire","NO_TRANSFORM","scale","makeScreenProgram","ctx","screenTexture","backgroundTexture","canvasRect","boundBoxTextureTransform","lastRenderedBoundingBox","updateScreenTextures","screenProgram","getScreenVertexShader","getScreenFragmentShader","api","fadeOutLastFrame","renderCurrentScreen","boundingBoxUpdated","viewport","drawTexture","fadeOpacity","saveLastBbox","enable","BLEND","blendFunc","SRC_ALPHA","DST_ALPHA","clearColor","backgroundColor","g","b","clear","COLOR_BUFFER_BIT","disable","temp","audioTexture","emptyPixels","deleteTexture","NEAREST","textureTransform","useProgram","quadBuffer","a_pos","screenTextureUnit","uniform1i","u_screen","uniform1f","u_opacity_border","u_opacity","uniform3f","u_transform","drawArrays","TRIANGLES","decodeFloatRGBA_code","decodeFloatRGBA","BaseShaderNode_BaseShaderNode","BaseShaderNode","classCallCheck_default","simplex_noise_code","simplex_noise","getInputUniforms","UserDefinedVelocityFunction_UserDefinedVelocityFunction","UserDefinedVelocityFunction","updateCode","possibleConstructorReturn_default","__proto__","getPrototypeOf","call","newUpdateCode","RungeKuttaIntegrator_RungeKuttaIntegrator","RungeKuttaIntegrator","shaderBasedColor","colorCode","udf","integrate","getVariables","getMain","getMethods","getDefines","getFunctions","getColorFunctionBody","DrawParticleGraph_DrawParticleGraph","DrawParticleGraph","decodePositions","textureBasedPosition","colorParts","methods","addMethods","main","addMain","join","producer","array","encodeFloatRGBA_code","encodeFloatRGBA","TexturePositionNode_TexturePosition","TexturePosition","isDecode","renderNodes","nodes","forEach","node","addToCode","getMainBody","line","PanzoomTransform_PanzoomTransform","PanzoomTransform","config","decode","srcPosName","posName","updatePositionGraph_UpdatePositionGraph","UpdatePositionGraph","options","readStoredPosition","udfVelocity","integratePositions","dropParticles","updatePositionGraph_RandomParticleDropper","writeComputedPosition","panZoomDecode","panZoomEncode","velocityCode","setNewUpdateCode","floatPacking_encodeFloatRGBA","val","out","writeOffset","mantissa","mag","abs","exponent","floor","log2","exp2","floatPacking_decodeFloatRGBA","A","B","C","D","sign","exp","LN2","makeStatCounter","getMin","getMax","reset","POSITIVE_INFINITY","NEGATIVE_INFINITY","OUT_V_X","OUT_V_Y","colorProgram","velocity_y_texture","velocity_x_texture","particleStateResolution","pendingSpeedUpdate","numParticles","velocity_x","velocity_y","speedNeedsUpdate","velocityCounter","listenToEvents","updateParticlesPositions","updateParticlesCount","setColorMinMax","requestSpeedUpdate","off","disposeTextures","uniform2f","u_velocity_range","u_out_coordinate","readPixels","updateMinMax","vx","readFloat","vy","offset","textureCollection","dimensions","textures","index","textureInfo","particleState","bindTextures","assignProgramUniforms","tInfo","particlePositionShaderCodeBuilder","updatePositionProgram_updatePositionProgram","readTextures","writeTextures","updateProgram","pendingVectorLines","readVelocity","putVectorLinesRequestIntoQueue","prepareToDraw","vectorField","setCustomVectorField","fragment","getFragmentShader","vertex","getVertexShader","newProgram","inputs","updateBindings","u_rand_seed","frameSeed","u_h","integrationTimeStep","frame","cursor","uniform4f","clickX","clickY","hoverX","hoverY","u_min","u_max","u_drop_rate","writeInfo","processVectorLinesRequest","request","resolutionOfParticlesInRequest","resolution","texturesForRead","texturesForWrite","xStats","yStats","decoded_velocity_x","Float32Array","decoded_velocity_y","idx","updatePositionProgram_readFloat","vectorLineInfo","defaultConfig","isAudioEnabled","vectorLinesEnabled","FREE_TEXTURE_UNIT","showBindings","field_play_config","programs_audioProgram","audioProgram_audioProgram","audioWidth","audioHeight","audioBuffer","audioDirty","updateAudioBuffer","updateTextures","newBuffer","drawParticlesProgram","particleIndexBuffer","audioProgram","drawProgram","currentVectorField","updatePositionProgram","initPrograms","drawParticles","updateColorMode","initDrawProgram","drawGraph","vertexShaderCode","particleIndices","particleStateX","particleStateY","deleteBuffer","a_index","u_particles_res","POINTS","url","Promise","download","resolve","reject","req","XMLHttpRequest","updateProgress","e","lengthComputable","progress","loaded","total","percent","transferComplete","status","response","responseType","parse","transferFailed","transferCanceled","addEventListener","open","send","loadedLinks","Map","fetchGLSL","link","trimmed","trim","cachedResponse","then","pragmaInclude","nullCode","makePragmaParser","parsedLines","processLineByLine","pending","all","catch","error","lines","split","outputLines","currentIndex","processPragma","indexOf","include","substr","insertIndex","glslParser","check","log","errorCount","bind","oe","vectorFieldGlobals","getParsedVectorFieldFunction","vectorFieldCode","pragmaParseResult","parserResult","globals","parserError","diag","diagnostics","firstError","lineColumn","_lineOffsets","contents","column","substring","end","prefix","diagText","text","whitespace","errorDetail","isFloatError","createVectorFieldEditorState","parseCode","currentVectorFieldVersion","currentVectorFieldCode","loadCodeFromAppState","setCode","trySetNewCode","cancelled","updateErrorInfo","persistedCode","console","customCode","currentResult","capturedVersion","message","createInputCollection","currentProgram","boundInputs","bindInput","inputIndex","inputBinding","prevBinding","updateInputBinding","input","updateBinding","loadTexture","resolveTexture","rejectTexture","image","Image","crossOrigin","onload","onerror","reportError","src","err","level","internalFormat","srcFormat","srcType","isPowerOf2","generateMipmap","LINEAR","value","createImageInputBinding","callbacks","setTexture","handleError","loadedTexture","done","realIndex","createInputsModel","readInputsFromAppState","getInputs","addInput","inputNumber","vm","createInputElementViewModel","i0","pendingUpdate","immediate","setBinding","binding","INITIAL_SPEED","integrationTimeStepFromSpeed","speed","fadeOutFromSpeed","initScene","top","left","setWidthHeight","onResize","currentPanZoomTransform","DEPTH_TEST","STENCIL_TEST","lastAnimationFrame","lastAnimationFrameTime","createFramebuffer","isPaused","inputsModel","vectorFieldEditorState","nextFrame","stop","setPaused","getParticlesCount","setParticlesCount","setFadeOutSpeed","getFadeOutSpeed","getSpeed","setSpeed","setBackgroundColor","getCanvasRect","getBoundingBox","restoreBBox","parseInt","f","parseFloat","shouldPause","newParticleCount","updateBoundingBox","devicePixelRatio","canvas","style","removeEventListener","draw","timeSinceLastFrame","performanceRatio","correctedSpeed","drawScreen","ceil","E","clientX","clientY","FieldVisualization_FieldVizualisation","FieldVizualisation","ctxOptions","antialias","alpha","updateVectorField","updateColorFunction","remove","n","toFixed","GLSLcode","codeLines","circle","formatNumberforGLSL","squares","steadyK","FieldVisualization___decorate","FieldVisualization___metadata","FieldVisualization___vue_render__","FieldVisualization___vue_static_render_fns__","FieldVisualization_injectStyle","FieldVisualization___vue_template_functional__","FieldVisualization___vue_styles__","FieldVisualization___vue_scopeId__","FieldVisualization___vue_module_identifier__","FieldVisualization_Component","FieldVisualization","components_FieldVisualization","index_es","library","faBluetooth_default","faBluetoothB_default","faPlayCircle_default","faPauseCircle_default","faCaretSquareDown_default","faCaretSquareUp_default","MuseRecorder_MuseRecorder","MuseRecorder","connectionStatus","sessionInProgress","currentSession","sessionsDetailsOpened","museClient","muse","connect","startSession","subscribe","cS","currentSessionSubscription","relativeBandPowers","pipe","operators","sessions","band","power","session","bandSession","find","NaN","reduce","sumOfSessions","bandSessionValue","rbps","arbps","rbp","freeze","takeRight","ALPHA","apply","toConsumableArray_default","GAMMA","unsubscribe","stopSession","MuseRecorder___decorate","components","Session","FontAwesomeIcon","vue_fontawesome_default","MuseRecorder_render","muse-recorder__greeting--connected","font-size","muse-recorder__connection--connected","icon","disconnect","connectToMuse","directives","rawName","expression","modifiers","step","domProps","__r","_n","target","blur","$forceUpdate","_e","MuseRecorder_staticRenderFns","MuseRecorder_injectStyle","MuseRecorder___vue_template_functional__","MuseRecorder___vue_styles__","MuseRecorder___vue_scopeId__","MuseRecorder___vue_module_identifier__","MuseRecorder_Component","components_MuseRecorder","src_components_MuseRecorder","App_App","App___decorate","App_render","App_staticRenderFns","App_injectStyle","App___vue_template_functional__","App___vue_styles__","App___vue_scopeId__","App___vue_module_identifier__","App_Component","selectortype_script_index_0_src_App","src_App","vue_runtime_esm","use","vuex_esm","store","Store","state","mutations","actions","register_service_worker","ready","cached","updated","offline","_error","productionTip","$mount"],"mappings":"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","file":"js/app.e327be90.js","sourcesContent":["/**\n * A simple message bus. Facilitates uncoupled communication between\n * components of fieldplay.\n */\nvar eventify = require('ngraph.events');\n\nmodule.exports = eventify({});\n\n\n// WEBPACK FOOTER //\n// ./src/lib/field-play/bus.js","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport { Component, Vue, Prop } from 'vue-property-decorator';\nimport { AveragedRelativeBandPowers } from './MuseRecorder.vue';\nimport { line } from 'd3-shape';\nimport { scaleLinear } from 'd3-scale';\nimport { saveAs } from 'file-saver';\n\n@Component\nexport default class Session extends Vue {\n  @Prop({ default: [] })\n  sessionData: AveragedRelativeBandPowers[];\n  \n  @Prop({ default: 800 })\n  width: number;\n\n  @Prop({ default: 500 })\n  height: number;\n\n  get series(): string[] {\n    return Object.keys(this.sessionData[0] || {});\n  }\n\n  get xScale() {\n    return scaleLinear()\n      .domain([0, this.sessionData.length - 1])\n      .range([0, this.width]);\n  }\n\n  get yScale() {\n    return scaleLinear()\n      .domain([0, 0.5])\n      .range([this.height, 0]);\n  }\n\n  private lineForSerie(serie: string): string | null {\n    return line()(this.sessionData.map(\n      (v, i) => [\n        this.xScale(i),\n        this.yScale(v[serie])\n      ] as [number, number]\n    ));\n  }\n\n  private saveAsJSON(): void {\n    let blob = new Blob(\n      [JSON.stringify(this.sessionData, null, 2)],\n      {type: \"application/json;charset=utf-8\"}\n    );\n    let exportDate = new Date();\n    let filename = `muse-session-${exportDate.toISOString()}.json` \n    saveAs(blob, filename);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./node_modules/vue-loader/lib/selector.js?type=script&index=0!./src/components/Session.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"muse-recorder__session\"},[_c('svg',{staticClass:\"session__chart\",attrs:{\"width\":_vm.width,\"height\":_vm.height}},_vm._l((_vm.series),function(serie){return _c('path',{key:serie,class:['session__serie', 'session__serie--' + serie.toLowerCase()],attrs:{\"d\":_vm.lineForSerie(serie)}})})),_c('div',{staticClass:\"session__legend\"},_vm._l((_vm.series),function(serie){return _c('div',{key:serie,class:['session__legend__item', 'session__legend__item--' + serie.toLowerCase()]},[_c('div',{staticClass:\"session__legend__item__color\"}),_c('span',[_vm._v(_vm._s(serie))])])})),_c('button',{staticStyle:{\"flex\":\"none\",\"height\":\"2em\"},on:{\"click\":function($event){_vm.saveAsJSON()}}},[_vm._v(\"\\n    Export session to JSON file\\n  \")])])}\nvar staticRenderFns = []\nexport { render, staticRenderFns }\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-fc1651c8\",\"hasScoped\":true,\"optionsId\":\"0\",\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/components/Session.vue\n// module id = null\n// module chunks = ","function injectStyle (context) {\n  require(\"!!../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":false,\\\"minimize\\\":true}!../../node_modules/vue-loader/lib/style-compiler/index?{\\\"optionsId\\\":\\\"0\\\",\\\"vue\\\":true,\\\"id\\\":\\\"data-v-fc1651c8\\\",\\\"scoped\\\":true,\\\"sourceMap\\\":false}!sass-loader?{\\\"sourceMap\\\":false}!../../node_modules/vue-loader/lib/selector?type=styles&index=0!./Session.vue\")\n}\n/* script */\nexport * from \"!!cache-loader?{\\\"cacheDirectory\\\":\\\"/home/david/dev/art/muse/brain-control/node_modules/.cache/cache-loader\\\"}!babel-loader!ts-loader?{\\\"transpileOnly\\\":true,\\\"appendTsSuffixTo\\\":[{}],\\\"happyPackMode\\\":false}!../../node_modules/vue-loader/lib/selector?type=script&index=0!./Session.vue\"\nimport __vue_script__ from \"!!cache-loader?{\\\"cacheDirectory\\\":\\\"/home/david/dev/art/muse/brain-control/node_modules/.cache/cache-loader\\\"}!babel-loader!ts-loader?{\\\"transpileOnly\\\":true,\\\"appendTsSuffixTo\\\":[{}],\\\"happyPackMode\\\":false}!../../node_modules/vue-loader/lib/selector?type=script&index=0!./Session.vue\"\n/* template */\nimport {render as __vue_render__, staticRenderFns as __vue_static_render_fns__} from \"!!../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-fc1651c8\\\",\\\"hasScoped\\\":true,\\\"optionsId\\\":\\\"0\\\",\\\"buble\\\":{\\\"transforms\\\":{}}}!../../node_modules/vue-loader/lib/selector?type=template&index=0!./Session.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-fc1651c8\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nimport normalizeComponent from \"!../../node_modules/vue-loader/lib/runtime/component-normalizer\"\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_render__,\n  __vue_static_render_fns__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/components/Session.vue\n// module id = null\n// module chunks = ","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport { Component, Prop, Vue, Watch } from 'vue-property-decorator';\nimport { line, lineRadial, arc, curveCardinal, curveNatural, curveMonotoneX, curveBasis } from 'd3-shape';\nimport { interpolateString, interpolateNumber, interpolate } from 'd3-interpolate';\nimport { easeCubicOut, easeCubicIn, easeCubic, easeCircle } from 'd3-ease';\n\n@Component\nexport default class Vizualisation extends Vue {\n  @Prop({ default: 1 })\n  k1: number;\n\n  @Prop({ default: 1 })\n  k2: number;\n\n  tk1: number = this.k1;\n  tk2: number = this.k2;\n\n  colors = ['#00f', '#0f0', '#f00'];\n  // colors = ['cyan', 'magenta', 'yellow'];\n\n  @Watch('k1')\n  animateK1 (targetVal: number) {\n    let duration = 1000;\n    let start = Date.now();\n    let interpolator = interpolateNumber(this.tk1 as number, targetVal);\n    let animate = () => {\n      let t = (Date.now() - start) / duration;\n      if (t >= 1) {\n        this.tk1 = targetVal;\n      } else {\n        requestAnimationFrame(animate);\n        this.tk1 = interpolator(t);\n      }\n    }\n    animate();\n  }\n\n  @Watch('k2')\n  animateK2 (targetVal: number) {\n    let duration = 1000;\n    let start = Date.now();\n    let interpolator = interpolateNumber(this.tk2 as number, targetVal);\n    let animate = () => {\n      let t = (Date.now() - start) / duration;\n      if (t >= 1) {\n        this.tk2 = targetVal;\n      } else {\n        requestAnimationFrame(animate);\n        this.tk2 = interpolator(t);\n      }\n    }\n    animate();\n  }\n\n  @Prop({ default: 800 })\n  height: number;\n\n  @Prop({ default: 800 })\n  width: number;\n\n  get originTranslation () {\n    return `translate(${this.width / 2}, ${this.height})`;\n  }\n\n  brainWires (k1: number, k2: number) {\n    return [-1/2, 0, 1/2].map(y => this.brainWire(k1, k2, y))\n  }\n\n  brainWire (k1: number, k2: number, y: number) {\n    let curve = line().curve(\n      curveCardinal.tension(y)\n    );\n\n    return curve(this.wirePoints(k1, k2, y));\n  }\n\n  wirePoints (k1: number, k2: number, y: number) {\n    let k = k1 + easeCircle(y) * (k2 - k1);\n\n    let masterPoints = [\n      this.leftPoint(k, y),\n      this.leftMiddlePoint(k, y),\n      this.middlePoint(k, y),\n      this.rightMiddlePoint(k, y),\n      this.rightPoint(k, y),\n    ]\n\n    let wireWidth = 100;\n\n    let points = masterPoints.map(\n      (p): [number, number] => [p[0], p[1] + wireWidth / 2]\n    ).concat(\n      masterPoints.reverse().map(\n        (p): [number, number] => [p[0], - p[1] - wireWidth / 2]\n      )\n    );\n\n    points.push(points[0]);\n\n    return points.map(this.verticalTranslation(- this.width / 2 - (1 - Math.max(k1, k2)) * 2 * y * this.radius));\n  }\n\n  get radius () {\n    return Math.sqrt(\n      Math.pow((this.width / 2), 2) + Math.pow((this.height / 2), 2)\n    ) / 2;\n  }\n\n  leftPoint (k: number, y: number): [number, number] {\n    return [\n      interpolateNumber(- this.width / 2, - this.radius)(easeCubicIn(k))\n    ,\n      interpolateNumber(0, this.radius)( y * k )\n    ]\n  }\n\n  leftMiddlePoint (k: number, y: number): [number, number] {\n    let circleOrSquareRatio = interpolateNumber(Math.SQRT2 / 2, 1);\n\n    return [\n      interpolateNumber(- this.width / 4, - this.radius * circleOrSquareRatio(y))(easeCubicIn(k))\n    ,\n      interpolateNumber(0, - this.radius * circleOrSquareRatio(y))(easeCubic(k)) + interpolateNumber(0, this.radius)( y * k )\n    ]\n  }\n\n  middlePoint (k: number, y: number): [number, number] {\n    return [\n      0\n    ,\n      interpolateNumber(0, - this.radius)(easeCubicOut(k)) + interpolateNumber(0, this.radius)( y * k )\n    ]\n  }\n\n  rightMiddlePoint (k: number, y: number): [number, number] {\n    return this.verticalSymetry(this.leftMiddlePoint(k, y));\n  }\n\n  rightPoint (k: number, y: number): [number, number] {\n    return this.verticalSymetry(this.leftPoint(k, y));\n  }\n\n  verticalSymetry (point: [number, number]): [number, number] {\n    return [\n      -point[0], point[1]\n    ]\n  }\n\n  horizontalSymetry (point: [number, number]): [number, number] {\n    return [\n      point[0], -point[1]\n    ]\n  }\n\n  verticalTranslation (dy: number) {\n    return function(point: [number, number]): [number, number] {\n      return [\n        point[0], dy + point[1]\n      ]\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./node_modules/vue-loader/lib/selector.js?type=script&index=0!./src/components/Visualization.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('svg',{staticClass:\"brain-visualization\",attrs:{\"height\":_vm.height,\"width\":_vm.width}},[_c('defs',[_c('filter',{attrs:{\"id\":\"goo\"}},[_c('feGaussianBlur',{attrs:{\"in\":\"SourceGraphic\",\"stdDeviation\":\"10\",\"result\":\"blur\"}}),_c('feColorMatrix',{attrs:{\"in\":\"blur\",\"mode\":\"matrix\",\"values\":\"1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 20 -18\",\"result\":\"goo\"}}),_c('feComposite',{attrs:{\"in\":\"SourceGraphic\",\"in2\":\"goo\",\"operator\":\"atop\"}})],1)]),_c('g',{staticClass:\"brain-wires\"},_vm._l((_vm.brainWires(_vm.tk1, _vm.tk2)),function(wire,i){return _c('path',{key:i,staticClass:\"brain-wire\",attrs:{\"filter\":\"url(#goo)\",\"transform\":_vm.originTranslation,\"d\":wire,\"fill\":_vm.colors[i]}})}))])}\nvar staticRenderFns = []\nexport { render, staticRenderFns }\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-888b4562\",\"hasScoped\":true,\"optionsId\":\"0\",\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/components/Visualization.vue\n// module id = null\n// module chunks = ","function injectStyle (context) {\n  require(\"!!../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":false,\\\"minimize\\\":true}!../../node_modules/vue-loader/lib/style-compiler/index?{\\\"optionsId\\\":\\\"0\\\",\\\"vue\\\":true,\\\"id\\\":\\\"data-v-888b4562\\\",\\\"scoped\\\":true,\\\"sourceMap\\\":false}!sass-loader?{\\\"sourceMap\\\":false}!../../node_modules/vue-loader/lib/selector?type=styles&index=0!./Visualization.vue\")\n}\n/* script */\nexport * from \"!!cache-loader?{\\\"cacheDirectory\\\":\\\"/home/david/dev/art/muse/brain-control/node_modules/.cache/cache-loader\\\"}!babel-loader!ts-loader?{\\\"transpileOnly\\\":true,\\\"appendTsSuffixTo\\\":[{}],\\\"happyPackMode\\\":false}!../../node_modules/vue-loader/lib/selector?type=script&index=0!./Visualization.vue\"\nimport __vue_script__ from \"!!cache-loader?{\\\"cacheDirectory\\\":\\\"/home/david/dev/art/muse/brain-control/node_modules/.cache/cache-loader\\\"}!babel-loader!ts-loader?{\\\"transpileOnly\\\":true,\\\"appendTsSuffixTo\\\":[{}],\\\"happyPackMode\\\":false}!../../node_modules/vue-loader/lib/selector?type=script&index=0!./Visualization.vue\"\n/* template */\nimport {render as __vue_render__, staticRenderFns as __vue_static_render_fns__} from \"!!../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-888b4562\\\",\\\"hasScoped\\\":true,\\\"optionsId\\\":\\\"0\\\",\\\"buble\\\":{\\\"transforms\\\":{}}}!../../node_modules/vue-loader/lib/selector?type=template&index=0!./Visualization.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-888b4562\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nimport normalizeComponent from \"!../../node_modules/vue-loader/lib/runtime/component-normalizer\"\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_render__,\n  __vue_static_render_fns__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/components/Visualization.vue\n// module id = null\n// module chunks = ","\nimport _ from 'lodash';\nimport { CreateElement, VNode } from 'vue';\nimport { Component, Prop, Vue, Watch } from 'vue-property-decorator';\nimport {\n  Scene, Camera,\n  WebGLRenderer, PerspectiveCamera\n} from 'three';\n\nimport * as THREE from 'three';\n\nconst CAMERA_DISTANCE = 200;\nconst BOUNDS = {\n  X: CAMERA_DISTANCE * 2,\n  Y: CAMERA_DISTANCE * 2\n};\n\nconst CIRCLE_RADIUS = CAMERA_DISTANCE * Math.SQRT2;\nconst SQUARE_SIZE = CAMERA_DISTANCE;\nconst SQUARE_RADIUS = SQUARE_SIZE / 2;\n\nconst POINTS_COUNT = 1000\nconst POINTS_RENEWAL_CHANCE = 0.001;\n\n@Component\nexport default class ParticlesVizualisation extends Vue {\n  private scene: Scene;\n  private renderer: WebGLRenderer;\n  private camera: Camera;\n  private geometry: THREE.Geometry;\n  private points: THREE.Points;\n  private lastAnimationId: number | undefined;\n\n  @Prop({ required: true })\n  public k1: number;\n\n  @Prop({ required: true })\n  public k2: number;\n\n  @Prop({ default: false })\n  public paused: boolean;\n\n  created () {\n    this.scene = new Scene();\n\n    this.renderer = new WebGLRenderer({\n      preserveDrawingBuffer: true\n    });\n    this.renderer.autoClearColor = false;\n\n    this.camera = new PerspectiveCamera( 120, window.innerWidth / window.innerHeight, 0.1, 1000 );\n\n    // TRAIL EFFECT\n    // Create a semi-transparent plane\n    let fadeMaterial = new THREE.MeshBasicMaterial({\n      color: 0x000000,\n      transparent: true,\n      opacity: 0.04,\n      depthWrite: false\n    });\n    let fadePlane = new THREE.PlaneBufferGeometry(1, 1);\n    let fadeMesh = new THREE.Mesh(fadePlane, fadeMaterial);\n\n    // Group the plane and the camera in cameraGroup\n    let cameraGroup = new THREE.Object3D();\n    cameraGroup.add(this.camera);\n    cameraGroup.add(fadeMesh);\n    cameraGroup.translateZ(CAMERA_DISTANCE);\n\n    // Place the plane in front of the camera\n    fadeMesh.position.z = -0.1;\n\n    //Render the Make plane before points\n    fadeMesh.renderOrder = -1;\n\n    this.scene.add(cameraGroup);\n\n    // POINTS\n    let material = new THREE.PointsMaterial({\n      size: 2,\n      vertexColors: THREE.VertexColors,\n      opacity: 0.6,\n      transparent: true,\n      map: this.createCanvasMaterial('white', 64),\n      depthWrite: false\n    });\n    this.geometry = new THREE.Geometry();\n\n    _.times(POINTS_COUNT, this.addRandomPoint);\n    this.points = new THREE.Points(this.geometry, material);\n\n    this.scene.add(this.points);\n  }\n\n  randomPositionOnPlane () {\n    return new THREE.Vector3(\n      2 * (Math.random() - 0.5) * BOUNDS.X,\n      2 * (Math.random() - 0.5) * BOUNDS.Y,\n      0\n    )\n  }\n\n  addRandomPoint () {\n    this.geometry.vertices.push(this.randomPositionOnPlane());\n\n    this.geometry.colors.push(new THREE.Color(\n      Math.random(), Math.random(), Math.random()\n    ));\n  }\n\n  mounted () {\n    this.renderer.setSize(window.innerWidth, window.innerHeight);\n    this.animate();\n    this.$el.appendChild(this.renderer.domElement);\n  }\n\n  get horizontalWeigth () {\n    return 1 - Math.max(this.k1, this.k2);\n  }\n\n  get circleWeigth () {\n    if ((this.k1 + this.k2) === 0)\n      return 0\n    return this.k1;\n  }\n\n  get squareWeigth () {\n    if ((this.k1 + this.k2) === 0)\n      return 0\n    return this.k2;\n  }\n\n  animate () {\n    // Re-randomly position some of the points\n    this.geometry.vertices.map((vertice) => {\n      if (Math.random() <= POINTS_RENEWAL_CHANCE) {\n        let v = this.randomPositionOnPlane();\n        vertice.set(v.x, v.y, v.z);\n        this.geometry.verticesNeedUpdate = true;\n      }\n    });\n\n    // Move points\n    if ( !_.isNaN(this.k1) && !_.isNaN(this.k2) ) {\n      this.geometry.vertices.map( (particle) => {\n        let h = this.horizontalMovement(particle);\n        let c = this.circularMovement(particle);\n        let s = this.squareMovement(particle);\n\n        let weightedMovementAlongAxis = (h: number, c: number, s: number): number =>\n          this.circleWeigth * c + this.squareWeigth * s + this.horizontalWeigth * h\n\n        let movement: [number, number] = [\n          weightedMovementAlongAxis(h[0], c[0], s[0]),\n          weightedMovementAlongAxis(h[1], c[1], s[1])\n        ]\n        this.moveParticle(\n          particle, movement\n        );\n      });\n\n      this.geometry.verticesNeedUpdate = true;\n    }\n\n    this.geometry.colors.map( (particleColor) => {\n      let dX, dY, dZ;\n      dX = (Math.random() - .5 ) / 5;\n      dY = (Math.random() - .5 ) / 5;\n      dZ = (Math.random() - .5 ) / 5;\n\n      particleColor.add(new THREE.Color(dX, dY, dZ));\n    });\n    this.geometry.colorsNeedUpdate = true;\n\n    this.renderer.render(this.scene, this.camera);\n    this.continue()\n  }\n\n  createCanvasMaterial (color: string, size: number): THREE.Texture {\n    let matCanvas = document.createElement('canvas');\n    matCanvas.width = matCanvas.height = size;\n    let matContext = matCanvas.getContext('2d');\n    let texture = new THREE.Texture(matCanvas);\n    if (!matContext)\n      return new THREE.Texture();\n\n    // Circle\n    let center = size / 2;\n    matContext.beginPath();\n    matContext.arc(center, center, center, 0, 2 * Math.PI);\n    matContext.closePath();\n    matContext.fillStyle = color;\n    matContext.fill();\n\n    texture.needsUpdate = true;\n    return texture;\n  }\n\n  moveParticle (particle: THREE.Vertex, movement: [number, number]) {\n    particle.x += movement[0];\n    particle.y += movement[1];\n\n    if (particle.x > BOUNDS.X)\n      particle.x = -1 * BOUNDS.X;\n    if (particle.x < -1 * BOUNDS.X)\n      particle.x = BOUNDS.X;\n    if (particle.y > BOUNDS.Y)\n      particle.y = -1 * BOUNDS.Y;\n    if (particle.y < -1 * BOUNDS.Y)\n      particle.y = BOUNDS.Y;\n  }\n\n  horizontalMovement (particle: THREE.Vertex): [number, number] {\n    return [\n      1,\n      Math.sin(particle.x / 16 / Math.PI) / 2\n    ];\n  }\n\n  circularMovement (particle: THREE.Vertex): [number, number] {\n    let r = Math.pow( Math.pow(particle.x, 2) + Math.pow(particle.y, 2) , .5);\n    let θ = Math.atan2(particle.y, particle.x);\n\n    // Movement towards the circle\n    let dr = (CIRCLE_RADIUS - r) / 250; // 250 frames to match the circle\n    // Movement along the circle\n    let dθ = 2 * Math.PI / 2000; // 1000 frames to complete the circle\n\n    return [\n      dr * Math.cos(θ) - r * Math.sin(θ) * dθ,\n      dr * Math.cos(θ) + r * Math.cos(θ) * dθ\n    ];\n  }\n\n  squareMovement (particle: THREE.Vertex) {\n    let x = particle.x;\n    let y = particle.y;\n\n    let dx: number;\n    let dy: number;\n    let r: number;\n    let dr = (x: number, y: number, r: number): [number, number] => [0, 0]\n\n    if (x >= 0) {\n      dy = 1;\n      if (y >= 0) {\n        r = y / (1 - x); \n        dx = -1;\n      } else { // y < 0\n        r = y / (x - 1); \n        dx = 1;\n      }\n    } else { // x < 0\n      dy = -1;\n      if (y > 0) {\n        r = y / (x + 1); \n        dx = -1;\n      } else { // y < 0\n        r = y / (-1 - x); \n        dx = 1;\n      }\n    }\n\n    // let dr = (SQUARE_SIZE - r) / 1000;\n\n    return [dx, dy];\n  }\n\n  continue () {\n    if (!this.paused)\n      this.lastAnimationId = window.requestAnimationFrame(this.animate);\n  }\n\n  pause () {\n    if (this.lastAnimationId)\n      window.cancelAnimationFrame(this.lastAnimationId);\n    this.lastAnimationId = undefined;\n  }\n\n  @Watch('paused')\n  onPausedChanged () {\n    this.paused ? this.pause() : this.continue()\n  }\n\n  render (h: CreateElement): VNode {\n    return h('div', { class: 'brain-particles' });\n  }\n\n  destroyed () {\n    this.pause();\n    this.renderer.dispose();\n    this.geometry.dispose();\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./node_modules/vue-loader/lib/selector.js?type=script&index=0!./src/components/ParticlesVisualization.vue","function injectStyle (context) {\n  require(\"!!../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":false,\\\"minimize\\\":true}!../../node_modules/vue-loader/lib/style-compiler/index?{\\\"optionsId\\\":\\\"0\\\",\\\"vue\\\":true,\\\"id\\\":\\\"data-v-2f884374\\\",\\\"scoped\\\":true,\\\"sourceMap\\\":false}!sass-loader?{\\\"sourceMap\\\":false}!../../node_modules/vue-loader/lib/selector?type=styles&index=0!./ParticlesVisualization.vue\")\n}\n/* script */\nexport * from \"!!cache-loader?{\\\"cacheDirectory\\\":\\\"/home/david/dev/art/muse/brain-control/node_modules/.cache/cache-loader\\\"}!babel-loader!ts-loader?{\\\"transpileOnly\\\":true,\\\"appendTsSuffixTo\\\":[{}],\\\"happyPackMode\\\":false}!../../node_modules/vue-loader/lib/selector?type=script&index=0!./ParticlesVisualization.vue\"\nimport __vue_script__ from \"!!cache-loader?{\\\"cacheDirectory\\\":\\\"/home/david/dev/art/muse/brain-control/node_modules/.cache/cache-loader\\\"}!babel-loader!ts-loader?{\\\"transpileOnly\\\":true,\\\"appendTsSuffixTo\\\":[{}],\\\"happyPackMode\\\":false}!../../node_modules/vue-loader/lib/selector?type=script&index=0!./ParticlesVisualization.vue\"\n/* template */\nvar __vue_render__, __vue_static_render_fns__\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-2f884374\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nimport normalizeComponent from \"!../../node_modules/vue-loader/lib/runtime/component-normalizer\"\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_render__,\n  __vue_static_render_fns__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/components/ParticlesVisualization.vue\n// module id = null\n// module chunks = ","/**\n * This file is based on https://github.com/mapbox/webgl-wind\n * by Vladimir Agafonkin\n * \n * Released under ISC License, Copyright (c) 2016, Mapbox\n * https://github.com/mapbox/webgl-wind/blob/master/LICENSE\n * \n * Adapted to field maps by Andrei Kashcha\n * Copyright (C) 2017\n */\nexport default {\n  createTexture: createTexture,\n  bindFramebuffer: bindFramebuffer,\n  createProgram: createProgram, \n  createBuffer: createBuffer,\n  bindAttribute: bindAttribute,\n  bindTexture: bindTexture\n}\n\nfunction bindTexture(gl, texture, unit) {\n  gl.activeTexture(gl.TEXTURE0 + unit);\n  gl.bindTexture(gl.TEXTURE_2D, texture);\n}\n\nfunction createBuffer(gl, data) {\n  var buffer = gl.createBuffer();\n  gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n  gl.bufferData(gl.ARRAY_BUFFER, data, gl.STATIC_DRAW);\n  return buffer;\n}\n\nfunction createTexture(gl, filter, data, width, height) {\n  var texture = gl.createTexture();\n  gl.bindTexture(gl.TEXTURE_2D, texture);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, filter);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, filter);\n  if (data instanceof Uint8Array) {\n      gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, width, height, 0, gl.RGBA, gl.UNSIGNED_BYTE, data);\n  } else {\n      gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, data);\n  }\n  gl.bindTexture(gl.TEXTURE_2D, null);\n  return texture;\n}\n\nfunction bindFramebuffer(gl, framebuffer, texture) {\n  gl.bindFramebuffer(gl.FRAMEBUFFER, framebuffer);\n  if (texture) {\n      gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, texture, 0);\n  }\n}\n\nfunction bindAttribute(gl, buffer, attribute, numComponents) {\n  gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n  gl.enableVertexAttribArray(attribute);\n  gl.vertexAttribPointer(attribute, numComponents, gl.FLOAT, false, 0, 0);\n}\n\nfunction createProgram(gl, vertexSource, fragmentSource) {\n  var program = gl.createProgram();\n\n  var vertexShader = createShader(gl, gl.VERTEX_SHADER, vertexSource);\n  var fragmentShader = createShader(gl, gl.FRAGMENT_SHADER, fragmentSource);\n\n  gl.attachShader(program, vertexShader);\n  gl.attachShader(program, fragmentShader);\n\n  gl.linkProgram(program);\n  if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {\n      throw new Error(gl.getProgramInfoLog(program));\n  }\n\n  var wrapper = {\n    program: program,\n    unload: unload\n  };\n\n  var numAttributes = gl.getProgramParameter(program, gl.ACTIVE_ATTRIBUTES);\n  var i;\n  for (i = 0; i < numAttributes; i++) {\n      var attribute = gl.getActiveAttrib(program, i);\n      wrapper[attribute.name] = gl.getAttribLocation(program, attribute.name);\n  }\n  var numUniforms = gl.getProgramParameter(program, gl.ACTIVE_UNIFORMS);\n  for (i = 0; i < numUniforms; i++) {\n      var uniform = gl.getActiveUniform(program, i);\n      wrapper[uniform.name] = gl.getUniformLocation(program, uniform.name);\n  }\n\n  return wrapper; \n\n  function unload() {\n    gl.deleteProgram(program);\n  }\n}\n\nfunction createShader(gl, type, source) {\n  var shader = gl.createShader(type);\n  gl.shaderSource(shader, source);\n\n  gl.compileShader(shader);\n  if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\n      throw new Error(gl.getShaderInfoLog(shader));\n  }\n\n  return shader;\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/field-play/gl-utils.js","/**\n * Various color modes.\n */\nexport default {\n  /**\n   * Each particle gets its own color\n   */\n  UNIFORM: 1,\n\n  /**\n   * Color of a particle depends on its velocity\n   */\n  VELOCITY: 2,\n\n  /**\n   * Color of a particle depends on its velocity vector angle.\n   */\n  ANGLE: 3,\n\n  /**\n   * The color comes from a shader. WIP\n   */\n  CUSTOM: 4\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/field-play/programs/colorModes.js","/**\n * Wraps a simple vector field string into our default shader code.\n * @param {String} field \n */\nexport default function wrapVectorField(field) {\n  return `// p.x and p.y are current coordinates\n// v.x and v.y is a velocity at point p\nvec2 get_velocity(vec2 p) {\n  vec2 v = vec2(0., 0.);\n\n  // change this to get a new vector field\n  ${field}\n\n  return v;\n}`\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/field-play/wrapVectorField.js","/**\n * Checks whether current window belongs to a \"Small\" screen\n * size. Small screens have slightly different initial behavior.\n * E.g. the settings window is always collapsed.\n * \n * This needs to be in sync with `small-screen` variable in\n *  ../commponents/shared.styl\n */\nexport default function isSmallScreen() {\n  return window.innerWidth < 600\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/field-play/isSmallScreen.js","import queryState from 'query-state';\nimport bus from './bus';\nimport ColorModes from './programs/colorModes';\nimport wrapVectorField from './wrapVectorField';\nimport isSmallScreen from './isSmallScreen';\n\n/**\n * The state of the fieldplay is stored in the query string. This is the\n * only place where query string can be manipulated or fetched.\n */\n\nvar qs = queryState({}, {\n  useSearch: true,\n  // Older version of the app used hash to store application arguments.\n  // Turns out hash is not good for websites like reddit. They can block\n  // url, saying \"url was already submitted\" if the only part that is different\n  // is hash. So, we switch to search string, and maintain backward compatibility\n  // for fields created before.\n  rewriteHashToSearch: true\n});\n\nvar currentState = {}; //qs.get();\n\nvar defaultVectorField = wrapVectorField(`v.x = 0.1 * p.y;\n  v.y = -0.2 * p.y;`);\n\nvar pendingSave;\nvar defaults = {\n  timeStep: 0.01,\n  dropProbability: 0.009,\n  particleCount: 10000,\n  fadeout: .998,\n  colorMode: ColorModes.UNIFORM\n}\n\nlet settingsPanel = {\n  collapsed: isSmallScreen(),\n};\n\nexport default {\n  settingsPanel,\n  saveBBox,\n  getBBox,\n  makeBBox,\n  getQS() { return qs; },\n  saveCode,\n  getCode,\n  getDefaultCode,\n\n  getDropProbability,\n  setDropProbability,\n\n  getIntegrationTimeStep,\n  setIntegrationTimeStep,\n\n  getParticleCount,\n  setParticleCount,\n\n  getFadeout,\n  setFadeout,\n\n  getColorMode,\n  setColorMode,\n\n  getColorFunction,\n  setColorFunction\n}\n\nqs.onChange(function() {\n  bus.fire('scene-ready', window.scene);\n});\n\nfunction getColorMode() {\n  let colorMode = qs.get('cm');\n  return defined(colorMode) ? colorMode : defaults.colorMode;\n}\n\nfunction setColorMode(colorMode) {\n  if (!defined(colorMode)) return;\n  // qs.set({cm: colorMode});\n  currentState.cm = colorMode;\n}\n\nfunction getColorFunction() {\n  let colorFunction = qs.get('cf');\n  return colorFunction || '';\n}\n\nfunction setColorFunction(colorFunction) {\n  // qs.set({cf: colorFunction});\n  currentState.cf = colorFunction;\n}\n\nfunction getFadeout() {\n  let fadeout = qs.get('fo');\n  return defined(fadeout) ? fadeout : defaults.fadeout;\n}\n\nfunction setFadeout(fadeout) {\n  if (!defined(fadeout)) return;\n  // qs.set({fo: fadeout});\n  currentState.fo = fadeout;\n}\n\nfunction getParticleCount() {\n  let particleCount = qs.get('pc');\n  return defined(particleCount) ? particleCount : defaults.particleCount;\n}\n\nfunction setParticleCount(particleCount) {\n  if (!defined(particleCount)) return;\n  // qs.set({pc: particleCount});\n  currentState.pc = particleCount;\n}\n\nfunction getIntegrationTimeStep() {\n  let timeStep = qs.get('dt');\n  return defined(timeStep) ? timeStep : defaults.timeStep;\n}\n\nfunction setIntegrationTimeStep(dt) {\n  if (!defined(dt)) return;\n  // qs.set({dt: dt})\n  currentState.dt = dt;\n}\n\nfunction getDropProbability() {\n  let dropProbability = qs.get('dp');\n  return defined(dropProbability) ? dropProbability : defaults.dropProbability;\n}\n\nfunction setDropProbability(dropProbability) {\n  if (!defined(dropProbability)) return;\n  clamp(dropProbability, 0, 1);\n  // qs.set({dp: dropProbability})\n}\n\nfunction getBBox() {\n  let cx = qs.get('cx');\n  let cy = qs.get('cy');\n  let w = qs.get('w');\n  let h = qs.get('h');\n  return makeBBox(cx, cy, w, h);\n}\n\nfunction makeBBox(cx, cy, w, h) {\n  let bboxDefined = defined(cx) && defined(cy) && defined(w) && defined(h);\n  if (!bboxDefined) return;\n\n  let w2 = w/2;\n  let h2 = h/2;\n  var p = 10000;\n  return {\n    minX: Math.round(p * (cx - w2))/p,\n    maxX: Math.round(p * (cx + w2))/p,\n    minY: Math.round(p * (cy - h2))/p,\n    maxY: Math.round(p * (cy + h2))/p\n  };\n}\n\nfunction saveBBox(bbox, immediate = false) {\n  bbox = {\n    cx: (bbox.minX + bbox.maxX) * 0.5,\n    cy: (bbox.minY + bbox.maxY) * 0.5,\n    w: (bbox.maxX - bbox.minX),\n    h: (bbox.maxX - bbox.minX)\n  }\n\n  if (bbox.w <= 0 || bbox.h <= 0) return;\n\n  currentState.cx = bbox.cx;\n  currentState.cy = bbox.cy;\n  currentState.w = bbox.w;\n  currentState.h = bbox.h;\n\n  if(pendingSave) {\n    clearTimeout(pendingSave);\n    pendingSave = 0;\n  }\n\n  // if (immediate) qs.set(bbox);\n  else {\n    pendingSave = setTimeout(() => {\n      pendingSave = 0;\n      // qs.set(bbox);\n    }, 300);\n  }\n}\n\nfunction getCode() {\n  var vfCode = qs.get('vf');\n  if (vfCode) return vfCode;\n\n  // If we didn't get code yet, let's try read to read it from previous version\n  // of the API.\n  // TODO: Need to figure out how to develop this in backward/future compatible way.\n  var oldCode = qs.get('code');\n  if (oldCode) {\n    vfCode = wrapVectorField(oldCode);\n    // side effect - let's clean the old URL\n    delete(currentState.code);\n    // qs.set('vf', vfCode);\n    return vfCode;\n  }\n\n  return defaultVectorField;\n}\n\nfunction getDefaultCode() {\n  return defaultVectorField;\n}\n\nfunction saveCode(code) {\n  // qs.set({\n  //   vf: code\n  // });\n  currentState.code = code;\n}\n\nfunction defined(number) {\n  return Number.isFinite(number);\n}\n\nfunction clamp(x, min, max) {\n  return x < min ? min :\n        (x > max) ? max : x;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/field-play/appState.js","/**\n * Renders computed state onto the screen.\n */\nimport glUtils from '../gl-utils';\n\nconst NO_TRANSFORM = {dx: 0, dy: 0, scale: 1};\n\nexport default function makeScreenProgram(ctx) {\n  var {gl, canvasRect} = ctx;\n\n  var screenTexture, backgroundTexture;\n  var boundBoxTextureTransform = {dx: 0, dy: 0, scale: 1};\n  var lastRenderedBoundingBox = null;\n\n  updateScreenTextures();\n  var screenProgram = glUtils.createProgram(gl, getScreenVertexShader(), getScreenFragmentShader());\n  \n  var api = {\n    fadeOutLastFrame,\n    renderCurrentScreen,\n    updateScreenTextures,\n\n    boundingBoxUpdated: false\n  };\n\n  return api;\n  \n  function fadeOutLastFrame() {\n    // render to the frame buffer\n    glUtils.bindFramebuffer(gl, ctx.framebuffer, screenTexture);\n    gl.viewport(0, 0, canvasRect.width, canvasRect.height);\n\n    if (api.boundingBoxUpdated && lastRenderedBoundingBox) {\n      // We move the back texture, relative to the bounding box change. This eliminates\n      // particle train artifacts, though, not all of them: https://computergraphics.stackexchange.com/questions/5754/fading-particles-and-transition\n      // If you know how to improve this - please let me know.\n      boundBoxTextureTransform.dx = -(ctx.bbox.minX - lastRenderedBoundingBox.minX)/(ctx.bbox.maxX - ctx.bbox.minX);\n      boundBoxTextureTransform.dy = -(ctx.bbox.minY - lastRenderedBoundingBox.minY)/(ctx.bbox.maxY - ctx.bbox.minY);\n      boundBoxTextureTransform.scale = (ctx.bbox.maxX - ctx.bbox.minX) / (lastRenderedBoundingBox.maxX - lastRenderedBoundingBox.minX);\n      drawTexture(backgroundTexture, ctx.fadeOpacity, boundBoxTextureTransform);\n    } else {\n      drawTexture(backgroundTexture, ctx.fadeOpacity, NO_TRANSFORM)\n    }\n  }\n\n  function renderCurrentScreen() {\n    glUtils.bindFramebuffer(gl, null);\n\n    saveLastBbox();\n\n    gl.enable(gl.BLEND); \n    gl.blendFunc(gl.SRC_ALPHA, gl.DST_ALPHA);\n    gl.clearColor(ctx.backgroundColor.r, ctx.backgroundColor.g, ctx.backgroundColor.b, ctx.backgroundColor.a);\n    gl.clear(gl.COLOR_BUFFER_BIT);\n    drawTexture(screenTexture, 1.0, NO_TRANSFORM);\n    gl.disable(gl.BLEND);\n\n    var temp = backgroundTexture;\n    backgroundTexture = screenTexture;\n    screenTexture = temp;\n\n    api.boundingBoxUpdated = false;\n    if (window.audioTexture) {\n      drawTexture(window.audioTexture, 1.0, NO_TRANSFORM);\n    }\n  }\n\n  function updateScreenTextures() {\n    var {width, height} = canvasRect;\n    var emptyPixels = new Uint8Array(width * height * 4);\n    if (screenTexture) {\n      gl.deleteTexture(screenTexture);\n    }\n    if (backgroundTexture) {\n      gl.deleteTexture(backgroundTexture);\n    }\n\n    screenTexture = glUtils.createTexture(gl, gl.NEAREST, emptyPixels, width, height);\n    backgroundTexture = glUtils.createTexture(gl, gl.NEAREST, emptyPixels, width, height);\n  }\n\n  function saveLastBbox() {\n    if (!lastRenderedBoundingBox) {\n      lastRenderedBoundingBox = {\n        minX: ctx.bbox.minX,\n        minY: ctx.bbox.minY,\n        maxX: ctx.bbox.maxX,\n        maxY: ctx.bbox.maxY\n      }\n\n      return;\n    } \n\n    lastRenderedBoundingBox.minX = ctx.bbox.minX;\n    lastRenderedBoundingBox.minY = ctx.bbox.minY;\n    lastRenderedBoundingBox.maxX = ctx.bbox.maxX;\n    lastRenderedBoundingBox.maxY = ctx.bbox.maxY;\n  }\n\n  function drawTexture(texture, opacity, textureTransform) {\n    var program = screenProgram;\n    gl.useProgram(program.program);\n    glUtils.bindAttribute(gl, ctx.quadBuffer, program.a_pos, 2);\n\n    // TODO: This index is very fragile. I need to find a way\n    glUtils.bindTexture(gl, texture, ctx.screenTextureUnit);\n    gl.uniform1i(program.u_screen, ctx.screenTextureUnit);\n\n    gl.uniform1f(program.u_opacity_border, 0.02);\n    gl.uniform1f(program.u_opacity, opacity);\n    gl.uniform3f(program.u_transform, textureTransform.dx, textureTransform.dy, textureTransform.scale);\n\n    gl.drawArrays(gl.TRIANGLES, 0, 6);\n  }\n}\n\nfunction getScreenVertexShader() {\n  return `// screen program\nprecision highp float;\n\nattribute vec2 a_pos;\nvarying vec2 v_tex_pos;\nuniform vec3 u_transform;\n\nvoid main() {\n    v_tex_pos = a_pos;\n    vec2 pos = a_pos;\n\n    // This transformation tries to move texture (raster) to the approximate position\n    // of particles on the current frame. This is needed to avoid rendering artifacts\n    // during pan/zoom: https://computergraphics.stackexchange.com/questions/5754/fading-particles-and-transition\n\n    // PS: I must admit, I wrote this formula through sweat and tears, and\n    // I still have no idea why I don't need to apply (pos.y - 0.5) to Y coordinate.\n    // Is it because I use aspect ratio for bounding box?\n    pos.x = (pos.x - 0.5) / u_transform.z - u_transform.x + 0.5 * u_transform.z;\n    pos.y = pos.y / u_transform.z + u_transform.y;\n\n    pos = 1.0 - 2.0 * pos;\n    gl_Position = vec4(pos, 0, 1);\n}`\n}\n\nfunction getScreenFragmentShader() {\n  return `precision highp float;\nuniform sampler2D u_screen;\nuniform float u_opacity;\nuniform float u_opacity_border;\n\nvarying vec2 v_tex_pos;\n\nvoid main() {\n  vec2 p = 1.0 - v_tex_pos;\n  vec4 color = texture2D(u_screen, p);\n\n  gl_FragColor = vec4(floor(255.0 * color * u_opacity) / 255.0);\n}`\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/field-play/programs/screenProgram.js","/**\n * A shader function to decode rgba encoded color into float position.\n */\nconst code = `\nhighp float decodeFloatRGBA( vec4 v ) {\n  float a = floor(v.r * 255.0 + 0.5);\n  float b = floor(v.g * 255.0 + 0.5);\n  float c = floor(v.b * 255.0 + 0.5);\n  float d = floor(v.a * 255.0 + 0.5);\n\n  float exponent = a - 127.0;\n  float sign = 1.0 - mod(d, 2.0)*2.0;\n  float mantissa = float(a > 0.0)\n                  + b / 256.0\n                  + c / 65536.0\n                  + floor(d / 2.0) / 8388608.0;\n  return sign * mantissa * exp2(exponent);\n}\n`\n\nexport default code;\n\n\n// WEBPACK FOOTER //\n// ./src/lib/field-play/shaderGraph/parts/decodeFloatRGBA.js","export default class BaseShaderNode {\n  constructor() { }\n  getDefines() { return ''; }\n  getFunctions() { return ''; }\n  getMainBody() { return ''; }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/field-play/shaderGraph/BaseShaderNode.js","//\n// Description : Array and textureless GLSL 2D simplex noise function.\n//      Author : Ian McEwan, Ashima Arts.\n//  Maintainer : stegu\n//     Lastmod : 20110822 (ijm)\n//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.\n//               Distributed under the MIT License. See LICENSE file.\n//               https://github.com/ashima/webgl-noise\n//               https://github.com/stegu/webgl-noise\n// \n\nvar code = `\nvec3 mod289(vec3 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec2 mod289(vec2 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec3 permute(vec3 x) {\n  return mod289(((x*34.0)+1.0)*x);\n}\n\nfloat snoise(vec2 v)\n  {\n  const vec4 C = vec4(0.211324865405187,  // (3.0-sqrt(3.0))/6.0\n                      0.366025403784439,  // 0.5*(sqrt(3.0)-1.0)\n                     -0.577350269189626,  // -1.0 + 2.0 * C.x\n                      0.024390243902439); // 1.0 / 41.0\n// First corner\n  vec2 i  = floor(v + dot(v, C.yy) );\n  vec2 x0 = v -   i + dot(i, C.xx);\n\n// Other corners\n  vec2 i1;\n  //i1.x = step( x0.y, x0.x ); // x0.x > x0.y ? 1.0 : 0.0\n  //i1.y = 1.0 - i1.x;\n  i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\n  // x0 = x0 - 0.0 + 0.0 * C.xx ;\n  // x1 = x0 - i1 + 1.0 * C.xx ;\n  // x2 = x0 - 1.0 + 2.0 * C.xx ;\n  vec4 x12 = x0.xyxy + C.xxzz;\n  x12.xy -= i1;\n\n// Permutations\n  i = mod289(i); // Avoid truncation effects in permutation\n  vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 ))\n\t\t+ i.x + vec3(0.0, i1.x, 1.0 ));\n\n  vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);\n  m = m*m ;\n  m = m*m ;\n\n// Gradients: 41 points uniformly over a line, mapped onto a diamond.\n// The ring size 17*17 = 289 is close to a multiple of 41 (41*7 = 287)\n\n  vec3 x = 2.0 * fract(p * C.www) - 1.0;\n  vec3 h = abs(x) - 0.5;\n  vec3 ox = floor(x + 0.5);\n  vec3 a0 = x - ox;\n\n// Normalise gradients implicitly by scaling m\n// Approximation of: m *= inversesqrt( a0*a0 + h*h );\n  m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );\n\n// Compute final noise value at P\n  vec3 g;\n  g.x  = a0.x  * x0.x  + h.x  * x0.y;\n  g.yz = a0.yz * x12.xz + h.yz * x12.yw;\n  return 130.0 * dot(m, g);\n}\n`\n\nexport default code;\n\n\n// WEBPACK FOOTER //\n// ./src/lib/field-play/shaderGraph/parts/simplex-noise.js","export function getInputUniforms() {\n  return `uniform sampler2D input0;\nuniform sampler2D input1;`;\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/field-play/shaderGraph/customInput.js","import BaseShaderNode from './BaseShaderNode';\nimport snoise from './parts/simplex-noise';\nimport {getInputUniforms} from './customInput';\n\nexport default class UserDefinedVelocityFunction extends BaseShaderNode {\n  constructor(updateCode) {\n    super();\n    this.updateCode = updateCode || '';\n  }\n\n  setNewUpdateCode(newUpdateCode) {\n    this.updateCode = newUpdateCode;\n  }\n\n  getDefines() {\n    return `\nuniform float frame;\nuniform vec4 cursor;\n// TODO: use inputN instead.\nuniform sampler2D u_audio;\n\n#define PI 3.1415926535897932384626433832795\n\n${getInputUniforms()}\n`\n  }\n\n  getFunctions() {\n  // TODO: Do I need to worry about \"glsl injection\" (i.e. is there potential for security attack?)\n  // TODO: Do I need to inject snoise only when it's used?\n    return `\n    // pseudo-random generator\nconst vec3 rand_constants = vec3(12.9898, 78.233, 4375.85453);\nfloat rand(const vec2 co) {\n    float t = dot(rand_constants.xy, co);\n    return fract(sin(t) * (rand_constants.z + t));\n}\n\n${snoise}\n\nvec2 rotate(vec2 p,float a) {\n\treturn cos(a)*p+sin(a)*vec2(p.y,-p.x);\n}\n\n// TODO: This will change. Don't use it.\nfloat audio(float index) {\n  float rgbI = floor(index/4.);\n  vec2 txPos = vec2(fract(rgbI / 5.), floor(rgbI / 5.) / 5.);\n  vec4 rgba = texture2D(u_audio, txPos);\n  \n  float offset = mod(index, 4.);\n  if (offset == 0.) return rgba[0];\n  if (offset == 1.) return rgba[1];\n  if (offset == 2.) return rgba[2];\n  return rgba[3];\n}\n\n${this.updateCode ? this.updateCode : 'vec2 get_velocity(vec2 p) { return vec2(0.); }'}\n  `\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/field-play/shaderGraph/UserDefinedVelocityFunction.js","import BaseShaderNode from './BaseShaderNode';\n\nexport default class RungeKuttaIntegrator extends BaseShaderNode {\n  constructor () {\n    super();\n  }\n\n  getDefines() {\n    return `\nuniform float u_h;\n`\n  }\n\n  getFunctions() {\n    return `\nvec2 rk4(const vec2 point) {\n  vec2 k1 = get_velocity( point );\n  vec2 k2 = get_velocity( point + k1 * u_h * 0.5);\n  vec2 k3 = get_velocity( point + k2 * u_h * 0.5);\n  vec2 k4 = get_velocity( point + k3 * u_h);\n\n  return k1 * u_h / 6. + k2 * u_h/3. + k3 * u_h/3. + k4 * u_h/6.;\n}`\n  }\n\n  getMainBody() {\n    return `\n  vec2 velocity = rk4(pos);\n`\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/field-play/shaderGraph/RungeKuttaIntegrator.js","import UserDefinedVelocityFunction from './UserDefinedVelocityFunction';\nimport RungeKuttaIntegrator from './RungeKuttaIntegrator';\nimport ColorModes from '../programs/colorModes';\n\nexport default function shaderBasedColor(colorMode, vfCode, colorCode) {\n  var udf = new UserDefinedVelocityFunction(vfCode);\n  var integrate = new RungeKuttaIntegrator();\n\n  return {\n    getVariables,\n    getMain,\n    getMethods\n  }\n\n  function getVariables() {\n    return `\nuniform vec2 u_velocity_range;\nvarying vec4 v_particle_color;\n\n${udf.getDefines()}\n${integrate.getDefines()}\n`\n  }\n\n  function getMethods() {\n    return `\n// https://github.com/hughsk/glsl-hsv2rgb\nvec3 hsv2rgb(vec3 c) {\n  vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n  vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n  return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\n\n${udf.getFunctions()}\n${integrate.getFunctions()}\n${getColorFunctionBody()}\n`\n  }\n\n  function getColorFunctionBody() {\n    if (colorMode === ColorModes.UNIFORM) {\n      return `\nvec4 get_color(vec2 p) {\n  return vec4(0.302, 0.737, 0.788, 1.);\n}\n`\n    }\n    if (colorMode === ColorModes.VELOCITY) {\n      return colorCode || `\n        vec4 get_color(vec2 p) {\n          vec2 velocity = get_velocity(p);\n          float speed = (length(velocity) - u_velocity_range[0])/(u_velocity_range[1] - u_velocity_range[0]);\n          float hue = 0.05 + (1. - speed) * 0.5;\n          return vec4(hsv2rgb(vec3(hue, 0.9, 1.)), 1.0);\n        }\n      `;\n    }\n\n    if (colorMode === ColorModes.CUSTOM) {\n      if (!colorCode) throw new Error('color mode is set to custom, but no color function is specified');\n      return colorCode;\n    }\n\n    return ` \nvec4 get_color(vec2 p) {\n  vec2 velocity = get_velocity(p);\n  float speed = (atan(velocity.y, velocity.x) + PI)/(2.0 * PI);\n  return vec4(hsv2rgb(vec3(speed, 0.9, 1.)), 1.0);\n}\n`;\n  }\n\n  function getMain() {\n    return `  v_particle_color = get_color(v_particle_pos);`\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/field-play/shaderGraph/shaderBasedColor.js","import decodeFloatRGBA from './parts/decodeFloatRGBA';\nimport shaderBasedColor from './shaderBasedColor';\n\n// TODO: this duplicates code from texture position.\nexport default class DrawParticleGraph {\n  constructor(ctx) {\n    this.colorMode = ctx.colorMode;\n    this.colorFunction = ctx.colorFunction || '';\n  }\n\n  getFragmentShader() {\n    return `precision highp float;\nvarying vec4 v_particle_color;\nvoid main() {\n  gl_FragColor = v_particle_color;\n}`\n  }\n\n  getVertexShader(vfCode) {\n    let decodePositions = textureBasedPosition();\n    let colorParts = shaderBasedColor(this.colorMode, vfCode, this.colorFunction);\n    let methods = []\n    addMethods(decodePositions, methods);\n    addMethods(colorParts, methods);\n    let main = [];\n    addMain(decodePositions, main);\n    addMain(colorParts, main);\n\n    return `precision highp float;\nattribute float a_index;\nuniform float u_particles_res;\nuniform vec2 u_min;\nuniform vec2 u_max;\n\n${decodePositions.getVariables() || ''}\n${colorParts.getVariables()}\n\n${decodeFloatRGBA}\n\n${methods.join('\\n')}\n\nvoid main() {\n  vec2 txPos = vec2(\n        fract(a_index / u_particles_res),\n        floor(a_index / u_particles_res) / u_particles_res);\n  gl_PointSize = 1.0;\n\n${main.join('\\n')}\n\n  vec2 du = (u_max - u_min);\n  v_particle_pos = (v_particle_pos - u_min)/du;\n  gl_Position = vec4(2.0 * v_particle_pos.x - 1.0, (1. - 2. * (v_particle_pos.y)),  0., 1.);\n}`\n  }\n}\n\nfunction addMethods(producer, array) {\n  if (producer.getMethods) {\n    array.push(producer.getMethods());\n  }\n}\n\nfunction addMain(producer, array) {\n  if (producer.getMain) {\n    array.push(producer.getMain());\n  }\n}\n\nfunction textureBasedPosition() {\n  return {\n    getVariables,\n    getMain\n  }\n\n  function getVariables() {\n    return `\nuniform sampler2D u_particles_x;\nuniform sampler2D u_particles_y;\n    `\n  }\n\n  function getMain() {\n    return `\n  vec2 v_particle_pos = vec2(\n    decodeFloatRGBA(texture2D(u_particles_x, txPos)),\n    decodeFloatRGBA(texture2D(u_particles_y, txPos))\n  );\n`\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/field-play/shaderGraph/DrawParticleGraph.js","const code = `\nvec4 encodeFloatRGBA(highp float val) {\n    if (val == 0.0) {\n        return vec4(0.0, 0.0, 0.0, 0.0);\n    }\n\n    float mag = abs(val);\n    float exponent = floor(log2(mag));\n    // Correct log2 approximation errors.\n    exponent += float(exp2(exponent) <= mag / 2.0);\n    exponent -= float(exp2(exponent) > mag);\n\n    float mantissa;\n    if (exponent > 100.0) {\n        // Not sure why this needs to be done in two steps for the largest float to work.\n        // Best guess is the optimizer rewriting '/ exp2(e)' into '* exp2(-e)',\n        // but exp2(-128.0) is too small to represent.\n        mantissa = mag / 1024.0 / exp2(exponent - 10.0) - 1.0;\n    } else {\n        mantissa = mag / float(exp2(exponent)) - 1.0;\n    }\n\n    float a = exponent + 127.0;\n    mantissa *= 256.0;\n    float b = floor(mantissa);\n    mantissa -= b;\n    mantissa *= 256.0;\n    float c = floor(mantissa);\n    mantissa -= c;\n    mantissa *= 128.0;\n    float d = floor(mantissa) * 2.0 + float(val < 0.0);\n    return vec4(a, b, c, d) / 255.0;\n}\n`\n\nexport default code;\n\n\n// WEBPACK FOOTER //\n// ./src/lib/field-play/shaderGraph/parts/encodeFloatRGBA.js","import BaseShaderNode from './BaseShaderNode';\nimport encodeFloatRGBA from './parts/encodeFloatRGBA';\nimport decodeFloatRGBA from './parts/decodeFloatRGBA';\n\n/**\n * Reads/writes particle coordinates from/to a texture;\n */\nexport default class TexturePosition extends BaseShaderNode {\n  constructor(isDecode) {\n    super();\n\n    // When it's decoding, it must read from the texture.\n    // Otherwise it must write to the texture;\n    this.isDecode = isDecode;\n  }\n\n  getFunctions() {\n    if (this.isDecode) {\n      return `\n    ${encodeFloatRGBA}\n    ${decodeFloatRGBA}\n`\n    }\n  }\n\n  getDefines() {\n    if (this.isDecode) {\n      // TODO: How to avoid duplication and silly checks?\n    return `\nprecision highp float;\n\nuniform sampler2D u_particles_x;\nuniform sampler2D u_particles_y;\n\n// Which coordinate needs to be printed onto the texture\nuniform int u_out_coordinate;\n\nvarying vec2 v_tex_pos;\n`;\n    }\n  }\n\n  getMainBody() {\n  if (this.isDecode) {\n    return `\n   vec2 pos = vec2(\n     decodeFloatRGBA(texture2D(u_particles_x, v_tex_pos)),\n     decodeFloatRGBA(texture2D(u_particles_y, v_tex_pos))\n   );\n`\n    }\n    return `\n    if (u_out_coordinate == 0) gl_FragColor = encodeFloatRGBA(newPos.x);\n    else if (u_out_coordinate == 1) gl_FragColor = encodeFloatRGBA(newPos.y);\n    else if (u_out_coordinate == 6) gl_FragColor = encodeFloatRGBA(get_velocity(pos).x);\n    else if (u_out_coordinate == 7) gl_FragColor = encodeFloatRGBA(get_velocity(pos).y);\n`\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/field-play/shaderGraph/TexturePositionNode.js","\nexport default function renderNodes(nodes) {\n  let code = [] \n\n  nodes.forEach(node => { if (node.getDefines) addToCode(node.getDefines()); });\n  nodes.forEach(node => { if (node.getFunctions) addToCode(node.getFunctions()); });\n\n  addToCode('void main() {')\n    nodes.forEach(node => { if (node.getMainBody) addToCode(node.getMainBody()); });\n  addToCode('}')\n  return code.join('\\n');\n\n  function addToCode(line) {\n    if (line) code.push(line)\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/field-play/shaderGraph/renderNodes.js","import BaseShaderNode from './BaseShaderNode';\n\nexport default class PanzoomTransform extends BaseShaderNode {\n  constructor(config) {\n    super();\n    // decode is used when we move particle read from the texture\n    // otherwise we write particle to texture and need to reverse transform\n    this.decode = config && config.decode;\n    this.srcPosName = (config && config.posName) || 'pos';\n  }\n\n  getDefines() {\n    if (this.decode) {\n      // TODO: Need to figure out how to not duplicate this.\n    return `\n  uniform vec2 u_min;\n  uniform vec2 u_max;\n`;\n    }\n  }\n\n  getMainBody() {\n    if (this.decode) {\n      return `\n  // move particle position according to current transform\n  vec2 du = (u_max - u_min);\n  pos.x = ${this.srcPosName}.x * du.x + u_min.x;\n  pos.y = ${this.srcPosName}.y * du.y + u_min.y;\n`\n    }\n    return `\n  pos.x = (${this.srcPosName}.x - u_min.x)/du.x;\n  pos.y = (${this.srcPosName}.y - u_min.y)/du.y;\n`\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/field-play/shaderGraph/PanzoomTransform.js","import BaseShaderNode from './BaseShaderNode';\nimport TexturePositionNode from './TexturePositionNode';\nimport renderNodes from './renderNodes';\nimport UserDefinedVelocityFunction from './UserDefinedVelocityFunction';\nimport PanzoomTransform from './PanzoomTransform';\nimport RungeKuttaIntegrator from './RungeKuttaIntegrator';\n\nexport default class UpdatePositionGraph {\n  constructor(options) {\n    this.readStoredPosition = new TexturePositionNode(/* isDecode = */ true);\n    this.udfVelocity = new UserDefinedVelocityFunction();\n    this.integratePositions = new RungeKuttaIntegrator();\n    this.dropParticles = new RandomParticleDropper();\n    this.writeComputedPosition = new TexturePositionNode(/* isDecode = */ false);\n    this.panZoomDecode = new PanzoomTransform({decode: true});\n    this.panZoomEncode = new PanzoomTransform({decode: false});\n\n    this.colorMode = options && options.colorMode;\n  }\n\n  setCustomVectorField(velocityCode) {\n    this.udfVelocity.setNewUpdateCode(velocityCode);\n  }\n\n  getVertexShader () {\n    return `precision highp float;\n\nattribute vec2 a_pos;\nvarying vec2 v_tex_pos;\nuniform vec2 u_min;\nuniform vec2 u_max;\n\nvoid main() {\n    v_tex_pos = a_pos;\n    gl_Position = vec4(1.0 - 2.0 * a_pos, 0, 1);\n}`\n  }\n\n  getFragmentShader() {\n    var nodes = [\n      this.readStoredPosition,\n      this.dropParticles,\n      this.udfVelocity,\n      this.integratePositions, {\n        getMainBody() {\n          return `\n  vec2 newPos = pos + velocity;\n  `\n        }\n      },\n      this.writeComputedPosition\n    ];\n    return renderNodes(nodes);\n  }\n}\n\nclass RandomParticleDropper extends BaseShaderNode {\n  getDefines() {\n    return `\nuniform float u_drop_rate;\nuniform float u_rand_seed;\nuniform vec2 u_min;\nuniform vec2 u_max;\n`\n  }\n\n  getFunctions() {\n    // TODO: Ideally this node should probably depend on\n    // random number generator node, so that we don't duplicate code\n    return `\n`\n  }\n\n  getMainBody() {\n    return `\n  // a random seed to use for the particle drop\n  vec2 seed = (pos + v_tex_pos) * u_rand_seed;\n  // drop rate is a chance a particle will restart at random position, to avoid degeneration\n  float drop = step(1.0 - u_drop_rate, rand(seed));\n\n  // TODO: This can be customized to produce various emitters\n  // random_pos is in range from 0..1, we move it to the bounding box:\n  vec2 random_pos = vec2(rand(seed + 1.9), rand(seed + 8.4)) * (u_max - u_min) + u_min;\n  pos = mix(pos, random_pos, drop);\n`;\n  }\n\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/field-play/shaderGraph/updatePositionGraph.js","/**\n * This file encodes/decodes float values into 32bit rgba array\n * \n * It is based on https://computergraphics.stackexchange.com/questions/4151/webgl-packing-unpacking-functions-that-can-roundtrip-all-typical-32-bit-floats\n * and it is not perfect. If you know how to improve it - please let me know.\n */\n\n/**\n * Encodes float value into output array\n * @param {float} val - value to be encode\n * @param {Uint8Array} out  - array where encoded value needs to be written.\n * @param {Number} writeOffset - offset in the original array where values should be written.\n */\nexport function encodeFloatRGBA(val, out, writeOffset) {\n  if (val == 0.0) {\n    out[writeOffset + 0] = 0; out[writeOffset + 1] = 0; out[writeOffset + 2] = 0; out[writeOffset + 3] = 0;\n    return;\n  }\n\n  var mag = Math.abs(val);\n  var exponent = Math.floor(Math.log2(mag));\n  // Correct log2 approximation errors.\n  exponent += (exp2(exponent) <= mag / 2.0) ? 1 : 0;\n  exponent -= (exp2(exponent) > mag) ? 1 : 0;\n\n  var mantissa;\n  if (exponent > 100.0) {\n      mantissa = mag / 1024.0 / exp2(exponent - 10.0) - 1.0;\n  } else {\n      mantissa = mag / (exp2(exponent)) - 1.0;\n  }\n\n  var a = exponent + 127.0;\n  mantissa *= 256.0;\n  var b = Math.floor(mantissa);\n  mantissa -= b;\n  mantissa *= 256.0;\n  var c = Math.floor(mantissa);\n  mantissa -= c;\n  mantissa *= 128.0;\n  var d = Math.floor(mantissa) * 2.0 + ((val < 0.0) ? 1: 0);\n\n  out[writeOffset + 0] = a; out[writeOffset + 1] = b; out[writeOffset + 2] = c; out[writeOffset + 3] = d;\n}\n\n/**\n * Given byte values in range [0..255] returns decoded float value.\n * \n * @param {Byte} r \n * @param {Byte} g \n * @param {Byte} b \n * @param {Byte} a \n */\nexport function decodeFloatRGBA(r, g, b, a) {\n  var A = Math.floor(r + 0.5);\n  var B = Math.floor(g + 0.5);\n  var C = Math.floor(b + 0.5);\n  var D = Math.floor(a + 0.5);\n\n  var exponent = A - 127.0;\n  var sign = 1.0 - (D % 2.0) * 2.0;\n  var mantissa = ((A > 0.0) ? 1 : 0)\n                  + B / 256.0\n                  + C / 65536.0\n                  + Math.floor(D / 2.0) / 8388608.0;\n  return sign * mantissa * exp2(exponent);\n}\n\nfunction exp2(exponent) { return Math.exp(exponent * Math.LN2); }\n\n\n// WEBPACK FOOTER //\n// ./src/lib/field-play/utils/floatPacking.js","/**\n * A simple interface to compute eventual min/max \n */\nexport default function makeStatCounter() {\n  var min, max;\n\n  var api = {\n    getMin() { return min; },\n    getMax() { return max; },\n    add(x) {\n      if (x < min) min = x;\n      if (x > max) max = x;\n    },\n    reset: reset\n  };\n\n  return api;\n\n  function reset() {\n    min = Number.POSITIVE_INFINITY;\n    max = Number.NEGATIVE_INFINITY;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/field-play/utils/makeStatCounter.js","import util from '../gl-utils';\nimport bus from '../bus';\nimport {decodeFloatRGBA} from '../utils/floatPacking';\nimport makeStatCounter from '../utils/makeStatCounter';\n\nconst OUT_V_X = 6;\nconst OUT_V_Y = 7;\n/**\n * This program allows to change color of each particle. It works by\n * reading current velocities into a texture from the framebuffer. Once\n * velocities are read, it checks velocity scale and passes it to a draw program.\n */\nexport default function colorProgram(ctx) {\n  var speedNeedsUpdate = true;\n  var {gl} = ctx;\n  var velocity_y_texture, velocity_x_texture;\n  var particleStateResolution;\n  var pendingSpeedUpdate;\n  var numParticles;\n  var velocityCounter = makeStatCounter();\n  var velocity_x;\n  var velocity_y;\n\n  listenToEvents();\n\n  return {\n    updateCode,\n    updateParticlesPositions,\n    updateParticlesCount,\n    setColorMinMax,\n    requestSpeedUpdate,\n    dispose\n  };\n\n  function listenToEvents() {\n    bus.on('integration-timestep-changed', requestSpeedUpdate);\n    bus.on('bbox-change', requestSpeedUpdate);\n    bus.on('refresh-speed', requestSpeedUpdate);\n  }\n\n  function dispose() {\n    bus.off('integration-timestep-changed', requestSpeedUpdate);\n    bus.off('bbox-change', requestSpeedUpdate);\n    bus.off('refresh-speed', requestSpeedUpdate);\n    disposeTextures();\n  }\n\n  function disposeTextures() {\n    if (velocity_x_texture) gl.deleteTexture(velocity_x_texture);\n    if (velocity_y_texture) gl.deleteTexture(velocity_y_texture);\n  }\n\n  function requestSpeedUpdate() {\n    if (pendingSpeedUpdate) clearTimeout(pendingSpeedUpdate);\n    pendingSpeedUpdate = setTimeout(() => {\n      speedNeedsUpdate = true;\n      pendingSpeedUpdate = 0;\n    }, 50);\n  }\n\n  function setColorMinMax(program) {\n    gl.uniform2f(program.u_velocity_range, velocityCounter.getMin(), velocityCounter.getMax());\n  }\n\n  function updateParticlesCount() {\n    disposeTextures();\n\n    particleStateResolution = ctx.particleStateResolution;\n    numParticles = particleStateResolution * particleStateResolution;\n\n    velocity_x = new Uint8Array(numParticles * 4);\n    velocity_y = new Uint8Array(numParticles * 4);\n    velocity_x_texture = util.createTexture(gl, gl.NEAREST, velocity_x, particleStateResolution, particleStateResolution);\n    velocity_y_texture = util.createTexture(gl, gl.NEAREST, velocity_y, particleStateResolution, particleStateResolution);\n\n    requestSpeedUpdate();\n  }\n\n  function updateCode() {\n    requestSpeedUpdate();\n  }\n\n  function updateParticlesPositions(program) {\n    if (!speedNeedsUpdate || !velocity_x || !velocity_y) return;\n    speedNeedsUpdate = false;\n\n    // We assume this is called from update position program\n    util.bindFramebuffer(gl, ctx.framebuffer, velocity_x_texture);\n    gl.uniform1i(program.u_out_coordinate, OUT_V_X);\n    gl.drawArrays(gl.TRIANGLES, 0, 6);\n    gl.readPixels(0, 0, particleStateResolution, particleStateResolution, gl.RGBA, gl.UNSIGNED_BYTE, velocity_x);\n\n    util.bindFramebuffer(gl, ctx.framebuffer, velocity_y_texture);\n    gl.uniform1i(program.u_out_coordinate, OUT_V_Y);\n    gl.drawArrays(gl.TRIANGLES, 0, 6);\n    gl.readPixels(0, 0, particleStateResolution, particleStateResolution, gl.RGBA, gl.UNSIGNED_BYTE, velocity_y);\n\n    updateMinMax();\n  }\n\n  function updateMinMax() {\n    velocityCounter.reset();\n    // TODO: Do I want this to be async?\n    for(var i = 0; i < velocity_y.length; i+=4) {\n      var vx = readFloat(velocity_x, i);\n      var vy = readFloat(velocity_y, i);\n      var v = Math.sqrt(vx * vx + vy * vy);\n      velocityCounter.add(v);\n    }\n  }\n}\n\nfunction readFloat(buffer, offset) {\n    return decodeFloatRGBA(\n      buffer[offset + 0],\n      buffer[offset + 1],\n      buffer[offset + 2],\n      buffer[offset + 3]\n    );\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/field-play/programs/colorProgram.js","/**\n * A wrapper over collection of textures. Can be used to represent\n * individual textures for every dimension.\n */\nimport glUtil from '../gl-utils';\n\nexport default function textureCollection(gl, dimensions, particleStateResolution) {\n  var textures = dimensions.map((d, index) => {\n    var textureInfo = {\n      texture: glUtil.createTexture(gl, gl.NEAREST, d.particleState, particleStateResolution, particleStateResolution),\n      index: index,\n      name: d.name\n    }\n\n    return textureInfo;\n  })\n\n  return {\n    dispose,\n    bindTextures,\n    assignProgramUniforms,\n    length: dimensions.length,\n    textures,\n    get(i) { return textures[i]; }\n  }\n\n  function assignProgramUniforms(program) {\n    textures.forEach(tInfo => {\n      gl.uniform1i(program['u_particles_' + tInfo.name], tInfo.index);\n    });\n  }\n\n  function dispose() {\n    textures.forEach(tInfo => gl.deleteTexture(tInfo.texture));\n  }\n\n  function bindTextures(gl, program) {\n    textures.forEach((tInfo) => {\n      glUtil.bindTexture(gl, tInfo.texture, tInfo.index);\n      gl.uniform1i(program['u_particles_' + tInfo.name], tInfo.index);\n    })\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/field-play/utils/textureCollection.js","import util from '../gl-utils';\nimport UpdatePositionGraph from '../shaderGraph/updatePositionGraph';\nimport ColorMode from './colorModes';\nimport makeReadProgram from './colorProgram';\nimport textureCollection from '../utils/textureCollection';\nimport makeStatCounter from '../utils/makeStatCounter';\nimport {decodeFloatRGBA} from '../utils/floatPacking';\nimport bus from '../bus';\n\nconst particlePositionShaderCodeBuilder = new UpdatePositionGraph();\n\nexport default function updatePositionProgram(ctx) {\n  var gl = ctx.gl;\n  var readTextures, writeTextures;\n  var particleStateResolution;\n  var updateProgram;\n  var readVelocity = makeReadProgram(ctx);\n\n  // If someone needs to get vectors out from the GPU, they send a `vector-lines-request`\n  // over the bus. This request is delayed until next compute frame. Once it is handled,\n  // we send them back response with calculated vectors.\n  var pendingVectorLines;\n\n  // TODO: need to make sure we are not leaking.\n  bus.on('vector-lines-request', putVectorLinesRequestIntoQueue);\n\n  return {\n    updateCode,\n    updateParticlesPositions,\n    updateParticlesCount,\n    prepareToDraw,\n  };\n\n  function updateCode(vectorField) {\n    particlePositionShaderCodeBuilder.setCustomVectorField(vectorField);\n    let fragment = particlePositionShaderCodeBuilder.getFragmentShader();\n    let vertex = particlePositionShaderCodeBuilder.getVertexShader();\n\n    let newProgram = util.createProgram(gl, vertex, fragment);\n\n    if (updateProgram) updateProgram.unload();\n    updateProgram = newProgram;\n\n    if (ctx.colorMode === ColorMode.VELOCITY) readVelocity.requestSpeedUpdate();\n  }\n  \n  function updateParticlesCount(x, y) {\n    particleStateResolution = ctx.particleStateResolution;\n\n    var dimensions = [{\n      name: 'x',\n      particleState: x\n    }, {\n      name: 'y',\n      particleState: y\n    }];\n\n    if (readTextures) readTextures.dispose();\n    readTextures = textureCollection(gl, dimensions, particleStateResolution);\n\n    if (writeTextures) writeTextures.dispose();\n    writeTextures = textureCollection(gl, dimensions, particleStateResolution);\n\n    readVelocity.updateParticlesCount();\n  }\n\n  function prepareToDraw(program) {\n    var colorMode = ctx.colorMode;\n    if (colorMode === ColorMode.VELOCITY) readVelocity.setColorMinMax(program);\n\n    readTextures.bindTextures(gl, program);\n  }\n\n  function updateParticlesPositions() {\n    var program = updateProgram;\n    gl.useProgram(program.program);\n  \n    util.bindAttribute(gl, ctx.quadBuffer, program.a_pos, 2);\n  \n    ctx.inputs.updateBindings(program);\n\n    // TODO: Remove this.\n    if (ctx.audioTexture) {\n      util.bindTexture(gl, ctx.audioTexture, 5);\n      gl.uniform1i(program['u_audio'], 5);\n    }\n\n    readTextures.bindTextures(gl, program);\n  \n    gl.uniform1f(program.u_rand_seed, ctx.frameSeed);\n    gl.uniform1f(program.u_h, ctx.integrationTimeStep);\n    gl.uniform1f(program.frame, ctx.frame);\n    var cursor = ctx.cursor;\n    gl.uniform4f(program.cursor, cursor.clickX, cursor.clickY, cursor.hoverX, cursor.hoverY);\n\n    var bbox = ctx.bbox;\n    gl.uniform2f(program.u_min, bbox.minX, bbox.minY);\n    gl.uniform2f(program.u_max, bbox.maxX, bbox.maxY);\n\n    gl.uniform1f(program.u_drop_rate, ctx.dropProbability);\n  \n    // Draw each coordinate individually\n    for(var i = 0; i < writeTextures.length; ++i) {\n      var writeInfo = writeTextures.get(i);\n      gl.uniform1i(program.u_out_coordinate, i);\n      util.bindFramebuffer(gl, ctx.framebuffer, writeInfo.texture);\n      gl.viewport(0, 0, particleStateResolution, particleStateResolution);\n      gl.drawArrays(gl.TRIANGLES, 0, 6);\n    }\n\n    // TODO: I think I need to keep this time-bound, i.e. allocate X ms to\n    // process particle positions, and move on. So that the rendering thread is not paused for too long\n    if (ctx.colorMode === ColorMode.VELOCITY) {\n      readVelocity.updateParticlesPositions(program);\n    }\n\n    if (pendingVectorLines) {\n      processVectorLinesRequest(program);\n      pendingVectorLines = null;\n    }\n\n    // swap the particle state textures so the new one becomes the current one\n    var temp = readTextures;\n    readTextures = writeTextures;\n    writeTextures = temp;\n  }\n\n  function putVectorLinesRequestIntoQueue(request) {\n    pendingVectorLines = request;\n  }\n\n  function processVectorLinesRequest(program) {\n    // TODO: Move this out\n    var dimensions = [{\n      name: 'x',\n      particleState: pendingVectorLines.x\n    }, {\n      name: 'y',\n      particleState: pendingVectorLines.y\n    }];\n\n    // We create temporary textures and load requested positions in there\n    var resolutionOfParticlesInRequest = pendingVectorLines.resolution;\n    var numParticles = resolutionOfParticlesInRequest * resolutionOfParticlesInRequest;\n\n    var texturesForRead = textureCollection(gl, dimensions, resolutionOfParticlesInRequest);\n    var texturesForWrite = textureCollection(gl, dimensions, resolutionOfParticlesInRequest);\n\n    texturesForRead.bindTextures(gl, program);\n\n    // Then we request coordinates out from GPU for each dimension\n    var writeInfo = texturesForWrite.get(0);\n    gl.uniform1i(program.u_out_coordinate, 6); // v_x\n\n    util.bindFramebuffer(gl, ctx.framebuffer, writeInfo.texture);\n    gl.viewport(0, 0, resolutionOfParticlesInRequest, resolutionOfParticlesInRequest);\n    gl.drawArrays(gl.TRIANGLES, 0, 6);\n\n    var velocity_x = new Uint8Array(numParticles * 4);\n    gl.readPixels(0, 0, resolutionOfParticlesInRequest, resolutionOfParticlesInRequest, gl.RGBA, gl.UNSIGNED_BYTE, velocity_x);\n\n    gl.uniform1i(program.u_out_coordinate, 7); // v_y\n    writeInfo = texturesForWrite.get(1);\n    util.bindFramebuffer(gl, ctx.framebuffer, writeInfo.texture);\n    gl.viewport(0, 0, resolutionOfParticlesInRequest, resolutionOfParticlesInRequest);\n    gl.drawArrays(gl.TRIANGLES, 0, 6);\n\n    var velocity_y = new Uint8Array(numParticles * 4);\n    gl.readPixels(0, 0, resolutionOfParticlesInRequest, resolutionOfParticlesInRequest, gl.RGBA, gl.UNSIGNED_BYTE, velocity_y);\n\n    texturesForWrite.dispose();\n    texturesForRead.dispose();\n\n    var xStats = makeStatCounter();\n    var yStats = makeStatCounter();\n\n    var decoded_velocity_x = new Float32Array(numParticles);\n    var decoded_velocity_y = new Float32Array(numParticles);\n    for(var i = 0; i < velocity_y.length; i+=4) {\n      var idx = i/4;\n      var vx = readFloat(velocity_x, i);\n      var vy = readFloat(velocity_y, i);\n      decoded_velocity_x[idx] = vx;\n      decoded_velocity_y[idx] = vy;\n      xStats.add(vx);\n      yStats.add(vy);\n    }\n\n    var vectorLineInfo = {\n      xStats,\n      yStats,\n      decoded_velocity_x,\n      decoded_velocity_y,\n      resolution: resolutionOfParticlesInRequest\n    };\n\n    bus.fire('vector-line-ready', vectorLineInfo);\n  }\n}\n\nfunction readFloat(buffer, offset) {\n    return decodeFloatRGBA(\n      buffer[offset + 0],\n      buffer[offset + 1],\n      buffer[offset + 2],\n      buffer[offset + 3]\n    );\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/field-play/programs/updatePositionProgram.js","import appState from './appState';\n\nconst defaultConfig = {\n  // I need to flash our more details before making any promises.\n  isAudioEnabled: false,\n  // this allows to render an overlay grid with vectors. Enable it\n  // and drag the scene a little bit.\n  vectorLinesEnabled: false,\n\n  // Starting from which texture unit we can bind custom inputs?\n  FREE_TEXTURE_UNIT: 4,\n\n  // whether input bindings should be visible\n  showBindings: appState.getQS().get('showBindings') || false\n}\n\nexport default defaultConfig;\n\n\n// WEBPACK FOOTER //\n// ./src/lib/field-play/config.js","import bus from '../bus';\nimport glUtil from '../gl-utils';\n\nexport default audioProgram;\n\nfunction audioProgram(ctx) {\n  var gl = ctx.gl;\n\n  var audioWidth = 8, audioHeight = 8;\n  var audioBuffer = new Uint8Array(audioWidth * audioHeight * 4);\n  var audioTexture = glUtil.createTexture(gl, gl.NEAREST, audioBuffer, audioWidth, audioHeight);\n  var audioDirty = false;\n  ctx.audioTexture = audioTexture;\n\n  bus.on('audio', updateAudioBuffer);\n\n  return {\n    updateTextures,\n    dispose\n  };\n\n  function dispose() {\n    bus.off('audio', updateAudioBuffer);\n    gl.deleteTexture(audioTexture);\n  }\n\n  function updateTextures() {\n    if (!audioDirty) return;\n    audioDirty = false;\n\n    // TODO: This should come from fftSize?\n    var width = 5, height = 5;\n    gl.bindTexture(gl.TEXTURE_2D, audioTexture);\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, width, height, 0, gl.RGBA, gl.UNSIGNED_BYTE, audioBuffer);\n    gl.bindTexture(gl.TEXTURE_2D, null);\n  }\n\n  function updateAudioBuffer(newBuffer) {\n    audioBuffer = newBuffer;\n    audioDirty = true;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/field-play/programs/audioProgram.js","import util from '../gl-utils';\nimport DrawParticleGraph from '../shaderGraph/DrawParticleGraph';\nimport makeUpdatePositionProgram from './updatePositionProgram';\nimport { encodeFloatRGBA } from '../utils/floatPacking.js';\nimport config from '../config';\nimport createAudioProgram from './audioProgram';\n\n/**\n * This program manages particles life-cycle. It updates particles positions\n * and initiates drawing them on screen.\n * \n * @param {Object} ctx rendering context. Holds WebGL state\n */\nexport default function drawParticlesProgram(ctx) {\n  var gl = ctx.gl;\n\n  var particleStateResolution, particleIndexBuffer;\n  var numParticles;\n\n  var currentVectorField = '';\n  var updatePositionProgram = makeUpdatePositionProgram(ctx);\n  var audioProgram;\n\n  var drawProgram;\n  initPrograms();\n\n  return {\n    updateParticlesCount,\n    updateParticlesPositions,\n    drawParticles,\n    updateCode,\n    updateColorMode\n  }\n\n  function initPrograms() {\n    // need to update the draw graph because color mode shader has changed.\n    initDrawProgram();\n\n    if (config.isAudioEnabled) {\n      if (audioProgram) audioProgram.dispose();\n      audioProgram = createAudioProgram(ctx);\n    }\n  }\n\n  function initDrawProgram() {\n    if (drawProgram) drawProgram.unload();\n\n    const drawGraph = new DrawParticleGraph(ctx);\n    const vertexShaderCode = drawGraph.getVertexShader(currentVectorField);\n    drawProgram = util.createProgram(gl, vertexShaderCode, drawGraph.getFragmentShader());\n  }\n\n  function updateParticlesPositions() {\n    if (!currentVectorField) return;\n\n    ctx.frame += 1\n    ctx.frameSeed = Math.random();\n\n    // TODO: Remove this.\n    if (audioProgram) audioProgram.updateTextures();\n\n    updatePositionProgram.updateParticlesPositions();\n  }\n\n  function updateColorMode() {\n    initDrawProgram();\n  }\n\n  function updateCode(vfCode) {\n    ctx.frame = 0;\n    currentVectorField = vfCode;\n    updatePositionProgram.updateCode(vfCode);\n\n    initDrawProgram();\n  }\n\n  function updateParticlesCount() {\n    particleStateResolution = ctx.particleStateResolution;\n    numParticles = particleStateResolution * particleStateResolution;\n    var particleIndices = new Float32Array(numParticles);\n    var particleStateX = new Uint8Array(numParticles * 4);\n    var particleStateY = new Uint8Array(numParticles * 4);\n\n    var minX = ctx.bbox.minX; var minY = ctx.bbox.minY;\n    var width = ctx.bbox.maxX - minX;\n    var height = ctx.bbox.maxY - minY;\n    for (var i = 0; i < numParticles; i++) {\n      encodeFloatRGBA((Math.random()) * width + minX, particleStateX, i * 4); // randomize the initial particle positions\n      encodeFloatRGBA((Math.random()) * height + minY, particleStateY, i * 4); // randomize the initial particle positions\n\n      particleIndices[i] = i;\n    }\n\n    if (particleIndexBuffer) gl.deleteBuffer(particleIndexBuffer);\n    particleIndexBuffer = util.createBuffer(gl, particleIndices);\n\n    updatePositionProgram.updateParticlesCount(particleStateX, particleStateY);\n  }\n\n  function drawParticles() {\n    if (!currentVectorField) return;\n\n    var program = drawProgram;\n    gl.useProgram(program.program);\n  \n    util.bindAttribute(gl, particleIndexBuffer, program.a_index, 1);\n    \n    updatePositionProgram.prepareToDraw(program);\n    ctx.inputs.updateBindings(program);\n  \n    gl.uniform1f(program.u_h, ctx.integrationTimeStep);\n    gl.uniform1f(program.frame, ctx.frame);\n    gl.uniform1f(program.u_particles_res, particleStateResolution);\n    var bbox = ctx.bbox;\n    gl.uniform2f(program.u_min, bbox.minX, bbox.minY);\n    gl.uniform2f(program.u_max, bbox.maxX, bbox.maxY);\n  \n    var cursor = ctx.cursor;\n    gl.uniform4f(program.cursor, cursor.clickX, cursor.clickY, cursor.hoverX, cursor.hoverY);\n    gl.drawArrays(gl.POINTS, 0, numParticles); \n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/field-play/programs/drawParticlesProgram.js","/**\n * XMLHttpRequest wrapped into a promise.\n * \n * @param {String} url \n */\nexport default function request(url, options) {\n  if (!options) options = {};\n\n  return new Promise(download);\n\n  function download(resolve, reject) {\n    var req = new XMLHttpRequest();\n\n    if (typeof options.progress === 'function') {\n      req.addEventListener('progress', updateProgress, false);\n    }\n\n    req.addEventListener('load', transferComplete, false);\n    req.addEventListener('error', transferFailed, false);\n    req.addEventListener('abort', transferCanceled, false);\n\n    req.open('GET', url);\n    if (options.responseType) {\n      req.responseType = options.responseType;\n    }\n    req.send(null);\n\n    function updateProgress(e) {\n      if (e.lengthComputable) {\n        options.progress({\n          loaded: e.loaded,\n          total: e.total,\n          percent: e.loaded / e.total\n        });\n      }\n    }\n\n    function transferComplete() {\n      if (req.status !== 200) {\n        reject(`Unexpected status code ${req.status} when calling ${url}`);\n        return;\n      }\n      var response = req.response;\n\n      if (options.responseType === 'json' && typeof response === 'string') {\n        // IE\n        response = JSON.parse(response);\n      }\n\n      resolve(response);\n    }\n\n    function transferFailed() {\n      reject(`Failed to download ${url}`);\n    }\n\n    function transferCanceled() {\n      reject(`Cancelled download of ${url}`);\n    }\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/field-play/utils/request.js","var loadedLinks = new Map(); // from link to response\nimport request from '../utils/request';\n\nexport default function fetchGLSL(link) {\n  if (!link) return Promise.reject('Missing link')\n  var trimmed = link.trim();\n  if (!trimmed) return Promise.reject('Missing link');\n\n  let cachedResponse = loadedLinks.get(trimmed)\n  if (cachedResponse) return Promise.resolve(cachedResponse);\n\n  return request(link).then(code => {\n    loadedLinks.set(link, code);\n    return code;\n  });\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/field-play/editor/fetchGLSL.js","import fetchGLSL from './fetchGLSL.js';\n\nvar pragmaInclude = '#include ';\nvar nullCode = { code: '' }\n\n/**\n * Naively parses glsl code and tries to replace all `#pragma` statements\n * with empty string. Gives structured collection of pragma statements back\n * \n * @param {String} code \n */\nexport default function makePragmaParser(code) {\n  if (!code) return new Promise(resolve => resolve(nullCode));\n\n  var parsedLines = processLineByLine(code);\n  if (parsedLines.pending.length > 0) {\n    return Promise.all(parsedLines.pending).then(() => parsedLines)\n      .catch(error => { return {error: {error}}; });\n  }\n\n  return new Promise(resolve => resolve(parsedLines));\n}\n\nfunction processLineByLine(code) {\n  var pending = []\n  var lines = code.split('\\n');\n  var outputLines = [];\n  var currentIndex = 0;\n  lines.forEach((line, index) => {\n    currentIndex = index;\n    if (line && line[0] === '#') {\n      outputLines.push('');\n      processPragma(line);\n    } else {\n      outputLines.push(line);\n    }\n  });\n\n  return {\n    getCode,\n    pending\n  };\n\n  function getCode() {\n    return outputLines.join('\\n');\n  }\n\n  function processPragma(line) {\n    if (line.indexOf(pragmaInclude) === 0) {\n      var include = line.substr(pragmaInclude.length);\n      var insertIndex = currentIndex;\n      pending.push(fetchGLSL(include).then(code => {\n        outputLines[insertIndex] = code\n      }))\n    }\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/field-play/editor/pragmaParser.js","/**\n * This module parses user defined vector field code.\n */\n\nimport bus from '../bus';\nimport pragmaParse from './pragmaParser';\n\n// This is naive parser that is being used until the real `glsl-parser`\n// is loaded asynchronously. This parser assumes there are no errors\n// TODO: maybe I should be more careful here?\nvar glslParser = {\n  check(code) {\n    return {\n      code,\n      log: {\n        errorCount: 0\n      }\n    };\n  }\n};\n\n// glsl-parser is ~179KB uncompressed, we don't want to wait until it is downloaded.\n// So we load it asynchronously...\nrequire.ensure('glsl-parser', () => {\n  // ... and replace the naive parser with the real one, when ready.\n  glslParser = require('glsl-parser');\n\n  // notify interested parties, so that they can recheck code if they wish.\n  bus.fire('glsl-parser-ready'); \n});\n\nvar vectorFieldGlobals = `\nimport {\n  float PI;\n  float snoise(vec2 v);\n  float frame;\n  vec4 cursor;\n  vec2 rotate(vec2 p,float a);\n  float audio(float index);\n  float rand(const vec2 co);\n  sampler2D input0;\n  sampler2D input1;\n}`;\n\n/**\n * Given a string, verifies that it is a valid glsl code for a vector field,\n * and then returns code + log.\n * \n * @param {String} vectorFieldCode \n */\nexport default function getParsedVectorFieldFunction(vectorFieldCode) {\n  // TODO: what if we want to support 3d?\n  return pragmaParse(vectorFieldCode).then(pragmaParseResult => {\n    if (pragmaParseResult.error) {\n      return pragmaParseResult;\n    }\n\n    vectorFieldCode = pragmaParseResult.getCode();\n\n    var parserResult = glslParser.check(vectorFieldCode, { globals: vectorFieldGlobals });\n    parserResult.code = vectorFieldCode;\n\n    if (parserResult.log.errorCount) parserResult.error = parserError(parserResult.log);\n\n    return parserResult;\n  });\n}\n\nfunction parserError(log) {\n  let diag = log.diagnostics[0];\n  // TODO probably need to check kind (errors are 0, warnings are 1)\n  let firstError = diag.range;\n  let lineColumn = firstError.lineColumn();\n  let source = firstError.source;\n  let offset = source._lineOffsets[lineColumn.line]\n  let line = source.contents.substr(offset,  lineColumn.column);\n  line += source.contents.substring(firstError.start, firstError.end);\n  let prefix = 'Line ' + lineColumn.line + ': ';\n  let diagText = diag.text;\n  return {\n    error: \n      prefix + line + '\\n' +\n      whitespace(prefix.length) + whitespace(lineColumn.column) + '^',\n    errorDetail: diagText,\n    isFloatError: isFloatError(diagText)\n  };\n}\n\nfunction isFloatError(diagText) {\n  return diagText.indexOf('\"int\"') > -1 &&\n    diagText.indexOf('\"float\"')  > -1;\n}\n\nfunction whitespace(length) {\n  return new Array(length + 1).join(' ');\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/field-play/editor/getParsedVectorFieldFunction.js","import bus from '../bus';\nimport appState from '../appState';\nimport getParsedVectorFieldFunction from './getParsedVectorFieldFunction';\n\n/**\n * A text editor state for the vector field equation. Manages vector field\n * program compilation and error reporting state.\n *\n * @param {Object} drawProgram \n */\nexport default function createVectorFieldEditorState(drawProgram) {\n  bus.on('glsl-parser-ready', parseCode);\n  var currentVectorFieldVersion = 0;\n\n  // What is the current code?\n  var currentVectorFieldCode = appState.getCode();\n\n  // For delayed parsing result verification (e.g. when vue is loaded it\n  // can request us to see if there were any errors)\n  var parserResult;\n\n  loadCodeFromAppState();\n\n  var api = {\n    getCode,\n    setCode,\n    dispose,\n\n    // These properties are for UI only\n    code: currentVectorFieldCode,\n    error: '',\n    errorDetail: '',\n    isFloatError: false \n  };\n\n  return api;\n\n  function dispose() {\n    bus.off('glsl-parser-ready', parseCode);\n  }\n\n  function getCode() {\n    return appState.getCode();\n  }\n\n  function setCode(vectorFieldCode) {\n    if (vectorFieldCode === currentVectorFieldCode) {\n      // If field hasn't changed, let's make sure that there was no previous\n      // error\n      if (parserResult && parserResult.error) {\n        // And if there was error, let's revalidate code:\n        parseCode();\n      }\n      return;\n    } \n\n    trySetNewCode(vectorFieldCode).then((result) => {\n      if (result.cancelled) return;\n\n      if (result && result.error) {\n        updateErrorInfo(result.error);\n        return result;\n      }\n\n      currentVectorFieldCode = vectorFieldCode;\n      api.code = vectorFieldCode;\n      appState.saveCode(vectorFieldCode);\n    });\n  }\n\n  function updateErrorInfo(parserResult) {\n    if (parserResult && parserResult.error) {\n      api.error = parserResult.error;\n      api.errorDetail = parserResult.errorDetail;\n      api.isFloatError = parserResult.isFloatError;\n    } else {\n      api.error = '';\n      api.errorDetail = '';\n      api.isFloatError = false;\n    }\n  }\n\n  function loadCodeFromAppState() {\n    let persistedCode = appState.getCode();\n    if (persistedCode) {\n      trySetNewCode(persistedCode).then(result => {\n        if (!result.error) return; // This means we set correctly;\n        // If we get here - something went wrong. see the console\n        console.error('Failed to restore previous vector field: ', result.error);\n        // Let's use default vector field\n        trySetNewCode(appState.getDefaultCode());\n      });\n    } else {\n      // we want a default vector field\n      trySetNewCode(appState.getDefaultCode());\n    }\n  }\n\n  function parseCode(customCode) {\n    return getParsedVectorFieldFunction(customCode || currentVectorFieldCode)\n      .then(currentResult => {\n        parserResult = currentResult\n        updateErrorInfo(parserResult.error);\n        return parserResult;\n      });\n  }\n\n  function trySetNewCode(vectorFieldCode) {\n    currentVectorFieldVersion += 1;\n    var capturedVersion = currentVectorFieldVersion;\n    // step 1 - run through parser\n    return parseCode(vectorFieldCode).then(parserResult => {\n      if (capturedVersion !== currentVectorFieldVersion) {\n        parserResult.cancelled = true;\n        // a newer request was issued. Ignore these results.\n        return parserResult;\n      }\n\n      if (parserResult.error) {\n        return parserResult;\n      }\n      // step 2 - run through real webgl\n      try {\n        drawProgram.updateCode(parserResult.code);\n        return parserResult;\n      } catch (e) {\n        return {\n          error: {\n            error: e.message\n          }\n        }\n      }\n    });\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/field-play/editor/vectorFieldState.js","/**\n * Collection of input bindings. Individual program works with this collection\n * to command it update texture bindings.\n */\nexport default function createInputCollection() {\n  var boundInputs = new Map() \n  var currentProgram;\n  return {\n    updateBindings,\n    bindInput,\n  }\n\n  function bindInput(inputIndex, inputBinding) {\n    var prevBinding = boundInputs.get(inputIndex);\n    if (prevBinding) {\n      prevBinding.dispose();\n    }\n    boundInputs.set(inputIndex, inputBinding);\n  }\n\n  function updateBindings(program) {\n    currentProgram = program;\n    boundInputs.forEach(updateInputBinding);\n  }\n\n  function updateInputBinding(input, inputIndex) {\n    input.updateBinding(currentProgram, inputIndex);\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/field-play/programs/inputs/inputCollection.js","// https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/Tutorial/Using_textures_in_WebGL\nexport default function loadTexture(gl, url) {\n  var resolveTexture, rejectTexture;\n\n  var image = new Image();\n  image.crossOrigin = '';\n\n  image.onload = bindTexture;\n  image.onerror = reportError;\n  image.src = url;\n\n  return new Promise((resolve, reject) => {\n    resolveTexture = resolve;\n    rejectTexture = reject;\n  });\n\n  function reportError(err) {\n    rejectTexture(err);\n  }\n\n  function bindTexture() {\n    var texture = gl.createTexture();\n    var level = 0;\n    var internalFormat = gl.RGBA;\n    var srcFormat = gl.RGBA;\n    var srcType = gl.UNSIGNED_BYTE;\n    gl.bindTexture(gl.TEXTURE_2D, texture);\n    gl.texImage2D(gl.TEXTURE_2D, level, internalFormat,\n                  srcFormat, srcType, image);\n\n    if (isPowerOf2(image.width) && isPowerOf2(image.height)) {\n       gl.generateMipmap(gl.TEXTURE_2D);\n    } else {\n       gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n       gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n       gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n    }\n\n    resolveTexture(texture);\n  }\n}\n\nfunction isPowerOf2(value) {\n  return (value & (value - 1)) == 0;\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/field-play/programs/inputs/loadTexture.js","/**\n * Creates a single image binding element in the input collection.\n */\nimport loadTexture from \"./loadTexture\";\nimport glUtils from '../../gl-utils';\nimport config from '../../config';\nimport bus from '../../bus';\n\nconst FREE_TEXTURE_UNIT = config.FREE_TEXTURE_UNIT;\n\nexport default function createImageInputBinding(ctx, url, callbacks) {\n  var texture = null;\n  loadTexture(ctx.gl, url).then(setTexture).catch(handleError);\n\n  return {\n    updateBinding,\n    dispose() {\n      // TODO: Potential race condition, as loadTexture is async.\n      ctx.gl.deleteTexture(texture);\n    }\n  }\n\n  function handleError(err) {\n    if (callbacks && callbacks.error) {\n      callbacks.error(err);\n    }\n  }\n\n  function setTexture(loadedTexture) {\n    texture = loadedTexture;\n    bus.fire('refresh-speed')\n    if (callbacks && callbacks.done) {\n      callbacks.done(url);\n    }\n  }\n\n  function updateBinding(program, inputIndex) {\n    if (!texture) return;\n\n    var realIndex = inputIndex + FREE_TEXTURE_UNIT;\n    glUtils.bindTexture(ctx.gl, texture, realIndex);\n    ctx.gl.uniform1i(program[`input${inputIndex}`], realIndex);\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/field-play/programs/inputs/imageInput.js","import createInputCollection from './programs/inputs/inputCollection';\nimport createVideoInput from './programs/inputs/videoInput';\nimport createImageInputBinding from './programs/inputs/imageInput';\nimport appState from './appState.js';\n\n// Allows to bind media elements to vector field\nexport default function createInputsModel(ctx) {\n  ctx.inputs = createInputCollection();\n  var inputs = [];\n  readInputsFromAppState();\n\n  var api = {\n    getInputs,\n    addInput,\n  };\n\n  return api;\n\n  function getInputs() {\n    return inputs;\n  }\n\n  function addInput(inputNumber) {\n    var vm = createInputElementViewModel(ctx, inputNumber);\n    inputs.push(vm);\n    return vm;\n  }\n\n  function readInputsFromAppState() {\n    var i0 = appState.getQS().get('i0');\n    if (i0) {\n      var vm = addInput(0);\n      vm.link = i0;\n      vm.updateBinding(/* immediate = */ true);\n    }\n  }\n}\n\nfunction createInputElementViewModel(ctx, inputNumber) {\n  var pendingUpdate = null;\n\n  var input = {\n    link: '',\n    error: null,\n    name: `input${inputNumber}`,\n    updateBinding\n  }\n\n  return input;\n\n  function updateBinding(immediate) {\n    if (pendingUpdate) {\n      clearTimeout(pendingUpdate);\n      pendingUpdate = null;\n    }\n\n    if (immediate) {\n      setBinding();\n    } else {\n      pendingUpdate = setTimeout(setBinding, 300);\n    }\n  }\n\n  function setBinding() {\n    input.error = null;\n    pendingUpdate = null;\n    var binding = createImageInputBinding(ctx, input.link, {\n      done() {\n        // TODO: Preview\n        appState.getQS().set(`i${inputNumber}`, input.link);\n      },\n      error(err) {\n        // TODO: Better Error checking\n        input.error = err;\n      }\n    });\n    ctx.inputs.bindInput(0, binding);\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/field-play/createInputsModel.js","/**\n * This file is based on https://github.com/mapbox/webgl-wind\n * by Vladimir Agafonkin\n *\n * Released under ISC License, Copyright (c) 2016, Mapbox\n * https://github.com/mapbox/webgl-wind/blob/master/LICENSE\n *\n * Adapted to field maps by Andrei Kashcha\n * Copyright (C) 2017\n */\nimport util from './gl-utils';\nimport bus from './bus';\nimport appState from './appState';\n\nimport createScreenProgram from './programs/screenProgram';\nimport createDrawParticlesProgram from './programs/drawParticlesProgram';\nimport createVectorFieldEditorState from './editor/vectorFieldState';\nimport createInputsModel from './createInputsModel';\n\nconst INITIAL_SPEED = 1;\n\nfunction integrationTimeStepFromSpeed(speed) {\n  return speed * 0.004;\n}\n\nfunction fadeOutFromSpeed(speed) {\n  return 1 - speed * 0.002;\n}\n\n/**\n * Kicks offs the app rendering. Initialized before even vue is loaded.\n *\n * @param {WebGLRenderingContext} gl\n */\nexport default function initScene(gl) {\n  // Canvas size management\n  var canvasRect = { width: 0, height: 0, top: 0, left: 0 };\n  setWidthHeight(window.innerWidth, window.innerHeight);\n  window.addEventListener('resize', onResize, true);\n\n  // TODO: It feels like bounding box management needs to be moved out from here.\n  // TODO: bbox needs to be a class with width/height properties.\n  var bbox = appState.getBBox() || {};\n  var currentPanZoomTransform = {\n    scale: 0.1,\n    x: window.innerWidth / 2,\n    y: window.innerHeight / 2\n  };\n\n  // How many particles do we want?\n  var particleCount = appState.getParticleCount();\n\n  gl.disable(gl.DEPTH_TEST);\n  gl.disable(gl.STENCIL_TEST);\n\n  // Context variable is a way to share rendering state between multiple programs. It has a lot of stuff on it.\n  // I found that it's the easiest way to work in state-full world of WebGL.\n  // Until I discover a better way to write WebGL code.\n  var ctx = {\n    gl,\n    bbox,\n    canvasRect,\n\n    inputs: null,\n\n    framebuffer: gl.createFramebuffer(),\n\n    // This is used only to render full-screen rectangle. Main magic happens inside textures.\n    quadBuffer: util.createBuffer(gl, new Float32Array([0, 0, 1, 0, 0, 1, 0, 1, 1, 0, 1, 1])),\n\n    colorMode: appState.getColorMode(),\n    colorFunction: appState.getColorFunction(),\n\n    // This defines texture unit for screen rendering. First few indices are taken by textures\n    // that compute particles position/color\n    // TODO: I need to find a better way to manage this.\n    screenTextureUnit: 3,\n\n    speed: INITIAL_SPEED,\n    integrationTimeStep: integrationTimeStepFromSpeed(INITIAL_SPEED),\n\n    // On each frame the likelihood for a particle to reset its position is this:\n    dropProbability: appState.getDropProbability(),\n\n    // current frame number. Reset every time when new shader is compiled\n    frame: 0,\n\n    // TOREMOVE\n    // Information about mouse cursor. Could be useful to simplify\n    // exploration\n    cursor: {\n      // Where mouse was last time clicked (or tapped)\n      clickX: 0, clickY: 0,\n      // where mouse was last time moved. If this is a touch device\n      // this is the same as clickX, clickY\n      hoverX: 0, hoverY: 0\n    },\n\n    // Texture size to store particles' positions\n    particleStateResolution: 0,\n\n    // How quickly we should fade previous frame (from 0..1)\n    fadeOpacity: fadeOutFromSpeed(INITIAL_SPEED),\n\n    backgroundColor: { r: 0, g: 0, b: 0, a: 1 },\n\n    // Ignore this one for a moment. Yes, the app support web audio API,\n    // but it's rudimentary, so... shhh! it's a secret.\n    // Don't shhh on me!\n    audioTexture: null\n  };\n\n  // Frame management\n  var lastAnimationFrame;\n  var lastAnimationFrameTime;\n  var isPaused = false;\n\n  var inputsModel = createInputsModel(ctx);\n\n  // screen rendering;\n  var screenProgram = createScreenProgram(ctx);\n  var drawProgram = createDrawParticlesProgram(ctx);\n  // var cursorUpdater = createCursorUpdater(ctx);\n  var vectorFieldEditorState = createVectorFieldEditorState(drawProgram);\n\n  // particles\n  updateParticlesCount(particleCount);\n\n  var api = {\n    start: nextFrame,\n    stop,\n    dispose,\n\n    setPaused,\n\n    getParticlesCount,\n    setParticlesCount,\n\n    setFadeOutSpeed,\n    getFadeOutSpeed,\n\n    setDropProbability,\n    getDropProbability,\n\n    getSpeed,\n    setSpeed,\n\n    setColorMode,\n    getColorMode,\n\n    setColorFunction,\n    getColorFunction,\n\n    vectorFieldEditorState,\n\n    inputsModel,\n\n    setBackgroundColor,\n\n    getCanvasRect() {\n      // We trust they don't do anything bad with this ...\n      return canvasRect;\n    },\n\n    getBoundingBox() {\n      // again, we trust. Maybe to much?\n      return ctx.bbox;\n    }\n  }\n\n  restoreBBox();\n\n  setTimeout(() => {\n    bus.fire('scene-ready', api);\n  })\n\n  return api;\n\n  function assignIfPossible(change, key, newBoundingBox) {\n    var value = Number.parseFloat(change[key]);\n    if (Number.isFinite(value)) {\n      newBoundingBox[key] = value;\n    }\n  }\n\n\n  function setColorMode(x) {\n    var mode = parseInt(x, 10);\n    ctx.colorMode = mode;\n    drawProgram.updateColorMode(mode);\n  }\n\n  function getColorMode() {\n    return ctx.colorMode;\n  }\n\n  function setColorFunction(code) {\n    ctx.colorFunction = code;\n    drawProgram.updateColorMode(ctx.colorMode);\n  }\n\n  function getColorFunction() {\n    return ctx.colorFunction;\n  }\n\n  function getSpeed() {\n    return ctx.speed;\n  }\n\n  function setSpeed(x) {\n    var f = parseFloat(x);\n    if (Number.isFinite(f)) {\n      ctx.speed = f;\n      ctx.integrationTimeStep = integrationTimeStepFromSpeed(speed);\n      ctx.fadeOpacity = fadeOutFromSpeed(speed);\n      bus.fire('integration-timestep-changed', ctx.integrationTimeStep);\n    }\n  }\n\n  function setPaused(shouldPause) {\n    isPaused = shouldPause;\n    nextFrame();\n  }\n\n  // Main screen fade out configuration\n  function setFadeOutSpeed(x) {\n    var f = parseFloat(x);\n    if (Number.isFinite(f)) {\n      ctx.fadeOpacity = f;\n      appState.setFadeout(f);\n    }\n  }\n\n  function getFadeOutSpeed() {\n    return appState.getFadeout();\n  }\n\n  // Number of particles configuration\n  function getParticlesCount() {\n    return appState.getParticleCount();\n  }\n\n  function setParticlesCount(newParticleCount) {\n    if (!Number.isFinite(newParticleCount)) return;\n    if (newParticleCount === particleCount) return;\n    if (newParticleCount < 1) return;\n\n    updateParticlesCount(newParticleCount);\n\n    particleCount = newParticleCount;\n    appState.setParticleCount(newParticleCount);\n  }\n\n  // drop probability\n  function setDropProbability(x) {\n    var f = parseFloat(x);\n    if (Number.isFinite(f)) {\n      // TODO: Do I need to worry about duplication/clamping?\n      appState.setDropProbability(f);\n      ctx.dropProbability = f;\n    }\n  }\n\n  function getDropProbability() {\n    return appState.getDropProbability();\n  }\n\n  function onResize() {\n    setWidthHeight(window.innerWidth, window.innerHeight);\n\n    screenProgram.updateScreenTextures();\n\n    updateBoundingBox();\n  }\n\n  function setWidthHeight(w, h) {\n    var dx = Math.max(w * 0.02, 30);\n    var dy = Math.max(h * 0.02, 30);\n    let x = w + 2 * dx;\n    let y = h + 2 * dy;\n    canvasRect.width = window.devicePixelRatio * x;\n    canvasRect.height = window.devicePixelRatio * y;\n    canvasRect.top = - dy;\n    canvasRect.left = - dx;\n\n\n    let canvas = gl.canvas;\n    canvas.style.width = x + 'px';\n    canvas.style.height = y + 'px';\n    canvas.style.left = (-dx) + 'px';\n    canvas.style.top = (-dy) + 'px';\n    canvas.width = canvasRect.width;\n    canvas.height = canvasRect.height;\n  }\n\n  function dispose() {\n    stop();\n    window.removeEventListener('resize', onResize, true);\n    vectorFieldEditorState.dispose();\n  }\n\n  function nextFrame() {\n    if (lastAnimationFrame) return;\n\n    if (isPaused) return;\n\n    lastAnimationFrame = requestAnimationFrame(draw);\n    lastAnimationFrameTime = Date.now();\n  }\n\n  function stop() {\n    cancelAnimationFrame(lastAnimationFrame);\n    lastAnimationFrame = 0;\n    lastAnimationFrameTime = undefined;\n  }\n\n  function draw() {\n    lastAnimationFrame = 0;\n\n    // Adjust integration time step if we missed frames\n    if (lastAnimationFrameTime) {\n      let timeSinceLastFrame = Date.now() - lastAnimationFrameTime;\n      let performanceRatio = (1000 / 30) / timeSinceLastFrame;\n      let correctedSpeed = ctx.speed / Math.min(performanceRatio, 1);\n      ctx.integrationTimeStep = integrationTimeStepFromSpeed(correctedSpeed);\n      ctx.fadeOpacity = fadeOutFromSpeed(correctedSpeed);\n      // bus.fire('integration-timestep-changed', ctx.integrationTimeStep);\n    }\n    drawScreen();\n\n    nextFrame();\n  }\n\n  function drawScreen() {\n    screenProgram.fadeOutLastFrame()\n    drawProgram.drawParticles();\n    screenProgram.renderCurrentScreen();\n    drawProgram.updateParticlesPositions();\n  }\n\n  function updateParticlesCount(numParticles) {\n    // we create a square texture where each pixel will hold a particle position encoded as RGBA\n    ctx.particleStateResolution = Math.ceil(Math.sqrt(numParticles));\n    drawProgram.updateParticlesCount();\n  }\n\n  function restoreBBox() {\n    var {width, height} = canvasRect;\n\n    let sX = Math.PI * Math.E;\n    let sY = Math.PI * Math.E;\n    let tX = 0;\n    let tY = 0;\n\n    var w2 = sX * width / 2;\n    var h2 = sY * width / 2;\n    updateBoundingBox();\n  }\n\n  function updateBoundingBox() {\n    screenProgram.boundingBoxUpdated = true;\n\n    currentPanZoomTransform = {\n      scale: 0.1,\n      x: window.innerWidth / 2,\n      y: window.innerHeight / 2\n    };\n\n    var {width, height} = canvasRect;\n    width /= window.devicePixelRatio;\n    height /= window.devicePixelRatio;\n\n    var minX = clientX(0);\n    var minY = clientY(0);\n    var maxX = clientX(width);\n    var maxY = clientY(height);\n\n    // we divide by width to keep aspect ratio\n    // var ar = width/height;\n    var p = 10000;\n    bbox.minX = Math.round(p * minX/width)/p;\n    bbox.minY = Math.round(p * -minY/width)/p;\n    bbox.maxX = Math.round(p * maxX/width)/p;\n    bbox.maxY = Math.round(p * -maxY/ width)/p;\n\n    bus.fire('bbox-change', bbox);\n\n    function clientX(x) {\n      return (x - currentPanZoomTransform.x)/currentPanZoomTransform.scale;\n    }\n\n    function clientY(y) {\n      return (y - currentPanZoomTransform.y)/currentPanZoomTransform.scale;\n    }\n  }\n\n  // backgroundColor should be an object with r, g, b, a properties (range: 0-1)\n  function setBackgroundColor(backgroundColor) {\n    ctx.backgroundColor = backgroundColor; \n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/field-play/scene.js","\nimport _ from 'lodash';\nimport { CreateElement, VNode } from 'vue';\nimport { Component, Prop, Vue, Watch } from 'vue-property-decorator';\nimport initScene from '../lib/field-play/scene';\nimport ColorModes from '../lib/field-play/programs/colorModes';\n\n@Component\nexport default class FieldVizualisation extends Vue {\n  private scene: any;\n\n  @Prop({ required: true })\n  public k1: number;\n\n  @Prop({ required: true })\n  public k2: number;\n\n  @Prop({ required: true })\n  public n: number;\n\n  @Prop({ default: false })\n  public paused: boolean;\n\n  private timeStep: number = 0.01;\n  private dropProbability: number = 0.009;\n  private fadeout: number = .998;\n\n  get particleCount (): number {\n    return Math.max(this.n * 500 * Math.pow(window.devicePixelRatio, 2), 1);\n  }\n\n  mounted () {\n    let canvas: HTMLCanvasElement = this.$el as HTMLCanvasElement;\n    let ctxOptions = { antialias: true, alpha: false };\n    let gl = canvas.getContext('webgl', ctxOptions) ||\n    canvas.getContext('experimental-webgl', ctxOptions);\n\n    this.scene = initScene(gl);\n    this.scene.setParticlesCount(this.particleCount);\n    this.scene.setBackgroundColor({\n      r: 0.05, g: 0, b: 0.1, a: 1\n    });\n    this.scene.setDropProbability(0.001)\n    this.updateVectorField();\n    this.updateColorFunction();\n    this.scene.setColorMode(ColorModes.VELOCITY);\n\n    if (!this.paused)\n      this.scene.start();\n  }\n\n  beforeDestroy () {\n    this.scene.dispose();\n    this.$el.remove();\n  }\n\n  formatNumberforGLSL (n: number): string {\n    if (_.isNaN(n))\n      return '0.'\n    return n.toFixed(4);\n  }\n\n  get GLSLcode () {\n    let codeLines: string[] = [];\n\n    codeLines.push(`v.x = 0.;`);\n    codeLines.push(`v.y = 0.;`);\n    codeLines.push(`float tau = acos(0.);`);\n    codeLines.push(`float pi = tau / 2.;`);\n    codeLines.push(`float l = length(p);`)\n\n    if (this.k1 > 0) {\n      // CIRCLE-EYE: alpha\n      let circle = {\n        x: `p.y`,\n        y: `-p.x`\n      }\n      codeLines.push(`v.x += pow(${this.formatNumberforGLSL(this.k1)}, 2.) * (${circle.x}) / pow(max(1., abs(3. * l) - 2. * tau), 3.);`);\n      codeLines.push(`v.y += pow(${this.formatNumberforGLSL(this.k1)}, 2.) * (${circle.y}) / pow(max(1., abs(3. * l) - 2. * tau), 3.);`);\n    }\n\n    if (this.k2 > 0) {\n      // SQUARES: gamma\n      let squares = {\n        x: `sign(sin(p.y * 4.)) / 2. + (1. - ${this.formatNumberforGLSL(this.k2)}) * sin(p.y * 4.)`,\n        y: `sign(-1. * sin(p.x * 4.)) / 2. - (1. - ${this.formatNumberforGLSL(this.k2)}) * sin(p.x * 4.)`\n      };\n      codeLines.push(`float d = (abs(p.x) + abs(p.y)) * 2. / 3.;`)\n      codeLines.push(`if ( (d < tau) && (d > pi / 2.) ) {`);\n        codeLines.push(`v.x += pow(${this.formatNumberforGLSL(this.k2)}, 3.) * (${squares.x});`);\n        codeLines.push(`v.y += pow(${this.formatNumberforGLSL(this.k2)}, 3.) * (${squares.y});`);\n      codeLines.push(`}`);\n    }\n\n    let steadyK = Math.pow( (1 - Math.max(this.k1, this.k2)) * Math.pow(this.k1 + this.k2, 2), 2);\n    codeLines.push(`v.x += ${this.formatNumberforGLSL(steadyK)} * p.x / pow(l, 2.);`);\n    codeLines.push(`v.y += ${this.formatNumberforGLSL(steadyK)} * p.y / pow(l, 2.);`);\n\n    codeLines.push(`v.x /= 2.;`);\n    codeLines.push(`v.y /= 2.;`);\n\n    return `\n    vec2 get_velocity(vec2 p) {\n      vec2 v = vec2(0., 0.);\n\n      ${codeLines.join('\\n')}\n\n      return v;\n    }`\n  }\n\n  updateVectorField () {\n    if (!this.scene)\n      return;\n\n    this.scene.vectorFieldEditorState.setCode(this.GLSLcode);\n  }\n\n  get colorFunction() {\n    let k = Math.pow((this.k2 - this.k1) / 2 + 0.5, 2);\n\n    return `\n      vec4 get_color(vec2 p) {\n        vec2 velocity = get_velocity(p);\n        float speed = (length(velocity) - u_velocity_range[0])/(u_velocity_range[1] - u_velocity_range[0]);\n        float hue = 0.05 + (1. - speed) * 0.5;\n        float hue1 = 1. - pow(hue, 3.) / 2. + 0.15;\n        float hue2 = .5 + pow(hue, 3.) / 2.;\n        hue = ${this.formatNumberforGLSL(k)} * hue1 + (1. - ${this.formatNumberforGLSL(k)}) * hue2;\n        return vec4(hsv2rgb(vec3(hue, 0.9, 1.)), 1.0);\n      }`;\n  }\n\n  updateColorFunction () {\n    if (!this.scene)\n      return;\n\n    this.scene.setColorFunction(this.colorFunction);\n  }\n\n  @Watch('GLSLcode')\n  GLSLcodeUpdated () {\n    this.updateVectorField();\n  }\n\n  @Watch('colorFunction')\n  colorFunctionToUpdate () {\n    this.updateColorFunction();\n  }\n\n  @Watch('paused')\n  togglePause () {\n    if (this.scene)\n      this.scene[this.paused ? 'stop' : 'start']();\n  }\n\n  @Watch('particleCount')\n  updateParticleCount () {\n    if (this.scene)\n      this.scene.setParticlesCount(this.particleCount);\n  }\n\n  render (h: CreateElement): VNode {\n    return h('canvas', { class: 'brain-particles' });\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./node_modules/vue-loader/lib/selector.js?type=script&index=0!./src/components/FieldVisualization.vue","function injectStyle (context) {\n  require(\"!!../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":false,\\\"minimize\\\":true}!../../node_modules/vue-loader/lib/style-compiler/index?{\\\"optionsId\\\":\\\"0\\\",\\\"vue\\\":true,\\\"id\\\":\\\"data-v-ac54b8d6\\\",\\\"scoped\\\":true,\\\"sourceMap\\\":false}!sass-loader?{\\\"sourceMap\\\":false}!../../node_modules/vue-loader/lib/selector?type=styles&index=0!./FieldVisualization.vue\")\n}\n/* script */\nexport * from \"!!cache-loader?{\\\"cacheDirectory\\\":\\\"/home/david/dev/art/muse/brain-control/node_modules/.cache/cache-loader\\\"}!babel-loader!ts-loader?{\\\"transpileOnly\\\":true,\\\"appendTsSuffixTo\\\":[{}],\\\"happyPackMode\\\":false}!../../node_modules/vue-loader/lib/selector?type=script&index=0!./FieldVisualization.vue\"\nimport __vue_script__ from \"!!cache-loader?{\\\"cacheDirectory\\\":\\\"/home/david/dev/art/muse/brain-control/node_modules/.cache/cache-loader\\\"}!babel-loader!ts-loader?{\\\"transpileOnly\\\":true,\\\"appendTsSuffixTo\\\":[{}],\\\"happyPackMode\\\":false}!../../node_modules/vue-loader/lib/selector?type=script&index=0!./FieldVisualization.vue\"\n/* template */\nvar __vue_render__, __vue_static_render_fns__\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-ac54b8d6\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nimport normalizeComponent from \"!../../node_modules/vue-loader/lib/runtime/component-normalizer\"\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_render__,\n  __vue_static_render_fns__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/components/FieldVisualization.vue\n// module id = null\n// module chunks = ","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport _ from 'lodash';\nimport { Component, Inject, Vue } from 'vue-property-decorator';\nimport { MuseClient } from 'muse-js';\nimport { EEGRelativePowerBand, POWER_BANDS, FrequencyBand } from 'muse-js';\nimport { Observable } from 'rxjs/Observable';\nimport { Subscription } from 'rxjs/Subscription';\nimport { bufferCount, map } from 'rxjs/operators';\nimport Session from './Session.vue';\nimport Visualization from './Visualization.vue';\nimport ParticlesVisualization from './ParticlesVisualization.vue';\nimport FieldVisualization from './FieldVisualization.vue';\n\nimport FontAwesomeIcon from '@fortawesome/vue-fontawesome';\n\nimport fontawesome from '@fortawesome/fontawesome';\nimport faBluetooth from '@fortawesome/fontawesome-free-brands/faBluetooth';\nimport faBluetoothB from '@fortawesome/fontawesome-free-brands/faBluetoothB';\nimport faPlayCircle from '@fortawesome/fontawesome-free-regular/faPlayCircle';\nimport faPauseCircle from '@fortawesome/fontawesome-free-regular/faPauseCircle';\nimport faCaretSquareDown from '@fortawesome/fontawesome-free-regular/faCaretSquareDown';\nimport faCaretSquareUp from '@fortawesome/fontawesome-free-regular/faCaretSquareUp';\n\nfontawesome.library.add(\n  faBluetooth, faBluetoothB,\n  faPlayCircle, faPauseCircle,\n  faCaretSquareDown, faCaretSquareUp\n);\n\nexport interface AveragedRelativeBandPowers {\n  [index: string]: number;\n}\n\n@Component({\n  components: {\n    Session,\n    Visualization,\n    ParticlesVisualization,\n    FieldVisualization,\n    FontAwesomeIcon,\n  }\n})\nexport default class MuseRecorder extends Vue {\n  private museClient: MuseClient;\n  private connectionStatus: boolean = false;\n  private sessionInProgress: boolean = false;\n  private currentSessionSubscription: Subscription;\n\n  private currentSession: AveragedRelativeBandPowers[] = [];\n\n  private k1: number = 0;\n  private k2: number = 0;\n  private n: number = 0;\n  private paused: boolean = true;\n  private sessionsDetailsOpened: boolean = false;\n\n  private created() {\n    this.museClient = new MuseClient();\n  }\n\n  private async connectToMuse() {\n    await this.museClient.connect();\n    await this.museClient.start();\n\n    this.startSession();\n\n    this.museClient.connectionStatus.subscribe(\n      cS => this.connectionStatus = cS\n    );\n  }\n\n  private startSession() {\n    this.currentSession = [];\n    // @ts-ignore\n    this.currentSessionSubscription = (this.museClient.relativeBandPowers as Observable<EEGRelativePowerBand[]>)\n      .pipe(\n        bufferCount(100, 50)\n      ,\n        map( (sessions: EEGRelativePowerBand[][]): EEGRelativePowerBand[] =>\n          Object.keys(POWER_BANDS).map( (k): EEGRelativePowerBand => {\n            return {\n              band: POWER_BANDS[k],\n              power: sessions.map(\n                  (session: EEGRelativePowerBand[]): number => {\n                    let bandSession = session.find( r => r.band.id == POWER_BANDS[k].id );\n                    if (bandSession) {\n                      return bandSession.power;\n                    } else {\n                      return NaN;\n                    }\n                  }\n                ).reduce(\n                  ((sumOfSessions, bandSessionValue) =>\n                    sumOfSessions += bandSessionValue\n                  ), 0\n                ) / sessions.length\n            };\n          })\n        )\n      ,\n        map( (rbps: EEGRelativePowerBand[]): AveragedRelativeBandPowers => {\n          let arbps: AveragedRelativeBandPowers = {};\n          rbps.forEach( (rbp) => arbps[rbp.band.id] = rbp.power );\n          return arbps;\n        })\n      ).subscribe(\n        (arbps: AveragedRelativeBandPowers) => {\n          this.currentSession.push(Object.freeze(arbps));\n          this.currentSession = _.takeRight(this.currentSession, 100);\n          this.n = Math.min(this.currentSession.length * 5, 100);\n          this.k1 = (\n            arbps.ALPHA - Math.min(...this.currentSession.map( d => d.ALPHA ))\n          ) / (\n            Math.max(...this.currentSession.map( d => d.ALPHA )) - Math.min(...this.currentSession.map( d => d.ALPHA ))\n          );\n          this.k2 = (\n            arbps.GAMMA - Math.min(...this.currentSession.map( d => d.GAMMA ))\n          ) / (\n            Math.max(...this.currentSession.map( d => d.GAMMA )) - Math.min(...this.currentSession.map( d => d.GAMMA ))\n          );\n        }\n      );\n    this.sessionInProgress = true;\n    this.paused = false;\n  }\n\n  private stopSession() {\n    if (this.currentSessionSubscription) {\n      this.currentSessionSubscription.unsubscribe();\n    }\n    this.sessionInProgress = false;\n    this.paused = true;\n  }\n\n  private beforeDestroy() {\n    this.stopSession();\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./node_modules/vue-loader/lib/selector.js?type=script&index=0!./src/components/MuseRecorder.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"muse-recorder\"},[_c('div',[_c('field-visualization',{attrs:{\"k1\":_vm.k1,\"k2\":_vm.k2,\"n\":_vm.n,\"paused\":_vm.paused}})],1),_c('div',{staticClass:\"muse-recorder__greeting\",class:{'muse-recorder__greeting--connected': _vm.connectionStatus}},[_c('div',{staticStyle:{\"font-size\":\"6em\"}},[_vm._v(\"Do you feel in control\")]),_c('div',{staticStyle:{\"font-size\":\"4em\"}},[_vm._v(\"of what's happenning\")]),_c('div',{staticStyle:{\"font-size\":\"8em\"}},[_vm._v(\"in your brain?\")])]),_c('div',{staticClass:\"muse-recorder__connection\",class:{'muse-recorder__connection--connected': _vm.connectionStatus}},[_c('font-awesome-icon',{staticClass:\"muse-recorder__connection-icon\",attrs:{\"icon\":['fab', _vm.connectionStatus ? 'bluetooth-b' : 'bluetooth']},on:{\"click\":function($event){_vm.connectionStatus ? _vm.disconnect() : _vm.connectToMuse()}}})],1),(true || _vm.connectionStatus)?_c('div',{staticClass:\"muse-recorder__session-control\"},[_c('div',{staticClass:\"muse-recorder__main-controls\"},[_c('font-awesome-icon',{staticClass:\"muse-recorder__session-control-icon\",attrs:{\"icon\":['far', _vm.sessionInProgress ? 'pause-circle' : 'play-circle']},on:{\"click\":function($event){_vm.sessionInProgress ? _vm.stopSession() : _vm.startSession()}}}),_c('font-awesome-icon',{staticClass:\"muse-recorder__session-details-icon\",attrs:{\"icon\":['far', _vm.sessionsDetailsOpened ? 'caret-square-down' : 'caret-square-up']},on:{\"click\":function($event){_vm.sessionsDetailsOpened = !_vm.sessionsDetailsOpened}}})],1),(_vm.sessionsDetailsOpened)?_c('div',{staticClass:\"muse-recorder__session-details\"},[_c('div',{staticClass:\"muse-recorder__viz-controls\"},[_c('button',{on:{\"click\":function($event){_vm.paused = !_vm.paused}}},[_vm._v(\" Pause viz\\n        \")]),_c('input',{directives:[{name:\"model\",rawName:\"v-model.number\",value:(_vm.k1),expression:\"k1\",modifiers:{\"number\":true}}],attrs:{\"type\":\"range\",\"min\":\"0\",\"max\":\"1\",\"step\":\"0.01\"},domProps:{\"value\":(_vm.k1)},on:{\"__r\":function($event){_vm.k1=_vm._n($event.target.value)},\"blur\":function($event){_vm.$forceUpdate()}}}),_c('pre',[_vm._v(\"k1: \"+_vm._s(_vm.k1))]),_c('input',{directives:[{name:\"model\",rawName:\"v-model.number\",value:(_vm.k2),expression:\"k2\",modifiers:{\"number\":true}}],attrs:{\"type\":\"range\",\"min\":\"0\",\"max\":\"1\",\"step\":\"0.01\"},domProps:{\"value\":(_vm.k2)},on:{\"__r\":function($event){_vm.k2=_vm._n($event.target.value)},\"blur\":function($event){_vm.$forceUpdate()}}}),_c('pre',[_vm._v(\"k2: \"+_vm._s(_vm.k2))]),_c('input',{directives:[{name:\"model\",rawName:\"v-model.number\",value:(_vm.n),expression:\"n\",modifiers:{\"number\":true}}],attrs:{\"type\":\"range\",\"min\":\"0\",\"max\":\"100\",\"step\":\"1\"},domProps:{\"value\":(_vm.n)},on:{\"__r\":function($event){_vm.n=_vm._n($event.target.value)},\"blur\":function($event){_vm.$forceUpdate()}}}),_c('pre',[_vm._v(\"n: \"+_vm._s(_vm.n))])]),(_vm.currentSession.length)?_c('Session',{attrs:{\"sessionData\":_vm.currentSession}}):_c('div',[_vm._v(\"\\n        No session data\\n      \")])],1):_vm._e()]):_vm._e()])}\nvar staticRenderFns = []\nexport { render, staticRenderFns }\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-33101aa1\",\"hasScoped\":true,\"optionsId\":\"0\",\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/components/MuseRecorder.vue\n// module id = null\n// module chunks = ","function injectStyle (context) {\n  require(\"!!../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":false,\\\"minimize\\\":true}!../../node_modules/vue-loader/lib/style-compiler/index?{\\\"optionsId\\\":\\\"0\\\",\\\"vue\\\":true,\\\"id\\\":\\\"data-v-33101aa1\\\",\\\"scoped\\\":true,\\\"sourceMap\\\":false}!sass-loader?{\\\"sourceMap\\\":false}!../../node_modules/vue-loader/lib/selector?type=styles&index=0!./MuseRecorder.vue\")\n}\n/* script */\nexport * from \"!!cache-loader?{\\\"cacheDirectory\\\":\\\"/home/david/dev/art/muse/brain-control/node_modules/.cache/cache-loader\\\"}!babel-loader!ts-loader?{\\\"transpileOnly\\\":true,\\\"appendTsSuffixTo\\\":[{}],\\\"happyPackMode\\\":false}!../../node_modules/vue-loader/lib/selector?type=script&index=0!./MuseRecorder.vue\"\nimport __vue_script__ from \"!!cache-loader?{\\\"cacheDirectory\\\":\\\"/home/david/dev/art/muse/brain-control/node_modules/.cache/cache-loader\\\"}!babel-loader!ts-loader?{\\\"transpileOnly\\\":true,\\\"appendTsSuffixTo\\\":[{}],\\\"happyPackMode\\\":false}!../../node_modules/vue-loader/lib/selector?type=script&index=0!./MuseRecorder.vue\"\n/* template */\nimport {render as __vue_render__, staticRenderFns as __vue_static_render_fns__} from \"!!../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-33101aa1\\\",\\\"hasScoped\\\":true,\\\"optionsId\\\":\\\"0\\\",\\\"buble\\\":{\\\"transforms\\\":{}}}!../../node_modules/vue-loader/lib/selector?type=template&index=0!./MuseRecorder.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-33101aa1\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nimport normalizeComponent from \"!../../node_modules/vue-loader/lib/runtime/component-normalizer\"\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_render__,\n  __vue_static_render_fns__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/components/MuseRecorder.vue\n// module id = null\n// module chunks = ","\n\n\n\n\n\n\nimport { Component, Vue } from 'vue-property-decorator';\nimport MuseRecorder from './components/MuseRecorder.vue';\n\n@Component({\n  components: {\n    MuseRecorder,\n  },\n})\nexport default class App extends Vue {}\n\n\n\n// WEBPACK FOOTER //\n// ./node_modules/vue-loader/lib/selector.js?type=script&index=0!./src/App.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{attrs:{\"id\":\"muse-recorder-app\"}},[_c('MuseRecorder')],1)}\nvar staticRenderFns = []\nexport { render, staticRenderFns }\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-4b9f0501\",\"hasScoped\":false,\"optionsId\":\"0\",\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/App.vue\n// module id = null\n// module chunks = ","function injectStyle (context) {\n  require(\"!!../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":false,\\\"minimize\\\":true}!../node_modules/vue-loader/lib/style-compiler/index?{\\\"optionsId\\\":\\\"0\\\",\\\"vue\\\":true,\\\"scoped\\\":false,\\\"sourceMap\\\":false}!sass-loader?{\\\"sourceMap\\\":false}!../node_modules/vue-loader/lib/selector?type=styles&index=0!./App.vue\")\n}\n/* script */\nexport * from \"!!cache-loader?{\\\"cacheDirectory\\\":\\\"/home/david/dev/art/muse/brain-control/node_modules/.cache/cache-loader\\\"}!babel-loader!ts-loader?{\\\"transpileOnly\\\":true,\\\"appendTsSuffixTo\\\":[{}],\\\"happyPackMode\\\":false}!../node_modules/vue-loader/lib/selector?type=script&index=0!./App.vue\"\nimport __vue_script__ from \"!!cache-loader?{\\\"cacheDirectory\\\":\\\"/home/david/dev/art/muse/brain-control/node_modules/.cache/cache-loader\\\"}!babel-loader!ts-loader?{\\\"transpileOnly\\\":true,\\\"appendTsSuffixTo\\\":[{}],\\\"happyPackMode\\\":false}!../node_modules/vue-loader/lib/selector?type=script&index=0!./App.vue\"\n/* template */\nimport {render as __vue_render__, staticRenderFns as __vue_static_render_fns__} from \"!!../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-4b9f0501\\\",\\\"hasScoped\\\":false,\\\"optionsId\\\":\\\"0\\\",\\\"buble\\\":{\\\"transforms\\\":{}}}!../node_modules/vue-loader/lib/selector?type=template&index=0!./App.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = null\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nimport normalizeComponent from \"!../node_modules/vue-loader/lib/runtime/component-normalizer\"\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_render__,\n  __vue_static_render_fns__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/App.vue\n// module id = null\n// module chunks = ","import Vue from 'vue';\nimport Vuex from 'vuex';\n\nVue.use(Vuex);\n\nexport default new Vuex.Store({\n  state: {\n\n  },\n  mutations: {\n\n  },\n  actions: {\n\n  },\n});\n\n\n\n// WEBPACK FOOTER //\n// ./src/store.ts","/* tslint:disable:no-console */\n\nimport { register } from 'register-service-worker';\n\nif (process.env.NODE_ENV === 'production') {\n  register(`${process.env.BASE_URL}service-worker.js`, {\n    ready() {\n      console.log(\n        'App is being served from cache by a service worker.\\n' +\n        'For more details, visit https://goo.gl/AFskqB',\n      );\n    },\n    cached() {\n      console.log('Content has been cached for offline use.');\n    },\n    updated() {\n      console.log('New content is available; please refresh.');\n    },\n    offline() {\n      console.log('No internet connection found. App is running in offline mode.');\n    },\n    error(error) {\n      console.error('Error during service worker registration:', error);\n    },\n  });\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/registerServiceWorker.ts","import Vue from 'vue';\nimport App from './App.vue';\nimport store from './store';\nimport './registerServiceWorker';\n\nVue.config.productionTip = false;\n\nnew Vue({\n  store,\n  render: (h) => h(App),\n}).$mount('#app');\n\n\n\n// WEBPACK FOOTER //\n// ./src/main.ts"],"sourceRoot":""}