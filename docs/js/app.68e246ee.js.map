{"version":3,"sources":["webpack:///../muse-js/dist/lib/zip-samples.js","webpack:///../muse-js/dist/muse.js","webpack:///../muse-js/dist/lib/muse-parse.js","webpack:///../muse-js/dist/lib/muse-utils.js","webpack:///./src/lib/field-play/bus.js","webpack:///../muse-js/dist/lib/process-samples.js","webpack:///./src/components/Session.vue?6811","webpack:///./src/components/Session.vue?88f6","webpack:///./src/components/Session.vue","webpack:///./src/components/Visualization.vue?f9ff","webpack:///./src/components/Visualization.vue?2bc3","webpack:///./src/components/Visualization.vue","webpack:///./src/components/ParticlesVisualization.vue?61c6","webpack:///./src/components/ParticlesVisualization.vue","webpack:///./src/lib/field-play/gl-utils.js","webpack:///./src/lib/field-play/programs/colorModes.js","webpack:///./src/lib/field-play/wrapVectorField.js","webpack:///./src/lib/field-play/isSmallScreen.js","webpack:///./src/lib/field-play/appState.js","webpack:///./src/lib/field-play/programs/screenProgram.js","webpack:///./src/lib/field-play/shaderGraph/parts/decodeFloatRGBA.js","webpack:///./src/lib/field-play/shaderGraph/BaseShaderNode.js","webpack:///./src/lib/field-play/shaderGraph/parts/simplex-noise.js","webpack:///./src/lib/field-play/shaderGraph/customInput.js","webpack:///./src/lib/field-play/shaderGraph/UserDefinedVelocityFunction.js","webpack:///./src/lib/field-play/shaderGraph/RungeKuttaIntegrator.js","webpack:///./src/lib/field-play/shaderGraph/shaderBasedColor.js","webpack:///./src/lib/field-play/shaderGraph/DrawParticleGraph.js","webpack:///./src/lib/field-play/shaderGraph/parts/encodeFloatRGBA.js","webpack:///./src/lib/field-play/shaderGraph/TexturePositionNode.js","webpack:///./src/lib/field-play/shaderGraph/renderNodes.js","webpack:///./src/lib/field-play/shaderGraph/PanzoomTransform.js","webpack:///./src/lib/field-play/shaderGraph/updatePositionGraph.js","webpack:///./src/lib/field-play/utils/floatPacking.js","webpack:///./src/lib/field-play/utils/makeStatCounter.js","webpack:///./src/lib/field-play/programs/colorProgram.js","webpack:///./src/lib/field-play/utils/textureCollection.js","webpack:///./src/lib/field-play/programs/updatePositionProgram.js","webpack:///./src/lib/field-play/config.js","webpack:///./src/lib/field-play/programs/audioProgram.js","webpack:///./src/lib/field-play/programs/drawParticlesProgram.js","webpack:///./src/lib/field-play/utils/request.js","webpack:///./src/lib/field-play/editor/fetchGLSL.js","webpack:///./src/lib/field-play/editor/pragmaParser.js","webpack:///./src/lib/field-play/editor/getParsedVectorFieldFunction.js","webpack:///./src/lib/field-play/editor/vectorFieldState.js","webpack:///./src/lib/field-play/programs/inputs/inputCollection.js","webpack:///./src/lib/field-play/programs/inputs/loadTexture.js","webpack:///./src/lib/field-play/programs/inputs/imageInput.js","webpack:///./src/lib/field-play/createInputsModel.js","webpack:///./src/lib/field-play/scene.js","webpack:///./src/components/FieldVisualization.vue?bca2","webpack:///./src/components/FieldVisualization.vue","webpack:///./src/components/MuseRecorder.vue?0ffa","webpack:///./src/components/MuseRecorder.vue?785b","webpack:///./src/components/MuseRecorder.vue","webpack:///./src/App.vue?eb80","webpack:///./src/App.vue?4f8e","webpack:///./src/App.vue","webpack:///./src/store.ts","webpack:///./src/registerServiceWorker.ts","webpack:///./src/main.ts"],"names":["Object","defineProperty","exports","value","muse_1","__webpack_require__","from_1","concat_1","mergeMap_1","bufferCount_1","map_1","skipLast_1","zipSamples","eegReadings","buffer","lastTimestamp","pipe","mergeMap","reading","timestamp","length","result","from","slice","splice","push","concat","readings","samples","map","x","index","data","NaN","_i","readings_1","electrode","EEG_FREQUENCY","zipSamplesToTimeSeries","bufferSize","bufferOverlap","bufferCount","skipLast","Math","ceil","zippedReadings","_","electrodeId","zippedReading","__awaiter","this","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","step","next","e","rejected","done","then","apply","__generator","body","f","y","t","g","label","sent","trys","ops","verb","throw","return","Symbol","iterator","n","v","op","TypeError","call","pop","BehaviorSubject_1","fromEvent_1","merge_1","filter_1","first_1","share_1","take_1","muse_parse_1","muse_utils_1","process_samples_1","zip_samples_1","process_samples_2","zipSamplesToSpectrum","MUSE_SERVICE","CONTROL_CHARACTERISTIC","TELEMETRY_CHARACTERISTIC","GYROSCOPE_CHARACTERISTIC","ACCELEROMETER_CHARACTERISTIC","EEG_CHARACTERISTICS","channelNames","MuseClient","enableAux","deviceName","connectionStatus","BehaviorSubject","gatt","lastIndex","prototype","connect","device","_a","service","_b","_c","telemetryCharacteristic","_d","gyroscopeCharacteristic","_e","accelerometerCharacteristic","_f","eegObservables","channelCount","_loop_1","this_1","channelIndex","_this","_g","navigator","bluetooth","requestDevice","filters","services","name","getPrimaryService","fromEvent","first","subscribe","getCharacteristic","controlChar","observableCharacteristic","rawControlData","decodeResponse","Uint8Array","share","controlResponses","parseControl","telemetryData","parseTelemetry","gyroscopeData","parseGyroscope","accelerometerData","parseAccelerometer","eegCharacteristics","characteristicId","eegChar","eventIndex","getUint16","decodeEEGSamples","subarray","getTimestamp","merge","rawFFT","absoluteBandPowers","spectrumToAbsolutePowerBands","relativeBandPowers","spectrumToRelativePowerBands","sendCommand","cmd","writeValue","encodeCommand","start","preset","pause","resume","deviceInfo","resultListener","filter","r","fw","take","toPromise","disconnect","SAMPLES_PER_READING","READING_DELTA","Date","getTime","process_samples_3","POWER_BANDS","concatMap_1","scan_1","controlData","concatMap","split","scan","acc","indexOf","JSON","parse","decodeUnsigned12BitData","samples12Bit","i","sequenceId","batteryLevel","fuelGaugeVoltage","temperature","parseImuReading","scale","sample","startIndex","getInt16","z","takeUntil_1","bytes","TextDecoder","decode","encoded","TextEncoder","encode","characteristic","disconnected","startNotifications","takeUntil","event","target","eventify","module","dsp_js_1","FFT_BUFFER_SIZE","FFT_WINDOW_OVERLAP","fft","RFFT","computeSpectrum","timeSerie","forward","WindowFunction","Hamming","spectrum","eggSamples","eegTimeSeries","d","Float64Array","computeTotalSpectrum","spectrumByElectrode","freqValue","freq","isFinite","reduce","sum","sumPowerOfBand","band","totalSpectrum","totalPower","freqPower","range","computeAbsolutePowerBand","power","log","computeAbsolutePowerBands","keys","k","eggSpectrum","computeRelativePowerBands","relativePowerBands","totalPowerOfBands","total","relativePowerBand","forEach","ALPHA","id","BETA_1","BETA_2","BETA_3","GAMMA","Session_Session","serie","d3_shape","sessionData","xScale","yScale","blob","Blob","stringify","type","exportDate","filename","toISOString","FileSaver","d3_scale","domain","width","height","lastSessionPoint","lodash_default","a","last","vue_property_decorator_umd","__decorate","default","__metadata","Array","Number","Session_render","_vm","_h","$createElement","_self","staticClass","attrs","_l","key","class","toLowerCase","lineForSerie","_v","_s","lastSessionPointForSerie","staticStyle","flex","on","click","$event","saveAsJSON","staticRenderFns","injectStyle","context","__vue_template_functional__","__vue_styles__","__vue_scopeId__","__vue_module_identifier__","Component","component_normalizer","components_Session","src_components_Session","Visualization_Vizualisation","Vizualisation","tk1","k1","tk2","k2","colors","targetVal","duration","now","interpolator","d3_interpolate","animate","_this2","requestAnimationFrame","_this3","_this4","brainWire","curve","tension","wirePoints","d3_ease","masterPoints","leftPoint","leftMiddlePoint","middlePoint","rightMiddlePoint","rightPoint","wireWidth","points","p","reverse","verticalTranslation","max","radius","circleOrSquareRatio","SQRT2","verticalSymetry","point","dy","sqrt","pow","Visualization___decorate","Visualization___metadata","Function","Visualization_render","in","stdDeviation","mode","values","in2","operator","brainWires","wire","transform","originTranslation","fill","Visualization_staticRenderFns","Visualization_injectStyle","Visualization___vue_template_functional__","Visualization___vue_styles__","Visualization___vue_scopeId__","Visualization___vue_module_identifier__","Visualization_Component","Visualization","components_Visualization","CAMERA_DISTANCE","BOUNDS","X","Y","CIRCLE_RADIUS","POINTS_COUNT","POINTS_RENEWAL_CHANCE","ParticlesVisualization_ParticlesVizualisation","scene","three_module","renderer","preserveDrawingBuffer","autoClearColor","camera","window","innerWidth","innerHeight","fadeMaterial","color","transparent","opacity","depthWrite","fadePlane","fadeMesh","cameraGroup","add","translateZ","position","renderOrder","material","size","vertexColors","createCanvasMaterial","geometry","times","addRandomPoint","random","vertices","randomPositionOnPlane","setSize","$el","appendChild","domElement","vertice","set","verticesNeedUpdate","isNaN","particle","h","horizontalMovement","c","circularMovement","s","squareMovement","weightedMovementAlongAxis","circleWeigth","squareWeigth","horizontalWeigth","movement","moveParticle","particleColor","dX","dY","dZ","colorsNeedUpdate","render","continue","matCanvas","document","createElement","matContext","getContext","texture","center","beginPath","arc","PI","closePath","fillStyle","needsUpdate","sin","θ","atan2","dr","dθ","cos","dx","paused","lastAnimationId","cancelAnimationFrame","undefined","dispose","ParticlesVisualization___decorate","required","ParticlesVisualization___metadata","Boolean","__vue_render__","__vue_static_render_fns__","ParticlesVisualization_injectStyle","ParticlesVisualization___vue_template_functional__","ParticlesVisualization___vue_styles__","ParticlesVisualization___vue_scopeId__","ParticlesVisualization___vue_module_identifier__","ParticlesVisualization_Component","ParticlesVisualization","components_ParticlesVisualization","gl_utils","createTexture","gl_utils_createTexture","bindFramebuffer","createProgram","createBuffer","bindAttribute","bindTexture","gl","unit","activeTexture","TEXTURE0","TEXTURE_2D","bindBuffer","ARRAY_BUFFER","bufferData","STATIC_DRAW","texParameteri","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","TEXTURE_MIN_FILTER","TEXTURE_MAG_FILTER","texImage2D","RGBA","UNSIGNED_BYTE","framebuffer","FRAMEBUFFER","framebufferTexture2D","COLOR_ATTACHMENT0","attribute","numComponents","enableVertexAttribArray","vertexAttribPointer","FLOAT","vertexSource","fragmentSource","program","vertexShader","createShader","VERTEX_SHADER","fragmentShader","FRAGMENT_SHADER","attachShader","linkProgram","getProgramParameter","LINK_STATUS","Error","getProgramInfoLog","wrapper","unload","numAttributes","ACTIVE_ATTRIBUTES","getActiveAttrib","getAttribLocation","numUniforms","ACTIVE_UNIFORMS","uniform","getActiveUniform","getUniformLocation","deleteProgram","source","shader","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","colorModes","UNIFORM","VELOCITY","ANGLE","CUSTOM","wrapVectorField","field","isSmallScreen","pendingSave","qs","query_state_default","useSearch","rewriteHashToSearch","currentState","defaultVectorField","defaults","timeStep","dropProbability","particleCount","fadeout","colorMode","settingsPanel","collapsed","appState","saveBBox","getBBox","makeBBox","getQS","saveCode","getCode","appState_getCode","getDefaultCode","getDropProbability","appState_getDropProbability","setDropProbability","appState_setDropProbability","getIntegrationTimeStep","setIntegrationTimeStep","getParticleCount","setParticleCount","getFadeout","setFadeout","getColorMode","appState_getColorMode","setColorMode","appState_setColorMode","getColorFunction","appState_getColorFunction","setColorFunction","appState_setColorFunction","get","defined","cm","colorFunction","cf","fo","pc","dt","clamp","cx","cy","w","bboxDefined","w2","h2","minX","round","maxX","minY","maxY","bbox","arguments","clearTimeout","setTimeout","vfCode","oldCode","code","number","min","onChange","bus_default","fire","NO_TRANSFORM","makeScreenProgram","ctx","screenTexture","backgroundTexture","canvasRect","boundBoxTextureTransform","lastRenderedBoundingBox","updateScreenTextures","screenProgram","getScreenVertexShader","getScreenFragmentShader","api","fadeOutLastFrame","renderCurrentScreen","boundingBoxUpdated","viewport","drawTexture","fadeOpacity","saveLastBbox","enable","BLEND","blendFunc","SRC_ALPHA","DST_ALPHA","clearColor","backgroundColor","b","clear","COLOR_BUFFER_BIT","disable","temp","audioTexture","emptyPixels","deleteTexture","NEAREST","textureTransform","useProgram","quadBuffer","a_pos","screenTextureUnit","uniform1i","u_screen","uniform1f","u_opacity_border","u_opacity","uniform3f","u_transform","drawArrays","TRIANGLES","decodeFloatRGBA_code","decodeFloatRGBA","BaseShaderNode_BaseShaderNode","BaseShaderNode","classCallCheck_default","simplex_noise_code","simplex_noise","getInputUniforms","UserDefinedVelocityFunction_UserDefinedVelocityFunction","UserDefinedVelocityFunction","updateCode","possibleConstructorReturn_default","__proto__","getPrototypeOf","newUpdateCode","RungeKuttaIntegrator_RungeKuttaIntegrator","RungeKuttaIntegrator","shaderBasedColor","colorCode","udf","integrate","getVariables","getMain","getMethods","getDefines","getFunctions","getColorFunctionBody","DrawParticleGraph_DrawParticleGraph","DrawParticleGraph","decodePositions","textureBasedPosition","colorParts","methods","addMethods","main","addMain","join","producer","array","encodeFloatRGBA_code","encodeFloatRGBA","TexturePositionNode_TexturePosition","TexturePosition","isDecode","renderNodes","nodes","node","addToCode","getMainBody","line","PanzoomTransform_PanzoomTransform","PanzoomTransform","config","srcPosName","posName","updatePositionGraph_UpdatePositionGraph","UpdatePositionGraph","options","readStoredPosition","udfVelocity","integratePositions","dropParticles","updatePositionGraph_RandomParticleDropper","writeComputedPosition","panZoomDecode","panZoomEncode","velocityCode","setNewUpdateCode","floatPacking_encodeFloatRGBA","val","out","writeOffset","mantissa","mag","abs","exponent","floor","log2","exp2","floatPacking_decodeFloatRGBA","A","B","C","D","sign","exp","LN2","makeStatCounter","getMin","getMax","reset","POSITIVE_INFINITY","NEGATIVE_INFINITY","OUT_V_X","OUT_V_Y","colorProgram","velocity_y_texture","velocity_x_texture","particleStateResolution","pendingSpeedUpdate","numParticles","velocity_x","velocity_y","speedNeedsUpdate","velocityCounter","listenToEvents","updateParticlesPositions","updateParticlesCount","setColorMinMax","requestSpeedUpdate","off","disposeTextures","uniform2f","u_velocity_range","u_out_coordinate","readPixels","updateMinMax","vx","readFloat","vy","offset","textureCollection","dimensions","textures","textureInfo","particleState","bindTextures","assignProgramUniforms","tInfo","particlePositionShaderCodeBuilder","updatePositionProgram_updatePositionProgram","readTextures","writeTextures","updateProgram","pendingVectorLines","readVelocity","putVectorLinesRequestIntoQueue","prepareToDraw","updateVariable","vectorField","setCustomVectorField","fragment","getFragmentShader","vertex","getVertexShader","newProgram","varName","uniformLocation","inputs","updateBindings","u_rand_seed","frameSeed","u_h","integrationTimeStep","frame","cursor","uniform4f","clickX","clickY","hoverX","hoverY","u_min","u_max","u_drop_rate","writeInfo","processVectorLinesRequest","request","resolutionOfParticlesInRequest","resolution","texturesForRead","texturesForWrite","xStats","yStats","decoded_velocity_x","Float32Array","decoded_velocity_y","idx","updatePositionProgram_readFloat","vectorLineInfo","defaultConfig","isAudioEnabled","vectorLinesEnabled","FREE_TEXTURE_UNIT","showBindings","field_play_config","programs_audioProgram","audioProgram_audioProgram","audioWidth","audioHeight","audioBuffer","audioDirty","updateAudioBuffer","updateTextures","newBuffer","drawParticlesProgram","particleIndexBuffer","audioProgram","drawProgram","currentVectorField","updatePositionProgram","initPrograms","drawParticles","updateColorMode","updateColorVariable","initDrawProgram","drawGraph","vertexShaderCode","updateVariableForDrawProgram","particleIndices","particleStateX","particleStateY","deleteBuffer","a_index","u_particles_res","POINTS","url","download","req","XMLHttpRequest","updateProgress","lengthComputable","progress","loaded","percent","transferComplete","status","response","responseType","transferFailed","transferCanceled","addEventListener","open","send","loadedLinks","Map","fetchGLSL","link","trimmed","trim","cachedResponse","pragmaInclude","nullCode","makePragmaParser","parsedLines","processLineByLine","pending","all","catch","error","lines","outputLines","currentIndex","processPragma","include","substr","insertIndex","glslParser","check","errorCount","bind","oe","vectorFieldGlobals","getParsedVectorFieldFunction","vectorFieldCode","pragmaParseResult","parserResult","globals","parserError","diag","diagnostics","firstError","lineColumn","_lineOffsets","contents","column","substring","end","prefix","diagText","text","whitespace","errorDetail","isFloatError","createVectorFieldEditorState","parseCode","currentVectorFieldVersion","currentVectorFieldCode","loadCodeFromAppState","setCode","trySetNewCode","cancelled","updateErrorInfo","persistedCode","console","customCode","currentResult","capturedVersion","message","createInputCollection","currentProgram","boundInputs","bindInput","inputIndex","inputBinding","prevBinding","updateInputBinding","input","updateBinding","loadTexture","resolveTexture","rejectTexture","image","Image","crossOrigin","onload","onerror","reportError","src","err","level","internalFormat","srcFormat","srcType","isPowerOf2","generateMipmap","LINEAR","createImageInputBinding","callbacks","setTexture","handleError","loadedTexture","realIndex","createInputsModel","readInputsFromAppState","getInputs","addInput","inputNumber","vm","createInputElementViewModel","i0","pendingUpdate","immediate","setBinding","binding","INITIAL_SPEED","integrationTimeStepFromSpeed","speed","fadeOutFromSpeed","initScene","top","left","setWidthHeight","onResize","currentPanZoomTransform","DEPTH_TEST","STENCIL_TEST","lastAnimationFrame","lastAnimationFrameTime","createFramebuffer","isPaused","inputsModel","vectorFieldEditorState","nextFrame","stop","setPaused","getParticlesCount","setParticlesCount","setFadeOutSpeed","getFadeOutSpeed","getSpeed","setSpeed","setBackgroundColor","getCanvasRect","getBoundingBox","restoreBBox","parseInt","parseFloat","shouldPause","newParticleCount","updateBoundingBox","devicePixelRatio","canvas","style","removeEventListener","draw","timeSinceLastFrame","performanceRatio","correctedSpeed","drawScreen","E","clientX","clientY","FieldVisualization_FieldVizualisation","FieldVizualisation","ctxOptions","antialias","alpha","updateVectorField","updateColorFunction","actuallyPaused","remove","toFixed","GLSLcode","k3","k4","k5","kColor","gamma","beta1","beta2","beta3","codeLines","circle","squares","whirl","cloverfield","ka","kb","FieldVisualization___decorate","FieldVisualization___metadata","FieldVisualization___vue_render__","FieldVisualization___vue_static_render_fns__","FieldVisualization_injectStyle","FieldVisualization___vue_template_functional__","FieldVisualization___vue_styles__","FieldVisualization___vue_scopeId__","FieldVisualization___vue_module_identifier__","FieldVisualization_Component","FieldVisualization","components_FieldVisualization","index_es","library","faBluetooth_default","faBluetoothB_default","faPlayCircle_default","faPauseCircle_default","faCaretSquareDown_default","faCaretSquareUp_default","MuseRecorder_MuseRecorder","MuseRecorder","sessionInProgress","currentSession","sessionsDetailsOpened","museClient","muse","startSession","cS","currentSessionSubscription","operators","sessions","session","bandSession","find","sumOfSessions","bandSessionValue","rbps","arbps","rbp","some","freeze","takeRight","toConsumableArray_default","unsubscribe","stopSession","MuseRecorder___decorate","components","Session","FontAwesomeIcon","vue_fontawesome_default","MuseRecorder_render","muse-recorder__greeting--connected","font-size","muse-recorder__connection--connected","icon","connectToMuse","directives","rawName","expression","modifiers","domProps","__r","_n","blur","$forceUpdate","MuseRecorder_staticRenderFns","MuseRecorder_injectStyle","MuseRecorder___vue_template_functional__","MuseRecorder___vue_styles__","MuseRecorder___vue_scopeId__","MuseRecorder___vue_module_identifier__","MuseRecorder_Component","components_MuseRecorder","src_components_MuseRecorder","App_App","App___decorate","App_render","App_staticRenderFns","App_injectStyle","App___vue_template_functional__","App___vue_styles__","App___vue_scopeId__","App___vue_module_identifier__","App_Component","selectortype_script_index_0_src_App","src_App","vue_runtime_esm","use","vuex_esm","store","Store","state","mutations","actions","register_service_worker","ready","cached","updated","offline","_error","productionTip","$mount"],"mappings":"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","file":"js/app.68e246ee.js","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar muse_1 = require(\"./../muse\");\nvar from_1 = require(\"rxjs/observable/from\");\nvar concat_1 = require(\"rxjs/operators/concat\");\nvar mergeMap_1 = require(\"rxjs/operators/mergeMap\");\nvar bufferCount_1 = require(\"rxjs/operators/bufferCount\");\nvar map_1 = require(\"rxjs/operators/map\");\nvar skipLast_1 = require(\"rxjs/operators/skipLast\");\nfunction zipSamples(eegReadings) {\n    var buffer = [];\n    var lastTimestamp = null;\n    return eegReadings.pipe(mergeMap_1.mergeMap(function (reading) {\n        if (reading.timestamp !== lastTimestamp) {\n            lastTimestamp = reading.timestamp;\n            if (buffer.length) {\n                var result = from_1.from([buffer.slice()]);\n                buffer.splice(0, buffer.length, reading);\n                return result;\n            }\n        }\n        buffer.push(reading);\n        return from_1.from([]);\n    }), concat_1.concat(from_1.from([buffer])), mergeMap_1.mergeMap(function (readings) {\n        var result = readings[0].samples.map(function (x, index) {\n            var data = [NaN, NaN, NaN, NaN, NaN];\n            for (var _i = 0, readings_1 = readings; _i < readings_1.length; _i++) {\n                var reading = readings_1[_i];\n                data[reading.electrode] = reading.samples[index];\n            }\n            return {\n                data: data,\n                index: readings[0].index,\n                timestamp: readings[0].timestamp + index * 1000. / muse_1.EEG_FREQUENCY,\n            };\n        });\n        return from_1.from(result);\n    }));\n}\nexports.zipSamples = zipSamples;\nfunction zipSamplesToTimeSeries(eegReadings, bufferSize, bufferOverlap) {\n    return zipSamples(eegReadings).pipe(bufferCount_1.bufferCount(bufferSize, bufferOverlap), \n    // skip incomplete readings\n    skipLast_1.skipLast(Math.ceil(bufferSize / bufferOverlap)), map_1.map(function (zippedReadings) {\n        return {\n            timestamp: zippedReadings[0].timestamp,\n            data: zippedReadings[0].data.map(function (_, electrodeId) {\n                return zippedReadings.map(function (zippedReading) { return zippedReading.data[electrodeId]; });\n            })\n        };\n    }));\n}\nexports.zipSamplesToTimeSeries = zipSamplesToTimeSeries;\n//# sourceMappingURL=zip-samples.js.map\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../muse-js/dist/lib/zip-samples.js\n// module id = F+2c\n// module chunks = 2","\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = y[op[0] & 2 ? \"return\" : op[0] ? \"throw\" : \"next\"]) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [0, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar BehaviorSubject_1 = require(\"rxjs/BehaviorSubject\");\nvar fromEvent_1 = require(\"rxjs/observable/fromEvent\");\nvar merge_1 = require(\"rxjs/observable/merge\");\nvar filter_1 = require(\"rxjs/operators/filter\");\nvar first_1 = require(\"rxjs/operators/first\");\nvar map_1 = require(\"rxjs/operators/map\");\nvar share_1 = require(\"rxjs/operators/share\");\nvar take_1 = require(\"rxjs/operators/take\");\nvar muse_parse_1 = require(\"./lib/muse-parse\");\nvar muse_utils_1 = require(\"./lib/muse-utils\");\nvar process_samples_1 = require(\"./lib/process-samples\");\nvar zip_samples_1 = require(\"./lib/zip-samples\");\nexports.zipSamples = zip_samples_1.zipSamples;\nvar process_samples_2 = require(\"./lib/process-samples\");\nexports.zipSamplesToSpectrum = process_samples_2.zipSamplesToSpectrum;\nexports.MUSE_SERVICE = 0xfe8d;\nvar CONTROL_CHARACTERISTIC = '273e0001-4c4d-454d-96be-f03bac821358';\nvar TELEMETRY_CHARACTERISTIC = '273e000b-4c4d-454d-96be-f03bac821358';\nvar GYROSCOPE_CHARACTERISTIC = '273e0009-4c4d-454d-96be-f03bac821358';\nvar ACCELEROMETER_CHARACTERISTIC = '273e000a-4c4d-454d-96be-f03bac821358';\nvar EEG_CHARACTERISTICS = [\n    '273e0003-4c4d-454d-96be-f03bac821358',\n    '273e0004-4c4d-454d-96be-f03bac821358',\n    '273e0005-4c4d-454d-96be-f03bac821358',\n    '273e0006-4c4d-454d-96be-f03bac821358',\n    '273e0007-4c4d-454d-96be-f03bac821358',\n];\nexports.EEG_FREQUENCY = 256;\n// These names match the characteristics defined in EEG_CHARACTERISTICS above\nexports.channelNames = [\n    'TP9',\n    'AF7',\n    'AF8',\n    'TP10',\n    'AUX',\n];\nvar MuseClient = /** @class */ (function () {\n    function MuseClient() {\n        this.enableAux = false;\n        this.deviceName = '';\n        this.connectionStatus = new BehaviorSubject_1.BehaviorSubject(false);\n        this.gatt = null;\n        this.lastIndex = null;\n        this.lastTimestamp = null;\n    }\n    MuseClient.prototype.connect = function (gatt) {\n        return __awaiter(this, void 0, void 0, function () {\n            var _this = this;\n            var device, _a, service, _b, _c, telemetryCharacteristic, _d, gyroscopeCharacteristic, _e, accelerometerCharacteristic, _f, eegObservables, channelCount, _loop_1, this_1, channelIndex;\n            return __generator(this, function (_g) {\n                switch (_g.label) {\n                    case 0:\n                        if (!gatt) return [3 /*break*/, 1];\n                        this.gatt = gatt;\n                        return [3 /*break*/, 4];\n                    case 1: return [4 /*yield*/, navigator.bluetooth.requestDevice({\n                            filters: [{ services: [exports.MUSE_SERVICE] }],\n                        })];\n                    case 2:\n                        device = _g.sent();\n                        _a = this;\n                        return [4 /*yield*/, device.gatt.connect()];\n                    case 3:\n                        _a.gatt = _g.sent();\n                        _g.label = 4;\n                    case 4:\n                        this.deviceName = this.gatt.device.name || null;\n                        return [4 /*yield*/, this.gatt.getPrimaryService(exports.MUSE_SERVICE)];\n                    case 5:\n                        service = _g.sent();\n                        fromEvent_1.fromEvent(this.gatt.device, 'gattserverdisconnected').pipe(first_1.first()).subscribe(function () {\n                            _this.gatt = null;\n                            _this.connectionStatus.next(false);\n                        });\n                        // Control\n                        _b = this;\n                        return [4 /*yield*/, service.getCharacteristic(CONTROL_CHARACTERISTIC)];\n                    case 6:\n                        // Control\n                        _b.controlChar = _g.sent();\n                        _c = this;\n                        return [4 /*yield*/, muse_utils_1.observableCharacteristic(this.controlChar)];\n                    case 7:\n                        _c.rawControlData = (_g.sent()).pipe(map_1.map(function (data) { return muse_utils_1.decodeResponse(new Uint8Array(data.buffer)); }), share_1.share());\n                        this.controlResponses = muse_parse_1.parseControl(this.rawControlData);\n                        return [4 /*yield*/, service.getCharacteristic(TELEMETRY_CHARACTERISTIC)];\n                    case 8:\n                        telemetryCharacteristic = _g.sent();\n                        _d = this;\n                        return [4 /*yield*/, muse_utils_1.observableCharacteristic(telemetryCharacteristic)];\n                    case 9:\n                        _d.telemetryData = (_g.sent()).pipe(map_1.map(muse_parse_1.parseTelemetry));\n                        return [4 /*yield*/, service.getCharacteristic(GYROSCOPE_CHARACTERISTIC)];\n                    case 10:\n                        gyroscopeCharacteristic = _g.sent();\n                        _e = this;\n                        return [4 /*yield*/, muse_utils_1.observableCharacteristic(gyroscopeCharacteristic)];\n                    case 11:\n                        _e.gyroscopeData = (_g.sent()).pipe(map_1.map(muse_parse_1.parseGyroscope));\n                        return [4 /*yield*/, service.getCharacteristic(ACCELEROMETER_CHARACTERISTIC)];\n                    case 12:\n                        accelerometerCharacteristic = _g.sent();\n                        _f = this;\n                        return [4 /*yield*/, muse_utils_1.observableCharacteristic(accelerometerCharacteristic)];\n                    case 13:\n                        _f.accelerometerData = (_g.sent()).pipe(map_1.map(muse_parse_1.parseAccelerometer));\n                        // EEG\n                        this.eegCharacteristics = [];\n                        eegObservables = [];\n                        channelCount = this.enableAux ? EEG_CHARACTERISTICS.length : 4;\n                        _loop_1 = function (channelIndex) {\n                            var characteristicId, eegChar, _a, _b;\n                            return __generator(this, function (_c) {\n                                switch (_c.label) {\n                                    case 0:\n                                        characteristicId = EEG_CHARACTERISTICS[channelIndex];\n                                        return [4 /*yield*/, service.getCharacteristic(characteristicId)];\n                                    case 1:\n                                        eegChar = _c.sent();\n                                        _b = (_a = eegObservables).push;\n                                        return [4 /*yield*/, muse_utils_1.observableCharacteristic(eegChar)];\n                                    case 2:\n                                        _b.apply(_a, [(_c.sent()).pipe(map_1.map(function (data) {\n                                                var eventIndex = data.getUint16(0);\n                                                return {\n                                                    electrode: channelIndex,\n                                                    index: eventIndex,\n                                                    samples: muse_parse_1.decodeEEGSamples(new Uint8Array(data.buffer).subarray(2)),\n                                                    timestamp: _this.getTimestamp(eventIndex),\n                                                };\n                                            }))]);\n                                        this_1.eegCharacteristics.push(eegChar);\n                                        return [2 /*return*/];\n                                }\n                            });\n                        };\n                        this_1 = this;\n                        channelIndex = 0;\n                        _g.label = 14;\n                    case 14:\n                        if (!(channelIndex < channelCount)) return [3 /*break*/, 17];\n                        return [5 /*yield**/, _loop_1(channelIndex)];\n                    case 15:\n                        _g.sent();\n                        _g.label = 16;\n                    case 16:\n                        channelIndex++;\n                        return [3 /*break*/, 14];\n                    case 17:\n                        this.eegReadings = merge_1.merge.apply(void 0, eegObservables).pipe(share_1.share());\n                        this.rawFFT = process_samples_1.zipSamplesToSpectrum(this.eegReadings).pipe(share_1.share());\n                        this.absoluteBandPowers = process_samples_1.spectrumToAbsolutePowerBands(this.rawFFT);\n                        this.relativeBandPowers = process_samples_1.spectrumToRelativePowerBands(this.rawFFT);\n                        this.connectionStatus.next(true);\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    MuseClient.prototype.sendCommand = function (cmd) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.controlChar.writeValue((muse_utils_1.encodeCommand(cmd)))];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    MuseClient.prototype.start = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var preset;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.pause()];\n                    case 1:\n                        _a.sent();\n                        preset = this.enableAux ? 'p20' : 'p21';\n                        return [4 /*yield*/, this.controlChar.writeValue(muse_utils_1.encodeCommand(preset))];\n                    case 2:\n                        _a.sent();\n                        return [4 /*yield*/, this.controlChar.writeValue(muse_utils_1.encodeCommand('s'))];\n                    case 3:\n                        _a.sent();\n                        return [4 /*yield*/, this.resume()];\n                    case 4:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    MuseClient.prototype.pause = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.sendCommand('h')];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    MuseClient.prototype.resume = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.sendCommand('d')];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    MuseClient.prototype.deviceInfo = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var resultListener;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        resultListener = this.controlResponses.pipe(filter_1.filter(function (r) { return !!r.fw; }), take_1.take(1)).toPromise();\n                        return [4 /*yield*/, this.sendCommand('v1')];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/, resultListener];\n                }\n            });\n        });\n    };\n    MuseClient.prototype.disconnect = function () {\n        if (this.gatt) {\n            this.lastIndex = null;\n            this.lastTimestamp = null;\n            this.gatt.disconnect();\n            this.connectionStatus.next(false);\n        }\n    };\n    MuseClient.prototype.getTimestamp = function (eventIndex) {\n        var SAMPLES_PER_READING = 12;\n        var READING_DELTA = 1000 * (1.0 / exports.EEG_FREQUENCY) * SAMPLES_PER_READING;\n        if (this.lastIndex === null || this.lastTimestamp === null) {\n            this.lastIndex = eventIndex;\n            this.lastTimestamp = new Date().getTime() - READING_DELTA;\n        }\n        // Handle wrap around\n        while ((this.lastIndex - eventIndex) > 0x1000) {\n            eventIndex += 0x10000;\n        }\n        if (eventIndex === this.lastIndex) {\n            return this.lastTimestamp;\n        }\n        if (eventIndex > this.lastIndex) {\n            this.lastTimestamp += READING_DELTA * (eventIndex - this.lastIndex);\n            this.lastIndex = eventIndex;\n            return this.lastTimestamp;\n        }\n        else {\n            return this.lastTimestamp - READING_DELTA * (this.lastIndex - eventIndex);\n        }\n    };\n    return MuseClient;\n}());\nexports.MuseClient = MuseClient;\nvar process_samples_3 = require(\"./lib/process-samples\");\nexports.POWER_BANDS = process_samples_3.POWER_BANDS;\n//# sourceMappingURL=muse.js.map\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../muse-js/dist/muse.js\n// module id = FNDN\n// module chunks = 2","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar concatMap_1 = require(\"rxjs/operators/concatMap\");\nvar filter_1 = require(\"rxjs/operators/filter\");\nvar map_1 = require(\"rxjs/operators/map\");\nvar scan_1 = require(\"rxjs/operators/scan\");\nfunction parseControl(controlData) {\n    return controlData.pipe(concatMap_1.concatMap(function (data) { return data.split(''); }), scan_1.scan(function (acc, value) {\n        if (acc.indexOf('}') >= 0) {\n            return value;\n        }\n        else {\n            return acc + value;\n        }\n    }, ''), filter_1.filter(function (value) { return value.indexOf('}') >= 0; }), map_1.map(function (value) { return JSON.parse(value); }));\n}\nexports.parseControl = parseControl;\nfunction decodeUnsigned12BitData(samples) {\n    var samples12Bit = [];\n    // tslint:disable:no-bitwise\n    for (var i = 0; i < samples.length; i++) {\n        if (i % 3 === 0) {\n            samples12Bit.push(samples[i] << 4 | samples[i + 1] >> 4);\n        }\n        else {\n            samples12Bit.push((samples[i] & 0xf) << 8 | samples[i + 1]);\n            i++;\n        }\n    }\n    // tslint:enable:no-bitwise\n    return samples12Bit;\n}\nexports.decodeUnsigned12BitData = decodeUnsigned12BitData;\nfunction decodeEEGSamples(samples) {\n    return decodeUnsigned12BitData(samples)\n        .map(function (n) { return 0.48828125 * (n - 0x800); });\n}\nexports.decodeEEGSamples = decodeEEGSamples;\nfunction parseTelemetry(data) {\n    // tslint:disable:object-literal-sort-keys\n    return {\n        sequenceId: data.getUint16(0),\n        batteryLevel: data.getUint16(2) / 512.,\n        fuelGaugeVoltage: data.getUint16(4) * 2.2,\n        // Next 2 bytes are probably ADC millivolt level, not sure\n        temperature: data.getUint16(8),\n    };\n    // tslint:enable:object-literal-sort-keys\n}\nexports.parseTelemetry = parseTelemetry;\nfunction parseImuReading(data, scale) {\n    function sample(startIndex) {\n        return {\n            x: scale * data.getInt16(startIndex),\n            y: scale * data.getInt16(startIndex + 2),\n            z: scale * data.getInt16(startIndex + 4),\n        };\n    }\n    // tslint:disable:object-literal-sort-keys\n    return {\n        sequenceId: data.getUint16(0),\n        samples: [sample(2), sample(8), sample(14)],\n    };\n    // tslint:enable:object-literal-sort-keys\n}\nfunction parseAccelerometer(data) {\n    return parseImuReading(data, 0.0000610352);\n}\nexports.parseAccelerometer = parseAccelerometer;\nfunction parseGyroscope(data) {\n    return parseImuReading(data, 0.0074768);\n}\nexports.parseGyroscope = parseGyroscope;\n//# sourceMappingURL=muse-parse.js.map\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../muse-js/dist/lib/muse-parse.js\n// module id = g7fr\n// module chunks = 2","\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = y[op[0] & 2 ? \"return\" : op[0] ? \"throw\" : \"next\"]) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [0, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar fromEvent_1 = require(\"rxjs/observable/fromEvent\");\nvar map_1 = require(\"rxjs/operators/map\");\nvar takeUntil_1 = require(\"rxjs/operators/takeUntil\");\nfunction decodeResponse(bytes) {\n    return new TextDecoder().decode(bytes.subarray(1, 1 + bytes[0]));\n}\nexports.decodeResponse = decodeResponse;\nfunction encodeCommand(cmd) {\n    var encoded = new TextEncoder('utf-8').encode(\"X\" + cmd + \"\\n\");\n    encoded[0] = encoded.length - 1;\n    return encoded;\n}\nexports.encodeCommand = encodeCommand;\nfunction observableCharacteristic(characteristic) {\n    return __awaiter(this, void 0, void 0, function () {\n        var disconnected;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0: return [4 /*yield*/, characteristic.startNotifications()];\n                case 1:\n                    _a.sent();\n                    disconnected = fromEvent_1.fromEvent(characteristic.service.device, 'gattserverdisconnected');\n                    return [2 /*return*/, fromEvent_1.fromEvent(characteristic, 'characteristicvaluechanged').pipe(takeUntil_1.takeUntil(disconnected), map_1.map(function (event) { return event.target.value; }))];\n            }\n        });\n    });\n}\nexports.observableCharacteristic = observableCharacteristic;\n//# sourceMappingURL=muse-utils.js.map\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../muse-js/dist/lib/muse-utils.js\n// module id = r/7J\n// module chunks = 2","/**\n * A simple message bus. Facilitates uncoupled communication between\n * components of fieldplay.\n */\nvar eventify = require('ngraph.events');\n\nmodule.exports = eventify({});\n\n\n// WEBPACK FOOTER //\n// ./src/lib/field-play/bus.js","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar dsp_js_1 = require(\"dsp.js\");\nvar muse_1 = require(\"./../muse\");\nvar zip_samples_1 = require(\"./zip-samples\");\nvar map_1 = require(\"rxjs/operators/map\");\nexports.FFT_BUFFER_SIZE = 256;\nexports.FFT_WINDOW_OVERLAP = 26;\nvar fft = new dsp_js_1.RFFT(exports.FFT_BUFFER_SIZE, muse_1.EEG_FREQUENCY);\n/*  From an array of measures, apply a Hamming window and a Fast Fourier Transform\n\n    The resulting spectrum contains of 128 frequency bands, the first one\n    representing the constant part (0Hz), the next ones having a width of 1Hz.\n*/\nfunction computeSpectrum(timeSerie) {\n    fft.forward(timeSerie.map(function (v, i) { return dsp_js_1.WindowFunction.Hamming(timeSerie.length, i) * v; }));\n    return fft.spectrum;\n}\nexports.computeSpectrum = computeSpectrum;\nfunction zipSamplesToSpectrum(eggSamples) {\n    return zip_samples_1.zipSamplesToTimeSeries(eggSamples, exports.FFT_BUFFER_SIZE, exports.FFT_WINDOW_OVERLAP).pipe(map_1.map(function (eegTimeSeries) {\n        return {\n            timestamp: eegTimeSeries.timestamp,\n            data: eegTimeSeries.data.map(function (d) { return new Float64Array(computeSpectrum(d)); })\n        };\n    }));\n}\nexports.zipSamplesToSpectrum = zipSamplesToSpectrum;\nfunction computeTotalSpectrum(spectrumByElectrode) {\n    return {\n        timestamp: spectrumByElectrode.timestamp,\n        data: spectrumByElectrode.data[0].map(function (freqValue, freq) {\n            return spectrumByElectrode.data\n                .map(function (spectrum) { return spectrum[freq]; })\n                .filter(isFinite)\n                .reduce(function (sum, v) { return sum + v; }, 0);\n        })\n    };\n}\nexports.computeTotalSpectrum = computeTotalSpectrum;\nfunction sumPowerOfBand(band, totalSpectrum) {\n    return totalSpectrum.data.reduce(function (totalPower, freqPower, freq) {\n        // This is a pretty naive implentation, case of float frequencies should be addressed\n        if ((freq >= band.range[0]) && (freq <= band.range[1]) && isFinite(freqPower)) {\n            return totalPower + freqPower;\n        }\n        else {\n            return totalPower;\n        }\n    }, 0);\n}\nfunction computeAbsolutePowerBand(band, totalSpectrum) {\n    return {\n        band: band,\n        power: Math.log(sumPowerOfBand(band, totalSpectrum))\n    };\n}\nexports.computeAbsolutePowerBand = computeAbsolutePowerBand;\nexports.POWER_BANDS = {\n    // DELTA: {\n    //     id: 'DELTA',\n    //     label: 'Delta waves',\n    //     range: [1, 4]\n    // },\n    // THETA: {\n    //     id: 'THETA',\n    //     label: 'Theta waves',\n    //     range: [4, 8]\n    // },\n    ALPHA: {\n        id: 'ALPHA',\n        label: 'Alpha waves',\n        range: [7.5, 13]\n    },\n    BETA_1: {\n        id: 'BETA_1',\n        label: 'Low-beta waves',\n        range: [13, 16]\n    },\n    BETA_2: {\n        id: 'BETA_2',\n        label: 'Med-beta waves',\n        range: [15, 20]\n    },\n    BETA_3: {\n        id: 'BETA_3',\n        label: 'Hight-beta waves',\n        range: [21, 28]\n    },\n    GAMMA: {\n        id: 'GAMMA',\n        label: 'Gamma waves',\n        range: [30, 44]\n    },\n};\nfunction computeAbsolutePowerBands(totalSpectrum) {\n    return Object.keys(exports.POWER_BANDS).map(function (k) { return computeAbsolutePowerBand(exports.POWER_BANDS[k], totalSpectrum); });\n}\nexports.computeAbsolutePowerBands = computeAbsolutePowerBands;\nfunction spectrumToAbsolutePowerBands(eggSpectrum) {\n    return eggSpectrum.pipe(map_1.map(function (d) { return computeTotalSpectrum(d); }), map_1.map(function (d) { return computeAbsolutePowerBands(d); }));\n}\nexports.spectrumToAbsolutePowerBands = spectrumToAbsolutePowerBands;\nfunction computeRelativePowerBands(totalSpectrum) {\n    var relativePowerBands = Object.keys(exports.POWER_BANDS).map(function (k) {\n        return {\n            band: exports.POWER_BANDS[k],\n            power: sumPowerOfBand(exports.POWER_BANDS[k], totalSpectrum) / (exports.POWER_BANDS[k].range[1] - exports.POWER_BANDS[k].range[0])\n        };\n    });\n    var totalPowerOfBands = relativePowerBands.reduce(function (total, relativePowerBand) {\n        return total + relativePowerBand.power;\n    }, 0);\n    relativePowerBands.forEach(function (r) {\n        r.power /= totalPowerOfBands;\n    });\n    return relativePowerBands;\n}\nexports.computeRelativePowerBands = computeRelativePowerBands;\nfunction spectrumToRelativePowerBands(eggSpectrum) {\n    return eggSpectrum.pipe(map_1.map(function (d) { return computeTotalSpectrum(d); }), map_1.map(function (d) { return computeRelativePowerBands(d); }));\n}\nexports.spectrumToRelativePowerBands = spectrumToRelativePowerBands;\n//# sourceMappingURL=process-samples.js.map\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../muse-js/dist/lib/process-samples.js\n// module id = wtQo\n// module chunks = 2","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport _ from 'lodash';\nimport { Component, Vue, Prop } from 'vue-property-decorator';\nimport { AveragedRelativeBandPowers } from './MuseRecorder.vue';\nimport { line } from 'd3-shape';\nimport { scaleLinear } from 'd3-scale';\nimport { saveAs } from 'file-saver';\n\n@Component\nexport default class Session extends Vue {\n  @Prop({ default: [] })\n  sessionData: AveragedRelativeBandPowers[];\n  \n  @Prop({ default: 800 })\n  width: number;\n\n  @Prop({ default: 500 })\n  height: number;\n\n  get series(): string[] {\n    return Object.keys(this.sessionData[0] || {});\n  }\n\n  get xScale() {\n    return scaleLinear()\n      .domain([0, this.sessionData.length - 1])\n      .range([0, this.width]);\n  }\n\n  get yScale() {\n    return scaleLinear()\n      .domain([0, 0.5])\n      .range([this.height, 0]);\n  }\n\n  get lastSessionPointForSerie () {\n    let lastSessionPoint = _.last(this.sessionData);\n    return (serie) => {\n      if ( lastSessionPoint && lastSessionPoint[serie] )\n        return lastSessionPoint[serie];\n      else\n        return '-';\n    }\n  }\n\n  private lineForSerie(serie: string): string | null {\n    return line()(this.sessionData.map(\n      (v, i) => [\n        this.xScale(i),\n        this.yScale(v[serie])\n      ] as [number, number]\n    ));\n  }\n\n  private saveAsJSON(): void {\n    let blob = new Blob(\n      [JSON.stringify(this.sessionData, null, 2)],\n      {type: \"application/json;charset=utf-8\"}\n    );\n    let exportDate = new Date();\n    let filename = `muse-session-${exportDate.toISOString()}.json` \n    saveAs(blob, filename);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./node_modules/vue-loader/lib/selector.js?type=script&index=0!./src/components/Session.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"muse-recorder__session\"},[_c('svg',{staticClass:\"session__chart\",attrs:{\"width\":_vm.width,\"height\":_vm.height}},_vm._l((_vm.series),function(serie){return _c('path',{key:serie,class:['session__serie', 'session__serie--' + serie.toLowerCase()],attrs:{\"d\":_vm.lineForSerie(serie)}})})),_c('div',{staticClass:\"session__legend\"},_vm._l((_vm.series),function(serie){return _c('div',{key:serie,class:['session__legend__item', 'session__legend__item--' + serie.toLowerCase()]},[_c('div',{staticClass:\"session__legend__item__color\"}),_c('span',[_vm._v(_vm._s(serie))]),_vm._v(\" - \"),_c('span',[_vm._v(\" \"+_vm._s(_vm.lastSessionPointForSerie(serie))+\" \")])])})),_c('button',{staticStyle:{\"flex\":\"none\",\"height\":\"2em\"},on:{\"click\":function($event){_vm.saveAsJSON()}}},[_vm._v(\"\\n    Export session to JSON file\\n  \")])])}\nvar staticRenderFns = []\nexport { render, staticRenderFns }\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-325b6cbc\",\"hasScoped\":true,\"optionsId\":\"0\",\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/components/Session.vue\n// module id = null\n// module chunks = ","function injectStyle (context) {\n  require(\"!!../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":false,\\\"minimize\\\":true}!../../node_modules/vue-loader/lib/style-compiler/index?{\\\"optionsId\\\":\\\"0\\\",\\\"vue\\\":true,\\\"id\\\":\\\"data-v-325b6cbc\\\",\\\"scoped\\\":true,\\\"sourceMap\\\":false}!sass-loader?{\\\"sourceMap\\\":false}!../../node_modules/vue-loader/lib/selector?type=styles&index=0!./Session.vue\")\n}\n/* script */\nexport * from \"!!cache-loader?{\\\"cacheDirectory\\\":\\\"/home/david/dev/art/muse/brain-control/node_modules/.cache/cache-loader\\\"}!babel-loader!ts-loader?{\\\"transpileOnly\\\":true,\\\"appendTsSuffixTo\\\":[{}],\\\"happyPackMode\\\":false}!../../node_modules/vue-loader/lib/selector?type=script&index=0!./Session.vue\"\nimport __vue_script__ from \"!!cache-loader?{\\\"cacheDirectory\\\":\\\"/home/david/dev/art/muse/brain-control/node_modules/.cache/cache-loader\\\"}!babel-loader!ts-loader?{\\\"transpileOnly\\\":true,\\\"appendTsSuffixTo\\\":[{}],\\\"happyPackMode\\\":false}!../../node_modules/vue-loader/lib/selector?type=script&index=0!./Session.vue\"\n/* template */\nimport {render as __vue_render__, staticRenderFns as __vue_static_render_fns__} from \"!!../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-325b6cbc\\\",\\\"hasScoped\\\":true,\\\"optionsId\\\":\\\"0\\\",\\\"buble\\\":{\\\"transforms\\\":{}}}!../../node_modules/vue-loader/lib/selector?type=template&index=0!./Session.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-325b6cbc\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nimport normalizeComponent from \"!../../node_modules/vue-loader/lib/runtime/component-normalizer\"\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_render__,\n  __vue_static_render_fns__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/components/Session.vue\n// module id = null\n// module chunks = ","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport { Component, Prop, Vue, Watch } from 'vue-property-decorator';\nimport { line, lineRadial, arc, curveCardinal, curveNatural, curveMonotoneX, curveBasis } from 'd3-shape';\nimport { interpolateString, interpolateNumber, interpolate } from 'd3-interpolate';\nimport { easeCubicOut, easeCubicIn, easeCubic, easeCircle } from 'd3-ease';\n\n@Component\nexport default class Vizualisation extends Vue {\n  @Prop({ default: 1 })\n  k1: number;\n\n  @Prop({ default: 1 })\n  k2: number;\n\n  tk1: number = this.k1;\n  tk2: number = this.k2;\n\n  colors = ['#00f', '#0f0', '#f00'];\n  // colors = ['cyan', 'magenta', 'yellow'];\n\n  @Watch('k1')\n  animateK1 (targetVal: number) {\n    let duration = 1000;\n    let start = Date.now();\n    let interpolator = interpolateNumber(this.tk1 as number, targetVal);\n    let animate = () => {\n      let t = (Date.now() - start) / duration;\n      if (t >= 1) {\n        this.tk1 = targetVal;\n      } else {\n        requestAnimationFrame(animate);\n        this.tk1 = interpolator(t);\n      }\n    }\n    animate();\n  }\n\n  @Watch('k2')\n  animateK2 (targetVal: number) {\n    let duration = 1000;\n    let start = Date.now();\n    let interpolator = interpolateNumber(this.tk2 as number, targetVal);\n    let animate = () => {\n      let t = (Date.now() - start) / duration;\n      if (t >= 1) {\n        this.tk2 = targetVal;\n      } else {\n        requestAnimationFrame(animate);\n        this.tk2 = interpolator(t);\n      }\n    }\n    animate();\n  }\n\n  @Prop({ default: 800 })\n  height: number;\n\n  @Prop({ default: 800 })\n  width: number;\n\n  get originTranslation () {\n    return `translate(${this.width / 2}, ${this.height})`;\n  }\n\n  brainWires (k1: number, k2: number) {\n    return [-1/2, 0, 1/2].map(y => this.brainWire(k1, k2, y))\n  }\n\n  brainWire (k1: number, k2: number, y: number) {\n    let curve = line().curve(\n      curveCardinal.tension(y)\n    );\n\n    return curve(this.wirePoints(k1, k2, y));\n  }\n\n  wirePoints (k1: number, k2: number, y: number) {\n    let k = k1 + easeCircle(y) * (k2 - k1);\n\n    let masterPoints = [\n      this.leftPoint(k, y),\n      this.leftMiddlePoint(k, y),\n      this.middlePoint(k, y),\n      this.rightMiddlePoint(k, y),\n      this.rightPoint(k, y),\n    ]\n\n    let wireWidth = 100;\n\n    let points = masterPoints.map(\n      (p): [number, number] => [p[0], p[1] + wireWidth / 2]\n    ).concat(\n      masterPoints.reverse().map(\n        (p): [number, number] => [p[0], - p[1] - wireWidth / 2]\n      )\n    );\n\n    points.push(points[0]);\n\n    return points.map(this.verticalTranslation(- this.width / 2 - (1 - Math.max(k1, k2)) * 2 * y * this.radius));\n  }\n\n  get radius () {\n    return Math.sqrt(\n      Math.pow((this.width / 2), 2) + Math.pow((this.height / 2), 2)\n    ) / 2;\n  }\n\n  leftPoint (k: number, y: number): [number, number] {\n    return [\n      interpolateNumber(- this.width / 2, - this.radius)(easeCubicIn(k))\n    ,\n      interpolateNumber(0, this.radius)( y * k )\n    ]\n  }\n\n  leftMiddlePoint (k: number, y: number): [number, number] {\n    let circleOrSquareRatio = interpolateNumber(Math.SQRT2 / 2, 1);\n\n    return [\n      interpolateNumber(- this.width / 4, - this.radius * circleOrSquareRatio(y))(easeCubicIn(k))\n    ,\n      interpolateNumber(0, - this.radius * circleOrSquareRatio(y))(easeCubic(k)) + interpolateNumber(0, this.radius)( y * k )\n    ]\n  }\n\n  middlePoint (k: number, y: number): [number, number] {\n    return [\n      0\n    ,\n      interpolateNumber(0, - this.radius)(easeCubicOut(k)) + interpolateNumber(0, this.radius)( y * k )\n    ]\n  }\n\n  rightMiddlePoint (k: number, y: number): [number, number] {\n    return this.verticalSymetry(this.leftMiddlePoint(k, y));\n  }\n\n  rightPoint (k: number, y: number): [number, number] {\n    return this.verticalSymetry(this.leftPoint(k, y));\n  }\n\n  verticalSymetry (point: [number, number]): [number, number] {\n    return [\n      -point[0], point[1]\n    ]\n  }\n\n  horizontalSymetry (point: [number, number]): [number, number] {\n    return [\n      point[0], -point[1]\n    ]\n  }\n\n  verticalTranslation (dy: number) {\n    return function(point: [number, number]): [number, number] {\n      return [\n        point[0], dy + point[1]\n      ]\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./node_modules/vue-loader/lib/selector.js?type=script&index=0!./src/components/Visualization.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('svg',{staticClass:\"brain-visualization\",attrs:{\"height\":_vm.height,\"width\":_vm.width}},[_c('defs',[_c('filter',{attrs:{\"id\":\"goo\"}},[_c('feGaussianBlur',{attrs:{\"in\":\"SourceGraphic\",\"stdDeviation\":\"10\",\"result\":\"blur\"}}),_c('feColorMatrix',{attrs:{\"in\":\"blur\",\"mode\":\"matrix\",\"values\":\"1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 20 -18\",\"result\":\"goo\"}}),_c('feComposite',{attrs:{\"in\":\"SourceGraphic\",\"in2\":\"goo\",\"operator\":\"atop\"}})],1)]),_c('g',{staticClass:\"brain-wires\"},_vm._l((_vm.brainWires(_vm.tk1, _vm.tk2)),function(wire,i){return _c('path',{key:i,staticClass:\"brain-wire\",attrs:{\"filter\":\"url(#goo)\",\"transform\":_vm.originTranslation,\"d\":wire,\"fill\":_vm.colors[i]}})}))])}\nvar staticRenderFns = []\nexport { render, staticRenderFns }\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-888b4562\",\"hasScoped\":true,\"optionsId\":\"0\",\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/components/Visualization.vue\n// module id = null\n// module chunks = ","function injectStyle (context) {\n  require(\"!!../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":false,\\\"minimize\\\":true}!../../node_modules/vue-loader/lib/style-compiler/index?{\\\"optionsId\\\":\\\"0\\\",\\\"vue\\\":true,\\\"id\\\":\\\"data-v-888b4562\\\",\\\"scoped\\\":true,\\\"sourceMap\\\":false}!sass-loader?{\\\"sourceMap\\\":false}!../../node_modules/vue-loader/lib/selector?type=styles&index=0!./Visualization.vue\")\n}\n/* script */\nexport * from \"!!cache-loader?{\\\"cacheDirectory\\\":\\\"/home/david/dev/art/muse/brain-control/node_modules/.cache/cache-loader\\\"}!babel-loader!ts-loader?{\\\"transpileOnly\\\":true,\\\"appendTsSuffixTo\\\":[{}],\\\"happyPackMode\\\":false}!../../node_modules/vue-loader/lib/selector?type=script&index=0!./Visualization.vue\"\nimport __vue_script__ from \"!!cache-loader?{\\\"cacheDirectory\\\":\\\"/home/david/dev/art/muse/brain-control/node_modules/.cache/cache-loader\\\"}!babel-loader!ts-loader?{\\\"transpileOnly\\\":true,\\\"appendTsSuffixTo\\\":[{}],\\\"happyPackMode\\\":false}!../../node_modules/vue-loader/lib/selector?type=script&index=0!./Visualization.vue\"\n/* template */\nimport {render as __vue_render__, staticRenderFns as __vue_static_render_fns__} from \"!!../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-888b4562\\\",\\\"hasScoped\\\":true,\\\"optionsId\\\":\\\"0\\\",\\\"buble\\\":{\\\"transforms\\\":{}}}!../../node_modules/vue-loader/lib/selector?type=template&index=0!./Visualization.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-888b4562\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nimport normalizeComponent from \"!../../node_modules/vue-loader/lib/runtime/component-normalizer\"\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_render__,\n  __vue_static_render_fns__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/components/Visualization.vue\n// module id = null\n// module chunks = ","\nimport _ from 'lodash';\nimport { CreateElement, VNode } from 'vue';\nimport { Component, Prop, Vue, Watch } from 'vue-property-decorator';\nimport {\n  Scene, Camera,\n  WebGLRenderer, PerspectiveCamera\n} from 'three';\n\nimport * as THREE from 'three';\n\nconst CAMERA_DISTANCE = 200;\nconst BOUNDS = {\n  X: CAMERA_DISTANCE * 2,\n  Y: CAMERA_DISTANCE * 2\n};\n\nconst CIRCLE_RADIUS = CAMERA_DISTANCE * Math.SQRT2;\nconst SQUARE_SIZE = CAMERA_DISTANCE;\nconst SQUARE_RADIUS = SQUARE_SIZE / 2;\n\nconst POINTS_COUNT = 1000\nconst POINTS_RENEWAL_CHANCE = 0.001;\n\n@Component\nexport default class ParticlesVizualisation extends Vue {\n  private scene: Scene;\n  private renderer: WebGLRenderer;\n  private camera: Camera;\n  private geometry: THREE.Geometry;\n  private points: THREE.Points;\n  private lastAnimationId: number | undefined;\n\n  @Prop({ required: true })\n  public k1: number;\n\n  @Prop({ required: true })\n  public k2: number;\n\n  @Prop({ default: false })\n  public paused: boolean;\n\n  created () {\n    this.scene = new Scene();\n\n    this.renderer = new WebGLRenderer({\n      preserveDrawingBuffer: true\n    });\n    this.renderer.autoClearColor = false;\n\n    this.camera = new PerspectiveCamera( 120, window.innerWidth / window.innerHeight, 0.1, 1000 );\n\n    // TRAIL EFFECT\n    // Create a semi-transparent plane\n    let fadeMaterial = new THREE.MeshBasicMaterial({\n      color: 0x000000,\n      transparent: true,\n      opacity: 0.04,\n      depthWrite: false\n    });\n    let fadePlane = new THREE.PlaneBufferGeometry(1, 1);\n    let fadeMesh = new THREE.Mesh(fadePlane, fadeMaterial);\n\n    // Group the plane and the camera in cameraGroup\n    let cameraGroup = new THREE.Object3D();\n    cameraGroup.add(this.camera);\n    cameraGroup.add(fadeMesh);\n    cameraGroup.translateZ(CAMERA_DISTANCE);\n\n    // Place the plane in front of the camera\n    fadeMesh.position.z = -0.1;\n\n    //Render the Make plane before points\n    fadeMesh.renderOrder = -1;\n\n    this.scene.add(cameraGroup);\n\n    // POINTS\n    let material = new THREE.PointsMaterial({\n      size: 2,\n      vertexColors: THREE.VertexColors,\n      opacity: 0.6,\n      transparent: true,\n      map: this.createCanvasMaterial('white', 64),\n      depthWrite: false\n    });\n    this.geometry = new THREE.Geometry();\n\n    _.times(POINTS_COUNT, this.addRandomPoint);\n    this.points = new THREE.Points(this.geometry, material);\n\n    this.scene.add(this.points);\n  }\n\n  randomPositionOnPlane () {\n    return new THREE.Vector3(\n      2 * (Math.random() - 0.5) * BOUNDS.X,\n      2 * (Math.random() - 0.5) * BOUNDS.Y,\n      0\n    )\n  }\n\n  addRandomPoint () {\n    this.geometry.vertices.push(this.randomPositionOnPlane());\n\n    this.geometry.colors.push(new THREE.Color(\n      Math.random(), Math.random(), Math.random()\n    ));\n  }\n\n  mounted () {\n    this.renderer.setSize(window.innerWidth, window.innerHeight);\n    this.animate();\n    this.$el.appendChild(this.renderer.domElement);\n  }\n\n  get horizontalWeigth () {\n    return 1 - Math.max(this.k1, this.k2);\n  }\n\n  get circleWeigth () {\n    if ((this.k1 + this.k2) === 0)\n      return 0\n    return this.k1;\n  }\n\n  get squareWeigth () {\n    if ((this.k1 + this.k2) === 0)\n      return 0\n    return this.k2;\n  }\n\n  animate () {\n    // Re-randomly position some of the points\n    this.geometry.vertices.map((vertice) => {\n      if (Math.random() <= POINTS_RENEWAL_CHANCE) {\n        let v = this.randomPositionOnPlane();\n        vertice.set(v.x, v.y, v.z);\n        this.geometry.verticesNeedUpdate = true;\n      }\n    });\n\n    // Move points\n    if ( !_.isNaN(this.k1) && !_.isNaN(this.k2) ) {\n      this.geometry.vertices.map( (particle) => {\n        let h = this.horizontalMovement(particle);\n        let c = this.circularMovement(particle);\n        let s = this.squareMovement(particle);\n\n        let weightedMovementAlongAxis = (h: number, c: number, s: number): number =>\n          this.circleWeigth * c + this.squareWeigth * s + this.horizontalWeigth * h\n\n        let movement: [number, number] = [\n          weightedMovementAlongAxis(h[0], c[0], s[0]),\n          weightedMovementAlongAxis(h[1], c[1], s[1])\n        ]\n        this.moveParticle(\n          particle, movement\n        );\n      });\n\n      this.geometry.verticesNeedUpdate = true;\n    }\n\n    this.geometry.colors.map( (particleColor) => {\n      let dX, dY, dZ;\n      dX = (Math.random() - .5 ) / 5;\n      dY = (Math.random() - .5 ) / 5;\n      dZ = (Math.random() - .5 ) / 5;\n\n      particleColor.add(new THREE.Color(dX, dY, dZ));\n    });\n    this.geometry.colorsNeedUpdate = true;\n\n    this.renderer.render(this.scene, this.camera);\n    this.continue()\n  }\n\n  createCanvasMaterial (color: string, size: number): THREE.Texture {\n    let matCanvas = document.createElement('canvas');\n    matCanvas.width = matCanvas.height = size;\n    let matContext = matCanvas.getContext('2d');\n    let texture = new THREE.Texture(matCanvas);\n    if (!matContext)\n      return new THREE.Texture();\n\n    // Circle\n    let center = size / 2;\n    matContext.beginPath();\n    matContext.arc(center, center, center, 0, 2 * Math.PI);\n    matContext.closePath();\n    matContext.fillStyle = color;\n    matContext.fill();\n\n    texture.needsUpdate = true;\n    return texture;\n  }\n\n  moveParticle (particle: THREE.Vertex, movement: [number, number]) {\n    particle.x += movement[0];\n    particle.y += movement[1];\n\n    if (particle.x > BOUNDS.X)\n      particle.x = -1 * BOUNDS.X;\n    if (particle.x < -1 * BOUNDS.X)\n      particle.x = BOUNDS.X;\n    if (particle.y > BOUNDS.Y)\n      particle.y = -1 * BOUNDS.Y;\n    if (particle.y < -1 * BOUNDS.Y)\n      particle.y = BOUNDS.Y;\n  }\n\n  horizontalMovement (particle: THREE.Vertex): [number, number] {\n    return [\n      1,\n      Math.sin(particle.x / 16 / Math.PI) / 2\n    ];\n  }\n\n  circularMovement (particle: THREE.Vertex): [number, number] {\n    let r = Math.pow( Math.pow(particle.x, 2) + Math.pow(particle.y, 2) , .5);\n    let θ = Math.atan2(particle.y, particle.x);\n\n    // Movement towards the circle\n    let dr = (CIRCLE_RADIUS - r) / 250; // 250 frames to match the circle\n    // Movement along the circle\n    let dθ = 2 * Math.PI / 2000; // 1000 frames to complete the circle\n\n    return [\n      dr * Math.cos(θ) - r * Math.sin(θ) * dθ,\n      dr * Math.cos(θ) + r * Math.cos(θ) * dθ\n    ];\n  }\n\n  squareMovement (particle: THREE.Vertex) {\n    let x = particle.x;\n    let y = particle.y;\n\n    let dx: number;\n    let dy: number;\n    let r: number;\n    let dr = (x: number, y: number, r: number): [number, number] => [0, 0]\n\n    if (x >= 0) {\n      dy = 1;\n      if (y >= 0) {\n        r = y / (1 - x); \n        dx = -1;\n      } else { // y < 0\n        r = y / (x - 1); \n        dx = 1;\n      }\n    } else { // x < 0\n      dy = -1;\n      if (y > 0) {\n        r = y / (x + 1); \n        dx = -1;\n      } else { // y < 0\n        r = y / (-1 - x); \n        dx = 1;\n      }\n    }\n\n    // let dr = (SQUARE_SIZE - r) / 1000;\n\n    return [dx, dy];\n  }\n\n  continue () {\n    if (!this.paused)\n      this.lastAnimationId = window.requestAnimationFrame(this.animate);\n  }\n\n  pause () {\n    if (this.lastAnimationId)\n      window.cancelAnimationFrame(this.lastAnimationId);\n    this.lastAnimationId = undefined;\n  }\n\n  @Watch('paused')\n  onPausedChanged () {\n    this.paused ? this.pause() : this.continue()\n  }\n\n  render (h: CreateElement): VNode {\n    return h('div', { class: 'brain-particles' });\n  }\n\n  destroyed () {\n    this.pause();\n    this.renderer.dispose();\n    this.geometry.dispose();\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./node_modules/vue-loader/lib/selector.js?type=script&index=0!./src/components/ParticlesVisualization.vue","function injectStyle (context) {\n  require(\"!!../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":false,\\\"minimize\\\":true}!../../node_modules/vue-loader/lib/style-compiler/index?{\\\"optionsId\\\":\\\"0\\\",\\\"vue\\\":true,\\\"id\\\":\\\"data-v-2f884374\\\",\\\"scoped\\\":true,\\\"sourceMap\\\":false}!sass-loader?{\\\"sourceMap\\\":false}!../../node_modules/vue-loader/lib/selector?type=styles&index=0!./ParticlesVisualization.vue\")\n}\n/* script */\nexport * from \"!!cache-loader?{\\\"cacheDirectory\\\":\\\"/home/david/dev/art/muse/brain-control/node_modules/.cache/cache-loader\\\"}!babel-loader!ts-loader?{\\\"transpileOnly\\\":true,\\\"appendTsSuffixTo\\\":[{}],\\\"happyPackMode\\\":false}!../../node_modules/vue-loader/lib/selector?type=script&index=0!./ParticlesVisualization.vue\"\nimport __vue_script__ from \"!!cache-loader?{\\\"cacheDirectory\\\":\\\"/home/david/dev/art/muse/brain-control/node_modules/.cache/cache-loader\\\"}!babel-loader!ts-loader?{\\\"transpileOnly\\\":true,\\\"appendTsSuffixTo\\\":[{}],\\\"happyPackMode\\\":false}!../../node_modules/vue-loader/lib/selector?type=script&index=0!./ParticlesVisualization.vue\"\n/* template */\nvar __vue_render__, __vue_static_render_fns__\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-2f884374\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nimport normalizeComponent from \"!../../node_modules/vue-loader/lib/runtime/component-normalizer\"\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_render__,\n  __vue_static_render_fns__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/components/ParticlesVisualization.vue\n// module id = null\n// module chunks = ","/**\n * This file is based on https://github.com/mapbox/webgl-wind\n * by Vladimir Agafonkin\n * \n * Released under ISC License, Copyright (c) 2016, Mapbox\n * https://github.com/mapbox/webgl-wind/blob/master/LICENSE\n * \n * Adapted to field maps by Andrei Kashcha\n * Copyright (C) 2017\n */\nexport default {\n  createTexture: createTexture,\n  bindFramebuffer: bindFramebuffer,\n  createProgram: createProgram, \n  createBuffer: createBuffer,\n  bindAttribute: bindAttribute,\n  bindTexture: bindTexture\n}\n\nfunction bindTexture(gl, texture, unit) {\n  gl.activeTexture(gl.TEXTURE0 + unit);\n  gl.bindTexture(gl.TEXTURE_2D, texture);\n}\n\nfunction createBuffer(gl, data) {\n  var buffer = gl.createBuffer();\n  gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n  gl.bufferData(gl.ARRAY_BUFFER, data, gl.STATIC_DRAW);\n  return buffer;\n}\n\nfunction createTexture(gl, filter, data, width, height) {\n  var texture = gl.createTexture();\n  gl.bindTexture(gl.TEXTURE_2D, texture);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, filter);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, filter);\n  if (data instanceof Uint8Array) {\n      gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, width, height, 0, gl.RGBA, gl.UNSIGNED_BYTE, data);\n  } else {\n      gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, data);\n  }\n  gl.bindTexture(gl.TEXTURE_2D, null);\n  return texture;\n}\n\nfunction bindFramebuffer(gl, framebuffer, texture) {\n  gl.bindFramebuffer(gl.FRAMEBUFFER, framebuffer);\n  if (texture) {\n      gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, texture, 0);\n  }\n}\n\nfunction bindAttribute(gl, buffer, attribute, numComponents) {\n  gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n  gl.enableVertexAttribArray(attribute);\n  gl.vertexAttribPointer(attribute, numComponents, gl.FLOAT, false, 0, 0);\n}\n\nfunction createProgram(gl, vertexSource, fragmentSource) {\n  var program = gl.createProgram();\n\n  var vertexShader = createShader(gl, gl.VERTEX_SHADER, vertexSource);\n  var fragmentShader = createShader(gl, gl.FRAGMENT_SHADER, fragmentSource);\n\n  gl.attachShader(program, vertexShader);\n  gl.attachShader(program, fragmentShader);\n\n  gl.linkProgram(program);\n  if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {\n      throw new Error(gl.getProgramInfoLog(program));\n  }\n\n  var wrapper = {\n    program: program,\n    unload: unload\n  };\n\n  var numAttributes = gl.getProgramParameter(program, gl.ACTIVE_ATTRIBUTES);\n  var i;\n  for (i = 0; i < numAttributes; i++) {\n      var attribute = gl.getActiveAttrib(program, i);\n      wrapper[attribute.name] = gl.getAttribLocation(program, attribute.name);\n  }\n  var numUniforms = gl.getProgramParameter(program, gl.ACTIVE_UNIFORMS);\n  for (i = 0; i < numUniforms; i++) {\n      var uniform = gl.getActiveUniform(program, i);\n      wrapper[uniform.name] = gl.getUniformLocation(program, uniform.name);\n  }\n\n  return wrapper; \n\n  function unload() {\n    gl.deleteProgram(program);\n  }\n}\n\nfunction createShader(gl, type, source) {\n  var shader = gl.createShader(type);\n  gl.shaderSource(shader, source);\n\n  gl.compileShader(shader);\n  if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\n      throw new Error(gl.getShaderInfoLog(shader));\n  }\n\n  return shader;\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/field-play/gl-utils.js","/**\n * Various color modes.\n */\nexport default {\n  /**\n   * Each particle gets its own color\n   */\n  UNIFORM: 1,\n\n  /**\n   * Color of a particle depends on its velocity\n   */\n  VELOCITY: 2,\n\n  /**\n   * Color of a particle depends on its velocity vector angle.\n   */\n  ANGLE: 3,\n\n  /**\n   * The color comes from a shader. WIP\n   */\n  CUSTOM: 4\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/field-play/programs/colorModes.js","/**\n * Wraps a simple vector field string into our default shader code.\n * @param {String} field \n */\nexport default function wrapVectorField(field) {\n  return `// p.x and p.y are current coordinates\n// v.x and v.y is a velocity at point p\nvec2 get_velocity(vec2 p) {\n  vec2 v = vec2(0., 0.);\n\n  // change this to get a new vector field\n  ${field}\n\n  return v;\n}`\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/field-play/wrapVectorField.js","/**\n * Checks whether current window belongs to a \"Small\" screen\n * size. Small screens have slightly different initial behavior.\n * E.g. the settings window is always collapsed.\n * \n * This needs to be in sync with `small-screen` variable in\n *  ../commponents/shared.styl\n */\nexport default function isSmallScreen() {\n  return window.innerWidth < 600\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/field-play/isSmallScreen.js","import queryState from 'query-state';\nimport bus from './bus';\nimport ColorModes from './programs/colorModes';\nimport wrapVectorField from './wrapVectorField';\nimport isSmallScreen from './isSmallScreen';\n\n/**\n * The state of the fieldplay is stored in the query string. This is the\n * only place where query string can be manipulated or fetched.\n */\n\nvar qs = queryState({}, {\n  useSearch: true,\n  // Older version of the app used hash to store application arguments.\n  // Turns out hash is not good for websites like reddit. They can block\n  // url, saying \"url was already submitted\" if the only part that is different\n  // is hash. So, we switch to search string, and maintain backward compatibility\n  // for fields created before.\n  rewriteHashToSearch: true\n});\n\nvar currentState = {}; //qs.get();\n\nvar defaultVectorField = wrapVectorField(`v.x = 0.1 * p.y;\n  v.y = -0.2 * p.y;`);\n\nvar pendingSave;\nvar defaults = {\n  timeStep: 0.01,\n  dropProbability: 0.009,\n  particleCount: 10000,\n  fadeout: .998,\n  colorMode: ColorModes.UNIFORM\n}\n\nlet settingsPanel = {\n  collapsed: isSmallScreen(),\n};\n\nexport default {\n  settingsPanel,\n  saveBBox,\n  getBBox,\n  makeBBox,\n  getQS() { return qs; },\n  saveCode,\n  getCode,\n  getDefaultCode,\n\n  getDropProbability,\n  setDropProbability,\n\n  getIntegrationTimeStep,\n  setIntegrationTimeStep,\n\n  getParticleCount,\n  setParticleCount,\n\n  getFadeout,\n  setFadeout,\n\n  getColorMode,\n  setColorMode,\n\n  getColorFunction,\n  setColorFunction\n}\n\nqs.onChange(function() {\n  bus.fire('scene-ready', window.scene);\n});\n\nfunction getColorMode() {\n  let colorMode = qs.get('cm');\n  return defined(colorMode) ? colorMode : defaults.colorMode;\n}\n\nfunction setColorMode(colorMode) {\n  if (!defined(colorMode)) return;\n  // qs.set({cm: colorMode});\n  currentState.cm = colorMode;\n}\n\nfunction getColorFunction() {\n  let colorFunction = qs.get('cf');\n  return colorFunction || '';\n}\n\nfunction setColorFunction(colorFunction) {\n  // qs.set({cf: colorFunction});\n  currentState.cf = colorFunction;\n}\n\nfunction getFadeout() {\n  let fadeout = qs.get('fo');\n  return defined(fadeout) ? fadeout : defaults.fadeout;\n}\n\nfunction setFadeout(fadeout) {\n  if (!defined(fadeout)) return;\n  // qs.set({fo: fadeout});\n  currentState.fo = fadeout;\n}\n\nfunction getParticleCount() {\n  let particleCount = qs.get('pc');\n  return defined(particleCount) ? particleCount : defaults.particleCount;\n}\n\nfunction setParticleCount(particleCount) {\n  if (!defined(particleCount)) return;\n  // qs.set({pc: particleCount});\n  currentState.pc = particleCount;\n}\n\nfunction getIntegrationTimeStep() {\n  let timeStep = qs.get('dt');\n  return defined(timeStep) ? timeStep : defaults.timeStep;\n}\n\nfunction setIntegrationTimeStep(dt) {\n  if (!defined(dt)) return;\n  // qs.set({dt: dt})\n  currentState.dt = dt;\n}\n\nfunction getDropProbability() {\n  let dropProbability = qs.get('dp');\n  return defined(dropProbability) ? dropProbability : defaults.dropProbability;\n}\n\nfunction setDropProbability(dropProbability) {\n  if (!defined(dropProbability)) return;\n  clamp(dropProbability, 0, 1);\n  // qs.set({dp: dropProbability})\n}\n\nfunction getBBox() {\n  let cx = qs.get('cx');\n  let cy = qs.get('cy');\n  let w = qs.get('w');\n  let h = qs.get('h');\n  return makeBBox(cx, cy, w, h);\n}\n\nfunction makeBBox(cx, cy, w, h) {\n  let bboxDefined = defined(cx) && defined(cy) && defined(w) && defined(h);\n  if (!bboxDefined) return;\n\n  let w2 = w/2;\n  let h2 = h/2;\n  var p = 10000;\n  return {\n    minX: Math.round(p * (cx - w2))/p,\n    maxX: Math.round(p * (cx + w2))/p,\n    minY: Math.round(p * (cy - h2))/p,\n    maxY: Math.round(p * (cy + h2))/p\n  };\n}\n\nfunction saveBBox(bbox, immediate = false) {\n  bbox = {\n    cx: (bbox.minX + bbox.maxX) * 0.5,\n    cy: (bbox.minY + bbox.maxY) * 0.5,\n    w: (bbox.maxX - bbox.minX),\n    h: (bbox.maxX - bbox.minX)\n  }\n\n  if (bbox.w <= 0 || bbox.h <= 0) return;\n\n  currentState.cx = bbox.cx;\n  currentState.cy = bbox.cy;\n  currentState.w = bbox.w;\n  currentState.h = bbox.h;\n\n  if(pendingSave) {\n    clearTimeout(pendingSave);\n    pendingSave = 0;\n  }\n\n  // if (immediate) qs.set(bbox);\n  else {\n    pendingSave = setTimeout(() => {\n      pendingSave = 0;\n      // qs.set(bbox);\n    }, 300);\n  }\n}\n\nfunction getCode() {\n  var vfCode = qs.get('vf');\n  if (vfCode) return vfCode;\n\n  // If we didn't get code yet, let's try read to read it from previous version\n  // of the API.\n  // TODO: Need to figure out how to develop this in backward/future compatible way.\n  var oldCode = qs.get('code');\n  if (oldCode) {\n    vfCode = wrapVectorField(oldCode);\n    // side effect - let's clean the old URL\n    delete(currentState.code);\n    // qs.set('vf', vfCode);\n    return vfCode;\n  }\n\n  return defaultVectorField;\n}\n\nfunction getDefaultCode() {\n  return defaultVectorField;\n}\n\nfunction saveCode(code) {\n  // qs.set({\n  //   vf: code\n  // });\n  currentState.code = code;\n}\n\nfunction defined(number) {\n  return Number.isFinite(number);\n}\n\nfunction clamp(x, min, max) {\n  return x < min ? min :\n        (x > max) ? max : x;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/field-play/appState.js","/**\n * Renders computed state onto the screen.\n */\nimport glUtils from '../gl-utils';\n\nconst NO_TRANSFORM = {dx: 0, dy: 0, scale: 1};\n\nexport default function makeScreenProgram(ctx) {\n  var {gl, canvasRect} = ctx;\n\n  var screenTexture, backgroundTexture;\n  var boundBoxTextureTransform = {dx: 0, dy: 0, scale: 1};\n  var lastRenderedBoundingBox = null;\n\n  updateScreenTextures();\n  var screenProgram = glUtils.createProgram(gl, getScreenVertexShader(), getScreenFragmentShader());\n  \n  var api = {\n    fadeOutLastFrame,\n    renderCurrentScreen,\n    updateScreenTextures,\n\n    boundingBoxUpdated: false\n  };\n\n  return api;\n  \n  function fadeOutLastFrame() {\n    // render to the frame buffer\n    glUtils.bindFramebuffer(gl, ctx.framebuffer, screenTexture);\n    gl.viewport(0, 0, canvasRect.width, canvasRect.height);\n\n    if (api.boundingBoxUpdated && lastRenderedBoundingBox) {\n      // We move the back texture, relative to the bounding box change. This eliminates\n      // particle train artifacts, though, not all of them: https://computergraphics.stackexchange.com/questions/5754/fading-particles-and-transition\n      // If you know how to improve this - please let me know.\n      boundBoxTextureTransform.dx = -(ctx.bbox.minX - lastRenderedBoundingBox.minX)/(ctx.bbox.maxX - ctx.bbox.minX);\n      boundBoxTextureTransform.dy = -(ctx.bbox.minY - lastRenderedBoundingBox.minY)/(ctx.bbox.maxY - ctx.bbox.minY);\n      boundBoxTextureTransform.scale = (ctx.bbox.maxX - ctx.bbox.minX) / (lastRenderedBoundingBox.maxX - lastRenderedBoundingBox.minX);\n      drawTexture(backgroundTexture, ctx.fadeOpacity, boundBoxTextureTransform);\n    } else {\n      drawTexture(backgroundTexture, ctx.fadeOpacity, NO_TRANSFORM)\n    }\n  }\n\n  function renderCurrentScreen() {\n    glUtils.bindFramebuffer(gl, null);\n\n    saveLastBbox();\n\n    gl.enable(gl.BLEND); \n    gl.blendFunc(gl.SRC_ALPHA, gl.DST_ALPHA);\n    gl.clearColor(ctx.backgroundColor.r, ctx.backgroundColor.g, ctx.backgroundColor.b, ctx.backgroundColor.a);\n    gl.clear(gl.COLOR_BUFFER_BIT);\n    drawTexture(screenTexture, 1.0, NO_TRANSFORM);\n    gl.disable(gl.BLEND);\n\n    var temp = backgroundTexture;\n    backgroundTexture = screenTexture;\n    screenTexture = temp;\n\n    api.boundingBoxUpdated = false;\n    if (window.audioTexture) {\n      drawTexture(window.audioTexture, 1.0, NO_TRANSFORM);\n    }\n  }\n\n  function updateScreenTextures() {\n    var {width, height} = canvasRect;\n    var emptyPixels = new Uint8Array(width * height * 4);\n    if (screenTexture) {\n      gl.deleteTexture(screenTexture);\n    }\n    if (backgroundTexture) {\n      gl.deleteTexture(backgroundTexture);\n    }\n\n    screenTexture = glUtils.createTexture(gl, gl.NEAREST, emptyPixels, width, height);\n    backgroundTexture = glUtils.createTexture(gl, gl.NEAREST, emptyPixels, width, height);\n  }\n\n  function saveLastBbox() {\n    if (!lastRenderedBoundingBox) {\n      lastRenderedBoundingBox = {\n        minX: ctx.bbox.minX,\n        minY: ctx.bbox.minY,\n        maxX: ctx.bbox.maxX,\n        maxY: ctx.bbox.maxY\n      }\n\n      return;\n    } \n\n    lastRenderedBoundingBox.minX = ctx.bbox.minX;\n    lastRenderedBoundingBox.minY = ctx.bbox.minY;\n    lastRenderedBoundingBox.maxX = ctx.bbox.maxX;\n    lastRenderedBoundingBox.maxY = ctx.bbox.maxY;\n  }\n\n  function drawTexture(texture, opacity, textureTransform) {\n    var program = screenProgram;\n    gl.useProgram(program.program);\n    glUtils.bindAttribute(gl, ctx.quadBuffer, program.a_pos, 2);\n\n    // TODO: This index is very fragile. I need to find a way\n    glUtils.bindTexture(gl, texture, ctx.screenTextureUnit);\n    gl.uniform1i(program.u_screen, ctx.screenTextureUnit);\n\n    gl.uniform1f(program.u_opacity_border, 0.02);\n    gl.uniform1f(program.u_opacity, opacity);\n    gl.uniform3f(program.u_transform, textureTransform.dx, textureTransform.dy, textureTransform.scale);\n\n    gl.drawArrays(gl.TRIANGLES, 0, 6);\n  }\n}\n\nfunction getScreenVertexShader() {\n  return `// screen program\nprecision highp float;\n\nattribute vec2 a_pos;\nvarying vec2 v_tex_pos;\nuniform vec3 u_transform;\n\nvoid main() {\n    v_tex_pos = a_pos;\n    vec2 pos = a_pos;\n\n    // This transformation tries to move texture (raster) to the approximate position\n    // of particles on the current frame. This is needed to avoid rendering artifacts\n    // during pan/zoom: https://computergraphics.stackexchange.com/questions/5754/fading-particles-and-transition\n\n    // PS: I must admit, I wrote this formula through sweat and tears, and\n    // I still have no idea why I don't need to apply (pos.y - 0.5) to Y coordinate.\n    // Is it because I use aspect ratio for bounding box?\n    pos.x = (pos.x - 0.5) / u_transform.z - u_transform.x + 0.5 * u_transform.z;\n    pos.y = pos.y / u_transform.z + u_transform.y;\n\n    pos = 1.0 - 2.0 * pos;\n    gl_Position = vec4(pos, 0, 1);\n}`\n}\n\nfunction getScreenFragmentShader() {\n  return `precision highp float;\nuniform sampler2D u_screen;\nuniform float u_opacity;\nuniform float u_opacity_border;\n\nvarying vec2 v_tex_pos;\n\nvoid main() {\n  vec2 p = 1.0 - v_tex_pos;\n  vec4 color = texture2D(u_screen, p);\n\n  gl_FragColor = vec4(floor(255.0 * color * u_opacity) / 255.0);\n}`\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/field-play/programs/screenProgram.js","/**\n * A shader function to decode rgba encoded color into float position.\n */\nconst code = `\nhighp float decodeFloatRGBA( vec4 v ) {\n  float a = floor(v.r * 255.0 + 0.5);\n  float b = floor(v.g * 255.0 + 0.5);\n  float c = floor(v.b * 255.0 + 0.5);\n  float d = floor(v.a * 255.0 + 0.5);\n\n  float exponent = a - 127.0;\n  float sign = 1.0 - mod(d, 2.0)*2.0;\n  float mantissa = float(a > 0.0)\n                  + b / 256.0\n                  + c / 65536.0\n                  + floor(d / 2.0) / 8388608.0;\n  return sign * mantissa * exp2(exponent);\n}\n`\n\nexport default code;\n\n\n// WEBPACK FOOTER //\n// ./src/lib/field-play/shaderGraph/parts/decodeFloatRGBA.js","export default class BaseShaderNode {\n  constructor() { }\n  getDefines() { return ''; }\n  getFunctions() { return ''; }\n  getMainBody() { return ''; }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/field-play/shaderGraph/BaseShaderNode.js","//\n// Description : Array and textureless GLSL 2D simplex noise function.\n//      Author : Ian McEwan, Ashima Arts.\n//  Maintainer : stegu\n//     Lastmod : 20110822 (ijm)\n//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.\n//               Distributed under the MIT License. See LICENSE file.\n//               https://github.com/ashima/webgl-noise\n//               https://github.com/stegu/webgl-noise\n// \n\nvar code = `\nvec3 mod289(vec3 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec2 mod289(vec2 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec3 permute(vec3 x) {\n  return mod289(((x*34.0)+1.0)*x);\n}\n\nfloat snoise(vec2 v)\n  {\n  const vec4 C = vec4(0.211324865405187,  // (3.0-sqrt(3.0))/6.0\n                      0.366025403784439,  // 0.5*(sqrt(3.0)-1.0)\n                     -0.577350269189626,  // -1.0 + 2.0 * C.x\n                      0.024390243902439); // 1.0 / 41.0\n// First corner\n  vec2 i  = floor(v + dot(v, C.yy) );\n  vec2 x0 = v -   i + dot(i, C.xx);\n\n// Other corners\n  vec2 i1;\n  //i1.x = step( x0.y, x0.x ); // x0.x > x0.y ? 1.0 : 0.0\n  //i1.y = 1.0 - i1.x;\n  i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\n  // x0 = x0 - 0.0 + 0.0 * C.xx ;\n  // x1 = x0 - i1 + 1.0 * C.xx ;\n  // x2 = x0 - 1.0 + 2.0 * C.xx ;\n  vec4 x12 = x0.xyxy + C.xxzz;\n  x12.xy -= i1;\n\n// Permutations\n  i = mod289(i); // Avoid truncation effects in permutation\n  vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 ))\n\t\t+ i.x + vec3(0.0, i1.x, 1.0 ));\n\n  vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);\n  m = m*m ;\n  m = m*m ;\n\n// Gradients: 41 points uniformly over a line, mapped onto a diamond.\n// The ring size 17*17 = 289 is close to a multiple of 41 (41*7 = 287)\n\n  vec3 x = 2.0 * fract(p * C.www) - 1.0;\n  vec3 h = abs(x) - 0.5;\n  vec3 ox = floor(x + 0.5);\n  vec3 a0 = x - ox;\n\n// Normalise gradients implicitly by scaling m\n// Approximation of: m *= inversesqrt( a0*a0 + h*h );\n  m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );\n\n// Compute final noise value at P\n  vec3 g;\n  g.x  = a0.x  * x0.x  + h.x  * x0.y;\n  g.yz = a0.yz * x12.xz + h.yz * x12.yw;\n  return 130.0 * dot(m, g);\n}\n`\n\nexport default code;\n\n\n// WEBPACK FOOTER //\n// ./src/lib/field-play/shaderGraph/parts/simplex-noise.js","export function getInputUniforms() {\n  return `uniform sampler2D input0;\nuniform sampler2D input1;`;\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/field-play/shaderGraph/customInput.js","import BaseShaderNode from './BaseShaderNode';\nimport snoise from './parts/simplex-noise';\nimport {getInputUniforms} from './customInput';\n\nexport default class UserDefinedVelocityFunction extends BaseShaderNode {\n  constructor(updateCode) {\n    super();\n    this.updateCode = updateCode || '';\n  }\n\n  setNewUpdateCode(newUpdateCode) {\n    this.updateCode = newUpdateCode;\n  }\n\n  getDefines() {\n    return `\nuniform float frame;\nuniform vec4 cursor;\n// TODO: use inputN instead.\nuniform sampler2D u_audio;\n\nuniform float u_k1;\nuniform float u_k2;\nuniform float u_k3;\nuniform float u_k4;\nuniform float u_k5;\n\n#define PI 3.1415926535897932384626433832795\n\n${getInputUniforms()}\n`\n  }\n\n  getFunctions() {\n  // TODO: Do I need to worry about \"glsl injection\" (i.e. is there potential for security attack?)\n  // TODO: Do I need to inject snoise only when it's used?\n    return `\n    // pseudo-random generator\nconst vec3 rand_constants = vec3(12.9898, 78.233, 4375.85453);\nfloat rand(const vec2 co) {\n    float t = dot(rand_constants.xy, co);\n    return fract(sin(t) * (rand_constants.z + t));\n}\n\n${snoise}\n\nvec2 rotate(vec2 p,float a) {\n\treturn cos(a)*p+sin(a)*vec2(p.y,-p.x);\n}\n\n// TODO: This will change. Don't use it.\nfloat audio(float index) {\n  float rgbI = floor(index/4.);\n  vec2 txPos = vec2(fract(rgbI / 5.), floor(rgbI / 5.) / 5.);\n  vec4 rgba = texture2D(u_audio, txPos);\n  \n  float offset = mod(index, 4.);\n  if (offset == 0.) return rgba[0];\n  if (offset == 1.) return rgba[1];\n  if (offset == 2.) return rgba[2];\n  return rgba[3];\n}\n\n${this.updateCode ? this.updateCode : 'vec2 get_velocity(vec2 p) { return vec2(0.); }'}\n  `\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/field-play/shaderGraph/UserDefinedVelocityFunction.js","import BaseShaderNode from './BaseShaderNode';\n\nexport default class RungeKuttaIntegrator extends BaseShaderNode {\n  constructor () {\n    super();\n  }\n\n  getDefines() {\n    return `\nuniform float u_h;\n`\n  }\n\n  getFunctions() {\n    return `\nvec2 rk4(const vec2 point) {\n  vec2 k1 = get_velocity( point );\n  vec2 k2 = get_velocity( point + k1 * u_h * 0.5);\n  vec2 k3 = get_velocity( point + k2 * u_h * 0.5);\n  vec2 k4 = get_velocity( point + k3 * u_h);\n\n  return k1 * u_h / 6. + k2 * u_h/3. + k3 * u_h/3. + k4 * u_h/6.;\n}`\n  }\n\n  getMainBody() {\n    return `\n  vec2 velocity = rk4(pos);\n`\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/field-play/shaderGraph/RungeKuttaIntegrator.js","import UserDefinedVelocityFunction from './UserDefinedVelocityFunction';\nimport RungeKuttaIntegrator from './RungeKuttaIntegrator';\nimport ColorModes from '../programs/colorModes';\n\nexport default function shaderBasedColor(colorMode, vfCode, colorCode) {\n  var udf = new UserDefinedVelocityFunction(vfCode);\n  var integrate = new RungeKuttaIntegrator();\n\n  return {\n    getVariables,\n    getMain,\n    getMethods\n  }\n\n  function getVariables() {\n    return `\nuniform vec2 u_velocity_range;\nuniform float u_k;\nvarying vec4 v_particle_color;\n\n${udf.getDefines()}\n${integrate.getDefines()}\n`\n  }\n\n  function getMethods() {\n    return `\n// https://github.com/hughsk/glsl-hsv2rgb\nvec3 hsv2rgb(vec3 c) {\n  vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n  vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n  return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\n\n${udf.getFunctions()}\n${integrate.getFunctions()}\n${getColorFunctionBody()}\n`\n  }\n\n  function getColorFunctionBody() {\n    if (colorMode === ColorModes.UNIFORM) {\n      return `\nvec4 get_color(vec2 p) {\n  return vec4(0.302, 0.737, 0.788, 1.);\n}\n`\n    }\n    if (colorMode === ColorModes.VELOCITY) {\n      return colorCode || `\n        vec4 get_color(vec2 p) {\n          vec2 velocity = get_velocity(p);\n          float speed = (length(velocity) - u_velocity_range[0])/(u_velocity_range[1] - u_velocity_range[0]);\n          float hue = 0.05 + (1. - speed) * 0.5;\n          return vec4(hsv2rgb(vec3(hue, 0.9, 1.)), 1.0);\n        }\n      `;\n    }\n\n    if (colorMode === ColorModes.CUSTOM) {\n      if (!colorCode) throw new Error('color mode is set to custom, but no color function is specified');\n      return colorCode;\n    }\n\n    return ` \nvec4 get_color(vec2 p) {\n  vec2 velocity = get_velocity(p);\n  float speed = (atan(velocity.y, velocity.x) + PI)/(2.0 * PI);\n  return vec4(hsv2rgb(vec3(speed, 0.9, 1.)), 1.0);\n}\n`;\n  }\n\n  function getMain() {\n    return `  v_particle_color = get_color(v_particle_pos);`\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/field-play/shaderGraph/shaderBasedColor.js","import decodeFloatRGBA from './parts/decodeFloatRGBA';\nimport shaderBasedColor from './shaderBasedColor';\n\n// TODO: this duplicates code from texture position.\nexport default class DrawParticleGraph {\n  constructor(ctx) {\n    this.colorMode = ctx.colorMode;\n    this.colorFunction = ctx.colorFunction || '';\n  }\n\n  getFragmentShader() {\n    return `precision highp float;\nvarying vec4 v_particle_color;\nvoid main() {\n  gl_FragColor = v_particle_color;\n}`\n  }\n\n  getVertexShader(vfCode) {\n    let decodePositions = textureBasedPosition();\n    let colorParts = shaderBasedColor(this.colorMode, vfCode, this.colorFunction);\n    let methods = []\n    addMethods(decodePositions, methods);\n    addMethods(colorParts, methods);\n    let main = [];\n    addMain(decodePositions, main);\n    addMain(colorParts, main);\n\n    return `precision highp float;\nattribute float a_index;\nuniform float u_particles_res;\nuniform vec2 u_min;\nuniform vec2 u_max;\n\n${decodePositions.getVariables() || ''}\n${colorParts.getVariables()}\n\n${decodeFloatRGBA}\n\n${methods.join('\\n')}\n\nvoid main() {\n  vec2 txPos = vec2(\n        fract(a_index / u_particles_res),\n        floor(a_index / u_particles_res) / u_particles_res);\n  gl_PointSize = 1.0;\n\n${main.join('\\n')}\n\n  vec2 du = (u_max - u_min);\n  v_particle_pos = (v_particle_pos - u_min)/du;\n  gl_Position = vec4(2.0 * v_particle_pos.x - 1.0, (1. - 2. * (v_particle_pos.y)),  0., 1.);\n}`\n  }\n}\n\nfunction addMethods(producer, array) {\n  if (producer.getMethods) {\n    array.push(producer.getMethods());\n  }\n}\n\nfunction addMain(producer, array) {\n  if (producer.getMain) {\n    array.push(producer.getMain());\n  }\n}\n\nfunction textureBasedPosition() {\n  return {\n    getVariables,\n    getMain\n  }\n\n  function getVariables() {\n    return `\nuniform sampler2D u_particles_x;\nuniform sampler2D u_particles_y;\n    `\n  }\n\n  function getMain() {\n    return `\n  vec2 v_particle_pos = vec2(\n    decodeFloatRGBA(texture2D(u_particles_x, txPos)),\n    decodeFloatRGBA(texture2D(u_particles_y, txPos))\n  );\n`\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/field-play/shaderGraph/DrawParticleGraph.js","const code = `\nvec4 encodeFloatRGBA(highp float val) {\n    if (val == 0.0) {\n        return vec4(0.0, 0.0, 0.0, 0.0);\n    }\n\n    float mag = abs(val);\n    float exponent = floor(log2(mag));\n    // Correct log2 approximation errors.\n    exponent += float(exp2(exponent) <= mag / 2.0);\n    exponent -= float(exp2(exponent) > mag);\n\n    float mantissa;\n    if (exponent > 100.0) {\n        // Not sure why this needs to be done in two steps for the largest float to work.\n        // Best guess is the optimizer rewriting '/ exp2(e)' into '* exp2(-e)',\n        // but exp2(-128.0) is too small to represent.\n        mantissa = mag / 1024.0 / exp2(exponent - 10.0) - 1.0;\n    } else {\n        mantissa = mag / float(exp2(exponent)) - 1.0;\n    }\n\n    float a = exponent + 127.0;\n    mantissa *= 256.0;\n    float b = floor(mantissa);\n    mantissa -= b;\n    mantissa *= 256.0;\n    float c = floor(mantissa);\n    mantissa -= c;\n    mantissa *= 128.0;\n    float d = floor(mantissa) * 2.0 + float(val < 0.0);\n    return vec4(a, b, c, d) / 255.0;\n}\n`\n\nexport default code;\n\n\n// WEBPACK FOOTER //\n// ./src/lib/field-play/shaderGraph/parts/encodeFloatRGBA.js","import BaseShaderNode from './BaseShaderNode';\nimport encodeFloatRGBA from './parts/encodeFloatRGBA';\nimport decodeFloatRGBA from './parts/decodeFloatRGBA';\n\n/**\n * Reads/writes particle coordinates from/to a texture;\n */\nexport default class TexturePosition extends BaseShaderNode {\n  constructor(isDecode) {\n    super();\n\n    // When it's decoding, it must read from the texture.\n    // Otherwise it must write to the texture;\n    this.isDecode = isDecode;\n  }\n\n  getFunctions() {\n    if (this.isDecode) {\n      return `\n    ${encodeFloatRGBA}\n    ${decodeFloatRGBA}\n`\n    }\n  }\n\n  getDefines() {\n    if (this.isDecode) {\n      // TODO: How to avoid duplication and silly checks?\n    return `\nprecision highp float;\n\nuniform sampler2D u_particles_x;\nuniform sampler2D u_particles_y;\n\n// Which coordinate needs to be printed onto the texture\nuniform int u_out_coordinate;\n\nvarying vec2 v_tex_pos;\n`;\n    }\n  }\n\n  getMainBody() {\n  if (this.isDecode) {\n    return `\n   vec2 pos = vec2(\n     decodeFloatRGBA(texture2D(u_particles_x, v_tex_pos)),\n     decodeFloatRGBA(texture2D(u_particles_y, v_tex_pos))\n   );\n`\n    }\n    return `\n    if (u_out_coordinate == 0) gl_FragColor = encodeFloatRGBA(newPos.x);\n    else if (u_out_coordinate == 1) gl_FragColor = encodeFloatRGBA(newPos.y);\n    else if (u_out_coordinate == 6) gl_FragColor = encodeFloatRGBA(get_velocity(pos).x);\n    else if (u_out_coordinate == 7) gl_FragColor = encodeFloatRGBA(get_velocity(pos).y);\n`\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/field-play/shaderGraph/TexturePositionNode.js","\nexport default function renderNodes(nodes) {\n  let code = [] \n\n  nodes.forEach(node => { if (node.getDefines) addToCode(node.getDefines()); });\n  nodes.forEach(node => { if (node.getFunctions) addToCode(node.getFunctions()); });\n\n  addToCode('void main() {')\n    nodes.forEach(node => { if (node.getMainBody) addToCode(node.getMainBody()); });\n  addToCode('}')\n  return code.join('\\n');\n\n  function addToCode(line) {\n    if (line) code.push(line)\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/field-play/shaderGraph/renderNodes.js","import BaseShaderNode from './BaseShaderNode';\n\nexport default class PanzoomTransform extends BaseShaderNode {\n  constructor(config) {\n    super();\n    // decode is used when we move particle read from the texture\n    // otherwise we write particle to texture and need to reverse transform\n    this.decode = config && config.decode;\n    this.srcPosName = (config && config.posName) || 'pos';\n  }\n\n  getDefines() {\n    if (this.decode) {\n      // TODO: Need to figure out how to not duplicate this.\n    return `\n  uniform vec2 u_min;\n  uniform vec2 u_max;\n`;\n    }\n  }\n\n  getMainBody() {\n    if (this.decode) {\n      return `\n  // move particle position according to current transform\n  vec2 du = (u_max - u_min);\n  pos.x = ${this.srcPosName}.x * du.x + u_min.x;\n  pos.y = ${this.srcPosName}.y * du.y + u_min.y;\n`\n    }\n    return `\n  pos.x = (${this.srcPosName}.x - u_min.x)/du.x;\n  pos.y = (${this.srcPosName}.y - u_min.y)/du.y;\n`\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/field-play/shaderGraph/PanzoomTransform.js","import BaseShaderNode from './BaseShaderNode';\nimport TexturePositionNode from './TexturePositionNode';\nimport renderNodes from './renderNodes';\nimport UserDefinedVelocityFunction from './UserDefinedVelocityFunction';\nimport PanzoomTransform from './PanzoomTransform';\nimport RungeKuttaIntegrator from './RungeKuttaIntegrator';\n\nexport default class UpdatePositionGraph {\n  constructor(options) {\n    this.readStoredPosition = new TexturePositionNode(/* isDecode = */ true);\n    this.udfVelocity = new UserDefinedVelocityFunction();\n    this.integratePositions = new RungeKuttaIntegrator();\n    this.dropParticles = new RandomParticleDropper();\n    this.writeComputedPosition = new TexturePositionNode(/* isDecode = */ false);\n    this.panZoomDecode = new PanzoomTransform({decode: true});\n    this.panZoomEncode = new PanzoomTransform({decode: false});\n\n    this.colorMode = options && options.colorMode;\n  }\n\n  setCustomVectorField(velocityCode) {\n    this.udfVelocity.setNewUpdateCode(velocityCode);\n  }\n\n  getVertexShader () {\n    return `precision highp float;\n\nattribute vec2 a_pos;\nvarying vec2 v_tex_pos;\nuniform vec2 u_min;\nuniform vec2 u_max;\n\nvoid main() {\n    v_tex_pos = a_pos;\n    gl_Position = vec4(1.0 - 2.0 * a_pos, 0, 1);\n}`\n  }\n\n  getFragmentShader() {\n    var nodes = [\n      this.readStoredPosition,\n      this.dropParticles,\n      this.udfVelocity,\n      this.integratePositions, {\n        getMainBody() {\n          return `\n  vec2 newPos = pos + velocity;\n  `\n        }\n      },\n      this.writeComputedPosition\n    ];\n    return renderNodes(nodes);\n  }\n}\n\nclass RandomParticleDropper extends BaseShaderNode {\n  getDefines() {\n    return `\nuniform float u_drop_rate;\nuniform float u_rand_seed;\nuniform vec2 u_min;\nuniform vec2 u_max;\n`\n  }\n\n  getFunctions() {\n    // TODO: Ideally this node should probably depend on\n    // random number generator node, so that we don't duplicate code\n    return `\n`\n  }\n\n  getMainBody() {\n    return `\n  // a random seed to use for the particle drop\n  vec2 seed = (pos + v_tex_pos) * u_rand_seed;\n  // drop rate is a chance a particle will restart at random position, to avoid degeneration\n  float drop = step(1.0 - u_drop_rate, rand(seed));\n\n  // TODO: This can be customized to produce various emitters\n  // random_pos is in range from 0..1, we move it to the bounding box:\n  vec2 random_pos = vec2(rand(seed + 1.9), rand(seed + 8.4)) * (u_max - u_min) + u_min;\n  pos = mix(pos, random_pos, drop);\n`;\n  }\n\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/field-play/shaderGraph/updatePositionGraph.js","/**\n * This file encodes/decodes float values into 32bit rgba array\n * \n * It is based on https://computergraphics.stackexchange.com/questions/4151/webgl-packing-unpacking-functions-that-can-roundtrip-all-typical-32-bit-floats\n * and it is not perfect. If you know how to improve it - please let me know.\n */\n\n/**\n * Encodes float value into output array\n * @param {float} val - value to be encode\n * @param {Uint8Array} out  - array where encoded value needs to be written.\n * @param {Number} writeOffset - offset in the original array where values should be written.\n */\nexport function encodeFloatRGBA(val, out, writeOffset) {\n  if (val == 0.0) {\n    out[writeOffset + 0] = 0; out[writeOffset + 1] = 0; out[writeOffset + 2] = 0; out[writeOffset + 3] = 0;\n    return;\n  }\n\n  var mag = Math.abs(val);\n  var exponent = Math.floor(Math.log2(mag));\n  // Correct log2 approximation errors.\n  exponent += (exp2(exponent) <= mag / 2.0) ? 1 : 0;\n  exponent -= (exp2(exponent) > mag) ? 1 : 0;\n\n  var mantissa;\n  if (exponent > 100.0) {\n      mantissa = mag / 1024.0 / exp2(exponent - 10.0) - 1.0;\n  } else {\n      mantissa = mag / (exp2(exponent)) - 1.0;\n  }\n\n  var a = exponent + 127.0;\n  mantissa *= 256.0;\n  var b = Math.floor(mantissa);\n  mantissa -= b;\n  mantissa *= 256.0;\n  var c = Math.floor(mantissa);\n  mantissa -= c;\n  mantissa *= 128.0;\n  var d = Math.floor(mantissa) * 2.0 + ((val < 0.0) ? 1: 0);\n\n  out[writeOffset + 0] = a; out[writeOffset + 1] = b; out[writeOffset + 2] = c; out[writeOffset + 3] = d;\n}\n\n/**\n * Given byte values in range [0..255] returns decoded float value.\n * \n * @param {Byte} r \n * @param {Byte} g \n * @param {Byte} b \n * @param {Byte} a \n */\nexport function decodeFloatRGBA(r, g, b, a) {\n  var A = Math.floor(r + 0.5);\n  var B = Math.floor(g + 0.5);\n  var C = Math.floor(b + 0.5);\n  var D = Math.floor(a + 0.5);\n\n  var exponent = A - 127.0;\n  var sign = 1.0 - (D % 2.0) * 2.0;\n  var mantissa = ((A > 0.0) ? 1 : 0)\n                  + B / 256.0\n                  + C / 65536.0\n                  + Math.floor(D / 2.0) / 8388608.0;\n  return sign * mantissa * exp2(exponent);\n}\n\nfunction exp2(exponent) { return Math.exp(exponent * Math.LN2); }\n\n\n// WEBPACK FOOTER //\n// ./src/lib/field-play/utils/floatPacking.js","/**\n * A simple interface to compute eventual min/max \n */\nexport default function makeStatCounter() {\n  var min, max;\n\n  var api = {\n    getMin() { return min; },\n    getMax() { return max; },\n    add(x) {\n      if (x < min) min = x;\n      if (x > max) max = x;\n    },\n    reset: reset\n  };\n\n  return api;\n\n  function reset() {\n    min = Number.POSITIVE_INFINITY;\n    max = Number.NEGATIVE_INFINITY;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/field-play/utils/makeStatCounter.js","import util from '../gl-utils';\nimport bus from '../bus';\nimport {decodeFloatRGBA} from '../utils/floatPacking';\nimport makeStatCounter from '../utils/makeStatCounter';\n\nconst OUT_V_X = 6;\nconst OUT_V_Y = 7;\n/**\n * This program allows to change color of each particle. It works by\n * reading current velocities into a texture from the framebuffer. Once\n * velocities are read, it checks velocity scale and passes it to a draw program.\n */\nexport default function colorProgram(ctx) {\n  var speedNeedsUpdate = true;\n  var {gl} = ctx;\n  var velocity_y_texture, velocity_x_texture;\n  var particleStateResolution;\n  var pendingSpeedUpdate;\n  var numParticles;\n  var velocityCounter = makeStatCounter();\n  var velocity_x;\n  var velocity_y;\n\n  listenToEvents();\n\n  return {\n    updateCode,\n    updateParticlesPositions,\n    updateParticlesCount,\n    setColorMinMax,\n    requestSpeedUpdate,\n    dispose\n  };\n\n  function listenToEvents() {\n    bus.on('integration-timestep-changed', requestSpeedUpdate);\n    bus.on('bbox-change', requestSpeedUpdate);\n    bus.on('refresh-speed', requestSpeedUpdate);\n  }\n\n  function dispose() {\n    bus.off('integration-timestep-changed', requestSpeedUpdate);\n    bus.off('bbox-change', requestSpeedUpdate);\n    bus.off('refresh-speed', requestSpeedUpdate);\n    disposeTextures();\n  }\n\n  function disposeTextures() {\n    if (velocity_x_texture) gl.deleteTexture(velocity_x_texture);\n    if (velocity_y_texture) gl.deleteTexture(velocity_y_texture);\n  }\n\n  function requestSpeedUpdate() {\n    if (pendingSpeedUpdate) clearTimeout(pendingSpeedUpdate);\n    pendingSpeedUpdate = setTimeout(() => {\n      speedNeedsUpdate = true;\n      pendingSpeedUpdate = 0;\n    }, 50);\n  }\n\n  function setColorMinMax(program) {\n    gl.uniform2f(program.u_velocity_range, velocityCounter.getMin(), velocityCounter.getMax());\n  }\n\n  function updateParticlesCount() {\n    disposeTextures();\n\n    particleStateResolution = ctx.particleStateResolution;\n    numParticles = particleStateResolution * particleStateResolution;\n\n    velocity_x = new Uint8Array(numParticles * 4);\n    velocity_y = new Uint8Array(numParticles * 4);\n    velocity_x_texture = util.createTexture(gl, gl.NEAREST, velocity_x, particleStateResolution, particleStateResolution);\n    velocity_y_texture = util.createTexture(gl, gl.NEAREST, velocity_y, particleStateResolution, particleStateResolution);\n\n    requestSpeedUpdate();\n  }\n\n  function updateCode() {\n    requestSpeedUpdate();\n  }\n\n  function updateParticlesPositions(program) {\n    if (!speedNeedsUpdate || !velocity_x || !velocity_y) return;\n    speedNeedsUpdate = false;\n\n    // We assume this is called from update position program\n    util.bindFramebuffer(gl, ctx.framebuffer, velocity_x_texture);\n    gl.uniform1i(program.u_out_coordinate, OUT_V_X);\n    gl.drawArrays(gl.TRIANGLES, 0, 6);\n    gl.readPixels(0, 0, particleStateResolution, particleStateResolution, gl.RGBA, gl.UNSIGNED_BYTE, velocity_x);\n\n    util.bindFramebuffer(gl, ctx.framebuffer, velocity_y_texture);\n    gl.uniform1i(program.u_out_coordinate, OUT_V_Y);\n    gl.drawArrays(gl.TRIANGLES, 0, 6);\n    gl.readPixels(0, 0, particleStateResolution, particleStateResolution, gl.RGBA, gl.UNSIGNED_BYTE, velocity_y);\n\n    updateMinMax();\n  }\n\n  function updateMinMax() {\n    velocityCounter.reset();\n    // TODO: Do I want this to be async?\n    for(var i = 0; i < velocity_y.length; i+=4) {\n      var vx = readFloat(velocity_x, i);\n      var vy = readFloat(velocity_y, i);\n      var v = Math.sqrt(vx * vx + vy * vy);\n      velocityCounter.add(v);\n    }\n  }\n}\n\nfunction readFloat(buffer, offset) {\n    return decodeFloatRGBA(\n      buffer[offset + 0],\n      buffer[offset + 1],\n      buffer[offset + 2],\n      buffer[offset + 3]\n    );\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/field-play/programs/colorProgram.js","/**\n * A wrapper over collection of textures. Can be used to represent\n * individual textures for every dimension.\n */\nimport glUtil from '../gl-utils';\n\nexport default function textureCollection(gl, dimensions, particleStateResolution) {\n  var textures = dimensions.map((d, index) => {\n    var textureInfo = {\n      texture: glUtil.createTexture(gl, gl.NEAREST, d.particleState, particleStateResolution, particleStateResolution),\n      index: index,\n      name: d.name\n    }\n\n    return textureInfo;\n  })\n\n  return {\n    dispose,\n    bindTextures,\n    assignProgramUniforms,\n    length: dimensions.length,\n    textures,\n    get(i) { return textures[i]; }\n  }\n\n  function assignProgramUniforms(program) {\n    textures.forEach(tInfo => {\n      gl.uniform1i(program['u_particles_' + tInfo.name], tInfo.index);\n    });\n  }\n\n  function dispose() {\n    textures.forEach(tInfo => gl.deleteTexture(tInfo.texture));\n  }\n\n  function bindTextures(gl, program) {\n    textures.forEach((tInfo) => {\n      glUtil.bindTexture(gl, tInfo.texture, tInfo.index);\n      gl.uniform1i(program['u_particles_' + tInfo.name], tInfo.index);\n    })\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/field-play/utils/textureCollection.js","import util from '../gl-utils';\nimport UpdatePositionGraph from '../shaderGraph/updatePositionGraph';\nimport ColorMode from './colorModes';\nimport makeReadProgram from './colorProgram';\nimport textureCollection from '../utils/textureCollection';\nimport makeStatCounter from '../utils/makeStatCounter';\nimport {decodeFloatRGBA} from '../utils/floatPacking';\nimport bus from '../bus';\n\nconst particlePositionShaderCodeBuilder = new UpdatePositionGraph();\n\nexport default function updatePositionProgram(ctx) {\n  var gl = ctx.gl;\n  var readTextures, writeTextures;\n  var particleStateResolution;\n  var updateProgram;\n  var readVelocity = makeReadProgram(ctx);\n\n  // If someone needs to get vectors out from the GPU, they send a `vector-lines-request`\n  // over the bus. This request is delayed until next compute frame. Once it is handled,\n  // we send them back response with calculated vectors.\n  var pendingVectorLines;\n\n  // TODO: need to make sure we are not leaking.\n  bus.on('vector-lines-request', putVectorLinesRequestIntoQueue);\n\n  return {\n    updateCode,\n    updateParticlesPositions,\n    updateParticlesCount,\n    prepareToDraw,\n    updateVariable\n  };\n\n  function updateCode(vectorField) {\n    particlePositionShaderCodeBuilder.setCustomVectorField(vectorField);\n    let fragment = particlePositionShaderCodeBuilder.getFragmentShader();\n    let vertex = particlePositionShaderCodeBuilder.getVertexShader();\n\n    let newProgram = util.createProgram(gl, vertex, fragment);\n\n    if (updateProgram) updateProgram.unload();\n    updateProgram = newProgram;\n\n    if (ctx.colorMode === ColorMode.VELOCITY) readVelocity.requestSpeedUpdate();\n  }\n\n  function updateVariable(varName, value) {\n    var uniformLocation = gl.getUniformLocation(updateProgram.program, `u_${varName}`);\n    gl.useProgram(updateProgram.program);\n    gl.uniform1f(uniformLocation, value);\n  }\n\n  function updateParticlesCount(x, y) {\n    particleStateResolution = ctx.particleStateResolution;\n\n    var dimensions = [{\n      name: 'x',\n      particleState: x\n    }, {\n      name: 'y',\n      particleState: y\n    }];\n\n    if (readTextures) readTextures.dispose();\n    readTextures = textureCollection(gl, dimensions, particleStateResolution);\n\n    if (writeTextures) writeTextures.dispose();\n    writeTextures = textureCollection(gl, dimensions, particleStateResolution);\n\n    readVelocity.updateParticlesCount();\n  }\n\n  function prepareToDraw(program) {\n    var colorMode = ctx.colorMode;\n    if (colorMode === ColorMode.VELOCITY) readVelocity.setColorMinMax(program);\n\n    readTextures.bindTextures(gl, program);\n  }\n\n  function updateParticlesPositions() {\n    var program = updateProgram;\n    gl.useProgram(program.program);\n  \n    util.bindAttribute(gl, ctx.quadBuffer, program.a_pos, 2);\n  \n    ctx.inputs.updateBindings(program);\n\n    // TODO: Remove this.\n    if (ctx.audioTexture) {\n      util.bindTexture(gl, ctx.audioTexture, 5);\n      gl.uniform1i(program['u_audio'], 5);\n    }\n\n    readTextures.bindTextures(gl, program);\n  \n    gl.uniform1f(program.u_rand_seed, ctx.frameSeed);\n    gl.uniform1f(program.u_h, ctx.integrationTimeStep);\n    gl.uniform1f(program.frame, ctx.frame);\n    var cursor = ctx.cursor;\n    gl.uniform4f(program.cursor, cursor.clickX, cursor.clickY, cursor.hoverX, cursor.hoverY);\n\n    var bbox = ctx.bbox;\n    gl.uniform2f(program.u_min, bbox.minX, bbox.minY);\n    gl.uniform2f(program.u_max, bbox.maxX, bbox.maxY);\n\n    gl.uniform1f(program.u_drop_rate, ctx.dropProbability);\n  \n    // Draw each coordinate individually\n    for(var i = 0; i < writeTextures.length; ++i) {\n      var writeInfo = writeTextures.get(i);\n      gl.uniform1i(program.u_out_coordinate, i);\n      util.bindFramebuffer(gl, ctx.framebuffer, writeInfo.texture);\n      gl.viewport(0, 0, particleStateResolution, particleStateResolution);\n      gl.drawArrays(gl.TRIANGLES, 0, 6);\n    }\n\n    // TODO: I think I need to keep this time-bound, i.e. allocate X ms to\n    // process particle positions, and move on. So that the rendering thread is not paused for too long\n    if (ctx.colorMode === ColorMode.VELOCITY) {\n      readVelocity.updateParticlesPositions(program);\n    }\n\n    if (pendingVectorLines) {\n      processVectorLinesRequest(program);\n      pendingVectorLines = null;\n    }\n\n    // swap the particle state textures so the new one becomes the current one\n    var temp = readTextures;\n    readTextures = writeTextures;\n    writeTextures = temp;\n  }\n\n  function putVectorLinesRequestIntoQueue(request) {\n    pendingVectorLines = request;\n  }\n\n  function processVectorLinesRequest(program) {\n    // TODO: Move this out\n    var dimensions = [{\n      name: 'x',\n      particleState: pendingVectorLines.x\n    }, {\n      name: 'y',\n      particleState: pendingVectorLines.y\n    }];\n\n    // We create temporary textures and load requested positions in there\n    var resolutionOfParticlesInRequest = pendingVectorLines.resolution;\n    var numParticles = resolutionOfParticlesInRequest * resolutionOfParticlesInRequest;\n\n    var texturesForRead = textureCollection(gl, dimensions, resolutionOfParticlesInRequest);\n    var texturesForWrite = textureCollection(gl, dimensions, resolutionOfParticlesInRequest);\n\n    texturesForRead.bindTextures(gl, program);\n\n    // Then we request coordinates out from GPU for each dimension\n    var writeInfo = texturesForWrite.get(0);\n    gl.uniform1i(program.u_out_coordinate, 6); // v_x\n\n    util.bindFramebuffer(gl, ctx.framebuffer, writeInfo.texture);\n    gl.viewport(0, 0, resolutionOfParticlesInRequest, resolutionOfParticlesInRequest);\n    gl.drawArrays(gl.TRIANGLES, 0, 6);\n\n    var velocity_x = new Uint8Array(numParticles * 4);\n    gl.readPixels(0, 0, resolutionOfParticlesInRequest, resolutionOfParticlesInRequest, gl.RGBA, gl.UNSIGNED_BYTE, velocity_x);\n\n    gl.uniform1i(program.u_out_coordinate, 7); // v_y\n    writeInfo = texturesForWrite.get(1);\n    util.bindFramebuffer(gl, ctx.framebuffer, writeInfo.texture);\n    gl.viewport(0, 0, resolutionOfParticlesInRequest, resolutionOfParticlesInRequest);\n    gl.drawArrays(gl.TRIANGLES, 0, 6);\n\n    var velocity_y = new Uint8Array(numParticles * 4);\n    gl.readPixels(0, 0, resolutionOfParticlesInRequest, resolutionOfParticlesInRequest, gl.RGBA, gl.UNSIGNED_BYTE, velocity_y);\n\n    texturesForWrite.dispose();\n    texturesForRead.dispose();\n\n    var xStats = makeStatCounter();\n    var yStats = makeStatCounter();\n\n    var decoded_velocity_x = new Float32Array(numParticles);\n    var decoded_velocity_y = new Float32Array(numParticles);\n    for(var i = 0; i < velocity_y.length; i+=4) {\n      var idx = i/4;\n      var vx = readFloat(velocity_x, i);\n      var vy = readFloat(velocity_y, i);\n      decoded_velocity_x[idx] = vx;\n      decoded_velocity_y[idx] = vy;\n      xStats.add(vx);\n      yStats.add(vy);\n    }\n\n    var vectorLineInfo = {\n      xStats,\n      yStats,\n      decoded_velocity_x,\n      decoded_velocity_y,\n      resolution: resolutionOfParticlesInRequest\n    };\n\n    bus.fire('vector-line-ready', vectorLineInfo);\n  }\n}\n\nfunction readFloat(buffer, offset) {\n    return decodeFloatRGBA(\n      buffer[offset + 0],\n      buffer[offset + 1],\n      buffer[offset + 2],\n      buffer[offset + 3]\n    );\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/field-play/programs/updatePositionProgram.js","import appState from './appState';\n\nconst defaultConfig = {\n  // I need to flash our more details before making any promises.\n  isAudioEnabled: false,\n  // this allows to render an overlay grid with vectors. Enable it\n  // and drag the scene a little bit.\n  vectorLinesEnabled: false,\n\n  // Starting from which texture unit we can bind custom inputs?\n  FREE_TEXTURE_UNIT: 4,\n\n  // whether input bindings should be visible\n  showBindings: appState.getQS().get('showBindings') || false\n}\n\nexport default defaultConfig;\n\n\n// WEBPACK FOOTER //\n// ./src/lib/field-play/config.js","import bus from '../bus';\nimport glUtil from '../gl-utils';\n\nexport default audioProgram;\n\nfunction audioProgram(ctx) {\n  var gl = ctx.gl;\n\n  var audioWidth = 8, audioHeight = 8;\n  var audioBuffer = new Uint8Array(audioWidth * audioHeight * 4);\n  var audioTexture = glUtil.createTexture(gl, gl.NEAREST, audioBuffer, audioWidth, audioHeight);\n  var audioDirty = false;\n  ctx.audioTexture = audioTexture;\n\n  bus.on('audio', updateAudioBuffer);\n\n  return {\n    updateTextures,\n    dispose\n  };\n\n  function dispose() {\n    bus.off('audio', updateAudioBuffer);\n    gl.deleteTexture(audioTexture);\n  }\n\n  function updateTextures() {\n    if (!audioDirty) return;\n    audioDirty = false;\n\n    // TODO: This should come from fftSize?\n    var width = 5, height = 5;\n    gl.bindTexture(gl.TEXTURE_2D, audioTexture);\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, width, height, 0, gl.RGBA, gl.UNSIGNED_BYTE, audioBuffer);\n    gl.bindTexture(gl.TEXTURE_2D, null);\n  }\n\n  function updateAudioBuffer(newBuffer) {\n    audioBuffer = newBuffer;\n    audioDirty = true;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/field-play/programs/audioProgram.js","import util from '../gl-utils';\nimport DrawParticleGraph from '../shaderGraph/DrawParticleGraph';\nimport makeUpdatePositionProgram from './updatePositionProgram';\nimport { encodeFloatRGBA } from '../utils/floatPacking.js';\nimport config from '../config';\nimport createAudioProgram from './audioProgram';\n\n/**\n * This program manages particles life-cycle. It updates particles positions\n * and initiates drawing them on screen.\n * \n * @param {Object} ctx rendering context. Holds WebGL state\n */\nexport default function drawParticlesProgram(ctx) {\n  var gl = ctx.gl;\n\n  var particleStateResolution, particleIndexBuffer;\n  var numParticles;\n\n  var currentVectorField = '';\n  var updatePositionProgram = makeUpdatePositionProgram(ctx);\n  var audioProgram;\n\n  var drawProgram;\n  initPrograms();\n\n  return {\n    updateParticlesCount,\n    updateParticlesPositions,\n    drawParticles,\n    updateCode,\n    updateColorMode,\n    updateVariable,\n    updateColorVariable\n  }\n\n  function initPrograms() {\n    // need to update the draw graph because color mode shader has changed.\n    initDrawProgram();\n\n    if (config.isAudioEnabled) {\n      if (audioProgram) audioProgram.dispose();\n      audioProgram = createAudioProgram(ctx);\n    }\n  }\n\n  function initDrawProgram() {\n    if (drawProgram) drawProgram.unload();\n\n    const drawGraph = new DrawParticleGraph(ctx);\n    const vertexShaderCode = drawGraph.getVertexShader(currentVectorField);\n    drawProgram = util.createProgram(gl, vertexShaderCode, drawGraph.getFragmentShader());\n  }\n\n  function updateParticlesPositions() {\n    if (!currentVectorField) return;\n\n    ctx.frame += 1\n    ctx.frameSeed = Math.random();\n\n    // TODO: Remove this.\n    if (audioProgram) audioProgram.updateTextures();\n\n    updatePositionProgram.updateParticlesPositions();\n  }\n\n  function updateColorMode() {\n    initDrawProgram();\n  }\n\n  function updateCode(vfCode) {\n    ctx.frame = 0;\n    currentVectorField = vfCode;\n    updatePositionProgram.updateCode(vfCode);\n    \n    initDrawProgram();\n  }\n\n  function updateVariableForDrawProgram(varName, value) {\n    var uniformLocation = gl.getUniformLocation(drawProgram.program, `u_${varName}`);\n    gl.useProgram(drawProgram.program);\n    gl.uniform1f(uniformLocation, value);\n  }\n\n  function updateVariable(varName, value) {\n    updatePositionProgram.updateVariable(varName, value);\n    updateVariableForDrawProgram(varName, value);\n  }\n\n  function updateColorVariable(value) {\n    updateVariableForDrawProgram('k', value);\n  }\n\n  function updateParticlesCount() {\n    particleStateResolution = ctx.particleStateResolution;\n    numParticles = particleStateResolution * particleStateResolution;\n    var particleIndices = new Float32Array(numParticles);\n    var particleStateX = new Uint8Array(numParticles * 4);\n    var particleStateY = new Uint8Array(numParticles * 4);\n\n    var minX = ctx.bbox.minX; var minY = ctx.bbox.minY;\n    var width = ctx.bbox.maxX - minX;\n    var height = ctx.bbox.maxY - minY;\n    for (var i = 0; i < numParticles; i++) {\n      encodeFloatRGBA((Math.random()) * width + minX, particleStateX, i * 4); // randomize the initial particle positions\n      encodeFloatRGBA((Math.random()) * height + minY, particleStateY, i * 4); // randomize the initial particle positions\n\n      particleIndices[i] = i;\n    }\n\n    if (particleIndexBuffer) gl.deleteBuffer(particleIndexBuffer);\n    particleIndexBuffer = util.createBuffer(gl, particleIndices);\n\n    updatePositionProgram.updateParticlesCount(particleStateX, particleStateY);\n  }\n\n  function drawParticles() {\n    if (!currentVectorField) return;\n\n    var program = drawProgram;\n    gl.useProgram(program.program);\n  \n    util.bindAttribute(gl, particleIndexBuffer, program.a_index, 1);\n    \n    updatePositionProgram.prepareToDraw(program);\n    ctx.inputs.updateBindings(program);\n  \n    gl.uniform1f(program.u_h, ctx.integrationTimeStep);\n    gl.uniform1f(program.frame, ctx.frame);\n    gl.uniform1f(program.u_particles_res, particleStateResolution);\n    var bbox = ctx.bbox;\n    gl.uniform2f(program.u_min, bbox.minX, bbox.minY);\n    gl.uniform2f(program.u_max, bbox.maxX, bbox.maxY);\n  \n    var cursor = ctx.cursor;\n    gl.uniform4f(program.cursor, cursor.clickX, cursor.clickY, cursor.hoverX, cursor.hoverY);\n    gl.drawArrays(gl.POINTS, 0, numParticles); \n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/field-play/programs/drawParticlesProgram.js","/**\n * XMLHttpRequest wrapped into a promise.\n * \n * @param {String} url \n */\nexport default function request(url, options) {\n  if (!options) options = {};\n\n  return new Promise(download);\n\n  function download(resolve, reject) {\n    var req = new XMLHttpRequest();\n\n    if (typeof options.progress === 'function') {\n      req.addEventListener('progress', updateProgress, false);\n    }\n\n    req.addEventListener('load', transferComplete, false);\n    req.addEventListener('error', transferFailed, false);\n    req.addEventListener('abort', transferCanceled, false);\n\n    req.open('GET', url);\n    if (options.responseType) {\n      req.responseType = options.responseType;\n    }\n    req.send(null);\n\n    function updateProgress(e) {\n      if (e.lengthComputable) {\n        options.progress({\n          loaded: e.loaded,\n          total: e.total,\n          percent: e.loaded / e.total\n        });\n      }\n    }\n\n    function transferComplete() {\n      if (req.status !== 200) {\n        reject(`Unexpected status code ${req.status} when calling ${url}`);\n        return;\n      }\n      var response = req.response;\n\n      if (options.responseType === 'json' && typeof response === 'string') {\n        // IE\n        response = JSON.parse(response);\n      }\n\n      resolve(response);\n    }\n\n    function transferFailed() {\n      reject(`Failed to download ${url}`);\n    }\n\n    function transferCanceled() {\n      reject(`Cancelled download of ${url}`);\n    }\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/field-play/utils/request.js","var loadedLinks = new Map(); // from link to response\nimport request from '../utils/request';\n\nexport default function fetchGLSL(link) {\n  if (!link) return Promise.reject('Missing link')\n  var trimmed = link.trim();\n  if (!trimmed) return Promise.reject('Missing link');\n\n  let cachedResponse = loadedLinks.get(trimmed)\n  if (cachedResponse) return Promise.resolve(cachedResponse);\n\n  return request(link).then(code => {\n    loadedLinks.set(link, code);\n    return code;\n  });\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/field-play/editor/fetchGLSL.js","import fetchGLSL from './fetchGLSL.js';\n\nvar pragmaInclude = '#include ';\nvar nullCode = { code: '' }\n\n/**\n * Naively parses glsl code and tries to replace all `#pragma` statements\n * with empty string. Gives structured collection of pragma statements back\n * \n * @param {String} code \n */\nexport default function makePragmaParser(code) {\n  if (!code) return new Promise(resolve => resolve(nullCode));\n\n  var parsedLines = processLineByLine(code);\n  if (parsedLines.pending.length > 0) {\n    return Promise.all(parsedLines.pending).then(() => parsedLines)\n      .catch(error => { return {error: {error}}; });\n  }\n\n  return new Promise(resolve => resolve(parsedLines));\n}\n\nfunction processLineByLine(code) {\n  var pending = []\n  var lines = code.split('\\n');\n  var outputLines = [];\n  var currentIndex = 0;\n  lines.forEach((line, index) => {\n    currentIndex = index;\n    if (line && line[0] === '#') {\n      outputLines.push('');\n      processPragma(line);\n    } else {\n      outputLines.push(line);\n    }\n  });\n\n  return {\n    getCode,\n    pending\n  };\n\n  function getCode() {\n    return outputLines.join('\\n');\n  }\n\n  function processPragma(line) {\n    if (line.indexOf(pragmaInclude) === 0) {\n      var include = line.substr(pragmaInclude.length);\n      var insertIndex = currentIndex;\n      pending.push(fetchGLSL(include).then(code => {\n        outputLines[insertIndex] = code\n      }))\n    }\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/field-play/editor/pragmaParser.js","/**\n * This module parses user defined vector field code.\n */\n\nimport bus from '../bus';\nimport pragmaParse from './pragmaParser';\n\n// This is naive parser that is being used until the real `glsl-parser`\n// is loaded asynchronously. This parser assumes there are no errors\n// TODO: maybe I should be more careful here?\nvar glslParser = {\n  check(code) {\n    return {\n      code,\n      log: {\n        errorCount: 0\n      }\n    };\n  }\n};\n\n// glsl-parser is ~179KB uncompressed, we don't want to wait until it is downloaded.\n// So we load it asynchronously...\nrequire.ensure('glsl-parser', () => {\n  // ... and replace the naive parser with the real one, when ready.\n  glslParser = require('glsl-parser');\n\n  // notify interested parties, so that they can recheck code if they wish.\n  bus.fire('glsl-parser-ready'); \n});\n\nvar vectorFieldGlobals = `\nimport {\n  float PI;\n  float snoise(vec2 v);\n  float frame;\n  vec4 cursor;\n  vec2 rotate(vec2 p,float a);\n  float audio(float index);\n  float rand(const vec2 co);\n  sampler2D input0;\n  sampler2D input1;\n}`;\n\n/**\n * Given a string, verifies that it is a valid glsl code for a vector field,\n * and then returns code + log.\n * \n * @param {String} vectorFieldCode \n */\nexport default function getParsedVectorFieldFunction(vectorFieldCode) {\n  // TODO: what if we want to support 3d?\n  return pragmaParse(vectorFieldCode).then(pragmaParseResult => {\n    if (pragmaParseResult.error) {\n      return pragmaParseResult;\n    }\n\n    vectorFieldCode = pragmaParseResult.getCode();\n\n    var parserResult = glslParser.check(vectorFieldCode, { globals: vectorFieldGlobals });\n    parserResult.code = vectorFieldCode;\n\n    if (parserResult.log.errorCount) parserResult.error = parserError(parserResult.log);\n\n    return parserResult;\n  });\n}\n\nfunction parserError(log) {\n  let diag = log.diagnostics[0];\n  // TODO probably need to check kind (errors are 0, warnings are 1)\n  let firstError = diag.range;\n  let lineColumn = firstError.lineColumn();\n  let source = firstError.source;\n  let offset = source._lineOffsets[lineColumn.line]\n  let line = source.contents.substr(offset,  lineColumn.column);\n  line += source.contents.substring(firstError.start, firstError.end);\n  let prefix = 'Line ' + lineColumn.line + ': ';\n  let diagText = diag.text;\n  return {\n    error: \n      prefix + line + '\\n' +\n      whitespace(prefix.length) + whitespace(lineColumn.column) + '^',\n    errorDetail: diagText,\n    isFloatError: isFloatError(diagText)\n  };\n}\n\nfunction isFloatError(diagText) {\n  return diagText.indexOf('\"int\"') > -1 &&\n    diagText.indexOf('\"float\"')  > -1;\n}\n\nfunction whitespace(length) {\n  return new Array(length + 1).join(' ');\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/field-play/editor/getParsedVectorFieldFunction.js","import bus from '../bus';\nimport appState from '../appState';\nimport getParsedVectorFieldFunction from './getParsedVectorFieldFunction';\n\n/**\n * A text editor state for the vector field equation. Manages vector field\n * program compilation and error reporting state.\n *\n * @param {Object} drawProgram \n */\nexport default function createVectorFieldEditorState(drawProgram) {\n  bus.on('glsl-parser-ready', parseCode);\n  var currentVectorFieldVersion = 0;\n\n  // What is the current code?\n  var currentVectorFieldCode = appState.getCode();\n\n  // For delayed parsing result verification (e.g. when vue is loaded it\n  // can request us to see if there were any errors)\n  var parserResult;\n\n  loadCodeFromAppState();\n\n  var api = {\n    getCode,\n    setCode,\n    dispose,\n    updateVariable,\n\n    // These properties are for UI only\n    code: currentVectorFieldCode,\n    error: '',\n    errorDetail: '',\n    isFloatError: false \n  };\n\n  return api;\n\n  function dispose() {\n    bus.off('glsl-parser-ready', parseCode);\n  }\n\n  function getCode() {\n    return appState.getCode();\n  }\n\n  function setCode(vectorFieldCode) {\n    if (vectorFieldCode === currentVectorFieldCode) {\n      // If field hasn't changed, let's make sure that there was no previous\n      // error\n      if (parserResult && parserResult.error) {\n        // And if there was error, let's revalidate code:\n        parseCode();\n      }\n      return;\n    } \n\n    trySetNewCode(vectorFieldCode).then((result) => {\n      if (result.cancelled) return;\n\n      if (result && result.error) {\n        updateErrorInfo(result.error);\n        return result;\n      }\n\n      currentVectorFieldCode = vectorFieldCode;\n      api.code = vectorFieldCode;\n      appState.saveCode(vectorFieldCode);\n    });\n  }\n\n  function updateErrorInfo(parserResult) {\n    if (parserResult && parserResult.error) {\n      api.error = parserResult.error;\n      api.errorDetail = parserResult.errorDetail;\n      api.isFloatError = parserResult.isFloatError;\n    } else {\n      api.error = '';\n      api.errorDetail = '';\n      api.isFloatError = false;\n    }\n  }\n\n  function loadCodeFromAppState() {\n    let persistedCode = appState.getCode();\n    if (persistedCode) {\n      trySetNewCode(persistedCode).then(result => {\n        if (!result.error) return; // This means we set correctly;\n        // If we get here - something went wrong. see the console\n        console.error('Failed to restore previous vector field: ', result.error);\n        // Let's use default vector field\n        trySetNewCode(appState.getDefaultCode());\n      });\n    } else {\n      // we want a default vector field\n      trySetNewCode(appState.getDefaultCode());\n    }\n  }\n\n  function parseCode(customCode) {\n    return getParsedVectorFieldFunction(customCode || currentVectorFieldCode)\n      .then(currentResult => {\n        parserResult = currentResult\n        updateErrorInfo(parserResult.error);\n        return parserResult;\n      });\n  }\n\n  function trySetNewCode(vectorFieldCode) {\n    currentVectorFieldVersion += 1;\n    var capturedVersion = currentVectorFieldVersion;\n    // step 1 - run through parser\n    return parseCode(vectorFieldCode).then(parserResult => {\n      if (capturedVersion !== currentVectorFieldVersion) {\n        parserResult.cancelled = true;\n        // a newer request was issued. Ignore these results.\n        return parserResult;\n      }\n\n      if (parserResult.error) {\n        return parserResult;\n      }\n      // step 2 - run through real webgl\n      try {\n        drawProgram.updateCode(parserResult.code);\n        return parserResult;\n      } catch (e) {\n        return {\n          error: {\n            error: e.message\n          }\n        }\n      }\n    });\n  }\n\n  function updateVariable(varName, value) {\n    drawProgram.updateVariable(varName, value);\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/field-play/editor/vectorFieldState.js","/**\n * Collection of input bindings. Individual program works with this collection\n * to command it update texture bindings.\n */\nexport default function createInputCollection() {\n  var boundInputs = new Map() \n  var currentProgram;\n  return {\n    updateBindings,\n    bindInput,\n  }\n\n  function bindInput(inputIndex, inputBinding) {\n    var prevBinding = boundInputs.get(inputIndex);\n    if (prevBinding) {\n      prevBinding.dispose();\n    }\n    boundInputs.set(inputIndex, inputBinding);\n  }\n\n  function updateBindings(program) {\n    currentProgram = program;\n    boundInputs.forEach(updateInputBinding);\n  }\n\n  function updateInputBinding(input, inputIndex) {\n    input.updateBinding(currentProgram, inputIndex);\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/field-play/programs/inputs/inputCollection.js","// https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/Tutorial/Using_textures_in_WebGL\nexport default function loadTexture(gl, url) {\n  var resolveTexture, rejectTexture;\n\n  var image = new Image();\n  image.crossOrigin = '';\n\n  image.onload = bindTexture;\n  image.onerror = reportError;\n  image.src = url;\n\n  return new Promise((resolve, reject) => {\n    resolveTexture = resolve;\n    rejectTexture = reject;\n  });\n\n  function reportError(err) {\n    rejectTexture(err);\n  }\n\n  function bindTexture() {\n    var texture = gl.createTexture();\n    var level = 0;\n    var internalFormat = gl.RGBA;\n    var srcFormat = gl.RGBA;\n    var srcType = gl.UNSIGNED_BYTE;\n    gl.bindTexture(gl.TEXTURE_2D, texture);\n    gl.texImage2D(gl.TEXTURE_2D, level, internalFormat,\n                  srcFormat, srcType, image);\n\n    if (isPowerOf2(image.width) && isPowerOf2(image.height)) {\n       gl.generateMipmap(gl.TEXTURE_2D);\n    } else {\n       gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n       gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n       gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n    }\n\n    resolveTexture(texture);\n  }\n}\n\nfunction isPowerOf2(value) {\n  return (value & (value - 1)) == 0;\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/field-play/programs/inputs/loadTexture.js","/**\n * Creates a single image binding element in the input collection.\n */\nimport loadTexture from \"./loadTexture\";\nimport glUtils from '../../gl-utils';\nimport config from '../../config';\nimport bus from '../../bus';\n\nconst FREE_TEXTURE_UNIT = config.FREE_TEXTURE_UNIT;\n\nexport default function createImageInputBinding(ctx, url, callbacks) {\n  var texture = null;\n  loadTexture(ctx.gl, url).then(setTexture).catch(handleError);\n\n  return {\n    updateBinding,\n    dispose() {\n      // TODO: Potential race condition, as loadTexture is async.\n      ctx.gl.deleteTexture(texture);\n    }\n  }\n\n  function handleError(err) {\n    if (callbacks && callbacks.error) {\n      callbacks.error(err);\n    }\n  }\n\n  function setTexture(loadedTexture) {\n    texture = loadedTexture;\n    bus.fire('refresh-speed')\n    if (callbacks && callbacks.done) {\n      callbacks.done(url);\n    }\n  }\n\n  function updateBinding(program, inputIndex) {\n    if (!texture) return;\n\n    var realIndex = inputIndex + FREE_TEXTURE_UNIT;\n    glUtils.bindTexture(ctx.gl, texture, realIndex);\n    ctx.gl.uniform1i(program[`input${inputIndex}`], realIndex);\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/field-play/programs/inputs/imageInput.js","import createInputCollection from './programs/inputs/inputCollection';\nimport createVideoInput from './programs/inputs/videoInput';\nimport createImageInputBinding from './programs/inputs/imageInput';\nimport appState from './appState.js';\n\n// Allows to bind media elements to vector field\nexport default function createInputsModel(ctx) {\n  ctx.inputs = createInputCollection();\n  var inputs = [];\n  readInputsFromAppState();\n\n  var api = {\n    getInputs,\n    addInput,\n  };\n\n  return api;\n\n  function getInputs() {\n    return inputs;\n  }\n\n  function addInput(inputNumber) {\n    var vm = createInputElementViewModel(ctx, inputNumber);\n    inputs.push(vm);\n    return vm;\n  }\n\n  function readInputsFromAppState() {\n    var i0 = appState.getQS().get('i0');\n    if (i0) {\n      var vm = addInput(0);\n      vm.link = i0;\n      vm.updateBinding(/* immediate = */ true);\n    }\n  }\n}\n\nfunction createInputElementViewModel(ctx, inputNumber) {\n  var pendingUpdate = null;\n\n  var input = {\n    link: '',\n    error: null,\n    name: `input${inputNumber}`,\n    updateBinding\n  }\n\n  return input;\n\n  function updateBinding(immediate) {\n    if (pendingUpdate) {\n      clearTimeout(pendingUpdate);\n      pendingUpdate = null;\n    }\n\n    if (immediate) {\n      setBinding();\n    } else {\n      pendingUpdate = setTimeout(setBinding, 300);\n    }\n  }\n\n  function setBinding() {\n    input.error = null;\n    pendingUpdate = null;\n    var binding = createImageInputBinding(ctx, input.link, {\n      done() {\n        // TODO: Preview\n        appState.getQS().set(`i${inputNumber}`, input.link);\n      },\n      error(err) {\n        // TODO: Better Error checking\n        input.error = err;\n      }\n    });\n    ctx.inputs.bindInput(0, binding);\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/field-play/createInputsModel.js","/**\n * This file is based on https://github.com/mapbox/webgl-wind\n * by Vladimir Agafonkin\n *\n * Released under ISC License, Copyright (c) 2016, Mapbox\n * https://github.com/mapbox/webgl-wind/blob/master/LICENSE\n *\n * Adapted to field maps by Andrei Kashcha\n * Copyright (C) 2017\n */\nimport util from './gl-utils';\nimport bus from './bus';\nimport appState from './appState';\n\nimport createScreenProgram from './programs/screenProgram';\nimport createDrawParticlesProgram from './programs/drawParticlesProgram';\nimport createVectorFieldEditorState from './editor/vectorFieldState';\nimport createInputsModel from './createInputsModel';\n\nconst INITIAL_SPEED = 1;\n\nfunction integrationTimeStepFromSpeed(speed) {\n  return speed * 0.004;\n}\n\nfunction fadeOutFromSpeed(speed) {\n  return 1 - speed * 0.002;\n}\n\n/**\n * Kicks offs the app rendering. Initialized before even vue is loaded.\n *\n * @param {WebGLRenderingContext} gl\n */\nexport default function initScene(gl) {\n  // Canvas size management\n  var canvasRect = { width: 0, height: 0, top: 0, left: 0 };\n  setWidthHeight(window.innerWidth, window.innerHeight);\n  window.addEventListener('resize', onResize, true);\n\n  // TODO: It feels like bounding box management needs to be moved out from here.\n  // TODO: bbox needs to be a class with width/height properties.\n  var bbox = appState.getBBox() || {};\n  var currentPanZoomTransform = {\n    scale: 0.1,\n    x: window.innerWidth / 2,\n    y: window.innerHeight / 2\n  };\n\n  // How many particles do we want?\n  var particleCount = appState.getParticleCount();\n\n  gl.disable(gl.DEPTH_TEST);\n  gl.disable(gl.STENCIL_TEST);\n\n  // Context variable is a way to share rendering state between multiple programs. It has a lot of stuff on it.\n  // I found that it's the easiest way to work in state-full world of WebGL.\n  // Until I discover a better way to write WebGL code.\n  var ctx = {\n    gl,\n    bbox,\n    canvasRect,\n\n    inputs: null,\n\n    framebuffer: gl.createFramebuffer(),\n\n    // This is used only to render full-screen rectangle. Main magic happens inside textures.\n    quadBuffer: util.createBuffer(gl, new Float32Array([0, 0, 1, 0, 0, 1, 0, 1, 1, 0, 1, 1])),\n\n    colorMode: appState.getColorMode(),\n    colorFunction: appState.getColorFunction(),\n\n    // This defines texture unit for screen rendering. First few indices are taken by textures\n    // that compute particles position/color\n    // TODO: I need to find a better way to manage this.\n    screenTextureUnit: 3,\n\n    speed: INITIAL_SPEED,\n    integrationTimeStep: integrationTimeStepFromSpeed(INITIAL_SPEED),\n\n    // On each frame the likelihood for a particle to reset its position is this:\n    dropProbability: appState.getDropProbability(),\n\n    // current frame number. Reset every time when new shader is compiled\n    frame: 0,\n\n    // TOREMOVE\n    // Information about mouse cursor. Could be useful to simplify\n    // exploration\n    cursor: {\n      // Where mouse was last time clicked (or tapped)\n      clickX: 0, clickY: 0,\n      // where mouse was last time moved. If this is a touch device\n      // this is the same as clickX, clickY\n      hoverX: 0, hoverY: 0\n    },\n\n    // Texture size to store particles' positions\n    particleStateResolution: 0,\n\n    // How quickly we should fade previous frame (from 0..1)\n    fadeOpacity: fadeOutFromSpeed(INITIAL_SPEED),\n\n    backgroundColor: { r: 0, g: 0, b: 0, a: 1 },\n\n    // Ignore this one for a moment. Yes, the app support web audio API,\n    // but it's rudimentary, so... shhh! it's a secret.\n    // Don't shhh on me!\n    audioTexture: null\n  };\n\n  // Frame management\n  var lastAnimationFrame;\n  var lastAnimationFrameTime;\n  var isPaused = false;\n\n  var inputsModel = createInputsModel(ctx);\n\n  // screen rendering;\n  var screenProgram = createScreenProgram(ctx);\n  var drawProgram = createDrawParticlesProgram(ctx);\n  // var cursorUpdater = createCursorUpdater(ctx);\n  var vectorFieldEditorState = createVectorFieldEditorState(drawProgram);\n\n  // particles\n  updateParticlesCount(particleCount);\n\n  var api = {\n    start: nextFrame,\n    stop,\n    dispose,\n\n    setPaused,\n\n    getParticlesCount,\n    setParticlesCount,\n\n    setFadeOutSpeed,\n    getFadeOutSpeed,\n\n    setDropProbability,\n    getDropProbability,\n\n    getSpeed,\n    setSpeed,\n\n    setColorMode,\n    getColorMode,\n\n    setColorFunction,\n    getColorFunction,\n\n    vectorFieldEditorState,\n    updateColorVariable,\n\n    inputsModel,\n\n    setBackgroundColor,\n\n    getCanvasRect() {\n      // We trust they don't do anything bad with this ...\n      return canvasRect;\n    },\n\n    getBoundingBox() {\n      // again, we trust. Maybe to much?\n      return ctx.bbox;\n    }\n  }\n\n  restoreBBox();\n\n  setTimeout(() => {\n    bus.fire('scene-ready', api);\n  })\n\n  return api;\n\n  function assignIfPossible(change, key, newBoundingBox) {\n    var value = Number.parseFloat(change[key]);\n    if (Number.isFinite(value)) {\n      newBoundingBox[key] = value;\n    }\n  }\n\n\n  function setColorMode(x) {\n    var mode = parseInt(x, 10);\n    ctx.colorMode = mode;\n    drawProgram.updateColorMode(mode);\n  }\n\n  function getColorMode() {\n    return ctx.colorMode;\n  }\n\n  function setColorFunction(code) {\n    ctx.colorFunction = code;\n    drawProgram.updateColorMode(ctx.colorMode);\n  }\n\n  function updateColorVariable(value) {\n    drawProgram.updateColorVariable(value);\n  }\n\n  function getColorFunction() {\n    return ctx.colorFunction;\n  }\n\n  function getSpeed() {\n    return ctx.speed;\n  }\n\n  function setSpeed(x) {\n    var f = parseFloat(x);\n    if (Number.isFinite(f)) {\n      ctx.speed = f;\n      ctx.integrationTimeStep = integrationTimeStepFromSpeed(speed);\n      ctx.fadeOpacity = fadeOutFromSpeed(speed);\n      bus.fire('integration-timestep-changed', ctx.integrationTimeStep);\n    }\n  }\n\n  function setPaused(shouldPause) {\n    isPaused = shouldPause;\n    nextFrame();\n  }\n\n  // Main screen fade out configuration\n  function setFadeOutSpeed(x) {\n    var f = parseFloat(x);\n    if (Number.isFinite(f)) {\n      ctx.fadeOpacity = f;\n      appState.setFadeout(f);\n    }\n  }\n\n  function getFadeOutSpeed() {\n    return appState.getFadeout();\n  }\n\n  // Number of particles configuration\n  function getParticlesCount() {\n    return appState.getParticleCount();\n  }\n\n  function setParticlesCount(newParticleCount) {\n    if (!Number.isFinite(newParticleCount)) return;\n    if (newParticleCount === particleCount) return;\n    if (newParticleCount < 1) return;\n\n    updateParticlesCount(newParticleCount);\n\n    particleCount = newParticleCount;\n    appState.setParticleCount(newParticleCount);\n  }\n\n  // drop probability\n  function setDropProbability(x) {\n    var f = parseFloat(x);\n    if (Number.isFinite(f)) {\n      // TODO: Do I need to worry about duplication/clamping?\n      appState.setDropProbability(f);\n      ctx.dropProbability = f;\n    }\n  }\n\n  function getDropProbability() {\n    return appState.getDropProbability();\n  }\n\n  function onResize() {\n    setWidthHeight(window.innerWidth, window.innerHeight);\n\n    screenProgram.updateScreenTextures();\n\n    updateBoundingBox();\n  }\n\n  function setWidthHeight(w, h) {\n    var dx = Math.max(w * 0.02, 30);\n    var dy = Math.max(h * 0.02, 30);\n    let x = w + 2 * dx;\n    let y = h + 2 * dy;\n    canvasRect.width = window.devicePixelRatio * x;\n    canvasRect.height = window.devicePixelRatio * y;\n    canvasRect.top = - dy;\n    canvasRect.left = - dx;\n\n\n    let canvas = gl.canvas;\n    canvas.style.width = x + 'px';\n    canvas.style.height = y + 'px';\n    canvas.style.left = (-dx) + 'px';\n    canvas.style.top = (-dy) + 'px';\n    canvas.width = canvasRect.width;\n    canvas.height = canvasRect.height;\n  }\n\n  function dispose() {\n    stop();\n    window.removeEventListener('resize', onResize, true);\n    vectorFieldEditorState.dispose();\n  }\n\n  function nextFrame() {\n    if (lastAnimationFrame) return;\n\n    if (isPaused) return;\n\n    lastAnimationFrame = requestAnimationFrame(draw);\n    lastAnimationFrameTime = Date.now();\n  }\n\n  function stop() {\n    cancelAnimationFrame(lastAnimationFrame);\n    lastAnimationFrame = 0;\n    lastAnimationFrameTime = undefined;\n  }\n\n  function draw() {\n    lastAnimationFrame = 0;\n\n    // Adjust integration time step if we missed frames\n    if (lastAnimationFrameTime) {\n      let timeSinceLastFrame = Date.now() - lastAnimationFrameTime;\n      let performanceRatio = (1000 / 30) / timeSinceLastFrame;\n      let correctedSpeed = ctx.speed / Math.min(performanceRatio, 1);\n      ctx.integrationTimeStep = integrationTimeStepFromSpeed(correctedSpeed);\n      ctx.fadeOpacity = fadeOutFromSpeed(correctedSpeed);\n      // bus.fire('integration-timestep-changed', ctx.integrationTimeStep);\n    }\n    drawScreen();\n\n    nextFrame();\n  }\n\n  function drawScreen() {\n    screenProgram.fadeOutLastFrame()\n    drawProgram.drawParticles();\n    screenProgram.renderCurrentScreen();\n    drawProgram.updateParticlesPositions();\n  }\n\n  function updateParticlesCount(numParticles) {\n    // we create a square texture where each pixel will hold a particle position encoded as RGBA\n    ctx.particleStateResolution = Math.ceil(Math.sqrt(numParticles));\n    drawProgram.updateParticlesCount();\n  }\n\n  function restoreBBox() {\n    var {width, height} = canvasRect;\n\n    let sX = Math.PI * Math.E;\n    let sY = Math.PI * Math.E;\n    let tX = 0;\n    let tY = 0;\n\n    var w2 = sX * width / 2;\n    var h2 = sY * width / 2;\n    updateBoundingBox();\n  }\n\n  function updateBoundingBox() {\n    screenProgram.boundingBoxUpdated = true;\n\n    currentPanZoomTransform = {\n      scale: 0.1,\n      x: window.innerWidth / 2,\n      y: window.innerHeight / 2\n    };\n\n    var {width, height} = canvasRect;\n    width /= window.devicePixelRatio;\n    height /= window.devicePixelRatio;\n\n    var minX = clientX(0);\n    var minY = clientY(0);\n    var maxX = clientX(width);\n    var maxY = clientY(height);\n\n    // we divide by width to keep aspect ratio\n    // var ar = width/height;\n    var p = 10000;\n    bbox.minX = Math.round(p * minX/width)/p;\n    bbox.minY = Math.round(p * -minY/width)/p;\n    bbox.maxX = Math.round(p * maxX/width)/p;\n    bbox.maxY = Math.round(p * -maxY/ width)/p;\n\n    bus.fire('bbox-change', bbox);\n\n    function clientX(x) {\n      return (x - currentPanZoomTransform.x)/currentPanZoomTransform.scale;\n    }\n\n    function clientY(y) {\n      return (y - currentPanZoomTransform.y)/currentPanZoomTransform.scale;\n    }\n  }\n\n  // backgroundColor should be an object with r, g, b, a properties (range: 0-1)\n  function setBackgroundColor(backgroundColor) {\n    ctx.backgroundColor = backgroundColor; \n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/field-play/scene.js","\nimport _ from 'lodash';\nimport { CreateElement, VNode } from 'vue';\nimport { Component, Prop, Vue, Watch } from 'vue-property-decorator';\nimport initScene from '../lib/field-play/scene';\nimport ColorModes from '../lib/field-play/programs/colorModes';\n\nimport { easeExpInOut } from 'd3-ease';\n\nfunction scale(x: number): number {\n  return easeExpInOut(x);\n}\n\n@Component\nexport default class FieldVizualisation extends Vue {\n  private scene: any;\n\n  @Prop({ required: true })\n  public alpha: number;\n\n  @Prop({ required: true })\n  public beta1: number;\n\n  @Prop({ required: true })\n  public beta2: number;\n\n  @Prop({ required: true })\n  public beta3: number;\n\n  @Prop({ required: true })\n  public gamma: number;\n\n  get k1(): number {\n    return scale(this.alpha);\n  };\n\n  get k2(): number {\n    return scale(this.gamma);\n  };\n\n  get k3(): number {\n    return scale(this.beta1);\n  };\n  get k4(): number {\n    return scale(this.beta2);\n  };\n  get k5(): number {\n    return scale(this.beta3);\n  };\n\n  @Prop({ required: true })\n  public n: number;\n\n  @Prop({ default: false })\n  public paused: boolean;\n\n  get actuallyPaused (): boolean {\n    return this.paused && this.n > 0;\n  }\n\n  private timeStep: number = 0.01;\n  private dropProbability: number = 0.009;\n  private fadeout: number = .998;\n\n  get particleCount (): number {\n    return Math.max(\n      this.n * (window.innerHeight * window.innerWidth) / 5000 * Math.pow(window.devicePixelRatio, 2)\n    , 1);\n  }\n\n  mounted () {\n    let canvas: HTMLCanvasElement = this.$el as HTMLCanvasElement;\n    let ctxOptions = { antialias: true, alpha: false };\n    let gl = canvas.getContext('webgl', ctxOptions) ||\n    canvas.getContext('experimental-webgl', ctxOptions);\n\n    this.scene = initScene(gl);\n    this.scene.setParticlesCount(this.particleCount);\n    this.scene.setBackgroundColor({\n      r: 0.05, g: 0, b: 0.1, a: 1\n    });\n    this.scene.setDropProbability(0.001)\n    this.updateVectorField();\n    this.updateColorFunction();\n    this.scene.setColorMode(ColorModes.VELOCITY);\n\n    if (!this.actuallyPaused)\n      this.scene.start();\n  }\n\n  beforeDestroy () {\n    this.scene.dispose();\n    this.$el.remove();\n  }\n\n  formatNumberforGLSL (n: number): string {\n    if (_.isNaN(n))\n      return '0.'\n    return n.toFixed(4);\n  }\n\n  get GLSLcode () {\n    let codeLines: string[] = [];\n\n    codeLines.push(`v.x = 0.;`);\n    codeLines.push(`v.y = 0.;`);\n    codeLines.push(`float tau = acos(0.);`);\n    codeLines.push(`float pi = tau / 2.;`);\n    codeLines.push(`float l = length(p);`)\n\n    codeLines.push(`if (u_k1 > .0) {`)\n      let circle = {\n        x: `p.y`,\n        y: `-p.x`\n      }\n      codeLines.push(`v.x += pow(u_k1, 2.) * (${circle.x}) / pow(max(1., abs(3. * l) - 2. * tau), 3.);`);\n      codeLines.push(`v.y += pow(u_k1, 2.) * (${circle.y}) / pow(max(1., abs(3. * l) - 2. * tau), 3.);`);\n    codeLines.push(`}`);\n\n    // SQUARES: Hi beta (3)\n    codeLines.push(`if (u_k5 > .0) {`)\n      let squares = {\n        x: `sign(sin(p.y * 4.)) / 2. + (1. - u_k5) * sin(p.y * 4.)`,\n        y: `sign(-1. * sin(p.x * 4.)) / 2. - (1. - u_k5) * sin(p.x * 4.)`\n      };\n      codeLines.push(`float sd = (abs(p.x) + abs(p.y)) * 2. / 3.;`);\n      codeLines.push(`if ( (sd < tau) && (sd > pi / 2.) ) {`);\n        codeLines.push(`v.x += pow(u_k5, 3.) * (${squares.x});`);\n        codeLines.push(`v.y += pow(u_k5, 3.) * (${squares.y});`);\n      codeLines.push(`}`);\n    codeLines.push(`}`);\n\n    // WHRIL: gamma\n    codeLines.push(`if (u_k2 > .0) {`)\n      let whirl = {\n        x: `(p.y + p.x) / pow(l, 2.) * atan(l) / tau / max(pow(l, 2.), 1.)`,\n        y: `(- p.x + p.y) / pow(l, 2.) * atan(l) / tau / max(pow(l, 2.), 1.)`\n      };\n      codeLines.push(`v.x -= pow(u_k2, 2.) * (${whirl.x});`);\n      codeLines.push(`v.y -= pow(u_k2, 2.) * (${whirl.y});`);\n    codeLines.push(`}`);\n\n    // explode idle: Low-beta (1)\n    codeLines.push(`if (u_k3 > .0) {`)\n      codeLines.push(`v.x += u_k3 * p.x / pow(l, 2.);`);\n      codeLines.push(`v.y += u_k3 * p.y / pow(l, 2.);`);\n    codeLines.push(`}`);\n\n    codeLines.push(`if (u_k4 > .0) {`)\n      codeLines.push(`float x = sin((p.x + p.y) * 3.);`)\n      codeLines.push(`float y = sin((p.x - p.y) * 3.);`)\n      codeLines.push(`float cd = max(max(abs(p.x), abs(p.y)) - 0.5, 0.);`)\n      // CLOVERFLIED processing units (cpu-like): Mid Beta (2)\n      let cloverfield = {\n        x: `4. * ((-1. / x / 50.) + (-1. / (y + x) / 100.) ) / max(1., pow(cd, 6.))`,\n        y: `4. * ((-1. / y / 50.) + (1.  / (x - y) / 100.) ) / max(1., pow(cd, 6.))`\n      };\n      codeLines.push(`v.x += pow(u_k4, 4.) * (${cloverfield.x});`);\n      codeLines.push(`v.y += pow(u_k4, 4.) * (${cloverfield.y});`);\n    codeLines.push(`}`);\n\n    codeLines.push(`v.x /= 2.;`);\n    codeLines.push(`v.y /= 2.;`);\n\n    return `\n    vec2 get_velocity(vec2 p) {\n      vec2 v = vec2(0., 0.);\n\n      ${codeLines.join('\\n')}\n\n      return v;\n    }`\n  }\n\n  updateVectorField () {\n    if (!this.scene)\n      return;\n\n    this.scene.vectorFieldEditorState.setCode(this.GLSLcode);\n  }\n\n  updateVariable (varName, value) {\n    if (!this.scene)\n      return;\n\n    this.scene.vectorFieldEditorState.updateVariable(varName, value);\n  }\n\n  updateColorVariable (value) {\n    if (!this.scene)\n      return;\n\n    this.scene.updateColorVariable(value);\n  }\n\n  get kColor () {\n    let ka = Math.pow((this.k2 - this.k1) / 2 + 0.5, 2);\n    let kb = Math.pow((this.k3 + this.k4 + this.k5) / 3, 2);\n    let k = ka + kb;\n\n    // clamp\n    k = Math.min(1, k);\n    k = Math.max(0, k);\n\n    return k;\n  }\n\n  get colorFunction() {\n    return `\n      vec4 get_color(vec2 p) {\n        vec2 velocity = get_velocity(p);\n        float speed = (length(velocity) - u_velocity_range[0])/(u_velocity_range[1] - u_velocity_range[0]);\n        float hue = 0.05 + (1. - speed) * 0.5;\n        float hue1 = 1. - pow(hue, 3.) / 2. + 0.15;\n        float hue2 = .5 + pow(hue, 3.) / 2.;\n        hue = u_k * hue1 + (1. - u_k) * hue2;\n        return vec4(hsv2rgb(vec3(hue, 0.9, 1.)), 1.0);\n      }`;\n  }\n\n  updateColorFunction () {\n    if (!this.scene)\n      return;\n\n    this.scene.setColorFunction(this.colorFunction);\n  }\n\n  @Watch('k1')\n  k1Updated () {\n    this.updateVariable('k1', this.k1);\n  }\n  @Watch('k2')\n  k2Updated () {\n    this.updateVariable('k2', this.k2);\n  }\n  @Watch('k3')\n  k3Updated () {\n    this.updateVariable('k3', this.k3);\n  }\n  @Watch('k4')\n  k4Updated () {\n    this.updateVariable('k4', this.k4);\n  }\n  @Watch('k5')\n  k5Updated () {\n    this.updateVariable('k5', this.k5);\n  }\n\n  @Watch('kColor')\n  kColorUpdated () {\n    this.updateColorVariable(this.kColor);\n  }\n\n  @Watch('actuallyPaused')\n  togglePause () {\n    if (this.scene)\n      this.scene[this.actuallyPaused ? 'stop' : 'start']();\n  }\n\n  @Watch('particleCount')\n  updateParticleCount () {\n    if (this.scene)\n      this.scene.setParticlesCount(this.particleCount);\n  }\n\n  render (h: CreateElement): VNode {\n    return h('canvas', { class: 'brain-particles' });\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./node_modules/vue-loader/lib/selector.js?type=script&index=0!./src/components/FieldVisualization.vue","function injectStyle (context) {\n  require(\"!!../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":false,\\\"minimize\\\":true}!../../node_modules/vue-loader/lib/style-compiler/index?{\\\"optionsId\\\":\\\"0\\\",\\\"vue\\\":true,\\\"id\\\":\\\"data-v-70aec022\\\",\\\"scoped\\\":true,\\\"sourceMap\\\":false}!sass-loader?{\\\"sourceMap\\\":false}!../../node_modules/vue-loader/lib/selector?type=styles&index=0!./FieldVisualization.vue\")\n}\n/* script */\nexport * from \"!!cache-loader?{\\\"cacheDirectory\\\":\\\"/home/david/dev/art/muse/brain-control/node_modules/.cache/cache-loader\\\"}!babel-loader!ts-loader?{\\\"transpileOnly\\\":true,\\\"appendTsSuffixTo\\\":[{}],\\\"happyPackMode\\\":false}!../../node_modules/vue-loader/lib/selector?type=script&index=0!./FieldVisualization.vue\"\nimport __vue_script__ from \"!!cache-loader?{\\\"cacheDirectory\\\":\\\"/home/david/dev/art/muse/brain-control/node_modules/.cache/cache-loader\\\"}!babel-loader!ts-loader?{\\\"transpileOnly\\\":true,\\\"appendTsSuffixTo\\\":[{}],\\\"happyPackMode\\\":false}!../../node_modules/vue-loader/lib/selector?type=script&index=0!./FieldVisualization.vue\"\n/* template */\nvar __vue_render__, __vue_static_render_fns__\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-70aec022\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nimport normalizeComponent from \"!../../node_modules/vue-loader/lib/runtime/component-normalizer\"\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_render__,\n  __vue_static_render_fns__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/components/FieldVisualization.vue\n// module id = null\n// module chunks = ","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport _ from 'lodash';\nimport { Component, Inject, Vue } from 'vue-property-decorator';\nimport { MuseClient } from 'muse-js';\nimport { EEGRelativePowerBand, POWER_BANDS, FrequencyBand } from 'muse-js';\nimport { Observable } from 'rxjs/Observable';\nimport { Subscription } from 'rxjs/Subscription';\nimport { bufferCount, map } from 'rxjs/operators';\nimport Session from './Session.vue';\nimport Visualization from './Visualization.vue';\nimport ParticlesVisualization from './ParticlesVisualization.vue';\nimport FieldVisualization from './FieldVisualization.vue';\n\nimport FontAwesomeIcon from '@fortawesome/vue-fontawesome';\n\nimport fontawesome from '@fortawesome/fontawesome';\nimport faBluetooth from '@fortawesome/fontawesome-free-brands/faBluetooth';\nimport faBluetoothB from '@fortawesome/fontawesome-free-brands/faBluetoothB';\nimport faPlayCircle from '@fortawesome/fontawesome-free-regular/faPlayCircle';\nimport faPauseCircle from '@fortawesome/fontawesome-free-regular/faPauseCircle';\nimport faCaretSquareDown from '@fortawesome/fontawesome-free-regular/faCaretSquareDown';\nimport faCaretSquareUp from '@fortawesome/fontawesome-free-regular/faCaretSquareUp';\n\nfontawesome.library.add(\n  faBluetooth, faBluetoothB,\n  faPlayCircle, faPauseCircle,\n  faCaretSquareDown, faCaretSquareUp\n);\n\nexport interface AveragedRelativeBandPowers {\n  [index: string]: number;\n}\n\n@Component({\n  components: {\n    Session,\n    Visualization,\n    ParticlesVisualization,\n    FieldVisualization,\n    FontAwesomeIcon,\n  }\n})\nexport default class MuseRecorder extends Vue {\n  private museClient: MuseClient;\n  private connectionStatus: boolean = false;\n  private sessionInProgress: boolean = false;\n  private currentSessionSubscription: Subscription;\n\n  private currentSession: AveragedRelativeBandPowers[] = [];\n\n  private alpha: number = 0;\n  private beta1: number = 0;\n  private beta2: number = 0;\n  private beta3: number = 0;\n  private gamma: number = 0;\n  private n: number = 0;\n  private paused: boolean = true;\n  private sessionsDetailsOpened: boolean = false;\n\n  private created() {\n    this.museClient = new MuseClient();\n  }\n\n  private async connectToMuse() {\n    await this.museClient.connect();\n    await this.museClient.start();\n\n    this.startSession();\n\n    this.museClient.connectionStatus.subscribe(\n      cS => this.connectionStatus = cS\n    );\n  }\n\n  private startSession() {\n    this.currentSession = [];\n    // @ts-ignore\n    this.currentSessionSubscription = (this.museClient.relativeBandPowers as Observable<EEGRelativePowerBand[]>)\n      .pipe(\n        bufferCount(100, 25)\n      ,\n        map( (sessions: EEGRelativePowerBand[][]): EEGRelativePowerBand[] =>\n          Object.keys(POWER_BANDS).map( (k): EEGRelativePowerBand => {\n            return {\n              band: POWER_BANDS[k],\n              power: sessions.map(\n                  (session: EEGRelativePowerBand[]): number => {\n                    let bandSession = session.find( r => r.band.id == POWER_BANDS[k].id );\n                    if (bandSession) {\n                      return bandSession.power;\n                    } else {\n                      return NaN;\n                    }\n                  }\n                ).reduce(\n                  ((sumOfSessions, bandSessionValue) =>\n                    sumOfSessions += bandSessionValue\n                  ), 0\n                ) / sessions.length\n            };\n          })\n        )\n      ,\n        map( (rbps: EEGRelativePowerBand[]): AveragedRelativeBandPowers => {\n          let arbps: AveragedRelativeBandPowers = {};\n          rbps.forEach( (rbp) => arbps[rbp.band.id] = rbp.power );\n          return arbps;\n        })\n      ).subscribe(\n        (arbps: AveragedRelativeBandPowers) => {\n          if ( _.some(arbps, v => _.isNaN(v) ) )\n            return;\n          this.currentSession.push(Object.freeze(arbps));\n          this.currentSession = _.takeRight(this.currentSession, 100);\n          this.n = Math.min(this.currentSession.length * 5, 100);\n          this.alpha = (\n            arbps.ALPHA - Math.min(...this.currentSession.map( d => d.ALPHA ))\n          ) / (\n            Math.max(...this.currentSession.map( d => d.ALPHA )) - Math.min(...this.currentSession.map( d => d.ALPHA ))\n          );\n          this.gamma = (\n            arbps.GAMMA - Math.min(...this.currentSession.map( d => d.GAMMA ))\n          ) / (\n            Math.max(...this.currentSession.map( d => d.GAMMA )) - Math.min(...this.currentSession.map( d => d.GAMMA ))\n          );\n          this.beta1 = (\n            arbps.BETA_1 - Math.min(...this.currentSession.map( d => d.BETA_1 ))\n          ) / (\n            Math.max(...this.currentSession.map( d => d.BETA_1 )) - Math.min(...this.currentSession.map( d => d.BETA_1 ))\n          );\n          this.beta2 = (\n            arbps.BETA_2 - Math.min(...this.currentSession.map( d => d.BETA_2 ))\n          ) / (\n            Math.max(...this.currentSession.map( d => d.BETA_2 )) - Math.min(...this.currentSession.map( d => d.BETA_2 ))\n          );\n          this.beta3 = (\n            arbps.BETA_3 - Math.min(...this.currentSession.map( d => d.BETA_3 ))\n          ) / (\n            Math.max(...this.currentSession.map( d => d.BETA_3 )) - Math.min(...this.currentSession.map( d => d.BETA_3 ))\n          );\n        }\n      );\n    this.sessionInProgress = true;\n    this.paused = false;\n  }\n\n  private stopSession() {\n    if (this.currentSessionSubscription) {\n      this.currentSessionSubscription.unsubscribe();\n    }\n    this.sessionInProgress = false;\n    this.paused = true;\n  }\n\n  private beforeDestroy() {\n    this.stopSession();\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./node_modules/vue-loader/lib/selector.js?type=script&index=0!./src/components/MuseRecorder.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"muse-recorder\"},[_c('div',[_c('field-visualization',{attrs:{\"alpha\":_vm.alpha,\"beta1\":_vm.beta1,\"beta2\":_vm.beta2,\"beta3\":_vm.beta3,\"gamma\":_vm.gamma,\"n\":_vm.n,\"paused\":_vm.paused}})],1),(_vm.n == 0)?_c('div',{staticClass:\"muse-recorder__greeting\",class:{'muse-recorder__greeting--connected': _vm.connectionStatus}},[_c('div',{staticStyle:{\"font-size\":\"6em\"}},[_vm._v(\"Do you feel in control\")]),_c('div',{staticStyle:{\"font-size\":\"4em\"}},[_vm._v(\"of what's happenning\")]),_c('div',{staticStyle:{\"font-size\":\"8em\"}},[_vm._v(\"in your brain?\")])]):_vm._e(),_c('div',{staticClass:\"muse-recorder__connection\",class:{'muse-recorder__connection--connected': _vm.connectionStatus}},[_c('font-awesome-icon',{staticClass:\"muse-recorder__connection-icon\",attrs:{\"icon\":['fab', _vm.connectionStatus ? 'bluetooth-b' : 'bluetooth']},on:{\"click\":function($event){_vm.connectionStatus ? _vm.disconnect() : _vm.connectToMuse()}}})],1),(true || _vm.connectionStatus)?_c('div',{staticClass:\"muse-recorder__session-control\"},[_c('div',{staticClass:\"muse-recorder__main-controls\"},[_c('font-awesome-icon',{staticClass:\"muse-recorder__session-control-icon\",attrs:{\"icon\":['far', _vm.sessionInProgress ? 'pause-circle' : 'play-circle']},on:{\"click\":function($event){_vm.sessionInProgress ? _vm.stopSession() : _vm.startSession()}}}),_c('font-awesome-icon',{staticClass:\"muse-recorder__session-details-icon\",attrs:{\"icon\":['far', _vm.sessionsDetailsOpened ? 'caret-square-down' : 'caret-square-up']},on:{\"click\":function($event){_vm.sessionsDetailsOpened = !_vm.sessionsDetailsOpened}}})],1),(_vm.sessionsDetailsOpened)?_c('div',{staticClass:\"muse-recorder__session-details\"},[_c('div',{staticClass:\"muse-recorder__viz-controls\"},[_c('button',{on:{\"click\":function($event){_vm.paused = !_vm.paused}}},[_vm._v(\" Pause viz\\n        \")]),_c('input',{directives:[{name:\"model\",rawName:\"v-model.number\",value:(_vm.alpha),expression:\"alpha\",modifiers:{\"number\":true}}],attrs:{\"type\":\"range\",\"min\":\"0\",\"max\":\"1\",\"step\":\"0.01\"},domProps:{\"value\":(_vm.alpha)},on:{\"__r\":function($event){_vm.alpha=_vm._n($event.target.value)},\"blur\":function($event){_vm.$forceUpdate()}}}),_c('pre',[_vm._v(\"alpha: \"+_vm._s(_vm.alpha))]),_c('input',{directives:[{name:\"model\",rawName:\"v-model.number\",value:(_vm.beta1),expression:\"beta1\",modifiers:{\"number\":true}}],attrs:{\"type\":\"range\",\"min\":\"0\",\"max\":\"1\",\"step\":\"0.01\"},domProps:{\"value\":(_vm.beta1)},on:{\"__r\":function($event){_vm.beta1=_vm._n($event.target.value)},\"blur\":function($event){_vm.$forceUpdate()}}}),_c('pre',[_vm._v(\"beta1: \"+_vm._s(_vm.beta1))]),_c('input',{directives:[{name:\"model\",rawName:\"v-model.number\",value:(_vm.beta2),expression:\"beta2\",modifiers:{\"number\":true}}],attrs:{\"type\":\"range\",\"min\":\"0\",\"max\":\"1\",\"step\":\"0.01\"},domProps:{\"value\":(_vm.beta2)},on:{\"__r\":function($event){_vm.beta2=_vm._n($event.target.value)},\"blur\":function($event){_vm.$forceUpdate()}}}),_c('pre',[_vm._v(\"beta2: \"+_vm._s(_vm.beta2))]),_c('input',{directives:[{name:\"model\",rawName:\"v-model.number\",value:(_vm.beta3),expression:\"beta3\",modifiers:{\"number\":true}}],attrs:{\"type\":\"range\",\"min\":\"0\",\"max\":\"1\",\"step\":\"0.01\"},domProps:{\"value\":(_vm.beta3)},on:{\"__r\":function($event){_vm.beta3=_vm._n($event.target.value)},\"blur\":function($event){_vm.$forceUpdate()}}}),_c('pre',[_vm._v(\"beta3: \"+_vm._s(_vm.beta3))]),_c('input',{directives:[{name:\"model\",rawName:\"v-model.number\",value:(_vm.gamma),expression:\"gamma\",modifiers:{\"number\":true}}],attrs:{\"type\":\"range\",\"min\":\"0\",\"max\":\"1\",\"step\":\"0.01\"},domProps:{\"value\":(_vm.gamma)},on:{\"__r\":function($event){_vm.gamma=_vm._n($event.target.value)},\"blur\":function($event){_vm.$forceUpdate()}}}),_c('pre',[_vm._v(\"gamma: \"+_vm._s(_vm.gamma))]),_c('input',{directives:[{name:\"model\",rawName:\"v-model.number\",value:(_vm.n),expression:\"n\",modifiers:{\"number\":true}}],attrs:{\"type\":\"range\",\"min\":\"0\",\"max\":\"100\",\"step\":\"1\"},domProps:{\"value\":(_vm.n)},on:{\"__r\":function($event){_vm.n=_vm._n($event.target.value)},\"blur\":function($event){_vm.$forceUpdate()}}}),_c('pre',[_vm._v(\"n: \"+_vm._s(_vm.n))])]),(_vm.currentSession.length)?_c('Session',{attrs:{\"sessionData\":_vm.currentSession}}):_c('div',[_vm._v(\"\\n        No session data\\n      \")])],1):_vm._e()]):_vm._e()])}\nvar staticRenderFns = []\nexport { render, staticRenderFns }\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-3f4cfb74\",\"hasScoped\":true,\"optionsId\":\"0\",\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/components/MuseRecorder.vue\n// module id = null\n// module chunks = ","function injectStyle (context) {\n  require(\"!!../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":false,\\\"minimize\\\":true}!../../node_modules/vue-loader/lib/style-compiler/index?{\\\"optionsId\\\":\\\"0\\\",\\\"vue\\\":true,\\\"id\\\":\\\"data-v-3f4cfb74\\\",\\\"scoped\\\":true,\\\"sourceMap\\\":false}!sass-loader?{\\\"sourceMap\\\":false}!../../node_modules/vue-loader/lib/selector?type=styles&index=0!./MuseRecorder.vue\")\n}\n/* script */\nexport * from \"!!cache-loader?{\\\"cacheDirectory\\\":\\\"/home/david/dev/art/muse/brain-control/node_modules/.cache/cache-loader\\\"}!babel-loader!ts-loader?{\\\"transpileOnly\\\":true,\\\"appendTsSuffixTo\\\":[{}],\\\"happyPackMode\\\":false}!../../node_modules/vue-loader/lib/selector?type=script&index=0!./MuseRecorder.vue\"\nimport __vue_script__ from \"!!cache-loader?{\\\"cacheDirectory\\\":\\\"/home/david/dev/art/muse/brain-control/node_modules/.cache/cache-loader\\\"}!babel-loader!ts-loader?{\\\"transpileOnly\\\":true,\\\"appendTsSuffixTo\\\":[{}],\\\"happyPackMode\\\":false}!../../node_modules/vue-loader/lib/selector?type=script&index=0!./MuseRecorder.vue\"\n/* template */\nimport {render as __vue_render__, staticRenderFns as __vue_static_render_fns__} from \"!!../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-3f4cfb74\\\",\\\"hasScoped\\\":true,\\\"optionsId\\\":\\\"0\\\",\\\"buble\\\":{\\\"transforms\\\":{}}}!../../node_modules/vue-loader/lib/selector?type=template&index=0!./MuseRecorder.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-3f4cfb74\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nimport normalizeComponent from \"!../../node_modules/vue-loader/lib/runtime/component-normalizer\"\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_render__,\n  __vue_static_render_fns__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/components/MuseRecorder.vue\n// module id = null\n// module chunks = ","\n\n\n\n\n\n\nimport { Component, Vue } from 'vue-property-decorator';\nimport MuseRecorder from './components/MuseRecorder.vue';\n\n@Component({\n  components: {\n    MuseRecorder,\n  },\n})\nexport default class App extends Vue {}\n\n\n\n// WEBPACK FOOTER //\n// ./node_modules/vue-loader/lib/selector.js?type=script&index=0!./src/App.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{attrs:{\"id\":\"muse-recorder-app\"}},[_c('MuseRecorder')],1)}\nvar staticRenderFns = []\nexport { render, staticRenderFns }\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-4b9f0501\",\"hasScoped\":false,\"optionsId\":\"0\",\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/App.vue\n// module id = null\n// module chunks = ","function injectStyle (context) {\n  require(\"!!../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":false,\\\"minimize\\\":true}!../node_modules/vue-loader/lib/style-compiler/index?{\\\"optionsId\\\":\\\"0\\\",\\\"vue\\\":true,\\\"scoped\\\":false,\\\"sourceMap\\\":false}!sass-loader?{\\\"sourceMap\\\":false}!../node_modules/vue-loader/lib/selector?type=styles&index=0!./App.vue\")\n}\n/* script */\nexport * from \"!!cache-loader?{\\\"cacheDirectory\\\":\\\"/home/david/dev/art/muse/brain-control/node_modules/.cache/cache-loader\\\"}!babel-loader!ts-loader?{\\\"transpileOnly\\\":true,\\\"appendTsSuffixTo\\\":[{}],\\\"happyPackMode\\\":false}!../node_modules/vue-loader/lib/selector?type=script&index=0!./App.vue\"\nimport __vue_script__ from \"!!cache-loader?{\\\"cacheDirectory\\\":\\\"/home/david/dev/art/muse/brain-control/node_modules/.cache/cache-loader\\\"}!babel-loader!ts-loader?{\\\"transpileOnly\\\":true,\\\"appendTsSuffixTo\\\":[{}],\\\"happyPackMode\\\":false}!../node_modules/vue-loader/lib/selector?type=script&index=0!./App.vue\"\n/* template */\nimport {render as __vue_render__, staticRenderFns as __vue_static_render_fns__} from \"!!../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-4b9f0501\\\",\\\"hasScoped\\\":false,\\\"optionsId\\\":\\\"0\\\",\\\"buble\\\":{\\\"transforms\\\":{}}}!../node_modules/vue-loader/lib/selector?type=template&index=0!./App.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = null\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nimport normalizeComponent from \"!../node_modules/vue-loader/lib/runtime/component-normalizer\"\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_render__,\n  __vue_static_render_fns__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/App.vue\n// module id = null\n// module chunks = ","import Vue from 'vue';\nimport Vuex from 'vuex';\n\nVue.use(Vuex);\n\nexport default new Vuex.Store({\n  state: {\n\n  },\n  mutations: {\n\n  },\n  actions: {\n\n  },\n});\n\n\n\n// WEBPACK FOOTER //\n// ./src/store.ts","/* tslint:disable:no-console */\n\nimport { register } from 'register-service-worker';\n\nif (process.env.NODE_ENV === 'production') {\n  register(`${process.env.BASE_URL}service-worker.js`, {\n    ready() {\n      console.log(\n        'App is being served from cache by a service worker.\\n' +\n        'For more details, visit https://goo.gl/AFskqB',\n      );\n    },\n    cached() {\n      console.log('Content has been cached for offline use.');\n    },\n    updated() {\n      console.log('New content is available; please refresh.');\n    },\n    offline() {\n      console.log('No internet connection found. App is running in offline mode.');\n    },\n    error(error) {\n      console.error('Error during service worker registration:', error);\n    },\n  });\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/registerServiceWorker.ts","import Vue from 'vue';\nimport App from './App.vue';\nimport store from './store';\nimport './registerServiceWorker';\n\nVue.config.productionTip = false;\n\nnew Vue({\n  store,\n  render: (h) => h(App),\n}).$mount('#app');\n\n\n\n// WEBPACK FOOTER //\n// ./src/main.ts"],"sourceRoot":""}