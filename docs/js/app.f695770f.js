webpackJsonp([2],{0:function(e,t,n){e.exports=n("x35b")},"F+2c":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n("FNDN"),o=n("873f"),i=n("iFEQ"),a=n("siKw"),s=n("NkOO"),u=n("o9N1"),c=n("T6YV");function l(e){var t=[],n=null;return e.pipe(a.mergeMap(function(e){if(e.timestamp!==n&&(n=e.timestamp,t.length)){var r=o.from([t.slice()]);return t.splice(0,t.length,e),r}return t.push(e),o.from([])}),i.concat(o.from([t])),a.mergeMap(function(e){var t=e[0].samples.map(function(t,n){for(var o=[NaN,NaN,NaN,NaN,NaN],i=0,a=e;i<a.length;i++){var s=a[i];o[s.electrode]=s.samples[n]}return{data:o,index:e[0].index,timestamp:e[0].timestamp+1e3*n/r.EEG_FREQUENCY}});return o.from(t)}))}function f(e,t,n){return l(e).pipe(s.bufferCount(t,n),c.skipLast(Math.ceil(t/n)),u.map(function(e){return{timestamp:e[0].timestamp,data:e[0].data.map(function(t,n){return e.map(function(e){return e.data[n]})})}}))}t.zipSamples=l,t.zipSamplesToTimeSeries=f},FNDN:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r["throw"](e))}catch(e){i(e)}}function u(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,s)}u((r=r.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return u([e,t])}}function u(i){if(n)throw new TypeError("Generator is already executing.");while(a)try{if(n=1,r&&(o=r[2&i[0]?"return":i[0]?"throw":"next"])&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[0,o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(o=a.trys,!(o=o.length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(t,"__esModule",{value:!0});var i=n("XSYY"),a=n("evJO"),s=n("PI56"),u=n("qxB6"),c=n("fzBq"),l=n("o9N1"),f=n("77+c"),d=n("HvJX"),p=n("g7fr"),h=n("r/7J"),m=n("wtQo"),v=n("F+2c");t.zipSamples=v.zipSamples;var g=n("wtQo");t.zipSamplesToSpectrum=g.zipSamplesToSpectrum,t.MUSE_SERVICE=65165;var y="273e0001-4c4d-454d-96be-f03bac821358",b="273e000b-4c4d-454d-96be-f03bac821358",_="273e0009-4c4d-454d-96be-f03bac821358",x="273e000a-4c4d-454d-96be-f03bac821358",w=["273e0003-4c4d-454d-96be-f03bac821358","273e0004-4c4d-454d-96be-f03bac821358","273e0005-4c4d-454d-96be-f03bac821358","273e0006-4c4d-454d-96be-f03bac821358","273e0007-4c4d-454d-96be-f03bac821358"];t.EEG_FREQUENCY=256,t.channelNames=["TP9","AF7","AF8","TP10","AUX"];var T=function(){function e(){this.enableAux=!1,this.deviceName="",this.connectionStatus=new i.BehaviorSubject(!1),this.gatt=null,this.lastIndex=null,this.lastTimestamp=null}return e.prototype.connect=function(e){return r(this,void 0,void 0,function(){var n,r,i,u,d,v,g,T,P,E,S,k,C,M,R,O,F=this;return o(this,function(A){switch(A.label){case 0:return e?(this.gatt=e,[3,4]):[3,1];case 1:return[4,navigator.bluetooth.requestDevice({filters:[{services:[t.MUSE_SERVICE]}]})];case 2:return n=A.sent(),r=this,[4,n.gatt.connect()];case 3:r.gatt=A.sent(),A.label=4;case 4:return this.deviceName=this.gatt.device.name||null,[4,this.gatt.getPrimaryService(t.MUSE_SERVICE)];case 5:return i=A.sent(),a.fromEvent(this.gatt.device,"gattserverdisconnected").pipe(c.first()).subscribe(function(){F.gatt=null,F.connectionStatus.next(!1)}),u=this,[4,i.getCharacteristic(y)];case 6:return u.controlChar=A.sent(),d=this,[4,h.observableCharacteristic(this.controlChar)];case 7:return d.rawControlData=A.sent().pipe(l.map(function(e){return h.decodeResponse(new Uint8Array(e.buffer))}),f.share()),this.controlResponses=p.parseControl(this.rawControlData),[4,i.getCharacteristic(b)];case 8:return v=A.sent(),g=this,[4,h.observableCharacteristic(v)];case 9:return g.telemetryData=A.sent().pipe(l.map(p.parseTelemetry)),[4,i.getCharacteristic(_)];case 10:return T=A.sent(),P=this,[4,h.observableCharacteristic(T)];case 11:return P.gyroscopeData=A.sent().pipe(l.map(p.parseGyroscope)),[4,i.getCharacteristic(x)];case 12:return E=A.sent(),S=this,[4,h.observableCharacteristic(E)];case 13:S.accelerometerData=A.sent().pipe(l.map(p.parseAccelerometer)),this.eegCharacteristics=[],k=[],C=this.enableAux?w.length:4,M=function(e){var t,n,r,a;return o(this,function(o){switch(o.label){case 0:return t=w[e],[4,i.getCharacteristic(t)];case 1:return n=o.sent(),a=(r=k).push,[4,h.observableCharacteristic(n)];case 2:return a.apply(r,[o.sent().pipe(l.map(function(t){var n=t.getUint16(0);return{electrode:e,index:n,samples:p.decodeEEGSamples(new Uint8Array(t.buffer).subarray(2)),timestamp:F.getTimestamp(n)}}))]),R.eegCharacteristics.push(n),[2]}})},R=this,O=0,A.label=14;case 14:return O<C?[5,M(O)]:[3,17];case 15:A.sent(),A.label=16;case 16:return O++,[3,14];case 17:return this.eegReadings=s.merge.apply(void 0,k).pipe(f.share()),this.rawFFT=m.zipSamplesToSpectrum(this.eegReadings).pipe(f.share()),this.absoluteBandPowers=m.spectrumToAbsolutePowerBands(this.rawFFT),this.relativeBandPowers=m.spectrumToRelativePowerBands(this.rawFFT),this.connectionStatus.next(!0),[2]}})})},e.prototype.sendCommand=function(e){return r(this,void 0,void 0,function(){return o(this,function(t){switch(t.label){case 0:return[4,this.controlChar.writeValue(h.encodeCommand(e))];case 1:return t.sent(),[2]}})})},e.prototype.start=function(){return r(this,void 0,void 0,function(){var e;return o(this,function(t){switch(t.label){case 0:return[4,this.pause()];case 1:return t.sent(),e=this.enableAux?"p20":"p21",[4,this.controlChar.writeValue(h.encodeCommand(e))];case 2:return t.sent(),[4,this.controlChar.writeValue(h.encodeCommand("s"))];case 3:return t.sent(),[4,this.resume()];case 4:return t.sent(),[2]}})})},e.prototype.pause=function(){return r(this,void 0,void 0,function(){return o(this,function(e){switch(e.label){case 0:return[4,this.sendCommand("h")];case 1:return e.sent(),[2]}})})},e.prototype.resume=function(){return r(this,void 0,void 0,function(){return o(this,function(e){switch(e.label){case 0:return[4,this.sendCommand("d")];case 1:return e.sent(),[2]}})})},e.prototype.deviceInfo=function(){return r(this,void 0,void 0,function(){var e;return o(this,function(t){switch(t.label){case 0:return e=this.controlResponses.pipe(u.filter(function(e){return!!e.fw}),d.take(1)).toPromise(),[4,this.sendCommand("v1")];case 1:return t.sent(),[2,e]}})})},e.prototype.disconnect=function(){this.gatt&&(this.lastIndex=null,this.lastTimestamp=null,this.gatt.disconnect(),this.connectionStatus.next(!1))},e.prototype.getTimestamp=function(e){var n=12,r=1/t.EEG_FREQUENCY*1e3*n;null!==this.lastIndex&&null!==this.lastTimestamp||(this.lastIndex=e,this.lastTimestamp=(new Date).getTime()-r);while(this.lastIndex-e>4096)e+=65536;return e===this.lastIndex?this.lastTimestamp:e>this.lastIndex?(this.lastTimestamp+=r*(e-this.lastIndex),this.lastIndex=e,this.lastTimestamp):this.lastTimestamp-r*(this.lastIndex-e)},e}();t.MuseClient=T;var P=n("wtQo");t.POWER_BANDS=P.POWER_BANDS},G3BA:function(e,t){},GIte:function(e,t){},"Rni/":function(e,t){},UqZ0:function(e,t){},g7fr:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n("0HXJ"),o=n("qxB6"),i=n("o9N1"),a=n("EWpk");function s(e){return e.pipe(r.concatMap(function(e){return e.split("")}),a.scan(function(e,t){return e.indexOf("}")>=0?t:e+t},""),o.filter(function(e){return e.indexOf("}")>=0}),i.map(function(e){return JSON.parse(e)}))}function u(e){for(var t=[],n=0;n<e.length;n++)n%3===0?t.push(e[n]<<4|e[n+1]>>4):(t.push((15&e[n])<<8|e[n+1]),n++);return t}function c(e){return u(e).map(function(e){return.48828125*(e-2048)})}function l(e){return{sequenceId:e.getUint16(0),batteryLevel:e.getUint16(2)/512,fuelGaugeVoltage:2.2*e.getUint16(4),temperature:e.getUint16(8)}}function f(e,t){function n(n){return{x:t*e.getInt16(n),y:t*e.getInt16(n+2),z:t*e.getInt16(n+4)}}return{sequenceId:e.getUint16(0),samples:[n(2),n(8),n(14)]}}function d(e){return f(e,610352e-10)}function p(e){return f(e,.0074768)}t.parseControl=s,t.decodeUnsigned12BitData=u,t.decodeEEGSamples=c,t.parseTelemetry=l,t.parseAccelerometer=d,t.parseGyroscope=p},ps32:function(e,t){},"r/7J":function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r["throw"](e))}catch(e){i(e)}}function u(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,s)}u((r=r.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return u([e,t])}}function u(i){if(n)throw new TypeError("Generator is already executing.");while(a)try{if(n=1,r&&(o=r[2&i[0]?"return":i[0]?"throw":"next"])&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[0,o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(o=a.trys,!(o=o.length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(t,"__esModule",{value:!0});var i=n("evJO"),a=n("o9N1"),s=n("R6D2");function u(e){return(new TextDecoder).decode(e.subarray(1,1+e[0]))}function c(e){var t=new TextEncoder("utf-8").encode("X"+e+"\n");return t[0]=t.length-1,t}function l(e){return r(this,void 0,void 0,function(){var t;return o(this,function(n){switch(n.label){case 0:return[4,e.startNotifications()];case 1:return n.sent(),t=i.fromEvent(e.service.device,"gattserverdisconnected"),[2,i.fromEvent(e,"characteristicvaluechanged").pipe(s.takeUntil(t),a.map(function(e){return e.target.value}))]}})})}t.decodeResponse=u,t.encodeCommand=c,t.observableCharacteristic=l},rZMD:function(e,t){},sa50:function(e,t,n){var r=n("puH/");e.exports=r({})},wtQo:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n("4UJL"),o=n("FNDN"),i=n("F+2c"),a=n("o9N1");t.FFT_BUFFER_SIZE=256,t.FFT_WINDOW_OVERLAP=26;var s=new r.RFFT(t.FFT_BUFFER_SIZE,o.EEG_FREQUENCY);function u(e){return s.forward(e.map(function(t,n){return r.WindowFunction.Hamming(e.length,n)*t})),s.spectrum}function c(e){return i.zipSamplesToTimeSeries(e,t.FFT_BUFFER_SIZE,t.FFT_WINDOW_OVERLAP).pipe(a.map(function(e){return{timestamp:e.timestamp,data:e.data.map(function(e){return new Float64Array(u(e))})}}))}function l(e){return{timestamp:e.timestamp,data:e.data[0].map(function(t,n){return e.data.map(function(e){return e[n]}).filter(isFinite).reduce(function(e,t){return e+t},0)})}}function f(e,t){return t.data.reduce(function(t,n,r){return r>=e.range[0]&&r<=e.range[1]&&isFinite(n)?t+n:t},0)}function d(e,t){return{band:e,power:Math.log(f(e,t))}}function p(e){return Object.keys(t.POWER_BANDS).map(function(n){return d(t.POWER_BANDS[n],e)})}function h(e){return e.pipe(a.map(function(e){return l(e)}),a.map(function(e){return p(e)}))}function m(e){var n=Object.keys(t.POWER_BANDS).map(function(n){return{band:t.POWER_BANDS[n],power:f(t.POWER_BANDS[n],e)}}),r=n.reduce(function(e,t){return e+t.power},0);return n.forEach(function(e){e.power/=r}),n}function v(e){return e.pipe(a.map(function(e){return l(e)}),a.map(function(e){return m(e)}))}t.computeSpectrum=u,t.zipSamplesToSpectrum=c,t.computeTotalSpectrum=l,t.computeAbsolutePowerBand=d,t.POWER_BANDS={DELTA:{id:"DELTA",label:"Delta waves",range:[1,4]},THETA:{id:"THETA",label:"Theta waves",range:[4,8]},ALPHA:{id:"ALPHA",label:"Alpha waves",range:[7.5,13]},BETA:{id:"BETA",label:"Beta waves",range:[13,30]},GAMMA:{id:"GAMMA",label:"Gamma waves",range:[30,44]}},t.computeAbsolutePowerBands=p,t.spectrumToAbsolutePowerBands=h,t.computeRelativePowerBands=m,t.spectrumToRelativePowerBands=v},x35b:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n("/5sW"),o=n("Z60a"),i=n.n(o),a=n("T/v0"),s=n.n(a),u=n("j/rp"),c=n.n(u),l=n("Oy1H"),f=n.n(l),d=n("EOM2"),p=n("rzQm"),h=n.n(p),m=(n("WpTh"),n("SldL"),n("C9uT")),v=n.n(m),g=(n("y9m4"),n("M4fF")),y=n.n(g),b=n("FNDN"),_=n("W+Sr"),x=n("8soT"),w=n("Q1TF"),T=n("lDdF"),P=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"===typeof Reflect?"undefined":f()(Reflect))&&"function"===typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},E=this&&this.__metadata||function(e,t){if("object"===("undefined"===typeof Reflect?"undefined":f()(Reflect))&&"function"===typeof Reflect.metadata)return Reflect.metadata(e,t)},S=function(e){function t(){return i()(this,t),s()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return c()(t,e),v()(t,[{key:"lineForSerie",value:function(e){var t=this;return Object(x["b"])()(this.sessionData.map(function(n,r){return[t.xScale(r),t.yScale(n[e])]}))}},{key:"saveAsJSON",value:function(){var e=new Blob([JSON.stringify(this.sessionData,null,2)],{type:"application/json;charset=utf-8"}),t=new Date,n="muse-session-".concat(t.toISOString(),".json");Object(T["saveAs"])(e,n)}},{key:"series",get:function(){return Object.keys(this.sessionData[0]||{})}},{key:"xScale",get:function(){return Object(w["a"])().domain([0,this.sessionData.length-1]).range([0,this.width])}},{key:"yScale",get:function(){return Object(w["a"])().domain([0,.5]).range([this.height,0])}}]),t}(d["Vue"]);P([Object(d["Prop"])({default:[]}),E("design:type",Array)],S.prototype,"sessionData",void 0),P([Object(d["Prop"])({default:800}),E("design:type",Number)],S.prototype,"width",void 0),P([Object(d["Prop"])({default:500}),E("design:type",Number)],S.prototype,"height",void 0),S=P([d["Component"]],S);var k=S,C=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"muse-recorder__session"},[n("svg",{staticClass:"session__chart",attrs:{width:e.width,height:e.height}},e._l(e.series,function(t){return n("path",{key:t,class:["session__serie","session__serie--"+t.toLowerCase()],attrs:{d:e.lineForSerie(t)}})})),n("div",{staticClass:"session__legend"},e._l(e.series,function(t){return n("div",{key:t,class:["session__legend__item","session__legend__item--"+t.toLowerCase()]},[n("div",{staticClass:"session__legend__item__color"}),n("span",[e._v(e._s(t))])])})),n("button",{staticStyle:{flex:"none",height:"2em"},on:{click:function(t){e.saveAsJSON()}}},[e._v("\n    Export session to JSON file\n  ")])])},M=[],R=n("XyMi");function O(e){n("ps32")}var F=!1,A=O,N="data-v-fc1651c8",D=null,B=Object(R["a"])(k,C,M,F,A,N,D),I=B.exports,U=n("twHu"),j=n("V0Ox"),L=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"===typeof Reflect?"undefined":f()(Reflect))&&"function"===typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},G=this&&this.__metadata||function(e,t){if("object"===("undefined"===typeof Reflect?"undefined":f()(Reflect))&&"function"===typeof Reflect.metadata)return Reflect.metadata(e,t)},X=function(e){function t(){var e;return i()(this,t),e=s()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments)),e.tk1=e.k1,e.tk2=e.k2,e.colors=["#00f","#0f0","#f00"],e}return c()(t,e),v()(t,[{key:"animateK1",value:function(e){var t=this,n=1e3,r=Date.now(),o=Object(U["b"])(this.tk1,e),i=function i(){var a=(Date.now()-r)/n;a>=1?t.tk1=e:(requestAnimationFrame(i),t.tk1=o(a))};i()}},{key:"animateK2",value:function(e){var t=this,n=1e3,r=Date.now(),o=Object(U["b"])(this.tk2,e),i=function i(){var a=(Date.now()-r)/n;a>=1?t.tk2=e:(requestAnimationFrame(i),t.tk2=o(a))};i()}},{key:"brainWires",value:function(e,t){var n=this;return[-.5,0,.5].map(function(r){return n.brainWire(e,t,r)})}},{key:"brainWire",value:function(e,t,n){var r=Object(x["b"])().curve(x["a"].tension(n));return r(this.wirePoints(e,t,n))}},{key:"wirePoints",value:function(e,t,n){var r=e+Object(j["a"])(n)*(t-e),o=[this.leftPoint(r,n),this.leftMiddlePoint(r,n),this.middlePoint(r,n),this.rightMiddlePoint(r,n),this.rightPoint(r,n)],i=100,a=o.map(function(e){return[e[0],e[1]+i/2]}).concat(o.reverse().map(function(e){return[e[0],-e[1]-i/2]}));return a.push(a[0]),a.map(this.verticalTranslation(-this.width/2-2*(1-Math.max(e,t))*n*this.radius))}},{key:"leftPoint",value:function(e,t){return[Object(U["b"])(-this.width/2,-this.radius)(Object(j["c"])(e)),Object(U["b"])(0,this.radius)(t*e)]}},{key:"leftMiddlePoint",value:function(e,t){var n=Object(U["b"])(Math.SQRT2/2,1);return[Object(U["b"])(-this.width/4,-this.radius*n(t))(Object(j["c"])(e)),Object(U["b"])(0,-this.radius*n(t))(Object(j["b"])(e))+Object(U["b"])(0,this.radius)(t*e)]}},{key:"middlePoint",value:function(e,t){return[0,Object(U["b"])(0,-this.radius)(Object(j["d"])(e))+Object(U["b"])(0,this.radius)(t*e)]}},{key:"rightMiddlePoint",value:function(e,t){return this.verticalSymetry(this.leftMiddlePoint(e,t))}},{key:"rightPoint",value:function(e,t){return this.verticalSymetry(this.leftPoint(e,t))}},{key:"verticalSymetry",value:function(e){return[-e[0],e[1]]}},{key:"horizontalSymetry",value:function(e){return[e[0],-e[1]]}},{key:"verticalTranslation",value:function(e){return function(t){return[t[0],e+t[1]]}}},{key:"originTranslation",get:function(){return"translate(".concat(this.width/2,", ").concat(this.height,")")}},{key:"radius",get:function(){return Math.sqrt(Math.pow(this.width/2,2)+Math.pow(this.height/2,2))/2}}]),t}(d["Vue"]);L([Object(d["Prop"])({default:1}),G("design:type",Number)],X.prototype,"k1",void 0),L([Object(d["Prop"])({default:1}),G("design:type",Number)],X.prototype,"k2",void 0),L([Object(d["Watch"])("k1"),G("design:type",Function),G("design:paramtypes",[Number]),G("design:returntype",void 0)],X.prototype,"animateK1",null),L([Object(d["Watch"])("k2"),G("design:type",Function),G("design:paramtypes",[Number]),G("design:returntype",void 0)],X.prototype,"animateK2",null),L([Object(d["Prop"])({default:800}),G("design:type",Number)],X.prototype,"height",void 0),L([Object(d["Prop"])({default:800}),G("design:type",Number)],X.prototype,"width",void 0),X=L([d["Component"]],X);var Y=X,z=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("svg",{staticClass:"brain-visualization",attrs:{height:e.height,width:e.width}},[n("defs",[n("filter",{attrs:{id:"goo"}},[n("feGaussianBlur",{attrs:{in:"SourceGraphic",stdDeviation:"10",result:"blur"}}),n("feColorMatrix",{attrs:{in:"blur",mode:"matrix",values:"1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 20 -18",result:"goo"}}),n("feComposite",{attrs:{in:"SourceGraphic",in2:"goo",operator:"atop"}})],1)]),n("g",{staticClass:"brain-wires"},e._l(e.brainWires(e.tk1,e.tk2),function(t,r){return n("path",{key:r,staticClass:"brain-wire",attrs:{filter:"url(#goo)",transform:e.originTranslation,d:t,fill:e.colors[r]}})}))])},W=[];function V(e){n("rZMD")}var q=!1,H=V,Q="data-v-888b4562",J=null,Z=Object(R["a"])(Y,z,W,q,H,Q,J),K=Z.exports,$=(n("No4x"),n("Ml+6")),ee=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"===typeof Reflect?"undefined":f()(Reflect))&&"function"===typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},te=this&&this.__metadata||function(e,t){if("object"===("undefined"===typeof Reflect?"undefined":f()(Reflect))&&"function"===typeof Reflect.metadata)return Reflect.metadata(e,t)},ne=200,re={X:2*ne,Y:2*ne},oe=ne*Math.SQRT2,ie=1e3,ae=.001,se=function(e){function t(){return i()(this,t),s()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return c()(t,e),v()(t,[{key:"created",value:function(){this.scene=new $["j"],this.renderer=new $["n"]({preserveDrawingBuffer:!0}),this.renderer.autoClearColor=!1,this.camera=new $["f"](120,window.innerWidth/window.innerHeight,.1,1e3);var e=new $["d"]({color:0,transparent:!0,opacity:.04,depthWrite:!1}),t=new $["g"](1,1),n=new $["c"](t,e),r=new $["e"];r.add(this.camera),r.add(n),r.translateZ(ne),n.position.z=-.1,n.renderOrder=-1,this.scene.add(r);var o=new $["i"]({size:2,vertexColors:$["m"],opacity:.6,transparent:!0,map:this.createCanvasMaterial("white",64),depthWrite:!1});this.geometry=new $["b"],y.a.times(ie,this.addRandomPoint),this.points=new $["h"](this.geometry,o),this.scene.add(this.points)}},{key:"randomPositionOnPlane",value:function(){return new $["l"](2*(Math.random()-.5)*re.X,2*(Math.random()-.5)*re.Y,0)}},{key:"addRandomPoint",value:function(){this.geometry.vertices.push(this.randomPositionOnPlane()),this.geometry.colors.push(new $["a"](Math.random(),Math.random(),Math.random()))}},{key:"mounted",value:function(){this.renderer.setSize(window.innerWidth,window.innerHeight),this.animate(),this.$el.appendChild(this.renderer.domElement)}},{key:"animate",value:function(){var e=this;this.geometry.vertices.map(function(t){if(Math.random()<=ae){var n=e.randomPositionOnPlane();t.set(n.x,n.y,n.z),e.geometry.verticesNeedUpdate=!0}}),y.a.isNaN(this.k1)||y.a.isNaN(this.k2)||(this.geometry.vertices.map(function(t){var n=e.horizontalMovement(t),r=e.circularMovement(t),o=e.squareMovement(t),i=function(t,n,r){return e.circleWeigth*n+e.squareWeigth*r+e.horizontalWeigth*t},a=[i(n[0],r[0],o[0]),i(n[1],r[1],o[1])];e.moveParticle(t,a)}),this.geometry.verticesNeedUpdate=!0),this.geometry.colors.map(function(e){var t,n,r;t=(Math.random()-.5)/5,n=(Math.random()-.5)/5,r=(Math.random()-.5)/5,e.add(new $["a"](t,n,r))}),this.geometry.colorsNeedUpdate=!0,this.renderer.render(this.scene,this.camera),this.continue()}},{key:"createCanvasMaterial",value:function(e,t){var n=document.createElement("canvas");n.width=n.height=t;var r=n.getContext("2d"),o=new $["k"](n);if(!r)return new $["k"];var i=t/2;return r.beginPath(),r.arc(i,i,i,0,2*Math.PI),r.closePath(),r.fillStyle=e,r.fill(),o.needsUpdate=!0,o}},{key:"moveParticle",value:function(e,t){e.x+=t[0],e.y+=t[1],e.x>re.X&&(e.x=-1*re.X),e.x<-1*re.X&&(e.x=re.X),e.y>re.Y&&(e.y=-1*re.Y),e.y<-1*re.Y&&(e.y=re.Y)}},{key:"horizontalMovement",value:function(e){return[1,Math.sin(e.x/16/Math.PI)/2]}},{key:"circularMovement",value:function(e){var t=Math.pow(Math.pow(e.x,2)+Math.pow(e.y,2),.5),n=Math.atan2(e.y,e.x),r=(oe-t)/250,o=2*Math.PI/2e3;return[r*Math.cos(n)-t*Math.sin(n)*o,r*Math.cos(n)+t*Math.cos(n)*o]}},{key:"squareMovement",value:function(e){var t,n,r=e.x,o=e.y;return r>=0?(n=1,o>=0?(o/(1-r),t=-1):(o/(r-1),t=1)):(n=-1,o>0?(o/(r+1),t=-1):(o/(-1-r),t=1)),[t,n]}},{key:"continue",value:function(){this.paused||(this.lastAnimationId=window.requestAnimationFrame(this.animate))}},{key:"pause",value:function(){this.lastAnimationId&&window.cancelAnimationFrame(this.lastAnimationId),this.lastAnimationId=void 0}},{key:"onPausedChanged",value:function(){this.paused?this.pause():this.continue()}},{key:"render",value:function(e){return e("div",{class:"brain-particles"})}},{key:"destroyed",value:function(){this.pause(),this.renderer.dispose(),this.geometry.dispose()}},{key:"horizontalWeigth",get:function(){return 1-Math.max(this.k1,this.k2)}},{key:"circleWeigth",get:function(){return this.k1+this.k2===0?0:this.k1}},{key:"squareWeigth",get:function(){return this.k1+this.k2===0?0:this.k2}}]),t}(d["Vue"]);ee([Object(d["Prop"])({required:!0}),te("design:type",Number)],se.prototype,"k1",void 0),ee([Object(d["Prop"])({required:!0}),te("design:type",Number)],se.prototype,"k2",void 0),ee([Object(d["Prop"])({default:!1}),te("design:type",Boolean)],se.prototype,"paused",void 0),ee([Object(d["Watch"])("paused"),te("design:type",Function),te("design:paramtypes",[]),te("design:returntype",void 0)],se.prototype,"onPausedChanged",null),se=ee([d["Component"]],se);var ue,ce,le=se;function fe(e){n("UqZ0")}var de=!1,pe=fe,he="data-v-2f884374",me=null,ve=Object(R["a"])(le,ue,ce,de,pe,he,me),ge=ve.exports,ye=(n("yuXV"),n("altv"),n("dTzs"),n("EuXz"),n("TFWu"),{createTexture:xe,bindFramebuffer:we,createProgram:Pe,createBuffer:_e,bindAttribute:Te,bindTexture:be});function be(e,t,n){e.activeTexture(e.TEXTURE0+n),e.bindTexture(e.TEXTURE_2D,t)}function _e(e,t){var n=e.createBuffer();return e.bindBuffer(e.ARRAY_BUFFER,n),e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW),n}function xe(e,t,n,r,o){var i=e.createTexture();return e.bindTexture(e.TEXTURE_2D,i),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,t),n instanceof Uint8Array?e.texImage2D(e.TEXTURE_2D,0,e.RGBA,r,o,0,e.RGBA,e.UNSIGNED_BYTE,n):e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n),e.bindTexture(e.TEXTURE_2D,null),i}function we(e,t,n){e.bindFramebuffer(e.FRAMEBUFFER,t),n&&e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0)}function Te(e,t,n,r){e.bindBuffer(e.ARRAY_BUFFER,t),e.enableVertexAttribArray(n),e.vertexAttribPointer(n,r,e.FLOAT,!1,0,0)}function Pe(e,t,n){var r=e.createProgram(),o=Ee(e,e.VERTEX_SHADER,t),i=Ee(e,e.FRAGMENT_SHADER,n);if(e.attachShader(r,o),e.attachShader(r,i),e.linkProgram(r),!e.getProgramParameter(r,e.LINK_STATUS))throw new Error(e.getProgramInfoLog(r));var a,s={program:r,unload:d},u=e.getProgramParameter(r,e.ACTIVE_ATTRIBUTES);for(a=0;a<u;a++){var c=e.getActiveAttrib(r,a);s[c.name]=e.getAttribLocation(r,c.name)}var l=e.getProgramParameter(r,e.ACTIVE_UNIFORMS);for(a=0;a<l;a++){var f=e.getActiveUniform(r,a);s[f.name]=e.getUniformLocation(r,f.name)}return s;function d(){e.deleteProgram(r)}}function Ee(e,t,n){var r=e.createShader(t);if(e.shaderSource(r,n),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS))throw new Error(e.getShaderInfoLog(r));return r}var Se=n("sa50"),ke=n.n(Se),Ce=n("3zJd"),Me=n.n(Ce),Re={UNIFORM:1,VELOCITY:2,ANGLE:3,CUSTOM:4};function Oe(e){return"// p.x and p.y are current coordinates\n// v.x and v.y is a velocity at point p\nvec2 get_velocity(vec2 p) {\n  vec2 v = vec2(0., 0.);\n\n  // change this to get a new vector field\n  ".concat(e,"\n\n  return v;\n}")}function Fe(){return window.innerWidth<600}var Ae,Ne=Me()({},{useSearch:!0,rewriteHashToSearch:!0}),De={},Be=Oe("v.x = 0.1 * p.y;\n  v.y = -0.2 * p.y;"),Ie={timeStep:.01,dropProbability:.009,particleCount:1e4,fadeout:.998,colorMode:Re.UNIFORM},Ue={collapsed:Fe()},je={settingsPanel:Ue,saveBBox:et,getBBox:Ke,makeBBox:$e,getQS:function(){return Ne},saveCode:rt,getCode:tt,getDefaultCode:nt,getDropProbability:Je,setDropProbability:Ze,getIntegrationTimeStep:He,setIntegrationTimeStep:Qe,getParticleCount:Ve,setParticleCount:qe,getFadeout:ze,setFadeout:We,getColorMode:Le,setColorMode:Ge,getColorFunction:Xe,setColorFunction:Ye};function Le(){var e=Ne.get("cm");return ot(e)?e:Ie.colorMode}function Ge(e){ot(e)&&(De.cm=e)}function Xe(){var e=Ne.get("cf");return e||""}function Ye(e){De.cf=e}function ze(){var e=Ne.get("fo");return ot(e)?e:Ie.fadeout}function We(e){ot(e)&&(De.fo=e)}function Ve(){var e=Ne.get("pc");return ot(e)?e:Ie.particleCount}function qe(e){ot(e)&&(De.pc=e)}function He(){var e=Ne.get("dt");return ot(e)?e:Ie.timeStep}function Qe(e){ot(e)&&(De.dt=e)}function Je(){var e=Ne.get("dp");return ot(e)?e:Ie.dropProbability}function Ze(e){ot(e)&&it(e,0,1)}function Ke(){var e=Ne.get("cx"),t=Ne.get("cy"),n=Ne.get("w"),r=Ne.get("h");return $e(e,t,n,r)}function $e(e,t,n,r){var o=ot(e)&&ot(t)&&ot(n)&&ot(r);if(o){var i=n/2,a=r/2,s=1e4;return{minX:Math.round(s*(e-i))/s,maxX:Math.round(s*(e+i))/s,minY:Math.round(s*(t-a))/s,maxY:Math.round(s*(t+a))/s}}}function et(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];e={cx:.5*(e.minX+e.maxX),cy:.5*(e.minY+e.maxY),w:e.maxX-e.minX,h:e.maxX-e.minX},e.w<=0||e.h<=0||(De.cx=e.cx,De.cy=e.cy,De.w=e.w,De.h=e.h,Ae?(clearTimeout(Ae),Ae=0):Ae=setTimeout(function(){Ae=0},300))}function tt(){var e=Ne.get("vf");if(e)return e;var t=Ne.get("code");return t?(e=Oe(t),delete De.code,e):Be}function nt(){return Be}function rt(e){De.code=e}function ot(e){return Number.isFinite(e)}function it(e,t,n){return e<t?t:e>n?n:e}Ne.onChange(function(){ke.a.fire("scene-ready",window.scene)});var at={dx:0,dy:0,scale:1};function st(e){var t,n,r=e.gl,o=e.canvasRect,i={dx:0,dy:0,scale:1},a=null;f();var s=ye.createProgram(r,ut(),ct()),u={fadeOutLastFrame:c,renderCurrentScreen:l,updateScreenTextures:f,boundingBoxUpdated:!1};return u;function c(){ye.bindFramebuffer(r,e.framebuffer,t),r.viewport(0,0,o.width,o.height),u.boundingBoxUpdated&&a?(i.dx=-(e.bbox.minX-a.minX)/(e.bbox.maxX-e.bbox.minX),i.dy=-(e.bbox.minY-a.minY)/(e.bbox.maxY-e.bbox.minY),i.scale=(e.bbox.maxX-e.bbox.minX)/(a.maxX-a.minX),p(n,e.fadeOpacity,i)):p(n,e.fadeOpacity,at)}function l(){ye.bindFramebuffer(r,null),d(),r.enable(r.BLEND),r.blendFunc(r.SRC_ALPHA,r.DST_ALPHA),r.clearColor(e.backgroundColor.r,e.backgroundColor.g,e.backgroundColor.b,e.backgroundColor.a),r.clear(r.COLOR_BUFFER_BIT),p(t,1,at),r.disable(r.BLEND);var o=n;n=t,t=o,u.boundingBoxUpdated=!1,window.audioTexture&&p(window.audioTexture,1,at)}function f(){var e=o.width,i=o.height,a=new Uint8Array(e*i*4);t&&r.deleteTexture(t),n&&r.deleteTexture(n),t=ye.createTexture(r,r.NEAREST,a,e,i),n=ye.createTexture(r,r.NEAREST,a,e,i)}function d(){a?(a.minX=e.bbox.minX,a.minY=e.bbox.minY,a.maxX=e.bbox.maxX,a.maxY=e.bbox.maxY):a={minX:e.bbox.minX,minY:e.bbox.minY,maxX:e.bbox.maxX,maxY:e.bbox.maxY}}function p(t,n,o){var i=s;r.useProgram(i.program),ye.bindAttribute(r,e.quadBuffer,i.a_pos,2),ye.bindTexture(r,t,e.screenTextureUnit),r.uniform1i(i.u_screen,e.screenTextureUnit),r.uniform1f(i.u_opacity_border,.02),r.uniform1f(i.u_opacity,n),r.uniform3f(i.u_transform,o.dx,o.dy,o.scale),r.drawArrays(r.TRIANGLES,0,6)}}function ut(){return"// screen program\nprecision highp float;\n\nattribute vec2 a_pos;\nvarying vec2 v_tex_pos;\nuniform vec3 u_transform;\n\nvoid main() {\n    v_tex_pos = a_pos;\n    vec2 pos = a_pos;\n\n    // This transformation tries to move texture (raster) to the approximate position\n    // of particles on the current frame. This is needed to avoid rendering artifacts\n    // during pan/zoom: https://computergraphics.stackexchange.com/questions/5754/fading-particles-and-transition\n\n    // PS: I must admit, I wrote this formula through sweat and tears, and\n    // I still have no idea why I don't need to apply (pos.y - 0.5) to Y coordinate.\n    // Is it because I use aspect ratio for bounding box?\n    pos.x = (pos.x - 0.5) / u_transform.z - u_transform.x + 0.5 * u_transform.z;\n    pos.y = pos.y / u_transform.z + u_transform.y;\n\n    pos = 1.0 - 2.0 * pos;\n    gl_Position = vec4(pos, 0, 1);\n}"}function ct(){return"precision highp float;\nuniform sampler2D u_screen;\nuniform float u_opacity;\nuniform float u_opacity_border;\n\nvarying vec2 v_tex_pos;\n\nvoid main() {\n  vec2 p = 1.0 - v_tex_pos;\n  vec4 color = texture2D(u_screen, p);\n\n  gl_FragColor = vec4(floor(255.0 * color * u_opacity) / 255.0);\n}"}var lt="\nhighp float decodeFloatRGBA( vec4 v ) {\n  float a = floor(v.r * 255.0 + 0.5);\n  float b = floor(v.g * 255.0 + 0.5);\n  float c = floor(v.b * 255.0 + 0.5);\n  float d = floor(v.a * 255.0 + 0.5);\n\n  float exponent = a - 127.0;\n  float sign = 1.0 - mod(d, 2.0)*2.0;\n  float mantissa = float(a > 0.0)\n                  + b / 256.0\n                  + c / 65536.0\n                  + floor(d / 2.0) / 8388608.0;\n  return sign * mantissa * exp2(exponent);\n}\n",ft=lt,dt=function(){function e(){i()(this,e)}return v()(e,[{key:"getDefines",value:function(){return""}},{key:"getFunctions",value:function(){return""}},{key:"getMainBody",value:function(){return""}}]),e}(),pt="\nvec3 mod289(vec3 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec2 mod289(vec2 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec3 permute(vec3 x) {\n  return mod289(((x*34.0)+1.0)*x);\n}\n\nfloat snoise(vec2 v)\n  {\n  const vec4 C = vec4(0.211324865405187,  // (3.0-sqrt(3.0))/6.0\n                      0.366025403784439,  // 0.5*(sqrt(3.0)-1.0)\n                     -0.577350269189626,  // -1.0 + 2.0 * C.x\n                      0.024390243902439); // 1.0 / 41.0\n// First corner\n  vec2 i  = floor(v + dot(v, C.yy) );\n  vec2 x0 = v -   i + dot(i, C.xx);\n\n// Other corners\n  vec2 i1;\n  //i1.x = step( x0.y, x0.x ); // x0.x > x0.y ? 1.0 : 0.0\n  //i1.y = 1.0 - i1.x;\n  i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\n  // x0 = x0 - 0.0 + 0.0 * C.xx ;\n  // x1 = x0 - i1 + 1.0 * C.xx ;\n  // x2 = x0 - 1.0 + 2.0 * C.xx ;\n  vec4 x12 = x0.xyxy + C.xxzz;\n  x12.xy -= i1;\n\n// Permutations\n  i = mod289(i); // Avoid truncation effects in permutation\n  vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 ))\n\t\t+ i.x + vec3(0.0, i1.x, 1.0 ));\n\n  vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);\n  m = m*m ;\n  m = m*m ;\n\n// Gradients: 41 points uniformly over a line, mapped onto a diamond.\n// The ring size 17*17 = 289 is close to a multiple of 41 (41*7 = 287)\n\n  vec3 x = 2.0 * fract(p * C.www) - 1.0;\n  vec3 h = abs(x) - 0.5;\n  vec3 ox = floor(x + 0.5);\n  vec3 a0 = x - ox;\n\n// Normalise gradients implicitly by scaling m\n// Approximation of: m *= inversesqrt( a0*a0 + h*h );\n  m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );\n\n// Compute final noise value at P\n  vec3 g;\n  g.x  = a0.x  * x0.x  + h.x  * x0.y;\n  g.yz = a0.yz * x12.xz + h.yz * x12.yw;\n  return 130.0 * dot(m, g);\n}\n",ht=pt;function mt(){return"uniform sampler2D input0;\nuniform sampler2D input1;"}var vt=function(e){function t(e){var n;return i()(this,t),n=s()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),n.updateCode=e||"",n}return c()(t,e),v()(t,[{key:"setNewUpdateCode",value:function(e){this.updateCode=e}},{key:"getDefines",value:function(){return"\nuniform float frame;\nuniform vec4 cursor;\n// TODO: use inputN instead.\nuniform sampler2D u_audio;\n\n#define PI 3.1415926535897932384626433832795\n\n".concat(mt(),"\n")}},{key:"getFunctions",value:function(){return"\n    // pseudo-random generator\nconst vec3 rand_constants = vec3(12.9898, 78.233, 4375.85453);\nfloat rand(const vec2 co) {\n    float t = dot(rand_constants.xy, co);\n    return fract(sin(t) * (rand_constants.z + t));\n}\n\n".concat(ht,"\n\nvec2 rotate(vec2 p,float a) {\n\treturn cos(a)*p+sin(a)*vec2(p.y,-p.x);\n}\n\n// TODO: This will change. Don't use it.\nfloat audio(float index) {\n  float rgbI = floor(index/4.);\n  vec2 txPos = vec2(fract(rgbI / 5.), floor(rgbI / 5.) / 5.);\n  vec4 rgba = texture2D(u_audio, txPos);\n  \n  float offset = mod(index, 4.);\n  if (offset == 0.) return rgba[0];\n  if (offset == 1.) return rgba[1];\n  if (offset == 2.) return rgba[2];\n  return rgba[3];\n}\n\n").concat(this.updateCode?this.updateCode:"vec2 get_velocity(vec2 p) { return vec2(0.); }","\n  ")}}]),t}(dt),gt=function(e){function t(){return i()(this,t),s()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return c()(t,e),v()(t,[{key:"getDefines",value:function(){return"\nuniform float u_h;\n"}},{key:"getFunctions",value:function(){return"\nvec2 rk4(const vec2 point) {\n  vec2 k1 = get_velocity( point );\n  vec2 k2 = get_velocity( point + k1 * u_h * 0.5);\n  vec2 k3 = get_velocity( point + k2 * u_h * 0.5);\n  vec2 k4 = get_velocity( point + k3 * u_h);\n\n  return k1 * u_h / 6. + k2 * u_h/3. + k3 * u_h/3. + k4 * u_h/6.;\n}"}},{key:"getMainBody",value:function(){return"\n  vec2 velocity = rk4(pos);\n"}}]),t}(dt);function yt(e,t,n){var r=new vt(t),o=new gt;return{getVariables:i,getMain:u,getMethods:a};function i(){return"\nuniform vec2 u_velocity_range;\nvarying vec4 v_particle_color;\n\n".concat(r.getDefines(),"\n").concat(o.getDefines(),"\n")}function a(){return"\n// https://github.com/hughsk/glsl-hsv2rgb\nvec3 hsv2rgb(vec3 c) {\n  vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n  vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n  return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\n\n".concat(r.getFunctions(),"\n").concat(o.getFunctions(),"\n").concat(s(),"\n")}function s(){if(e===Re.UNIFORM)return"\nvec4 get_color(vec2 p) {\n  return vec4(0.302, 0.737, 0.788, 1.);\n}\n";if(e===Re.VELOCITY)return n||"\n        vec4 get_color(vec2 p) {\n          vec2 velocity = get_velocity(p);\n          float speed = (length(velocity) - u_velocity_range[0])/(u_velocity_range[1] - u_velocity_range[0]);\n          float hue = 0.05 + (1. - speed) * 0.5;\n          return vec4(hsv2rgb(vec3(hue, 0.9, 1.)), 1.0);\n        }\n      ";if(e===Re.CUSTOM){if(!n)throw new Error("color mode is set to custom, but no color function is specified");return n}return" \nvec4 get_color(vec2 p) {\n  vec2 velocity = get_velocity(p);\n  float speed = (atan(velocity.y, velocity.x) + PI)/(2.0 * PI);\n  return vec4(hsv2rgb(vec3(speed, 0.9, 1.)), 1.0);\n}\n"}function u(){return"  v_particle_color = get_color(v_particle_pos);"}}var bt=function(){function e(t){i()(this,e),this.colorMode=t.colorMode,this.colorFunction=t.colorFunction||""}return v()(e,[{key:"getFragmentShader",value:function(){return"precision highp float;\nvarying vec4 v_particle_color;\nvoid main() {\n  gl_FragColor = v_particle_color;\n}"}},{key:"getVertexShader",value:function(e){var t=wt(),n=yt(this.colorMode,e,this.colorFunction),r=[];_t(t,r),_t(n,r);var o=[];return xt(t,o),xt(n,o),"precision highp float;\nattribute float a_index;\nuniform float u_particles_res;\nuniform vec2 u_min;\nuniform vec2 u_max;\n\n".concat(t.getVariables()||"","\n").concat(n.getVariables(),"\n\n").concat(ft,"\n\n").concat(r.join("\n"),"\n\nvoid main() {\n  vec2 txPos = vec2(\n        fract(a_index / u_particles_res),\n        floor(a_index / u_particles_res) / u_particles_res);\n  gl_PointSize = 1.0;\n\n").concat(o.join("\n"),"\n\n  vec2 du = (u_max - u_min);\n  v_particle_pos = (v_particle_pos - u_min)/du;\n  gl_Position = vec4(2.0 * v_particle_pos.x - 1.0, (1. - 2. * (v_particle_pos.y)),  0., 1.);\n}")}}]),e}();function _t(e,t){e.getMethods&&t.push(e.getMethods())}function xt(e,t){e.getMain&&t.push(e.getMain())}function wt(){return{getVariables:e,getMain:t};function e(){return"\nuniform sampler2D u_particles_x;\nuniform sampler2D u_particles_y;\n    "}function t(){return"\n  vec2 v_particle_pos = vec2(\n    decodeFloatRGBA(texture2D(u_particles_x, txPos)),\n    decodeFloatRGBA(texture2D(u_particles_y, txPos))\n  );\n"}}var Tt="\nvec4 encodeFloatRGBA(highp float val) {\n    if (val == 0.0) {\n        return vec4(0.0, 0.0, 0.0, 0.0);\n    }\n\n    float mag = abs(val);\n    float exponent = floor(log2(mag));\n    // Correct log2 approximation errors.\n    exponent += float(exp2(exponent) <= mag / 2.0);\n    exponent -= float(exp2(exponent) > mag);\n\n    float mantissa;\n    if (exponent > 100.0) {\n        // Not sure why this needs to be done in two steps for the largest float to work.\n        // Best guess is the optimizer rewriting '/ exp2(e)' into '* exp2(-e)',\n        // but exp2(-128.0) is too small to represent.\n        mantissa = mag / 1024.0 / exp2(exponent - 10.0) - 1.0;\n    } else {\n        mantissa = mag / float(exp2(exponent)) - 1.0;\n    }\n\n    float a = exponent + 127.0;\n    mantissa *= 256.0;\n    float b = floor(mantissa);\n    mantissa -= b;\n    mantissa *= 256.0;\n    float c = floor(mantissa);\n    mantissa -= c;\n    mantissa *= 128.0;\n    float d = floor(mantissa) * 2.0 + float(val < 0.0);\n    return vec4(a, b, c, d) / 255.0;\n}\n",Pt=Tt,Et=function(e){function t(e){var n;return i()(this,t),n=s()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),n.isDecode=e,n}return c()(t,e),v()(t,[{key:"getFunctions",value:function(){if(this.isDecode)return"\n    ".concat(Pt,"\n    ").concat(ft,"\n")}},{key:"getDefines",value:function(){if(this.isDecode)return"\nprecision highp float;\n\nuniform sampler2D u_particles_x;\nuniform sampler2D u_particles_y;\n\n// Which coordinate needs to be printed onto the texture\nuniform int u_out_coordinate;\n\nvarying vec2 v_tex_pos;\n"}},{key:"getMainBody",value:function(){return this.isDecode?"\n   vec2 pos = vec2(\n     decodeFloatRGBA(texture2D(u_particles_x, v_tex_pos)),\n     decodeFloatRGBA(texture2D(u_particles_y, v_tex_pos))\n   );\n":"\n    if (u_out_coordinate == 0) gl_FragColor = encodeFloatRGBA(newPos.x);\n    else if (u_out_coordinate == 1) gl_FragColor = encodeFloatRGBA(newPos.y);\n    else if (u_out_coordinate == 6) gl_FragColor = encodeFloatRGBA(get_velocity(pos).x);\n    else if (u_out_coordinate == 7) gl_FragColor = encodeFloatRGBA(get_velocity(pos).y);\n"}}]),t}(dt);function St(e){var t=[];return e.forEach(function(e){e.getDefines&&n(e.getDefines())}),e.forEach(function(e){e.getFunctions&&n(e.getFunctions())}),n("void main() {"),e.forEach(function(e){e.getMainBody&&n(e.getMainBody())}),n("}"),t.join("\n");function n(e){e&&t.push(e)}}var kt=function(e){function t(e){var n;return i()(this,t),n=s()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),n.decode=e&&e.decode,n.srcPosName=e&&e.posName||"pos",n}return c()(t,e),v()(t,[{key:"getDefines",value:function(){if(this.decode)return"\n  uniform vec2 u_min;\n  uniform vec2 u_max;\n"}},{key:"getMainBody",value:function(){return this.decode?"\n  // move particle position according to current transform\n  vec2 du = (u_max - u_min);\n  pos.x = ".concat(this.srcPosName,".x * du.x + u_min.x;\n  pos.y = ").concat(this.srcPosName,".y * du.y + u_min.y;\n"):"\n  pos.x = (".concat(this.srcPosName,".x - u_min.x)/du.x;\n  pos.y = (").concat(this.srcPosName,".y - u_min.y)/du.y;\n")}}]),t}(dt),Ct=function(){function e(t){i()(this,e),this.readStoredPosition=new Et(!0),this.udfVelocity=new vt,this.integratePositions=new gt,this.dropParticles=new Mt,this.writeComputedPosition=new Et(!1),this.panZoomDecode=new kt({decode:!0}),this.panZoomEncode=new kt({decode:!1}),this.colorMode=t&&t.colorMode}return v()(e,[{key:"setCustomVectorField",value:function(e){this.udfVelocity.setNewUpdateCode(e)}},{key:"getVertexShader",value:function(){return"precision highp float;\n\nattribute vec2 a_pos;\nvarying vec2 v_tex_pos;\nuniform vec2 u_min;\nuniform vec2 u_max;\n\nvoid main() {\n    v_tex_pos = a_pos;\n    gl_Position = vec4(1.0 - 2.0 * a_pos, 0, 1);\n}"}},{key:"getFragmentShader",value:function(){var e=[this.readStoredPosition,this.dropParticles,this.udfVelocity,this.integratePositions,{getMainBody:function(){return"\n  vec2 newPos = pos + velocity;\n  "}},this.writeComputedPosition];return St(e)}}]),e}(),Mt=function(e){function t(){return i()(this,t),s()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return c()(t,e),v()(t,[{key:"getDefines",value:function(){return"\nuniform float u_drop_rate;\nuniform float u_rand_seed;\nuniform vec2 u_min;\nuniform vec2 u_max;\n"}},{key:"getFunctions",value:function(){return"\n"}},{key:"getMainBody",value:function(){return"\n  // a random seed to use for the particle drop\n  vec2 seed = (pos + v_tex_pos) * u_rand_seed;\n  // drop rate is a chance a particle will restart at random position, to avoid degeneration\n  float drop = step(1.0 - u_drop_rate, rand(seed));\n\n  // TODO: This can be customized to produce various emitters\n  // random_pos is in range from 0..1, we move it to the bounding box:\n  vec2 random_pos = vec2(rand(seed + 1.9), rand(seed + 8.4)) * (u_max - u_min) + u_min;\n  pos = mix(pos, random_pos, drop);\n"}}]),t}(dt);n("N4KQ");function Rt(e,t,n){if(0==e)return t[n+0]=0,t[n+1]=0,t[n+2]=0,void(t[n+3]=0);var r,o=Math.abs(e),i=Math.floor(Math.log2(o));i+=Ft(i)<=o/2?1:0,i-=Ft(i)>o?1:0,r=i>100?o/1024/Ft(i-10)-1:o/Ft(i)-1;var a=i+127;r*=256;var s=Math.floor(r);r-=s,r*=256;var u=Math.floor(r);r-=u,r*=128;var c=2*Math.floor(r)+(e<0?1:0);t[n+0]=a,t[n+1]=s,t[n+2]=u,t[n+3]=c}function Ot(e,t,n,r){var o=Math.floor(e+.5),i=Math.floor(t+.5),a=Math.floor(n+.5),s=Math.floor(r+.5),u=o-127,c=1-s%2*2,l=(o>0?1:0)+i/256+a/65536+Math.floor(s/2)/8388608;return c*l*Ft(u)}function Ft(e){return Math.exp(e*Math.LN2)}function At(){var e,t,n={getMin:function(){return e},getMax:function(){return t},add:function(n){n<e&&(e=n),n>t&&(t=n)},reset:r};return n;function r(){e=Number.POSITIVE_INFINITY,t=Number.NEGATIVE_INFINITY}}var Nt=6,Dt=7;function Bt(e){var t,n,r,o,i,a,s,u=!0,c=e.gl,l=At();return f(),{updateCode:g,updateParticlesPositions:y,updateParticlesCount:v,setColorMinMax:m,requestSpeedUpdate:h,dispose:d};function f(){ke.a.on("integration-timestep-changed",h),ke.a.on("bbox-change",h),ke.a.on("refresh-speed",h)}function d(){ke.a.off("integration-timestep-changed",h),ke.a.off("bbox-change",h),ke.a.off("refresh-speed",h),p()}function p(){n&&c.deleteTexture(n),t&&c.deleteTexture(t)}function h(){o&&clearTimeout(o),o=setTimeout(function(){u=!0,o=0},50)}function m(e){c.uniform2f(e.u_velocity_range,l.getMin(),l.getMax())}function v(){p(),r=e.particleStateResolution,i=r*r,a=new Uint8Array(4*i),s=new Uint8Array(4*i),n=ye.createTexture(c,c.NEAREST,a,r,r),t=ye.createTexture(c,c.NEAREST,s,r,r),h()}function g(){h()}function y(o){u&&a&&s&&(u=!1,ye.bindFramebuffer(c,e.framebuffer,n),c.uniform1i(o.u_out_coordinate,Nt),c.drawArrays(c.TRIANGLES,0,6),c.readPixels(0,0,r,r,c.RGBA,c.UNSIGNED_BYTE,a),ye.bindFramebuffer(c,e.framebuffer,t),c.uniform1i(o.u_out_coordinate,Dt),c.drawArrays(c.TRIANGLES,0,6),c.readPixels(0,0,r,r,c.RGBA,c.UNSIGNED_BYTE,s),b())}function b(){l.reset();for(var e=0;e<s.length;e+=4){var t=It(a,e),n=It(s,e),r=Math.sqrt(t*t+n*n);l.add(r)}}}function It(e,t){return Ot(e[t+0],e[t+1],e[t+2],e[t+3])}function Ut(e,t,n){var r=t.map(function(t,r){var o={texture:ye.createTexture(e,e.NEAREST,t.particleState,n,n),index:r,name:t.name};return o});return{dispose:i,bindTextures:a,assignProgramUniforms:o,length:t.length,textures:r,get:function(e){return r[e]}};function o(t){r.forEach(function(n){e.uniform1i(t["u_particles_"+n.name],n.index)})}function i(){r.forEach(function(t){return e.deleteTexture(t.texture)})}function a(e,t){r.forEach(function(n){ye.bindTexture(e,n.texture,n.index),e.uniform1i(t["u_particles_"+n.name],n.index)})}}var jt=new Ct;function Lt(e){var t,n,r,o,i,a=e.gl,s=Bt(e);return ke.a.on("vector-lines-request",d),{updateCode:u,updateParticlesPositions:f,updateParticlesCount:c,prepareToDraw:l};function u(t){jt.setCustomVectorField(t);var n=jt.getFragmentShader(),r=jt.getVertexShader(),i=ye.createProgram(a,r,n);o&&o.unload(),o=i,e.colorMode===Re.VELOCITY&&s.requestSpeedUpdate()}function c(o,i){r=e.particleStateResolution;var u=[{name:"x",particleState:o},{name:"y",particleState:i}];t&&t.dispose(),t=Ut(a,u,r),n&&n.dispose(),n=Ut(a,u,r),s.updateParticlesCount()}function l(n){var r=e.colorMode;r===Re.VELOCITY&&s.setColorMinMax(n),t.bindTextures(a,n)}function f(){var u=o;a.useProgram(u.program),ye.bindAttribute(a,e.quadBuffer,u.a_pos,2),e.inputs.updateBindings(u),e.audioTexture&&(ye.bindTexture(a,e.audioTexture,5),a.uniform1i(u["u_audio"],5)),t.bindTextures(a,u),a.uniform1f(u.u_rand_seed,e.frameSeed),a.uniform1f(u.u_h,e.integrationTimeStep),a.uniform1f(u.frame,e.frame);var c=e.cursor;a.uniform4f(u.cursor,c.clickX,c.clickY,c.hoverX,c.hoverY);var l=e.bbox;a.uniform2f(u.u_min,l.minX,l.minY),a.uniform2f(u.u_max,l.maxX,l.maxY),a.uniform1f(u.u_drop_rate,e.dropProbability);for(var f=0;f<n.length;++f){var d=n.get(f);a.uniform1i(u.u_out_coordinate,f),ye.bindFramebuffer(a,e.framebuffer,d.texture),a.viewport(0,0,r,r),a.drawArrays(a.TRIANGLES,0,6)}e.colorMode===Re.VELOCITY&&s.updateParticlesPositions(u),i&&(p(u),i=null);var h=t;t=n,n=h}function d(e){i=e}function p(t){var n=[{name:"x",particleState:i.x},{name:"y",particleState:i.y}],r=i.resolution,o=r*r,s=Ut(a,n,r),u=Ut(a,n,r);s.bindTextures(a,t);var c=u.get(0);a.uniform1i(t.u_out_coordinate,6),ye.bindFramebuffer(a,e.framebuffer,c.texture),a.viewport(0,0,r,r),a.drawArrays(a.TRIANGLES,0,6);var l=new Uint8Array(4*o);a.readPixels(0,0,r,r,a.RGBA,a.UNSIGNED_BYTE,l),a.uniform1i(t.u_out_coordinate,7),c=u.get(1),ye.bindFramebuffer(a,e.framebuffer,c.texture),a.viewport(0,0,r,r),a.drawArrays(a.TRIANGLES,0,6);var f=new Uint8Array(4*o);a.readPixels(0,0,r,r,a.RGBA,a.UNSIGNED_BYTE,f),u.dispose(),s.dispose();for(var d=At(),p=At(),h=new Float32Array(o),m=new Float32Array(o),v=0;v<f.length;v+=4){var g=v/4,y=Gt(l,v),b=Gt(f,v);h[g]=y,m[g]=b,d.add(y),p.add(b)}var _={xStats:d,yStats:p,decoded_velocity_x:h,decoded_velocity_y:m,resolution:r};ke.a.fire("vector-line-ready",_)}}function Gt(e,t){return Ot(e[t+0],e[t+1],e[t+2],e[t+3])}var Xt={isAudioEnabled:!1,vectorLinesEnabled:!1,FREE_TEXTURE_UNIT:4,showBindings:je.getQS().get("showBindings")||!1},Yt=Xt,zt=Wt;function Wt(e){var t=e.gl,n=8,r=8,o=new Uint8Array(n*r*4),i=ye.createTexture(t,t.NEAREST,o,n,r),a=!1;return e.audioTexture=i,ke.a.on("audio",c),{updateTextures:u,dispose:s};function s(){ke.a.off("audio",c),t.deleteTexture(i)}function u(){if(a){a=!1;var e=5,n=5;t.bindTexture(t.TEXTURE_2D,i),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,e,n,0,t.RGBA,t.UNSIGNED_BYTE,o),t.bindTexture(t.TEXTURE_2D,null)}}function c(e){o=e,a=!0}}function Vt(e){var t,n,r,o,i,a=e.gl,s="",u=Lt(e);return c(),{updateParticlesCount:h,updateParticlesPositions:f,drawParticles:m,updateCode:p,updateColorMode:d};function c(){l(),Yt.isAudioEnabled&&(o&&o.dispose(),o=zt(e))}function l(){i&&i.unload();var t=new bt(e),n=t.getVertexShader(s);i=ye.createProgram(a,n,t.getFragmentShader())}function f(){s&&(e.frame+=1,e.frameSeed=Math.random(),o&&o.updateTextures(),u.updateParticlesPositions())}function d(){l()}function p(t){e.frame=0,s=t,u.updateCode(t),l()}function h(){t=e.particleStateResolution,r=t*t;for(var o=new Float32Array(r),i=new Uint8Array(4*r),s=new Uint8Array(4*r),c=e.bbox.minX,l=e.bbox.minY,f=e.bbox.maxX-c,d=e.bbox.maxY-l,p=0;p<r;p++)Rt(Math.random()*f+c,i,4*p),Rt(Math.random()*d+l,s,4*p),o[p]=p;n&&a.deleteBuffer(n),n=ye.createBuffer(a,o),u.updateParticlesCount(i,s)}function m(){if(s){var o=i;a.useProgram(o.program),ye.bindAttribute(a,n,o.a_index,1),u.prepareToDraw(o),e.inputs.updateBindings(o),a.uniform1f(o.u_h,e.integrationTimeStep),a.uniform1f(o.frame,e.frame),a.uniform1f(o.u_particles_res,t);var c=e.bbox;a.uniform2f(o.u_min,c.minX,c.minY),a.uniform2f(o.u_max,c.maxX,c.maxY);var l=e.cursor;a.uniform4f(o.cursor,l.clickX,l.clickY,l.hoverX,l.hoverY),a.drawArrays(a.POINTS,0,r)}}}n("mJx5"),n("fx22"),n("MsuQ");function qt(e,t){return t||(t={}),new Promise(n);function n(n,r){var o=new XMLHttpRequest;function i(e){e.lengthComputable&&t.progress({loaded:e.loaded,total:e.total,percent:e.loaded/e.total})}function a(){if(200===o.status){var i=o.response;"json"===t.responseType&&"string"===typeof i&&(i=JSON.parse(i)),n(i)}else r("Unexpected status code ".concat(o.status," when calling ").concat(e))}function s(){r("Failed to download ".concat(e))}function u(){r("Cancelled download of ".concat(e))}"function"===typeof t.progress&&o.addEventListener("progress",i,!1),o.addEventListener("load",a,!1),o.addEventListener("error",s,!1),o.addEventListener("abort",u,!1),o.open("GET",e),t.responseType&&(o.responseType=t.responseType),o.send(null)}}var Ht=new Map;function Qt(e){if(!e)return Promise.reject("Missing link");var t=e.trim();if(!t)return Promise.reject("Missing link");var n=Ht.get(t);return n?Promise.resolve(n):qt(e).then(function(t){return Ht.set(e,t),t})}var Jt="#include ",Zt={code:""};function Kt(e){if(!e)return new Promise(function(e){return e(Zt)});var t=$t(e);return t.pending.length>0?Promise.all(t.pending).then(function(){return t}).catch(function(e){return{error:{error:e}}}):new Promise(function(e){return e(t)})}function $t(e){var t=[],n=e.split("\n"),r=[],o=0;return n.forEach(function(e,t){o=t,e&&"#"===e[0]?(r.push(""),a(e)):r.push(e)}),{getCode:i,pending:t};function i(){return r.join("\n")}function a(e){if(0===e.indexOf(Jt)){var n=e.substr(Jt.length),i=o;t.push(Qt(n).then(function(e){r[i]=e}))}}}var en={check:function(e){return{code:e,log:{errorCount:0}}}};n.e(0).then(function(){en=n("TFw8"),ke.a.fire("glsl-parser-ready")}.bind(null,n)).catch(n.oe);var tn="\nimport {\n  float PI;\n  float snoise(vec2 v);\n  float frame;\n  vec4 cursor;\n  vec2 rotate(vec2 p,float a);\n  float audio(float index);\n  float rand(const vec2 co);\n  sampler2D input0;\n  sampler2D input1;\n}";function nn(e){return Kt(e).then(function(t){if(t.error)return t;e=t.getCode();var n=en.check(e,{globals:tn});return n.code=e,n.log.errorCount&&(n.error=rn(n.log)),n})}function rn(e){var t=e.diagnostics[0],n=t.range,r=n.lineColumn(),o=n.source,i=o._lineOffsets[r.line],a=o.contents.substr(i,r.column);a+=o.contents.substring(n.start,n.end);var s="Line "+r.line+": ",u=t.text;return{error:s+a+"\n"+an(s.length)+an(r.column)+"^",errorDetail:u,isFloatError:on(u)}}function on(e){return e.indexOf('"int"')>-1&&e.indexOf('"float"')>-1}function an(e){return new Array(e+1).join(" ")}function sn(e){ke.a.on("glsl-parser-ready",l);var t,n=0,r=je.getCode();c();var o={getCode:a,setCode:s,dispose:i,code:r,error:"",errorDetail:"",isFloatError:!1};return o;function i(){ke.a.off("glsl-parser-ready",l)}function a(){return je.getCode()}function s(e){e!==r?f(e).then(function(t){if(!t.cancelled){if(t&&t.error)return u(t.error),t;r=e,o.code=e,je.saveCode(e)}}):t&&t.error&&l()}function u(e){e&&e.error?(o.error=e.error,o.errorDetail=e.errorDetail,o.isFloatError=e.isFloatError):(o.error="",o.errorDetail="",o.isFloatError=!1)}function c(){var e=je.getCode();e?f(e).then(function(e){e.error&&(console.error("Failed to restore previous vector field: ",e.error),f(je.getDefaultCode()))}):f(je.getDefaultCode())}function l(e){return nn(e||r).then(function(e){return t=e,u(t.error),t})}function f(t){n+=1;var r=n;return l(t).then(function(t){if(r!==n)return t.cancelled=!0,t;if(t.error)return t;try{return e.updateCode(t.code),t}catch(e){return{error:{error:e.message}}}})}}function un(){var e,t=new Map;return{updateBindings:r,bindInput:n};function n(e,n){var r=t.get(e);r&&r.dispose(),t.set(e,n)}function r(n){e=n,t.forEach(o)}function o(t,n){t.updateBinding(e,n)}}function cn(e,t){var n,r,o=new Image;return o.crossOrigin="",o.onload=a,o.onerror=i,o.src=t,new Promise(function(e,t){n=e,r=t});function i(e){r(e)}function a(){var t=e.createTexture(),r=0,i=e.RGBA,a=e.RGBA,s=e.UNSIGNED_BYTE;e.bindTexture(e.TEXTURE_2D,t),e.texImage2D(e.TEXTURE_2D,r,i,a,s,o),ln(o.width)&&ln(o.height)?e.generateMipmap(e.TEXTURE_2D):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR)),n(t)}}function ln(e){return 0==(e&e-1)}var fn=Yt.FREE_TEXTURE_UNIT;function dn(e,t,n){var r=null;return cn(e.gl,t).then(i).catch(o),{updateBinding:a,dispose:function(){e.gl.deleteTexture(r)}};function o(e){n&&n.error&&n.error(e)}function i(e){r=e,ke.a.fire("refresh-speed"),n&&n.done&&n.done(t)}function a(t,n){if(r){var o=n+fn;ye.bindTexture(e.gl,r,o),e.gl.uniform1i(t["input".concat(n)],o)}}}function pn(e){e.inputs=un();var t=[];i();var n={getInputs:r,addInput:o};return n;function r(){return t}function o(n){var r=hn(e,n);return t.push(r),r}function i(){var e=je.getQS().get("i0");if(e){var t=o(0);t.link=e,t.updateBinding(!0)}}}function hn(e,t){var n=null,r={link:"",error:null,name:"input".concat(t),updateBinding:o};return r;function o(e){n&&(clearTimeout(n),n=null),e?i():n=setTimeout(i,300)}function i(){r.error=null,n=null;var o=dn(e,r.link,{done:function(){je.getQS().set("i".concat(t),r.link)},error:function(e){r.error=e}});e.inputs.bindInput(0,o)}}var mn=1;function vn(e){return.004*e}function gn(e){return 1-.002*e}function yn(e){var t={width:0,height:0,top:0,left:0};C(window.innerWidth,window.innerHeight),window.addEventListener("resize",k,!0);var n=je.getBBox()||{},r={scale:.1,x:window.innerWidth/2,y:window.innerHeight/2},o=je.getParticleCount();e.disable(e.DEPTH_TEST),e.disable(e.STENCIL_TEST);var i,a,s={gl:e,bbox:n,canvasRect:t,inputs:null,framebuffer:e.createFramebuffer(),quadBuffer:ye.createBuffer(e,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1])),colorMode:je.getColorMode(),colorFunction:je.getColorFunction(),screenTextureUnit:3,speed:mn,integrationTimeStep:vn(mn),dropProbability:je.getDropProbability(),frame:0,cursor:{clickX:0,clickY:0,hoverX:0,hoverY:0},particleStateResolution:0,fadeOpacity:gn(mn),backgroundColor:{r:0,g:0,b:0,a:1},audioTexture:null},u=!1,c=pn(s),l=st(s),f=Vt(s),d=sn(f);N(o);var p={start:R,stop:O,dispose:M,setPaused:_,getParticlesCount:T,setParticlesCount:P,setFadeOutSpeed:x,getFadeOutSpeed:w,setDropProbability:E,getDropProbability:S,getSpeed:y,setSpeed:b,setColorMode:h,getColorMode:m,setColorFunction:v,getColorFunction:g,vectorFieldEditorState:d,inputsModel:c,setBackgroundColor:I,getCanvasRect:function(){return t},getBoundingBox:function(){return s.bbox}};return D(),setTimeout(function(){ke.a.fire("scene-ready",p)}),p;function h(e){var t=parseInt(e,10);s.colorMode=t,f.updateColorMode(t)}function m(){return s.colorMode}function v(e){s.colorFunction=e,f.updateColorMode(s.colorMode)}function g(){return s.colorFunction}function y(){return s.speed}function b(e){var t=parseFloat(e);Number.isFinite(t)&&(s.speed=t,s.integrationTimeStep=vn(speed),s.fadeOpacity=gn(speed),ke.a.fire("integration-timestep-changed",s.integrationTimeStep))}function _(e){u=e,R()}function x(e){var t=parseFloat(e);Number.isFinite(t)&&(s.fadeOpacity=t,je.setFadeout(t))}function w(){return je.getFadeout()}function T(){return je.getParticleCount()}function P(e){Number.isFinite(e)&&e!==o&&(e<1||(N(e),o=e,je.setParticleCount(e)))}function E(e){var t=parseFloat(e);Number.isFinite(t)&&(je.setDropProbability(t),s.dropProbability=t)}function S(){return je.getDropProbability()}function k(){C(window.innerWidth,window.innerHeight),l.updateScreenTextures(),B()}function C(n,r){var o=Math.max(.02*n,30),i=Math.max(.02*r,30),a=n+2*o,s=r+2*i;t.width=window.devicePixelRatio*a,t.height=window.devicePixelRatio*s,t.top=-i,t.left=-o;var u=e.canvas;u.style.width=a+"px",u.style.height=s+"px",u.style.left=-o+"px",u.style.top=-i+"px",u.width=t.width,u.height=t.height}function M(){O(),window.removeEventListener("resize",k,!0),d.dispose()}function R(){i||u||(i=requestAnimationFrame(F),a=Date.now())}function O(){cancelAnimationFrame(i),i=0,a=void 0}function F(){if(i=0,a){var e=Date.now()-a,t=1e3/30/e,n=s.speed/Math.min(t,1);s.integrationTimeStep=vn(n),s.fadeOpacity=gn(n)}A(),R()}function A(){l.fadeOutLastFrame(),f.drawParticles(),l.renderCurrentScreen(),f.updateParticlesPositions()}function N(e){s.particleStateResolution=Math.ceil(Math.sqrt(e)),f.updateParticlesCount()}function D(){t.width,t.height,Math.PI,Math.E,Math.PI,Math.E;B()}function B(){l.boundingBoxUpdated=!0,r={scale:.1,x:window.innerWidth/2,y:window.innerHeight/2};var e=t.width,o=t.height;e/=window.devicePixelRatio,o/=window.devicePixelRatio;var i=f(0),a=d(0),s=f(e),u=d(o),c=1e4;function f(e){return(e-r.x)/r.scale}function d(e){return(e-r.y)/r.scale}n.minX=Math.round(c*i/e)/c,n.minY=Math.round(c*-a/e)/c,n.maxX=Math.round(c*s/e)/c,n.maxY=Math.round(c*-u/e)/c,ke.a.fire("bbox-change",n)}function I(e){s.backgroundColor=e}}var bn=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"===typeof Reflect?"undefined":f()(Reflect))&&"function"===typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},_n=this&&this.__metadata||function(e,t){if("object"===("undefined"===typeof Reflect?"undefined":f()(Reflect))&&"function"===typeof Reflect.metadata)return Reflect.metadata(e,t)},xn=function(e){function t(){var e;return i()(this,t),e=s()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments)),e.timeStep=.01,e.dropProbability=.009,e.fadeout=.998,e}return c()(t,e),v()(t,[{key:"mounted",value:function(){var e=this.$el,t={antialias:!0,alpha:!1},n=e.getContext("webgl",t)||e.getContext("experimental-webgl",t);this.scene=yn(n),this.scene.setParticlesCount(this.particleCount),this.scene.setBackgroundColor({r:.05,g:0,b:.1,a:1}),this.scene.setDropProbability(.001),this.updateVectorField(),this.updateColorFunction(),this.scene.setColorMode(Re.VELOCITY),this.actuallyPaused||this.scene.start()}},{key:"beforeDestroy",value:function(){this.scene.dispose(),this.$el.remove()}},{key:"formatNumberforGLSL",value:function(e){return y.a.isNaN(e)?"0.":e.toFixed(4)}},{key:"updateVectorField",value:function(){this.scene&&this.scene.vectorFieldEditorState.setCode(this.GLSLcode)}},{key:"updateColorFunction",value:function(){this.scene&&this.scene.setColorFunction(this.colorFunction)}},{key:"GLSLcodeUpdated",value:function(){this.updateVectorField()}},{key:"colorFunctionToUpdate",value:function(){this.updateColorFunction()}},{key:"togglePause",value:function(){this.scene&&this.scene[this.actuallyPaused?"stop":"start"]()}},{key:"updateParticleCount",value:function(){this.scene&&this.scene.setParticlesCount(this.particleCount)}},{key:"render",value:function(e){return e("canvas",{class:"brain-particles"})}},{key:"actuallyPaused",get:function(){return this.paused&&this.n>0}},{key:"particleCount",get:function(){return Math.max(this.n*(window.innerHeight*window.innerWidth)/5e3*Math.pow(window.devicePixelRatio,2),1)}},{key:"GLSLcode",get:function(){var e=[];if(e.push("v.x = 0.;"),e.push("v.y = 0.;"),e.push("float tau = acos(0.);"),e.push("float pi = tau / 2.;"),e.push("float l = length(p);"),this.k1>0){var t={x:"p.y",y:"-p.x"};e.push("v.x += pow(".concat(this.formatNumberforGLSL(this.k1),", 2.) * (").concat(t.x,") / pow(max(1., abs(3. * l) - 2. * tau), 3.);")),e.push("v.y += pow(".concat(this.formatNumberforGLSL(this.k1),", 2.) * (").concat(t.y,") / pow(max(1., abs(3. * l) - 2. * tau), 3.);"))}if(this.k2>0){var n={x:"sign(sin(p.y * 4.)) / 2. + (1. - ".concat(this.formatNumberforGLSL(this.k2),") * sin(p.y * 4.)"),y:"sign(-1. * sin(p.x * 4.)) / 2. - (1. - ".concat(this.formatNumberforGLSL(this.k2),") * sin(p.x * 4.)")};e.push("float d = (abs(p.x) + abs(p.y)) * 2. / 3.;"),e.push("if ( (d < tau) && (d > pi / 2.) ) {"),e.push("v.x += pow(".concat(this.formatNumberforGLSL(this.k2),", 3.) * (").concat(n.x,");")),e.push("v.y += pow(".concat(this.formatNumberforGLSL(this.k2),", 3.) * (").concat(n.y,");")),e.push("}")}var r=Math.pow((1-Math.max(this.k1,this.k2))*Math.pow(this.k1+this.k2,2),2);return e.push("v.x += ".concat(this.formatNumberforGLSL(r)," * p.x / pow(l, 2.);")),e.push("v.y += ".concat(this.formatNumberforGLSL(r)," * p.y / pow(l, 2.);")),e.push("v.x /= 2.;"),e.push("v.y /= 2.;"),"\n    vec2 get_velocity(vec2 p) {\n      vec2 v = vec2(0., 0.);\n\n      ".concat(e.join("\n"),"\n\n      return v;\n    }")}},{key:"colorFunction",get:function(){var e=Math.pow((this.k2-this.k1)/2+.5,2);return"\n      vec4 get_color(vec2 p) {\n        vec2 velocity = get_velocity(p);\n        float speed = (length(velocity) - u_velocity_range[0])/(u_velocity_range[1] - u_velocity_range[0]);\n        float hue = 0.05 + (1. - speed) * 0.5;\n        float hue1 = 1. - pow(hue, 3.) / 2. + 0.15;\n        float hue2 = .5 + pow(hue, 3.) / 2.;\n        hue = ".concat(this.formatNumberforGLSL(e)," * hue1 + (1. - ").concat(this.formatNumberforGLSL(e),") * hue2;\n        return vec4(hsv2rgb(vec3(hue, 0.9, 1.)), 1.0);\n      }")}}]),t}(d["Vue"]);bn([Object(d["Prop"])({required:!0}),_n("design:type",Number)],xn.prototype,"k1",void 0),bn([Object(d["Prop"])({required:!0}),_n("design:type",Number)],xn.prototype,"k2",void 0),bn([Object(d["Prop"])({required:!0}),_n("design:type",Number)],xn.prototype,"n",void 0),bn([Object(d["Prop"])({default:!1}),_n("design:type",Boolean)],xn.prototype,"paused",void 0),bn([Object(d["Watch"])("GLSLcode"),_n("design:type",Function),_n("design:paramtypes",[]),_n("design:returntype",void 0)],xn.prototype,"GLSLcodeUpdated",null),bn([Object(d["Watch"])("colorFunction"),_n("design:type",Function),_n("design:paramtypes",[]),_n("design:returntype",void 0)],xn.prototype,"colorFunctionToUpdate",null),bn([Object(d["Watch"])("actuallyPaused"),_n("design:type",Function),_n("design:paramtypes",[]),_n("design:returntype",void 0)],xn.prototype,"togglePause",null),bn([Object(d["Watch"])("particleCount"),_n("design:type",Function),_n("design:paramtypes",[]),_n("design:returntype",void 0)],xn.prototype,"updateParticleCount",null),xn=bn([d["Component"]],xn);var wn,Tn,Pn=xn;function En(e){n("Rni/")}var Sn=!1,kn=En,Cn="data-v-f76823fc",Mn=null,Rn=Object(R["a"])(Pn,wn,Tn,Sn,kn,Cn,Mn),On=Rn.exports,Fn=n("U0v6"),An=n.n(Fn),Nn=n("QxPg"),Dn=n("Os+h"),Bn=n.n(Dn),In=n("fAhp"),Un=n.n(In),jn=n("nIHM"),Ln=n.n(jn),Gn=n("T0ZZ"),Xn=n.n(Gn),Yn=n("gKoC"),zn=n.n(Yn),Wn=n("12ZA"),Vn=n.n(Wn),qn=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"===typeof Reflect?"undefined":f()(Reflect))&&"function"===typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Hn=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r["throw"](e))}catch(e){i(e)}}function u(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,s)}u((r=r.apply(e,t||[])).next())})};Nn["default"].library.add(Bn.a,Un.a,Ln.a,Xn.a,zn.a,Vn.a);var Qn=function(e){function t(){var e;return i()(this,t),e=s()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments)),e.connectionStatus=!1,e.sessionInProgress=!1,e.currentSession=[],e.k1=0,e.k2=0,e.n=0,e.paused=!0,e.sessionsDetailsOpened=!1,e}return c()(t,e),v()(t,[{key:"created",value:function(){this.museClient=new b["MuseClient"]}},{key:"connectToMuse",value:function(){return Hn(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.museClient.connect();case 2:return e.next=4,this.museClient.start();case 4:this.startSession(),this.museClient.connectionStatus.subscribe(function(e){return t.connectionStatus=e});case 6:case"end":return e.stop()}},e,this)}))}},{key:"startSession",value:function(){var e=this;this.currentSession=[],this.currentSessionSubscription=this.museClient.relativeBandPowers.pipe(Object(_["bufferCount"])(100,25),Object(_["map"])(function(e){return Object.keys(b["POWER_BANDS"]).map(function(t){return{band:b["POWER_BANDS"][t],power:e.map(function(e){var n=e.find(function(e){return e.band.id==b["POWER_BANDS"][t].id});return n?n.power:NaN}).reduce(function(e,t){return e+t},0)/e.length}})}),Object(_["map"])(function(e){var t={};return e.forEach(function(e){return t[e.band.id]=e.power}),t})).subscribe(function(t){y.a.some(t,function(e){return y.a.isNaN(e)})||(e.currentSession.push(Object.freeze(t)),e.currentSession=y.a.takeRight(e.currentSession,100),e.n=Math.min(5*e.currentSession.length,100),e.k1=(t.ALPHA-Math.min.apply(Math,h()(e.currentSession.map(function(e){return e.ALPHA}))))/(Math.max.apply(Math,h()(e.currentSession.map(function(e){return e.ALPHA})))-Math.min.apply(Math,h()(e.currentSession.map(function(e){return e.ALPHA})))),e.k2=(t.GAMMA-Math.min.apply(Math,h()(e.currentSession.map(function(e){return e.GAMMA}))))/(Math.max.apply(Math,h()(e.currentSession.map(function(e){return e.GAMMA})))-Math.min.apply(Math,h()(e.currentSession.map(function(e){return e.GAMMA})))))}),this.sessionInProgress=!0,this.paused=!1}},{key:"stopSession",value:function(){this.currentSessionSubscription&&this.currentSessionSubscription.unsubscribe(),this.sessionInProgress=!1,this.paused=!0}},{key:"beforeDestroy",value:function(){this.stopSession()}}]),t}(d["Vue"]);Qn=qn([Object(d["Component"])({components:{Session:I,Visualization:K,ParticlesVisualization:ge,FieldVisualization:On,FontAwesomeIcon:An.a}})],Qn);var Jn=Qn,Zn=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"muse-recorder"},[n("div",[n("field-visualization",{attrs:{k1:e.k1,k2:e.k2,n:e.n,paused:e.paused}})],1),0==e.n?n("div",{staticClass:"muse-recorder__greeting",class:{"muse-recorder__greeting--connected":e.connectionStatus}},[n("div",{staticStyle:{"font-size":"6em"}},[e._v("Do you feel in control")]),n("div",{staticStyle:{"font-size":"4em"}},[e._v("of what's happenning")]),n("div",{staticStyle:{"font-size":"8em"}},[e._v("in your brain?")])]):e._e(),n("div",{staticClass:"muse-recorder__connection",class:{"muse-recorder__connection--connected":e.connectionStatus}},[n("font-awesome-icon",{staticClass:"muse-recorder__connection-icon",attrs:{icon:["fab",e.connectionStatus?"bluetooth-b":"bluetooth"]},on:{click:function(t){e.connectionStatus?e.disconnect():e.connectToMuse()}}})],1),n("div",{staticClass:"muse-recorder__session-control"},[n("div",{staticClass:"muse-recorder__main-controls"},[n("font-awesome-icon",{staticClass:"muse-recorder__session-control-icon",attrs:{icon:["far",e.sessionInProgress?"pause-circle":"play-circle"]},on:{click:function(t){e.sessionInProgress?e.stopSession():e.startSession()}}}),n("font-awesome-icon",{staticClass:"muse-recorder__session-details-icon",attrs:{icon:["far",e.sessionsDetailsOpened?"caret-square-down":"caret-square-up"]},on:{click:function(t){e.sessionsDetailsOpened=!e.sessionsDetailsOpened}}})],1),e.sessionsDetailsOpened?n("div",{staticClass:"muse-recorder__session-details"},[n("div",{staticClass:"muse-recorder__viz-controls"},[n("button",{on:{click:function(t){e.paused=!e.paused}}},[e._v(" Pause viz\n        ")]),n("input",{directives:[{name:"model",rawName:"v-model.number",value:e.k1,expression:"k1",modifiers:{number:!0}}],attrs:{type:"range",min:"0",max:"1",step:"0.01"},domProps:{value:e.k1},on:{__r:function(t){e.k1=e._n(t.target.value)},blur:function(t){e.$forceUpdate()}}}),n("pre",[e._v("k1: "+e._s(e.k1))]),n("input",{directives:[{name:"model",rawName:"v-model.number",value:e.k2,expression:"k2",modifiers:{number:!0}}],attrs:{type:"range",min:"0",max:"1",step:"0.01"},domProps:{value:e.k2},on:{__r:function(t){e.k2=e._n(t.target.value)},blur:function(t){e.$forceUpdate()}}}),n("pre",[e._v("k2: "+e._s(e.k2))]),n("input",{directives:[{name:"model",rawName:"v-model.number",value:e.n,expression:"n",modifiers:{number:!0}}],attrs:{type:"range",min:"0",max:"100",step:"1"},domProps:{value:e.n},on:{__r:function(t){e.n=e._n(t.target.value)},blur:function(t){e.$forceUpdate()}}}),n("pre",[e._v("n: "+e._s(e.n))])]),e.currentSession.length?n("Session",{attrs:{sessionData:e.currentSession}}):n("div",[e._v("\n        No session data\n      ")])],1):e._e()])])},Kn=[];function $n(e){n("GIte")}var er=!1,tr=$n,nr="data-v-0b9ae5cd",rr=null,or=Object(R["a"])(Jn,Zn,Kn,er,tr,nr,rr),ir=or.exports,ar=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"===typeof Reflect?"undefined":f()(Reflect))&&"function"===typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},sr=function(e){function t(){return i()(this,t),s()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return c()(t,e),t}(d["Vue"]);sr=ar([Object(d["Component"])({components:{MuseRecorder:ir}})],sr);var ur=sr,cr=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"muse-recorder-app"}},[n("MuseRecorder")],1)},lr=[];function fr(e){n("G3BA")}var dr=!1,pr=fr,hr=null,mr=null,vr=Object(R["a"])(ur,cr,lr,dr,pr,hr,mr),gr=vr.exports,yr=n("NYxO");r["default"].use(yr["a"]);var br=new yr["a"].Store({state:{},mutations:{},actions:{}}),_r=n("ydGU");Object(_r["a"])("".concat("/","service-worker.js"),{ready:function(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},cached:function(){console.log("Content has been cached for offline use.")},updated:function(){console.log("New content is available; please refresh.")},offline:function(){console.log("No internet connection found. App is running in offline mode.")},error:function(e){console.error("Error during service worker registration:",e)}}),r["default"].config.productionTip=!1,new r["default"]({store:br,render:function(e){return e(gr)}}).$mount("#app")}},[0]);
//# sourceMappingURL=app.f695770f.js.map